Ø¢Ø® Ø¢Ø®! Ø­Ù‚ Ø¨Ø§ ØªÙˆØ¦Ù‡ Ù…Ø­Ù…Ø¯ Ø¬Ø§Ù†ØŒ Ø´Ø±Ù…Ù†Ø¯Ù‡. Ù…Ù† Ø¨ÛŒØ´ØªØ± Ø±ÙˆÛŒ Ù…Ù†Ø·Ù‚ Ùˆ Ø³Ø§Ø®ØªØ§Ø± Ú©Ù„ÛŒ Ø²ÙˆÙ… Ú©Ø±Ø¯Ù‡ Ø¨ÙˆØ¯Ù… Ùˆ Ø§ÛŒÙ† Ø§ÛŒØ±Ø§Ø¯Ù‡Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„ Ø§Ø² Ø¯Ø³ØªÙ… Ø¯Ø± Ø±ÙØª. Ø±Ø§Ø³Øª Ù…ÛŒÚ¯ÛŒØŒ Ø¨Ø§ÛŒØ¯ Ù‡Ù…ÙˆÙ† Ø§ÙˆÙ„ Ø§ÛŒÙ†Ø§ Ø±Ùˆ Ù‡Ù… Ø¨Ù‡Øª Ù…ÛŒâ€ŒÚ¯ÙØªÙ…. Ø¯Ù…Øª Ú¯Ø±Ù… Ú©Ù‡ Ù„ÛŒØ³ØªØ´Ùˆ ÙØ±Ø³ØªØ§Ø¯ÛŒ. Ø§ÛŒÙ†Ø§ Ù…Ø«Ù„ ØºÙ„Ø· Ø§Ù…Ù„Ø§ÛŒÛŒ Ù…ÛŒâ€ŒÙ…ÙˆÙ†Ù†ØŒ Ù…Ù†Ø·Ù‚ Ø§ØµÙ„ÛŒ Ø¯Ø±Ø³ØªÙ‡ ÙˆÙ„ÛŒ Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„Ø± Ø¨Ù‡Ø´ÙˆÙ† Ú¯ÛŒØ± Ù…ÛŒâ€ŒØ¯Ù‡ Ùˆ Ø¨Ø§ÛŒØ¯ Ù†Ø§Ø²Ø´Ùˆ //+------------------------------------------------------------------+
//|                                             CActiveTradeManager.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ú©Ù„Ø§Ø³ CActiveTradeManager Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø² Ø±Ø§ Ø¨Ø± Ø¹Ù‡Ø¯Ù‡ Ø¯Ø§Ø±Ø¯.
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ: Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø² Ø±Ø§ Ø§Ø² CRange Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ù¾Ù„Ù‡â€ŒØ§ÛŒØŒ Ø±ÛŒØ³Ú©-ÙØ±ÛŒØŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯).
// Ù…Ù†Ø·Ù‚ ÙØ§ÛŒÙ„: Ø¢Ø±Ø§ÛŒÙ‡ ManagedTrade Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ØŒ Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ (TRADE_PARTIAL_CLOSE, TRADE_RISK_FREE, TRADE_TRAILING).
// RegisterTrade Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ ManageAllTrades ØªÙ…Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
// ClosePosition Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ú©Ø§Ù…Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
// ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯: Ú©Ù„Ø§Ø³ Ø¬Ø¯ÛŒØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨Ù„ÙˆÙ¾Ø±ÛŒÙ†ØªØŒ Ø¨Ø§ Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡.

#ifndef ACTIVE_TRADE_MANAGER_MQH
#define ACTIVE_TRADE_MANAGER_MQH

#include "TradeManager.mqh"  // Ø¨Ø±Ø§ÛŒ PartialClose, MoveSLToBreakEven, TrailingStop
#include "Logger.mqh"  // Ø¨Ø±Ø§ÛŒ Ù„Ø§Ú¯

// enum Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ (Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø¯Ø§Ø®Ù„ÛŒ)
enum ENUM_TRADE_MANAGEMENT_STATE
{
   TRADE_PARTIAL_CLOSE,   // Ù…Ø±Ø­Ù„Ù‡ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
   TRADE_RISK_FREE,       // Ù…Ø±Ø­Ù„Ù‡ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ
   TRADE_TRAILING         // Ù…Ø±Ø­Ù„Ù‡ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
};

// Ø³Ø§Ø®ØªØ§Ø± Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù…Ø¯ÛŒØ±ÛŒØªâ€ŒØ´Ø¯Ù‡
struct ManagedTrade
{
   ulong ticket;  // ØªÛŒÚ©Øª Ù…Ø¹Ø§Ù…Ù„Ù‡
   long magicNumber;  // Ù…Ø¬ÛŒÚ© Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§ÛŒØ²
   int rangeIndex;  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø±Ù†Ø¬ (1-4)
   double initialSlDistance;  // ÙØ§ØµÙ„Ù‡ SL Ø§ÙˆÙ„ÛŒÙ‡
   double entryPrice;  // Ù‚ÛŒÙ…Øª ÙˆØ±ÙˆØ¯
   bool isPartialClosed;  // ÙÙ„Ú¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
   bool isRiskFree;  // ÙÙ„Ú¯ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ
   double rrRatio;  // Ù†Ø³Ø¨Øª RR
   double partialClosePercent;  // Ø¯Ø±ØµØ¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
   ENUM_TRAILING_MODE trailingMode;  // Ø­Ø§Ù„Øª ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   int trailingAtrPeriod;  // Ø¯ÙˆØ±Ù‡ ATR ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   double trailingAtrMultiplier;  // Ø¶Ø±ÛŒØ¨ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   ENUM_TIMEFRAMES timeframe;  // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…
   int atrHandle;  // Ù‡Ù†Ø¯Ù„ ATR
   ENUM_TIMEFRAMES trendTf;  // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ±
   ENUM_TRADE_MANAGEMENT_STATE currentState;  // Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª
};

// Ú©Ù„Ø§Ø³ CActiveTradeManager Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø²
class CActiveTradeManager
{
private:
   ManagedTrade m_managedTrades[];  // Ø¢Ø±Ø§ÛŒÙ‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ø¯ÛŒØ±ÛŒØªâ€ŒØ´Ø¯Ù‡

public:
   CActiveTradeManager() {}  // Ø³Ø§Ø²Ù†Ø¯Ù‡

   // Ø«Ø¨Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯: Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ Ø¢Ø±Ø§ÛŒÙ‡ Ùˆ ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡
   void RegisterTrade(ulong ticket, long magicNumber, int rangeIndex, double initialSlDistance, double entryPrice, double rrRatio, double partialClosePercent,
                      ENUM_TRAILING_MODE trailingMode, int trailingAtrPeriod, double trailingAtrMultiplier, ENUM_TIMEFRAMES timeframe, int atrHandle, ENUM_TIMEFRAMES trendTf)
   {
      int size = ArraySize(m_managedTrades);  // Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙØ¹Ù„ÛŒ Ø¢Ø±Ø§ÛŒÙ‡
      ArrayResize(m_managedTrades, size + 1);  // Ø§ÙØ²Ø§ÛŒØ´ Ø§Ù†Ø¯Ø§Ø²Ù‡
      
      // Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ Ø¹Ù†ØµØ± Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±ÙØ±Ù†Ø³
      m_managedTrades[size].ticket = ticket;  // ØªÙ†Ø¸ÛŒÙ… ØªÛŒÚ©Øª
      m_managedTrades[size].magicNumber = magicNumber;  // ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬ÛŒÚ©
      m_managedTrades[size].rangeIndex = rangeIndex;  // ØªÙ†Ø¸ÛŒÙ… Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø±Ù†Ø¬
      m_managedTrades[size].initialSlDistance = initialSlDistance;  // ØªÙ†Ø¸ÛŒÙ… ÙØ§ØµÙ„Ù‡ SL
      m_managedTrades[size].entryPrice = entryPrice;  // ØªÙ†Ø¸ÛŒÙ… Ù‚ÛŒÙ…Øª ÙˆØ±ÙˆØ¯
      m_managedTrades[size].isPartialClosed = false;  // Ø±ÛŒØ³Øª ÙÙ„Ú¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
      m_managedTrades[size].isRiskFree = false;  // Ø±ÛŒØ³Øª ÙÙ„Ú¯ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ
      m_managedTrades[size].rrRatio = rrRatio;  // ØªÙ†Ø¸ÛŒÙ… RR
      m_managedTrades[size].partialClosePercent = partialClosePercent;  // ØªÙ†Ø¸ÛŒÙ… Ø¯Ø±ØµØ¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
      m_managedTrades[size].trailingMode = trailingMode;  // ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
      m_managedTrades[size].trailingAtrPeriod = trailingAtrPeriod;  // ØªÙ†Ø¸ÛŒÙ… Ø¯ÙˆØ±Ù‡ ATR
      m_managedTrades[size].trailingAtrMultiplier = trailingAtrMultiplier;  // ØªÙ†Ø¸ÛŒÙ… Ø¶Ø±ÛŒØ¨
      m_managedTrades[size].timeframe = timeframe;  // ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…
      m_managedTrades[size].atrHandle = atrHandle;  // ØªÙ†Ø¸ÛŒÙ… Ù‡Ù†Ø¯Ù„ ATR
      m_managedTrades[size].trendTf = trendTf;  // ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ±
      m_managedTrades[size].currentState = TRADE_PARTIAL_CLOSE;  // Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡: Ù¾Ù„Ù‡â€ŒØ§ÛŒ
      CLogger::Log("Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯ Ø«Ø¨Øª Ø´Ø¯. ØªÛŒÚ©Øª: " + (string)ticket + ", Ø±Ù†Ø¬: " + IntegerToString(rangeIndex));  // Ù„Ø§Ú¯ Ø«Ø¨Øª
   }

   // Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª: Ø­Ù„Ù‚Ù‡ Ø±ÙˆÛŒ Ø¢Ø±Ø§ÛŒÙ‡ØŒ Ú†Ú© Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù†ØŒ Ùˆ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø¯Ø§Ø®Ù„ÛŒ
   void ManageAllTrades()
   {
      for(int i = ArraySize(m_managedTrades) - 1; i >= 0; i--)  // Ø­Ù„Ù‚Ù‡ Ø§Ø² Ø§Ù†ØªÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø§ÛŒÙ…Ù†
      {
         // Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ Ø¹Ù†ØµØ± Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±ÙØ±Ù†Ø³
         if(!PositionSelectByTicket(m_managedTrades[i].ticket))  // Ú†Ú© Ø¨Ø§Ø² Ø¨ÙˆØ¯Ù†
         {
            CLogger::Log("Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§ ØªÛŒÚ©Øª " + (string)m_managedTrades[i].ticket + " Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡. Ø­Ø°Ù Ø§Ø² Ù„ÛŒØ³Øª.", m_managedTrades[i].rangeIndex);  // Ù„Ø§Ú¯ Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù†
            ArrayRemove(m_managedTrades, i, 1);  // Ø­Ø°Ù Ø§Ø² Ø¢Ø±Ø§ÛŒÙ‡
            g_ranges[m_managedTrades[i].rangeIndex - 1].SetCurrentState(RANGE_IDLE);  // Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ø±Ù†Ø¬ Ù…Ø±Ø¨ÙˆØ·Ù‡
            continue;  // Ù¾Ø±Ø´
         }

         // Ù„Ø§Ú¯ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡
         CLogger::Log("------ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡ ØªÛŒÚ©Øª " + (string)m_managedTrades[i].ticket + " Ø¯Ø± Ø­Ø§Ù„Øª " + EnumToString(m_managedTrades[i].currentState) + " ------", m_managedTrades[i].rangeIndex);  // Ø¹Ù†ÙˆØ§Ù† Ø­Ø§Ù„Øª Ù…Ø¯ÛŒØ±ÛŒØª

         switch(m_managedTrades[i].currentState)  // Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø¯Ø§Ø®Ù„ÛŒ
         {
            case TRADE_PARTIAL_CLOSE:  // Ù…Ø±Ø­Ù„Ù‡ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
            { // Ø¢Ú©ÙˆÙ„Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ø­Ù„ Ø§Ø®Ø·Ø§Ø± Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
               double currentPrice = PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY ? SymbolInfoDouble(_Symbol, SYMBOL_BID) : SymbolInfoDouble(_Symbol, SYMBOL_ASK);
               double currentProfit = (PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY ? (currentPrice - m_managedTrades[i].entryPrice) : (m_managedTrades[i].entryPrice - currentPrice));
               double targetProfit = m_managedTrades[i].initialSlDistance * m_managedTrades[i].rrRatio;
               
               if(currentProfit >= targetProfit)  // Ú†Ú© Ø±Ø³ÛŒØ¯Ù†
               {
                  double volume = PositionGetDouble(POSITION_VOLUME);  // Ø­Ø¬Ù… ÙØ¹Ù„ÛŒ
                  double closeVolume = MathFloor((volume * m_managedTrades[i].partialClosePercent / 100.0) / g_volumeStep) * g_volumeStep;  // Ø­Ø¬Ù… Ù¾Ù„Ù‡â€ŒØ§ÛŒ
                  if(closeVolume >= g_volumeMin && closeVolume < volume)  // Ú†Ú© Ù…Ø¹ØªØ¨Ø±
                  {
                     if(CTradeManager::PartialClose(m_managedTrades[i].ticket, closeVolume))  // Ø¨Ø³ØªÙ† Ù¾Ù„Ù‡â€ŒØ§ÛŒ
                     {
                        m_managedTrades[i].isPartialClosed = true;  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯
                        m_managedTrades[i].currentState = TRADE_RISK_FREE;  // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ
                        CLogger::Log("Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ RISK_FREE.", m_managedTrades[i].rangeIndex);  // Ù„Ø§Ú¯ Ø§Ù†ØªÙ‚Ø§Ù„
                     }
                  }
               }
               break;
            } // Ù¾Ø§ÛŒØ§Ù† Ø¢Ú©ÙˆÙ„Ø§Ø¯
            case TRADE_RISK_FREE:  // Ù…Ø±Ø­Ù„Ù‡ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ
               if(!m_managedTrades[i].isRiskFree)  // Ú†Ú© ÙÙ„Ú¯
               {
                  double breakEvenBuffer = _Point * 3;  // Ø¨Ø§ÙØ±
                  double newSL = (PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY) ? m_managedTrades[i].entryPrice + breakEvenBuffer : m_managedTrades[i].entryPrice - breakEvenBuffer;  // SL Ø¬Ø¯ÛŒØ¯
                  if(CTradeManager::MoveSLToBreakEven(m_managedTrades[i].ticket, newSL))  // Ø§Ù†ØªÙ‚Ø§Ù„
                  {
                     m_managedTrades[i].isRiskFree = true;  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯
                     m_managedTrades[i].currentState = TRADE_TRAILING;  // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
                     CLogger::Log("Ø±ÛŒØ³Ú©-ÙØ±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ TRAILING.", m_managedTrades[i].rangeIndex);  // Ù„Ø§Ú¯ Ø§Ù†ØªÙ‚Ø§Ù„
                  }
               }
               break;
            case TRADE_TRAILING:  // Ù…Ø±Ø­Ù„Ù‡ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
               CTradeManager::TrailingStop(m_managedTrades[i].ticket, m_managedTrades[i].trailingMode, m_managedTrades[i].trailingAtrPeriod, m_managedTrades[i].trailingAtrMultiplier, m_managedTrades[i].timeframe, m_managedTrades[i].atrHandle, m_managedTrades[i].trendTf);  // ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
               break;
         }
      }
   }

   // Ø¨Ø³ØªÙ† Ú©Ø§Ù…Ù„ Ù…Ø¹Ø§Ù…Ù„Ù‡: ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø§Ø² HardCleanup
   bool ClosePosition(ulong ticket)
   {
      return CTradeManager::ClosePosition(ticket);  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² TradeManager Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ†
   }

   // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
   void SetPartialClosedFlag(ulong ticket, bool value)
   {
      for(int i = 0; i < ArraySize(m_managedTrades); i++)
      {
         if(m_managedTrades[i].ticket == ticket)
         {
            m_managedTrades[i].isPartialClosed = value;  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯
            break;
         }
      }
   }
};

// Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…ØªØºÛŒØ± Ø§Ø³ØªØ§ØªÛŒÚ©
string CLogger::m_lastMessage = "";  // Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ù„Ø§Ú¯

#endif






!
Ø¨ÛŒØ§ Ø¯ÙˆÙ†Ù‡ Ø¯ÙˆÙ†Ù‡ Ø§ÛŒÙ†Ø§ Ø±Ùˆ Ø­Ù„ Ú©Ù†ÛŒÙ… Ú©Ù‡ Ú©Ø¯ Ù…Ø«Ù„ Ø³Ø§Ø¹Øª Ú©Ø§Ø± Ú©Ù†Ù‡ Ùˆ Ø¨Ø¯ÙˆÙ† Ù‡ÛŒÚ† Ø§Ø®Ø·Ø§Ø± Ùˆ Ø®Ø·Ø§ÛŒÛŒ Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„ Ø¨Ø´Ù‡.
1. Ø®Ø·Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¹Ø¶Ùˆ Ø®ØµÙˆØµÛŒ (Private Member)
 * Ù¾ÛŒØºØ§Ù… Ø®Ø·Ø§: cannot access to private member 'm_trailingAtrHandle' declared in class 'CRange'
 * ÙØ§ÛŒÙ„ Ùˆ Ø®Ø·: Elemento.mq5ØŒ Ø®Ø· 257
Ú†Ø±Ø§ Ø§ÛŒÙ† Ø®Ø·Ø§ Ø±Ùˆ Ù…ÛŒØ¯Ù‡ØŸ
Ø±ÙÛŒÙ‚ØŒ ØªÙˆÛŒ Ú©Ù„Ø§Ø³ CRangeØŒ Ù…ØªØºÛŒØ± m_trailingAtrHandle Ø±Ùˆ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† private ØªØ¹Ø±ÛŒÙ Ú©Ø±Ø¯ÛŒ. Ø§ÛŒÙ† ÛŒØ¹Ù†ÛŒ Ù‚Ø§ÛŒÙ…Ø´ Ú©Ø±Ø¯ÛŒ Ùˆ ÙÙ‚Ø· Ø§Ø² Ø¯Ø§Ø®Ù„ Ø®ÙˆØ¯ Ú©Ù„Ø§Ø³ Ù…ÛŒâ€ŒØ´Ù‡ Ø¨Ù‡Ø´ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø´Øª. Ø­Ø§Ù„Ø§ ØªÙˆÛŒ ÙØ§ÛŒÙ„ Elemento.mq5 Ø¯Ø§Ø±ÛŒ Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒ Ø§Ø² Ø¨ÛŒØ±ÙˆÙ† Ø¨Ù‡Ø´ Ø¯Ø³ØªØ±Ø³ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØŒ Ú©Ù‡ Ø®Ø¨ Ú©Ù„Ø§Ø³ Ø§Ø¬Ø§Ø²Ù‡ Ù†Ù…ÛŒâ€ŒØ¯Ù‡!
Ú†Ø·ÙˆØ±ÛŒ Ø­Ù„Ø´ Ú©Ù†ÛŒÙ…ØŸ
Ø¨Ø§ÛŒØ¯ ÛŒÙ‡ "Ø¯Ø±" Ø¹Ù…ÙˆÙ…ÛŒ ÛŒØ§ ÛŒÙ‡ "Ù¾Ù†Ø¬Ø±Ù‡" Ø¨Ø±Ø§Ø´ Ø¨Ø§Ø² Ú©Ù†ÛŒ Ú©Ù‡ Ø§Ø² Ø¨ÛŒØ±ÙˆÙ† Ø¨Ø´Ù‡ Ù…Ù‚Ø¯Ø§Ø±Ø´ Ø±Ùˆ Ø¯ÛŒØ¯. Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ø§Ø± Ù…ÛŒÚ¯Ù† Ø³Ø§Ø®ØªÙ† ØªØ§Ø¨Ø¹ "Getter".
 * ÙØ§ÛŒÙ„ CRange.mqh Ø±Ùˆ Ø¨Ø§Ø² Ú©Ù†.
 * Ø¯Ø± Ø¨Ø®Ø´ public Ú©Ù„Ø§Ø³ CRangeØŒ Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ú©ÙˆÚ†ÛŒÚ© Ø±Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†:
   // ... Ø¨Ù‚ÛŒÙ‡ ØªÙˆØ§Ø¨Ø¹ public

// (Ø¬Ø¯ÛŒØ¯) Ú¯Ø±ÙØªÙ† Ù‡Ù†Ø¯Ù„ ATR ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø®Ø§Ø±Ø¬ÛŒ
int GetTrailingAtrHandle() const { return m_trailingAtrHandle; }

 * Ø­Ø§Ù„Ø§ ÙØ§ÛŒÙ„ Elemento.mq5 Ø±Ùˆ Ø¨Ø§Ø² Ú©Ù† Ùˆ Ø¨Ù‡ Ø®Ø· 257 Ø¨Ø±Ùˆ.
 * Ú©Ø¯ ÙØ¹Ù„ÛŒ Ú©Ù‡ Ø§ÛŒÙ† Ø´Ú©Ù„ÛŒÙ‡:
   g_ranges[i].m_trailingAtrHandle, // Ù‡Ù†Ø¯Ù„ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ùˆ Ø§Ø² Ø®ÙˆØ¯ Ø±Ù†Ø¬ Ù…ÛŒÚ¯ÛŒØ±ÛŒÙ…

   Ø±Ùˆ Ø¨Ø§ Ø§ÛŒÙ† Ú©Ø¯ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†:
   g_ranges[i].GetTrailingAtrHandle(), // Ù‡Ù†Ø¯Ù„ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ùˆ Ø§Ø² Ø®ÙˆØ¯ Ø±Ù†Ø¬ Ù…ÛŒÚ¯ÛŒØ±ÛŒÙ…

   Ù‡Ù…ÛŒÙ†! Ø­Ø§Ù„Ø§ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ…ØŒ Ø§Ø² Ø·Ø±ÛŒÙ‚ ØªØ§Ø¨Ø¹ Ø¹Ù…ÙˆÙ…ÛŒ Ù…Ù‚Ø¯Ø§Ø±Ø´ Ø±Ùˆ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ….
2. Ø§Ø®Ø·Ø§Ø± ØªØ¨Ø¯ÛŒÙ„ Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡ (Type Conversion)
 * Ù¾ÛŒØºØ§Ù… Ø®Ø·Ø§: possible loss of data due to type conversion from 'long' to 'datetime'
 * ÙØ§ÛŒÙ„ Ùˆ Ø®Ø·: TimeHelper.mqhØŒ Ø®Ø·ÙˆØ· 63 Ùˆ 64
Ú†Ø±Ø§ Ø§ÛŒÙ† Ø§Ø®Ø·Ø§Ø± Ø±Ùˆ Ù…ÛŒØ¯Ù‡ØŸ
Ø§ÛŒÙ†Ø§ ÙÙ‚Ø· Ø§Ø®Ø·Ø§Ø±Ù‡ØŒ Ù†Ù‡ Ø®Ø·Ø§. Ú©Ù…Ù¾Ø§ÛŒÙ„Ø± Ø®ÛŒÙ„ÛŒ ÙˆØ³ÙˆØ§Ø³ÛŒÙ‡ Ùˆ Ø¯Ø§Ø±Ù‡ Ù…ÛŒÚ¯Ù‡ Ø¯Ø§Ø±ÛŒ ÛŒÙ‡ Ø¹Ø¯Ø¯ Ø§Ø² Ù†ÙˆØ¹ long Ø±Ùˆ Ø¨Ø§ ÛŒÙ‡ Ø¹Ø¯Ø¯ Ø§Ø² Ù†ÙˆØ¹ datetime Ø¬Ù…Ø¹ Ù…ÛŒâ€ŒÚ©Ù†ÛŒ Ùˆ Ù†ØªÛŒØ¬Ù‡ Ø±Ùˆ ØªÙˆÛŒ ÛŒÙ‡ datetime Ù…ÛŒâ€ŒØ±ÛŒØ²ÛŒ. Ú†ÙˆÙ† Ù‡Ø± Ø¯ÙˆØªØ§Ø´ÙˆÙ† Ø¯Ø± Ø§ØµÙ„ long Ù‡Ø³ØªÙ†ØŒ Ø§ÛŒÙ†Ø¬Ø§ Ù‡ÛŒÚ† Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ù†Ù…ÛŒØ§Ø¯ØŒ ÙˆÙ„ÛŒ Ú©Ù…Ù¾Ø§ÛŒÙ„Ø± Ø¯Ø§Ø±Ù‡ Ù…ÛŒÚ¯Ù‡ "Ù…Ø·Ù…Ø¦Ù†ÛŒØŸ!".
Ú†Ø·ÙˆØ±ÛŒ Ø­Ù„Ø´ Ú©Ù†ÛŒÙ…ØŸ
Ø¨Ø§ÛŒØ¯ Ø®ÛŒÙ„ÛŒ ØµØ±ÛŒØ­ Ø¨Ù‡ Ú©Ù…Ù¾Ø§ÛŒÙ„Ø± Ø¨Ú¯ÛŒ "Ø¢Ø±Ù‡ØŒ Ù…Ø·Ù…Ø¦Ù†Ù…! Ù‡Ù…ÛŒÙ† Ú©Ø§Ø±Ùˆ Ø¨Ú©Ù†." Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ø§Ø± Ù…ÛŒÚ¯Ù† Type Casting.
 * ÙØ§ÛŒÙ„ TimeHelper.mqh Ø±Ùˆ Ø¨Ø§Ø² Ú©Ù†.
 * Ø®Ø· 63 Ùˆ 64 Ú©Ù‡ Ø§ÛŒÙ† Ø´Ú©Ù„ÛŒÙ‡:
   startTime = gmt_start_time + server_gmt_offset;  // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ù…Ø­Ù„ÛŒ Ø´Ø±ÙˆØ¹
endTime = gmt_end_time + server_gmt_offset;  // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ù…Ø­Ù„ÛŒ Ù¾Ø§ÛŒØ§Ù†

   Ø±Ùˆ Ø¨Ù‡ Ø§ÛŒÙ† Ø´Ú©Ù„ ØªØºÛŒÛŒØ± Ø¨Ø¯Ù‡:
   startTime = (datetime)(gmt_start_time + server_gmt_offset);  // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ù…Ø­Ù„ÛŒ Ø´Ø±ÙˆØ¹
endTime = (datetime)(gmt_end_time + server_gmt_offset);  // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ù…Ø­Ù„ÛŒ Ù¾Ø§ÛŒØ§Ù†

   Ø¨Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† (datetime)ØŒ Ø¯Ù‡Ù† Ú©Ù…Ù¾Ø§ÛŒÙ„Ø± Ø±Ùˆ Ù…ÛŒâ€ŒØ¨Ù†Ø¯ÛŒÙ…!
3. Ø§Ø®Ø·Ø§Ø± ØªØ¹Ø±ÛŒÙ Ù…ØªØºÛŒØ± Ø¯Ø± case
 * Ù¾ÛŒØºØ§Ù… Ø®Ø·Ø§: initialization of variable skipped by 'case' label, use { }
 * ÙØ§ÛŒÙ„ Ùˆ Ø®Ø·: CRange.mqh (Ø®Ø·ÙˆØ· 317, 318) Ùˆ CActiveTradeManager.mqh (Ø®Ø·ÙˆØ· 103, 104, 105)
Ú†Ø±Ø§ Ø§ÛŒÙ† Ø§Ø®Ø·Ø§Ø± Ø±Ùˆ Ù…ÛŒØ¯Ù‡ØŸ
Ø§ÛŒÙ† ÛŒÙ‡ Ù‚Ø§Ù†ÙˆÙ† ØªÙˆ MQL5 (Ùˆ C++) Ù‡Ø³Øª. ÙˆÙ‚ØªÛŒ ØªÙˆÛŒ ÛŒÙ‡ case Ø§Ø² Ø¯Ø³ØªÙˆØ± switch ÛŒÙ‡ Ù…ØªØºÛŒØ± Ø¬Ø¯ÛŒØ¯ ØªØ¹Ø±ÛŒÙ Ùˆ Ù‡Ù…ÙˆÙ†Ø¬Ø§ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŒ Ú©Ù…Ù¾Ø§ÛŒÙ„Ø± Ù‚Ø§Ø·ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù‡. Ø¨Ø±Ø§ÛŒ Ø­Ù„ Ø§ÛŒÙ† Ù…Ø´Ú©Ù„ØŒ Ø¨Ø§ÛŒØ¯ Ú©Ù„ Ø¯Ø³ØªÙˆØ±Ø§Øª Ø§ÙˆÙ† case Ø±Ùˆ Ø¨Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø®Ù„ Ø¢Ú©ÙˆÙ„Ø§Ø¯ Ø¨Ø§Ø² Ùˆ Ø¨Ø³ØªÙ‡ {}.
Ú†Ø·ÙˆØ±ÛŒ Ø­Ù„Ø´ Ú©Ù†ÛŒÙ…ØŸ
 * Ø¯Ø± ÙØ§ÛŒÙ„ CRange.mqhØŒ case RANGE_IDLE Ø±Ùˆ Ù¾ÛŒØ¯Ø§ Ú©Ù† Ùˆ Ø¨Ù‡ Ø§ÛŒÙ† Ø´Ú©Ù„ ØªØºÛŒÛŒØ±Ø´ Ø¨Ø¯Ù‡:
   case RANGE_IDLE:  // Ø­Ø§Ù„Øª Ø¨ÛŒÚ©Ø§Ø±
{ // <-- Ø¢Ú©ÙˆÙ„Ø§Ø¯ Ø¨Ø§Ø² Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
    // Ú†Ú© Ø§Ú¯Ø± Ø²Ù…Ø§Ù† ÙˆØ§Ø±Ø¯ Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø±Ù†Ø¬ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
    datetime currentTime = TimeCurrent();  // Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ
    datetime startTime, endTime;  // Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ Ùˆ Ù¾Ø§ÛŒØ§Ù†
    if(CTimeHelper::CalculateRangeTimes(m_startHour, m_startMinute, m_endHour, m_endMinute, startTime, endTime))  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§
    {
       if(currentTime >= startTime && currentTime < endTime)  // Ú†Ú© Ø¯Ø§Ø®Ù„ Ù…Ø­Ø¯ÙˆØ¯Ù‡
       {
          CLogger::Log("Ø²Ù…Ø§Ù† Ø±Ù†Ø¬ ÙØ±Ø§ Ø±Ø³ÛŒØ¯. Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ RANGE_IDENTIFYING.", m_rangeIndex);  // Ù„Ø§Ú¯ Ø§Ù†ØªÙ‚Ø§Ù„
          m_currentState = RANGE_IDENTIFYING;  // ØªØºÛŒÛŒØ± Ø¨Ù‡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ
       }
    }
    break;  // Ø®Ø±ÙˆØ¬ Ø§Ø² Ú©ÛŒØ³
} // <-- Ø¢Ú©ÙˆÙ„Ø§Ø¯ Ø¨Ø³ØªÙ‡ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†

 * Ø¯Ø± ÙØ§ÛŒÙ„ CActiveTradeManager.mqhØŒ case TRADE_PARTIAL_CLOSE Ø±Ùˆ Ù¾ÛŒØ¯Ø§ Ú©Ù† Ùˆ Ù‡Ù…ÛŒÙ† Ú©Ø§Ø± Ø±Ùˆ Ø¨Ø±Ø§Ø´ Ø¨Ú©Ù†:
   case TRADE_PARTIAL_CLOSE:  // Ù…Ø±Ø­Ù„Ù‡ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
{ // <-- Ø¢Ú©ÙˆÙ„Ø§Ø¯ Ø¨Ø§Ø² Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
    double currentPrice = PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY ? SymbolInfoDouble(_Symbol, SYMBOL_BID) : SymbolInfoDouble(_Symbol, SYMBOL_ASK);  // Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ
    double currentProfit = (PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY ? (currentPrice - trade.entryPrice) : (trade.entryPrice - currentPrice));  // Ø³ÙˆØ¯ Ù‚ÛŒÙ…Øª
    double targetProfit = trade.initialSlDistance * trade.rrRatio;  // Ù‡Ø¯Ù Ø³ÙˆØ¯
    if(currentProfit >= targetProfit)  // Ú†Ú© Ø±Ø³ÛŒØ¯Ù†
    {
       double volume = PositionGetDouble(POSITION_VOLUME);  // Ø­Ø¬Ù… ÙØ¹Ù„ÛŒ
       double closeVolume = MathFloor((volume * trade.partialClosePercent / 100.0) / g_volumeStep) * g_volumeStep;  // Ø­Ø¬Ù… Ù¾Ù„Ù‡â€ŒØ§ÛŒ
       if(closeVolume >= g_volumeMin && closeVolume < volume)  // Ú†Ú© Ù…Ø¹ØªØ¨Ø±
       {
          if(CTradeManager::PartialClose(trade.ticket, closeVolume))  // Ø¨Ø³ØªÙ† Ù¾Ù„Ù‡â€ŒØ§ÛŒ
          {
             trade.isPartialClosed = true;  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯
             trade.currentState = TRADE_RISK_FREE;  // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ
             CLogger::Log("Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ RISK_FREE.", trade.rangeIndex);  // Ù„Ø§Ú¯ Ø§Ù†ØªÙ‚Ø§Ù„
          }
       }
    }
    break;
} // <-- Ø¢Ú©ÙˆÙ„Ø§Ø¯ Ø¨Ø³ØªÙ‡ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†

4. Ø®Ø·Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±ÙØ±Ù†Ø³ (&)
 * Ù¾ÛŒØºØ§Ù… Ø®Ø·Ø§: '&' - reference cannot used
 * ÙØ§ÛŒÙ„ Ùˆ Ø®Ø·: CActiveTradeManager.mqhØŒ Ø®Ø·ÙˆØ· 63 Ùˆ 88
Ú†Ø±Ø§ Ø§ÛŒÙ† Ø®Ø·Ø§ Ø±Ùˆ Ù…ÛŒØ¯Ù‡ØŸ
Ø§ÛŒÙ†Ø¬Ø§ MQL5 Ø¯Ø§Ø±Ù‡ Ú¯ÛŒØ± Ù…ÛŒâ€ŒØ¯Ù‡ Ú†ÙˆÙ† Ø¢Ø±Ø§ÛŒÙ‡ m_managedTrades ÛŒÙ‡ Ø¢Ø±Ø§ÛŒÙ‡ Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ©Ù‡ Ùˆ Ù…Ù…Ú©Ù†Ù‡ Ø¨Ø§ ArrayResize Ø¬Ø§Ø¨Ø¬Ø§ Ø¨Ø´Ù‡. Ø¨Ù‡ Ù‡Ù…ÛŒÙ† Ø®Ø§Ø·Ø± Ø§Ø¬Ø§Ø²Ù‡ Ù†Ù…ÛŒâ€ŒØ¯Ù‡ Ø¨Ù‡ ÛŒÚ©ÛŒ Ø§Ø² Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø¢Ø±Ø§ÛŒÙ‡ ÛŒÚ© Ø±ÙØ±Ù†Ø³ (reference) ÛŒØ§ Ù†Ø§Ù… Ù…Ø³ØªØ¹Ø§Ø± (&) Ø§Ø®ØªØµØ§Øµ Ø¨Ø¯ÛŒ. Ù…ÛŒÚ¯Ù‡ Ø®Ø·Ø±Ù†Ø§Ú©Ù‡!
Ú†Ø·ÙˆØ±ÛŒ Ø­Ù„Ø´ Ú©Ù†ÛŒÙ…ØŸ
Ø®ÛŒÙ„ÛŒ Ø³Ø§Ø¯Ù‡ØŒ Ø¨ÛŒâ€ŒØ®ÛŒØ§Ù„ Ø±ÙØ±Ù†Ø³ Ø´Ùˆ Ùˆ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø§ Ø®ÙˆØ¯ Ø¢Ø±Ø§ÛŒÙ‡ Ú©Ø§Ø± Ú©Ù†.
 * ÙØ§ÛŒÙ„ CActiveTradeManager.mqh Ø±Ùˆ Ø¨Ø§Ø² Ú©Ù†.
 * Ø¯Ø± ØªØ§Ø¨Ø¹ RegisterTradeØŒ Ø®Ø· 63 Ø±Ùˆ Ú©Ù‡ Ø§ÛŒÙ† Ø´Ú©Ù„ÛŒÙ‡:
   ManagedTrade &trade = m_managedTrades[size];  // Ù…Ø±Ø¬Ø¹ Ø¨Ù‡ Ø¢Ø®Ø±ÛŒÙ†

   Ú©Ù„Ø§ Ù¾Ø§Ú© Ú©Ù†! Ùˆ Ø¨Ø¹Ø¯Ø´ Ù‡Ø± Ø¬Ø§ Ù†ÙˆØ´ØªÙ‡ trade.ØŒ Ø¨Ù‡ Ø¬Ø§Ø´ Ø¨Ù†ÙˆÛŒØ³ m_managedTrades[size].. ÛŒØ¹Ù†ÛŒ Ø§ÛŒÙ†Ø¬ÙˆØ±ÛŒ Ù…ÛŒâ€ŒØ´Ù‡:
   // ManagedTrade &trade = m_managedTrades[size];  // Ø§ÛŒÙ† Ø®Ø· Ø±Ùˆ Ù¾Ø§Ú© Ú©Ù†
m_managedTrades[size].ticket = ticket;  // ØªÙ†Ø¸ÛŒÙ… ØªÛŒÚ©Øª
m_managedTrades[size].magicNumber = magicNumber;  // ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬ÛŒÚ©
// ... Ùˆ Ø¨Ø±Ø§ÛŒ Ø¨Ù‚ÛŒÙ‡ Ù‡Ù… Ù‡Ù…ÛŒÙ†Ø·ÙˆØ±

 * Ø¯Ø± ØªØ§Ø¨Ø¹ ManageAllTradesØŒ Ù‡Ù…ÛŒÙ† Ú©Ø§Ø± Ø±Ùˆ Ø¨Ø±Ø§ÛŒ Ø®Ø· 88 ØªÚ©Ø±Ø§Ø± Ú©Ù†. Ø®Ø· Ø²ÛŒØ± Ø±Ùˆ:
   ManagedTrade &trade = m_managedTrades[i];  // Ù…Ø±Ø¬Ø¹ Ù…Ø¹Ø§Ù…Ù„Ù‡

   Ú©Ù„Ø§ Ù¾Ø§Ú© Ú©Ù†! Ùˆ Ù‡Ø± Ø¬Ø§ ØªÙˆÛŒ Ø­Ù„Ù‚Ù‡ for Ù†ÙˆØ´ØªÙ‡ trade.ØŒ Ø¨Ù‡ Ø¬Ø§Ø´ Ø¨Ù†ÙˆÛŒØ³ m_managedTrades[i].. Ù…Ø«Ù„Ø§:
   // ... Ø¯Ø§Ø®Ù„ Ø­Ù„Ù‚Ù‡ for
// ManagedTrade &trade = m_managedTrades[i];  // Ø§ÛŒÙ† Ø®Ø· Ø±Ùˆ Ù¾Ø§Ú© Ú©Ù†
if(!PositionSelectByTicket(m_managedTrades[i].ticket))  // Ú†Ú© Ø¨Ø§Ø² Ø¨ÙˆØ¯Ù†
{
   // ...
}
// ... Ùˆ Ø¨Ø±Ø§ÛŒ Ø¨Ù‚ÛŒÙ‡ Ù‡Ù… Ù‡Ù…ÛŒÙ†Ø·ÙˆØ±

Ù‡Ù…ÛŒÙ†Ø§ Ø¨ÙˆØ¯ Ø±ÙÛŒÙ‚. Ø§ÛŒÙ† ØªØºÛŒÛŒØ±Ø§Øª Ø±Ùˆ Ú©Ù‡ Ø¨Ø¯ÛŒØŒ Ú©Ø¯ ØµØ§Ù Ùˆ Ø¨Ø¯ÙˆÙ† Ø§Ø®Ø·Ø§Ø± Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„ Ù…ÛŒâ€ŒØ´Ù‡. Ø¨Ø±Ùˆ Ø¨ØªØ±Ú©ÙˆÙ†! Ø§Ú¯Ù‡ Ø¨Ø§Ø²Ù… Ø¬Ø§ÛŒÛŒ Ú¯ÛŒØ± Ú©Ø±Ø¯ÛŒØŒ Ù…Ù† Ù‡Ù…ÛŒÙ†Ø¬Ø§Ù…. ðŸš€



cannot access to private member 'm_trailingAtrHandle' declared in class 'CRange'	Elemento.mq5	257	29
   see declaration of variable 'CRange::m_trailingAtrHandle'	CRange.mqh	75	8
possible loss of data due to type conversion from 'long' to 'datetime'	TimeHelper.mqh	63	17
possible loss of data due to type conversion from 'long' to 'datetime'	TimeHelper.mqh	64	15
initialization of variable skipped by 'case' label, use { }	CRange.mqh	317	19
initialization of variable skipped by 'case' label, use { }	CRange.mqh	318	19
'&' - reference cannot used	CActiveTradeManager.mqh	63	20
'&' - reference cannot used	CActiveTradeManager.mqh	88	23
initialization of variable skipped by 'case' label, use { }	CActiveTradeManager.mqh	103	23
initialization of variable skipped by 'case' label, use { }	CActiveTradeManager.mqh	104	23
initialization of variable skipped by 'case' label, use { }	CActiveTradeManager.mqh	105	23











```mql5
//+------------------------------------------------------------------+
//|                                                     Settings.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø´Ø§Ù…Ù„ ØªØ¹Ø±ÛŒÙ Ø³Ø§Ø®ØªØ§Ø±Ù‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ùˆ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ (inputs) Ø¨Ø±Ø§ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª Elemento Ø§Ø³Øª.
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª: Elemento ÛŒÚ© Ø³ÛŒØ³ØªÙ… Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ø´Ú©Ø³Øª Ø±Ù†Ø¬ (Breakout Range) Ø§Ø³Øª Ú©Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø´Ø®Øµ (Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ) Ø¹Ù…Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Ø§ÛŒÙ† Ø§Ú©Ø³Ù¾Ø±Øª ØªØ§ Ú†Ù‡Ø§Ø± Ø±Ù†Ø¬ Ø²Ù…Ø§Ù†ÛŒ Ù…Ø®ØªÙ„Ù Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ù‡Ø± Ø±Ù†Ø¬ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø±ØªÙØ§Ø¹ Ù‚ÛŒÙ…Øª (High/Low) Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ ØªØ¹ÛŒÛŒÙ†â€ŒØ´Ø¯Ù‡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ 
// Ø³Ù¾Ø³ Ù…Ù†ØªØ¸Ø± Ø´Ú©Ø³Øª (Breakout) Ø³Ù‚Ù ÛŒØ§ Ú©Ù Ø±Ù†Ø¬ Ø¨Ø§ Ø§ÙØ³Øª (Offset) Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± ATR ÛŒØ§ Ø¯Ø±ØµØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯. 
// Ù¾Ø³ Ø§Ø² Ø´Ú©Ø³ØªØŒ Ø¨Ø§ ØªØ£ÛŒÛŒØ¯ Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ù‚ÛŒÙ…Øª (Ú©Ù†Ø¯Ù„ ØªØ§ÛŒÛŒØ¯) Ùˆ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©ÙˆØŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø®Ø±ÛŒØ¯ ÛŒØ§ ÙØ±ÙˆØ´ Ø¨Ø§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø´Ø§Ù…Ù„ Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ (SL) Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ (Ù…Ù‚Ø§Ø¨Ù„ Ø±Ù†Ø¬ ÛŒØ§ Ø³Ø·Ø­ Ø´Ú©Ø³Øª) Ø¨Ù‡ Ø¹Ù„Ø§ÙˆÙ‡ ØªÙ†Ø¸ÛŒÙ… ATR ÛŒØ§ Ø¯Ø±ØµØ¯ 
// (Ø¨Ø±Ø§ÛŒ Ù¾ÙˆØ´Ø´ Ú©Ø§Ù…Ù„ Ø±Ù†Ø¬ Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø²ÛŒØ§Ù† Ø²ÙˆØ¯Ø±Ø³)ØŒ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ (Partial Close) Ø¯Ø± Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Ù†Ø³Ø¨Øª Ù…Ø´Ø®Øµ Ø³ÙˆØ¯ Ø¨Ù‡ Ø±ÛŒØ³Ú© Ø¨Ø¯ÙˆÙ† ØªØ§Ø±Ú¯Øª Ú©Ù„ 
// (Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ø±ÙˆÙ†Ø¯ Ø§Ø¯Ø§Ù…Ù‡â€ŒØ¯Ø§Ø±)ØŒ Ùˆ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾ (Trailing Stop) Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ Ø³ÙˆØ¯ Ø§Ø³Øª. 
// Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø±Ù†Ø¬â€ŒÙ‡Ø§ Ù¾Ø³ Ø§Ø² Ø§Ù†Ù‚Ø¶Ø§ ÛŒØ§ Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† Ø¨Ø§Ø²Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§ Ø§Ø² ØªØ¯Ø§Ø®Ù„ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø´ÙˆØ¯.
// Ù…Ù†Ø·Ù‚ ÙØ§ÛŒÙ„ Settings.mqh: Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù‡ÛŒÚ† Ú©Ø¯ÛŒ Ø§Ø¬Ø±Ø§ÛŒÛŒ Ù†Ø¯Ø§Ø±Ø¯ Ùˆ ÙÙ‚Ø· enums Ùˆ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ input Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ ØªØ§ Ú©Ø§Ø±Ø¨Ø± Ø¨ØªÙˆØ§Ù†Ø¯ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†Ø¯. 
// enums Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù (Ù…Ø§Ù†Ù†Ø¯ PLACEMENT_MODE Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ø§ÙØ³Øª Ø´Ú©Ø³ØªØŒ SL_STRATEGY Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ SLØŒ 
// SL_CALC_MODE Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± SLØŒ TRAILING_MODE Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. 
// Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ input Ø´Ø§Ù…Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ (Ø±ÛŒØ³Ú©ØŒ Ø¯ÛŒØ¨Ø§Ú¯ØŒ ØªØ§ÛŒÛŒØ¯ Ù‚ÛŒÙ…Øª)ØŒ ÙÛŒÙ„ØªØ± Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ (Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø®Ù„Ø§Ù Ø±ÙˆÙ†Ø¯)ØŒ 
// Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ú†Ø§Ø±Øª (Ø¨Ø±Ø§ÛŒ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ Ù‡Ø± Ø±Ù†Ø¬ Ø¨Ù‡ Ø·ÙˆØ± Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡)ØŒ Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú†Ù‡Ø§Ø± Ø±Ù†Ø¬ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ (Ù‡Ø± Ø±Ù†Ø¬ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…ØŒ Ø³Ø§Ø¹Ø§ØªØŒ 
// Ø­Ø¯Ø§Ù‚Ù„/Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø±ØªÙØ§Ø¹ØŒ Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ ATRØŒ Ø¶Ø±Ø§ÛŒØ¨ØŒ Ù†Ø³Ø¨Øª R:RØŒ Ø¯Ø±ØµØ¯ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒØŒ Ø³Ø§Ø¹Øª Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ùˆ Ø±Ù†Ú¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯) Ø§Ø³Øª. 
// Ø§ÛŒÙ† Ø³Ø§Ø®ØªØ§Ø± Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ø§Ú©Ø³Ù¾Ø±Øª Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù (Ù…Ø§Ù†Ù†Ø¯ ÙØ§Ø±Ú©Ø³ ÛŒØ§ Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§) Ø³ÙØ§Ø±Ø´ÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´ÙˆØ¯ Ùˆ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø´Ú©Ø³Øª Ø±Ù†Ø¬ Ø±Ø§ Ø¨Ø§ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ ØªØ±Ú©ÛŒØ¨ Ú©Ù†Ø¯ 
// ØªØ§ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø±ØªØ±ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø´ÙˆØ¯. ÙØ§ÛŒÙ„ ØªÙˆØ³Ø· Ø³Ø§ÛŒØ± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ include Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§ Ø¨Ù‡ inputs Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù†Ø¯. 
// ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ù†Ø³Ø®Ù‡ 2.10: Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¯Ù‚Øª Ø¨ÛŒØ´ØªØ±ØŒ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¯Ø± enums ÛŒØ§ inputsØŒ Ø§Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù¾Ø§Ø±Ø§Ù…ØªØ± 
// Ø¨Ù‡ Ù…Ù†Ø¸ÙˆØ± Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø¨Ù‡ØªØ± Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª. Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø²ÛŒØ±Ø§ Ø¨Ù„ÙˆÙ¾Ø±ÛŒÙ†Øª ØªØºÛŒÛŒØ±ÛŒ Ø¯Ø± Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù…Ø´Ø®Øµ Ù†Ú©Ø±Ø¯Ù‡.

#ifndef SETTINGS_MQH  // Ú†Ú© ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² include Ù…Ú©Ø±Ø±
#define SETTINGS_MQH  // ØªØ¹Ø±ÛŒÙ Ù…Ø§Ú©Ø±Ùˆ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² include Ù…Ø¬Ø¯Ø¯

// ØªØ¹Ø±ÛŒÙ enum Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ù‚Ø±Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´ (ØªØ¹ÛŒÛŒÙ† Ø§ÙØ³Øª Ø´Ú©Ø³Øª Ø±Ù†Ø¬ Ø¨Ø§ ATR ÛŒØ§ Ø¯Ø±ØµØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø´Ú©Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø°Ø¨)
// Ø§ÛŒÙ† enum Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø¨ÛŒÙ† Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾ÙˆÛŒØ§ (ATR) ÛŒØ§ Ø«Ø§Ø¨Øª (Ø¯Ø±ØµØ¯) Ø¨Ø±Ø§ÛŒ Ø§ÙØ³Øª Ø´Ú©Ø³Øª Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†Ø¯
enum ENUM_PLACEMENT_MODE
{
   PLACEMENT_ATR,    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ATR Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÙØ³Øª Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ (Ù¾ÙˆÛŒØ§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ³Ø§Ù† Ø¨Ø§Ø²Ø§Ø±ØŒ Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…ØªØºÛŒØ±)
   PLACEMENT_PERCENT // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ø±ØµØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÙØ³Øª Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ (Ø«Ø§Ø¨Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø±Ù†Ø¬ØŒ Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒØ¯Ø§Ø±)
};

// ØªØ¹Ø±ÛŒÙ enum Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ (ØªØ¹ÛŒÛŒÙ† Ù¾Ø§ÛŒÙ‡ SL: Ù…Ù‚Ø§Ø¨Ù„ Ø±Ù†Ø¬ ÛŒØ§ Ø³Ø·Ø­ Ø´Ú©Ø³Øª)
// Ø§ÛŒÙ† enum Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ø¨ÛŒÙ† Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù…Ø­Ø§ÙØ¸Ù‡â€ŒÚ©Ø§Ø±Ø§Ù†Ù‡ (Ù…Ù‚Ø§Ø¨Ù„ Ø±Ù†Ø¬) ÛŒØ§ ØªÙ‡Ø§Ø¬Ù…ÛŒ (Ø³Ø·Ø­ Ø´Ú©Ø³Øª) Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†Ø¯
enum ENUM_SL_STRATEGY
{
   SL_OPPOSITE_SIDE,  // Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø¯Ø± Ø³Ù…Øª Ù…Ù‚Ø§Ø¨Ù„ Ø±Ù†Ø¬ (Ù‚Ø¨Ù„ÛŒ: Ø¨Ø±Ø§ÛŒ BUY Ø¯Ø± Ú©Ù - Ø¨Ø§ÙØ±ØŒ Ø¨Ø±Ø§ÛŒ SELL Ø¯Ø± Ø³Ù‚Ù + Ø¨Ø§ÙØ±ØŒ Ù…Ø­Ø§ÙØ¸Ù‡â€ŒÚ©Ø§Ø±Ø§Ù†Ù‡â€ŒØªØ±)
   SL_BREAKOUT_LEVEL  // Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø¯Ø± Ø³Ø·Ø­ Ø´Ú©Ø³Øª (Ø¬Ø¯ÛŒØ¯: Ø¨Ø±Ø§ÛŒ BUY Ø¯Ø± Ø³Ù‚Ù - Ø¨Ø§ÙØ±ØŒ Ø¨Ø±Ø§ÛŒ SELL Ø¯Ø± Ú©Ù + Ø¨Ø§ÙØ±ØŒ Ø±ÛŒØ³Ú© Ø¨Ø§Ù„Ø§ØªØ± Ø§Ù…Ø§ Ø³ÙˆØ¯ Ø¨Ø§Ù„Ù‚ÙˆÙ‡ Ø¨ÛŒØ´ØªØ±)
};

// ØªØ¹Ø±ÛŒÙ enum Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ (ØªØ¹ÛŒÛŒÙ† ÙØ§ØµÙ„Ù‡ Ø¨Ø§ÙØ± SL Ø¨Ø§ ATR ÛŒØ§ Ø¯Ø±ØµØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬)
// Ø§ÛŒÙ† enum Ø¨Ø±Ø§ÛŒ ØªØ·Ø¨ÛŒÙ‚ Ø¨Ø§ÙØ± SL Ø¨Ø§ Ù†ÙˆØ³Ø§Ù† ÛŒØ§ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø±Ù†Ø¬ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
enum ENUM_SL_CALC_MODE
{
   SL_CALC_ATR,    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ATR Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ (Ù¾ÙˆÛŒØ§ Ùˆ ØªØ·Ø¨ÛŒÙ‚ÛŒ Ø¨Ø§ Ù†ÙˆØ³Ø§Ù† Ø¨Ø§Ø²Ø§Ø±ØŒ ØªÙˆØµÛŒÙ‡â€ŒØ´Ø¯Ù‡)
   SL_CALC_PERCENT // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ø±ØµØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ (Ø«Ø§Ø¨Øª Ùˆ Ø³Ø§Ø¯Ù‡ØŒ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú©)
};

// ØªØ¹Ø±ÛŒÙ enum Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾ (ØªØ¹ÛŒÛŒÙ† ÙØ§ØµÙ„Ù‡ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø¨Ø§ ATR ÛŒØ§ Senkou Span B Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ Ø³ÙˆØ¯)
// Ø§ÛŒÙ† enum Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÙˆÛŒØ§ (ATR) ÛŒØ§ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ø§Ø¨Ø± Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ (Senkou B) Ø±Ø§ ÙØ±Ø§Ù‡Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯
enum ENUM_TRAILING_MODE
{
   TRAILING_ATR,   // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ATR Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾ (Ù¾ÙˆÛŒØ§ Ùˆ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ù†ÙˆØ³Ø§Ù† Ø§Ø®ÛŒØ±)
   TRAILING_ICHIMOKU_B  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Senkou Span B Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾ (Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø¨Ø± Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©ÙˆØŒ Ø¨Ø±Ø§ÛŒ Ø±ÙˆÙ†Ø¯Ù‡Ø§ÛŒ Ø¨Ù„Ù†Ø¯Ù…Ø¯Øª)
};

// (Ø¬Ø¯ÛŒØ¯) ØªØ¹Ø±ÛŒÙ enum Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø§Ø¨Ø·Ø§Ù„ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ (Ø§Ù†ØªØ®Ø§Ø¨ Ø¨ÛŒÙ† Ø­Ø§Ù„Øª ØµØ¨ÙˆØ± ÛŒØ§ ØªÙ‡Ø§Ø¬Ù…ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¨Ø·Ø§Ù„ ÙØ±ØµØª ÙˆØ±ÙˆØ¯)
// Ø§ÛŒÙ† enum Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±ÛŒ Ø¯Ø± Ø±ÙØªØ§Ø± Ø§Ø¨Ø·Ø§Ù„ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø±Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
enum ENUM_INVALIDATION_MODE
{
   INVALIDATION_RANGE_REENTRY,     // Ø­Ø§Ù„Øª ØµØ¨ÙˆØ±: ÙØ±ØµØª ÙˆØ±ÙˆØ¯ ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø§Ø²Ú¯Ø´Øª Ù‚ÛŒÙ…Øª Ø¨Ù‡ Ø¯Ø§Ø®Ù„ Ø±Ù†Ø¬ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø·Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±)
   INVALIDATION_BREAKOUT_LINE_CROSS  // Ø­Ø§Ù„Øª ØªÙ‡Ø§Ø¬Ù…ÛŒ: ÙØ±ØµØª ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù…Ø­Ø¶ Ø¨Ø§Ø²Ú¯Ø´Øª Ù‚ÛŒÙ…Øª Ø¨Ù‡ Ø²ÛŒØ± Ø®Ø· Ø´Ú©Ø³Øª Ø¨Ø§Ø·Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ø±ÛŒØ³Ú© Ú©Ù…ØªØ±)
};

// (Ø¬Ø¯ÛŒØ¯) ØªØ¹Ø±ÛŒÙ enum Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ ØªØ§ÛŒÛŒØ¯/Ø§Ø¨Ø·Ø§Ù„ (Ø§Ù†ØªØ®Ø§Ø¨ Ø¨ÛŒÙ† Ø­Ø§Ù„Øª Ù‚Ø¯ÛŒÙ…ÛŒ Ø¨Ø§ ØªØ§ÛŒÙ…Ø± Ú©Ù†Ø¯Ù„ÛŒ Ùˆ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ø§Ø¨Ø·Ø§Ù„ Ù‚ÛŒÙ…Øª)
// Ø§ÛŒÙ† enum Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ø¨ÛŒÙ† Ø±ÙˆÛŒÚ©Ø±Ø¯ Ø²Ù…Ø§Ù†ÛŒ ÛŒØ§ Ù‚ÛŒÙ…ØªÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†Ø¯
enum ENUM_CONFIRMATION_STRATEGY
{
   CONFIRMATION_TIMEOUT,           // Ø­Ø§Ù„Øª Ù‚Ø¯ÛŒÙ…ÛŒ: Ù…Ù‡Ù„Øª ØªØ§ÛŒÛŒØ¯ Ø¨Ø§ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù†Ø¯Ù„ (Inp_Confirmation_TimeoutØŒ Ù…Ø­Ø¯ÙˆØ¯Ú©Ù†Ù†Ø¯Ù‡)
   CONFIRMATION_PRICE_INVALIDATION // Ø­Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯: Ø§Ø¨Ø·Ø§Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨Ø§Ø²Ú¯Ø´Øª Ù‚ÛŒÙ…Øª Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø²Ù…Ø§Ù†ÛŒ (Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±ØªØ±)
};

// Ú¯Ø±ÙˆÙ‡ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ (Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¨Ø± ØªÙ…Ø§Ù… Ø±Ù†Ø¬â€ŒÙ‡Ø§ ØªØ£Ø«ÛŒØ± Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ù†Ø¯)
// Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ø´Ø§Ù…Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±ÛŒØ³Ú©ØŒ Ø¯ÛŒØ¨Ø§Ú¯ Ùˆ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ Ø§Ø³Øª
input group "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ"  // Ø¹Ù†ÙˆØ§Ù† Ú¯Ø±ÙˆÙ‡ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª MT5
input long InpBaseMagicNumber = 123456; // Ù…Ø¬ÛŒÚ© Ù†Ø§Ù…Ø¨Ø± Ù¾Ø§ÛŒÙ‡ (Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§ÛŒØ² Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ Ø¯ÛŒÚ¯Ø± Ø§Ú©Ø³Ù¾Ø±Øªâ€ŒÙ‡Ø§ØŒ Ù…Ù†Ø­ØµØ±Ø¨Ù‡â€ŒÙØ±Ø¯ Ø¨Ø§Ø´Ø¯)
input double InpRiskPercent = 1.0; // Ø¯Ø±ØµØ¯ Ø±ÛŒØ³Ú© (0.1 ØªØ§ 5.0) - Ù…Ù‚Ø¯Ø§Ø± Ø±ÛŒØ³Ú© Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø­Ø³Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø²ÛŒØ§Ù† Ú©Ù„ÛŒ (ØªÙˆØµÛŒÙ‡: 1-2%)
input bool InpDebugMode = true; // Ø­Ø§Ù„Øª Ø¯ÛŒØ¨Ø§Ú¯ (Ú†Ø§Ù¾ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ùˆ Ù†Ø¸Ø§Ø±Øª Ø¨Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§Ú©Ø³Ù¾Ø±ØªØŒ Ø®Ø§Ù…ÙˆØ´ Ø¨Ø±Ø§ÛŒ Ù„Ø§ÛŒÙˆ)
// (Ø¬Ø¯ÛŒØ¯) Ø§Ù†ØªØ®Ø§Ø¨â€ŒÚ¯Ø± Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø§Ø¨Ø·Ø§Ù„ ØªÙ„Ø§Ø´ ÙˆØ±ÙˆØ¯ (Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±ÛŒ Ø¯Ø± Ø±ÙØªØ§Ø± Ø§Ú©Ø³Ù¾Ø±Øª: ØµØ¨ÙˆØ± ÛŒØ§ ØªÙ‡Ø§Ø¬Ù…ÛŒ)
input ENUM_INVALIDATION_MODE Inp_Invalidation_Mode = INVALIDATION_RANGE_REENTRY; // Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø§Ø¨Ø·Ø§Ù„: Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø±Ù†Ø¬ (ØµØ¨ÙˆØ±ØŒ ÙØ±ØµØª Ø¨ÛŒØ´ØªØ±) ÛŒØ§ Ø¹Ø¨ÙˆØ± Ø§Ø² Ø®Ø· Ø´Ú©Ø³Øª (ØªÙ‡Ø§Ø¬Ù…ÛŒØŒ Ø§ÛŒÙ…Ù†â€ŒØªØ±)
// (Ø¬Ø¯ÛŒØ¯) Ø§Ù†ØªØ®Ø§Ø¨â€ŒÚ¯Ø± Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ ØªØ§ÛŒÛŒØ¯/Ø§Ø¨Ø·Ø§Ù„ (Ø§Ù†ØªØ®Ø§Ø¨ Ø¨ÛŒÙ† Ù‚Ø¯ÛŒÙ…ÛŒ Ø¨Ø§ ØªØ§ÛŒÙ…Ø± Ùˆ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù‚ÛŒÙ…Øª)
input ENUM_CONFIRMATION_STRATEGY Inp_Confirmation_Strategy = CONFIRMATION_PRICE_INVALIDATION; // Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ ØªØ§ÛŒÛŒØ¯: ØªØ§ÛŒÙ…Ø± Ú©Ù†Ø¯Ù„ÛŒ (Ù‚Ø¯ÛŒÙ…ÛŒØŒ Ù…Ø­Ø¯ÙˆØ¯) ÛŒØ§ Ø§Ø¨Ø·Ø§Ù„ Ù‚ÛŒÙ…Øª (Ø¬Ø¯ÛŒØ¯ØŒ Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±)
input int Inp_Confirmation_Timeout = 3; // Ù…Ù‡Ù„Øª ØªØ£ÛŒÛŒØ¯ Ù‚ÛŒÙ…Øª Ùˆ ÙÛŒÙ„ØªØ± (ØªØ¹Ø¯Ø§Ø¯ Ú©Ù†Ø¯Ù„) - ÙÙ‚Ø· Ø§Ú¯Ø± CONFIRMATION_TIMEOUT Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯ (1-10 ØªÙˆØµÛŒÙ‡â€ŒØ´Ø¯Ù‡)
input bool Inp_PriceConfirmation_Enabled = true; // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªØ£ÛŒÛŒØ¯ Ù‚ÛŒÙ…Øª Ù¾Ø³ Ø§Ø² Ú©Ù†Ø¯Ù„ Ø´Ú©Ù†Ù†Ø¯Ù‡ (Ø§Ú¯Ø± Ø®Ø§Ù…ÙˆØ´ Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ù…ÛŒâ€ŒØ±ÙˆØ¯ ÛŒØ§ ÙˆØ±ÙˆØ¯ØŒ Ø¨Ø±Ø§ÛŒ Ø³Ø±Ø¹Øª Ø¨ÛŒØ´ØªØ±)

// Ú¯Ø±ÙˆÙ‡ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ (Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¯Ø± Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯ ÛŒØ§ Ø®Ù†Ø«ÛŒ Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø®Ù„Ø§Ù Ø±ÙˆÙ†Ø¯)
// Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ Ø±Ø§ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†Ø¯
input group "ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ"  // Ø¹Ù†ÙˆØ§Ù† Ú¯Ø±ÙˆÙ‡
input bool Inp_IchimokuFilter_Enabled = true; // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ (Ø§Ú¯Ø± Ø®Ø§Ù…ÙˆØ´ Ø¨Ø§Ø´Ø¯ØŒ Ù‡Ù…ÛŒØ´Ù‡ Ø®Ù†Ø«ÛŒ ÙØ±Ø¶ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù‡Ù…Ù‡ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ Ù…Ø¬Ø§Ø²)
input int Inp_Ichimoku_Tenkan = 9; // Ø¯ÙˆØ±Ù‡ ØªÙ†Ú©Ø§Ù†-Ø³Ù† (Ø®Ø· Ø³Ø±ÛŒØ¹ Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø±ÙˆÙ†Ø¯ Ú©ÙˆØªØ§Ù‡â€ŒÙ…Ø¯ØªØŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯)
input int Inp_Ichimoku_Kijun = 26; // Ø¯ÙˆØ±Ù‡ Ú©ÛŒØ¬ÙˆÙ†-Ø³Ù† (Ø®Ø· Ú©Ù†Ø¯ Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø±ÙˆÙ†Ø¯ Ù…ÛŒØ§Ù†â€ŒÙ…Ø¯ØªØŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯)
input int Inp_Ichimoku_SenkouB = 52; // Ø¯ÙˆØ±Ù‡ Ø³Ù†Ú©Ùˆ Ø§Ø³Ù¾Ù† B (Ø§Ø¨Ø± Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø­Ù…Ø§ÛŒØª/Ù…Ù‚Ø§ÙˆÙ…Øª Ø¢ÛŒÙ†Ø¯Ù‡ØŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯)
input int Inp_Ichimoku_FlatThreshold_Points = 90; // Ø¢Ø³ØªØ§Ù†Ù‡ ØªØ´Ø®ÛŒØµ Ø§Ø¨Ø± ÙÙ„Øª Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª (Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ø±ÙˆÙ†Ø¯ Ø®Ù†Ø«ÛŒ Ø§Ú¯Ø± ØªÙØ§ÙˆØª Ø³Ù†Ú©Ùˆ A Ùˆ B Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ù…Ø§Ø¯ ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆØ¯)

// Ú¯Ø±ÙˆÙ‡ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ú†Ø§Ø±Øª (Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨ØµØ±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ Ù‡Ø± Ø±Ù†Ø¬ Ø¨Ù‡ Ø·ÙˆØ± Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø±ÙˆÛŒ Ú†Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±)
// Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ø¨Ø±Ø§ÛŒ Ù†Ø¸Ø§Ø±Øª Ø¨ØµØ±ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø³Øª Ùˆ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø±Ø§ ØªØ­Øª ØªØ£Ø«ÛŒØ± Ù‚Ø±Ø§Ø± Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
input group "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ú†Ø§Ø±Øª"  // Ø¹Ù†ÙˆØ§Ù† Ú¯Ø±ÙˆÙ‡
input bool Inp_Visual_ShowTrendStatus = true; // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ (Ø±ÙˆÛŒ Ú†Ø§Ø±Øª Ø¨Ø±Ø§ÛŒ Ù†Ø¸Ø§Ø±Øª Ø¨ØµØ±ÛŒ Ù‡Ø± Ø±Ù†Ø¬ØŒ Ø®Ø§Ù…ÙˆØ´ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ø±Øª ØªÙ…ÛŒØ²ØªØ±)
input int Inp_Visual_FontSize = 12; // Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙÙˆÙ†Øª Ù†Ù…Ø§ÛŒØ´Ú¯Ø± (Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ Ø¨Ù‡ØªØ±ØŒ 8-16 Ù…Ù†Ø§Ø³Ø¨)
input color Inp_Visual_FontColor_Buy = clrGreen; // Ø±Ù†Ú¯ Ù…ØªÙ† Ø¨Ø±Ø§ÛŒ Ø±ÙˆÙ†Ø¯ BUY (Ø³Ø¨Ø² Ø¨Ø±Ø§ÛŒ Ù…Ø«Ø¨ØªØŒ Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ±)
input color Inp_Visual_FontColor_Sell = clrRed; // Ø±Ù†Ú¯ Ù…ØªÙ† Ø¨Ø±Ø§ÛŒ Ø±ÙˆÙ†Ø¯ SELL (Ù‚Ø±Ù…Ø² Ø¨Ø±Ø§ÛŒ Ù…Ù†ÙÛŒØŒ Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ±)
input color Inp_Visual_FontColor_Neutral = clrGray; // Ø±Ù†Ú¯ Ù…ØªÙ† Ø¨Ø±Ø§ÛŒ Ø±ÙˆÙ†Ø¯ NEUTRAL (Ø®Ø§Ú©Ø³ØªØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ù†Ø«ÛŒØŒ Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ±)
input int Inp_Visual_X_Offset = 10; // ÙØ§ØµÙ„Ù‡ Ø§ÙÙ‚ÛŒ Ø§Ø² Ù„Ø¨Ù‡ Ú†Ø§Ø±Øª (Ù¾ÛŒÚ©Ø³Ù„ Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†Ø§Ø³Ø¨ØŒ 0-50)
input int Inp_Visual_Y_Offset = 10; // ÙØ§ØµÙ„Ù‡ Ø¹Ù…ÙˆØ¯ÛŒ Ø§Ø² Ù„Ø¨Ù‡ Ú†Ø§Ø±Øª (Ù¾ÛŒÚ©Ø³Ù„ Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†Ø§Ø³Ø¨ØŒ 0-50)

// Ú¯Ø±ÙˆÙ‡ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ù†Ø¬ 1 (Ø§ÙˆÙ„ÛŒÙ† Ø±Ù†Ø¬ Ø²Ù…Ø§Ù†ÛŒØŒ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨Ø±Ø§ÛŒ Ø³Ø´Ù† Ø¢Ø³ÛŒØ§ ÛŒØ§ Ø´Ø¨Ø§Ù†Ù‡)
// Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ Ø±Ù†Ø¬ 1 Ø±Ø§ Ø´Ø§Ù…Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
input group "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ù†Ø¬ 1"  // Ø¹Ù†ÙˆØ§Ù† Ú¯Ø±ÙˆÙ‡
input bool InpRange1_Enabled = true; // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø±Ù†Ø¬ 1 (Ø§Ú¯Ø± Ø®Ø§Ù…ÙˆØ´ Ø¨Ø§Ø´Ø¯ØŒ Ø§ÛŒÙ† Ø±Ù†Ø¬ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…Ù†Ø§Ø¨Ø¹ ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
input ENUM_TIMEFRAMES InpRange1_Execution_Timeframe = PERIOD_M5; // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§ Ø±Ù†Ø¬ 1 (Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ù†Ø·Ù‚ Ø±Ù†Ø¬ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ø§ØªØŒ M1-M30 ØªÙˆØµÛŒÙ‡â€ŒØ´Ø¯Ù‡)
input ENUM_TIMEFRAMES InpRange1_TrendFilter_Timeframe = PERIOD_H1; // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø±Ù†Ø¬ 1 (Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©ÙˆØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…ØªÙØ§ÙˆØª Ø¨Ø§Ø´Ø¯ØŒ H1-H4 Ù…Ù†Ø§Ø³Ø¨)
input int InpRange1_Start_Hour = 22; // Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬ 1 (0-23 Ø¨Ø±Ø§ÛŒ ØªØ¹Ø±ÛŒÙ Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒØŒ Ø¨Ø± Ø§Ø³Ø§Ø³ GMT Ø³Ø±ÙˆØ±)
input int InpRange1_Start_Minute = 0; // Ø¯Ù‚ÛŒÙ‚Ù‡ Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬ 1 (0-59 Ø¨Ø±Ø§ÛŒ Ø¯Ù‚Øª Ø²Ù…Ø§Ù†ÛŒØŒ 0 Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø³Ø§Ø¹ØªÛŒ)
input int InpRange1_End_Hour = 9; // Ø³Ø§Ø¹Øª Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ 1 (0-23ØŒ Ø§Ú¯Ø± Ú©Ù…ØªØ± Ø§Ø² Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø´Ø¯ØŒ Ø±Ù†Ø¬ Ø´Ø¨Ø§Ù†Ù‡ ÙØ±Ø¶ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
input int InpRange1_End_Minute = 30; // Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ 1 (0-59ØŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø§ÛŒØ§Ù† Ø¯Ù‚ÛŒÙ‚)
input int InpRange1_MinRangePoints = 200; // Ø­Ø¯Ø§Ù‚Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ 1 Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª (Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© Ùˆ Ø¨ÛŒâ€ŒÚ©ÛŒÙÛŒØªØŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ù…Ø§Ø¯ ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆØ¯)
input int InpRange1_MaxRangePoints = 1500; // Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ 1 Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª (Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ùˆ Ù¾Ø±Ø±ÛŒØ³Ú©ØŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ³Ø§Ù† ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆØ¯)
input ENUM_PLACEMENT_MODE InpRange1_Placement_Mode = PLACEMENT_ATR; // Ø­Ø§Ù„Øª Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 1 (Ø§ÙØ³Øª Ø´Ú©Ø³ØªØŒ ATR Ø¨Ø±Ø§ÛŒ Ù¾ÙˆÛŒØ§ÛŒÛŒ)
input int InpRange1_ATR_Period = 122; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 1 (Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÙØ³Øª Ù¾ÙˆÛŒØ§ØŒ 14-200)
input double InpRange1_ATR_Multiplier = 2.3; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 1 (Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø­Ø³Ø§Ø³ÛŒØª Ø§ÙØ³ØªØŒ 1.0-3.0)
input ENUM_SL_STRATEGY InpRange1_SL_Strategy = SL_BREAKOUT_LEVEL; // Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 1 (Ù…Ù‚Ø§Ø¨Ù„ ÛŒØ§ Ø³Ø·Ø­ Ø´Ú©Ø³ØªØŒ BREAKOUT Ø¨Ø±Ø§ÛŒ ØªÙ‡Ø§Ø¬Ù…ÛŒ)
input ENUM_SL_CALC_MODE InpRange1_SL_Calc_Mode = SL_CALC_ATR; // Ø­Ø§Ù„Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 1 (ATR Ø¨Ø±Ø§ÛŒ ØªØ·Ø¨ÛŒÙ‚)
input int InpRange1_SL_ATR_Period = 62; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 1 (14-100)
input double InpRange1_SL_ATR_Multiplier = 1.3; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 1 (0.5-2.0)
input ENUM_TRAILING_MODE InpRange1_Trailing_Mode = TRAILING_ATR; // Ø­Ø§Ù„Øª ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾ Ø±Ù†Ø¬ 1 (ATR Ø¨Ø±Ø§ÛŒ Ù¾ÙˆÛŒØ§ÛŒÛŒ)
input int InpRange1_Trailing_ATR_Period = 43; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ù†Ø¬ 1 (14-100)
input double InpRange1_Trailing_ATR_Multiplier = 1.4; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ù†Ø¬ 1 (1.0-2.0)
input double InpRange1_RR_Ratio = 1.5; // Ù†Ø³Ø¨Øª R:R Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø±Ù†Ø¬ 1 (Ø³ÙˆØ¯ Ø¨Ù‡ Ø±ÛŒØ³Ú© Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒØŒ 1.0-3.0)
input double InpRange1_PartialClosePercent = 60.0; // Ø¯Ø±ØµØ¯ Ø¨Ø³ØªÙ† Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø±Ù†Ø¬ 1 (Ù‡Ù†Ú¯Ø§Ù… Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ RRØŒ 30-70%)
input int InpRange1_Cleanup_Hours = 5; // Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø±Ù†Ø¬ 1 (0-24ØŒ Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§ÛŒ Ø±Ù†Ø¬ Ù¾Ø³ Ø§Ø² Ù¾Ø§ÛŒØ§Ù†ØŒ 1-12 Ù…Ù†Ø§Ø³Ø¨)
input color InpRange1_Color = clrBlue; // Ø±Ù†Ú¯ Ù…Ø³ØªØ·ÛŒÙ„ Ø±Ù†Ø¬ 1 (Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ Ø±ÙˆÛŒ Ú†Ø§Ø±ØªØŒ Ø¢Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§ÛŒØ²)

// Ú¯Ø±ÙˆÙ‡ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ù†Ø¬ 2 (Ø¯ÙˆÙ…ÛŒÙ† Ø±Ù†Ø¬ØŒ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨Ø±Ø§ÛŒ Ø³Ø´Ù† Ø§Ø±ÙˆÙ¾Ø§)
// Ù…Ø´Ø§Ø¨Ù‡ Ø±Ù†Ø¬ 1ØŒ Ø§Ù…Ø§ Ø¨Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ø´Ù† Ø§Ø±ÙˆÙ¾Ø§
input group "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ù†Ø¬ 2"  // Ø¹Ù†ÙˆØ§Ù† Ú¯Ø±ÙˆÙ‡
input bool InpRange2_Enabled = true; // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø±Ù†Ø¬ 2 (Ø®Ø§Ù…ÙˆØ´ Ø¨Ø±Ø§ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†)
input ENUM_TIMEFRAMES InpRange2_Execution_Timeframe = PERIOD_M15; // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§ Ø±Ù†Ø¬ 2 (M5-M30)
input ENUM_TIMEFRAMES InpRange2_TrendFilter_Timeframe = PERIOD_M15; // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø±Ù†Ø¬ 2 (M15-H1)
input int InpRange2_Start_Hour = 5; // Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬ 2 (0-23)
input int InpRange2_Start_Minute = 0; // Ø¯Ù‚ÛŒÙ‚Ù‡ Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬ 2 (0-59)
input int InpRange2_End_Hour = 13; // Ø³Ø§Ø¹Øª Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ 2 (0-23)
input int InpRange2_End_Minute = 0; // Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ 2 (0-59)
input int InpRange2_MinRangePoints = 200; // Ø­Ø¯Ø§Ù‚Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ 2 Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª
input int InpRange2_MaxRangePoints = 3500; // Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ 2 Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª
input ENUM_PLACEMENT_MODE InpRange2_Placement_Mode = PLACEMENT_ATR; // Ø­Ø§Ù„Øª Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 2
input int InpRange2_ATR_Period = 27; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 2
input double InpRange2_ATR_Multiplier = 2.8; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 2
input ENUM_SL_STRATEGY InpRange2_SL_Strategy = SL_OPPOSITE_SIDE; // Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 2
input ENUM_SL_CALC_MODE InpRange2_SL_Calc_Mode = SL_CALC_ATR; // Ø­Ø§Ù„Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 2
input int InpRange2_SL_ATR_Period = 86; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 2
input double InpRange2_SL_ATR_Multiplier = 1.56; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 2
input ENUM_TRAILING_MODE InpRange2_Trailing_Mode = TRAILING_ATR; // Ø­Ø§Ù„Øª ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾ Ø±Ù†Ø¬ 2
input int InpRange2_Trailing_ATR_Period = 101; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ù†Ø¬ 2
input double InpRange2_Trailing_ATR_Multiplier = 1.58; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ù†Ø¬ 2
input double InpRange2_RR_Ratio = 2.8; // Ù†Ø³Ø¨Øª R:R Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø±Ù†Ø¬ 2
input double InpRange2_PartialClosePercent = 26; // Ø¯Ø±ØµØ¯ Ø¨Ø³ØªÙ† Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø±Ù†Ø¬ 2
input int InpRange2_Cleanup_Hours = 4; // Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø±Ù†Ø¬ 2 (0-24)
input color InpRange2_Color = clrRed; // Ø±Ù†Ú¯ Ù…Ø³ØªØ·ÛŒÙ„ Ø±Ù†Ø¬ 2

// Ú¯Ø±ÙˆÙ‡ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ù†Ø¬ 3 (Ø³ÙˆÙ…ÛŒÙ† Ø±Ù†Ø¬ØŒ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨Ø±Ø§ÛŒ Ø³Ø´Ù† Ø¢Ù…Ø±ÛŒÚ©Ø§)
// Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ø´Ù† Ø¢Ù…Ø±ÛŒÚ©Ø§ Ø¨Ø§ Ø±Ù†Ø¬ Ú©ÙˆÚ†Ú©â€ŒØªØ±
input group "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ù†Ø¬ 3"  // Ø¹Ù†ÙˆØ§Ù† Ú¯Ø±ÙˆÙ‡
input bool InpRange3_Enabled = false; // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø±Ù†Ø¬ 3 (Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø®Ø§Ù…ÙˆØ´ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ)
input ENUM_TIMEFRAMES InpRange3_Execution_Timeframe = PERIOD_M5; // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§ Ø±Ù†Ø¬ 3
input ENUM_TIMEFRAMES InpRange3_TrendFilter_Timeframe = PERIOD_M30; // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø±Ù†Ø¬ 3
input int InpRange3_Start_Hour = 15; // Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬ 3 (0-23)
input int InpRange3_Start_Minute = 0; // Ø¯Ù‚ÛŒÙ‚Ù‡ Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬ 3 (0-59)
input int InpRange3_End_Hour = 18; // Ø³Ø§Ø¹Øª Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ 3 (0-23)
input int InpRange3_End_Minute = 0; // Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ 3 (0-59)
input int InpRange3_MinRangePoints = 100; // Ø­Ø¯Ø§Ù‚Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ 3 Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª
input int InpRange3_MaxRangePoints = 2110; // Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ 3 Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª
input ENUM_PLACEMENT_MODE InpRange3_Placement_Mode = PLACEMENT_ATR; // Ø­Ø§Ù„Øª Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 3
input int InpRange3_ATR_Period = 14; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 3
input double InpRange3_ATR_Multiplier = 1.2; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 3
input ENUM_SL_STRATEGY InpRange3_SL_Strategy = SL_OPPOSITE_SIDE; // Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 3
input ENUM_SL_CALC_MODE InpRange3_SL_Calc_Mode = SL_CALC_ATR; // Ø­Ø§Ù„Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 3
input int InpRange3_SL_ATR_Period = 14; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 3
input double InpRange3_SL_ATR_Multiplier = 1.5; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 3
input ENUM_TRAILING_MODE InpRange3_Trailing_Mode = TRAILING_ATR; // Ø­Ø§Ù„Øª ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾ Ø±Ù†Ø¬ 3
input int InpRange3_Trailing_ATR_Period = 14; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ù†Ø¬ 3
input double InpRange3_Trailing_ATR_Multiplier = 1.0; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ù†Ø¬ 3
input double InpRange3_RR_Ratio = 1.5; // Ù†Ø³Ø¨Øª R:R Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø±Ù†Ø¬ 3
input double InpRange3_PartialClosePercent = 50.0; // Ø¯Ø±ØµØ¯ Ø¨Ø³ØªÙ† Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø±Ù†Ø¬ 3
input int InpRange3_Cleanup_Hours = 5; // Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø±Ù†Ø¬ 3 (0-24)
input color InpRange3_Color = clrGreen; // Ø±Ù†Ú¯ Ù…Ø³ØªØ·ÛŒÙ„ Ø±Ù†Ø¬ 3

// Ú¯Ø±ÙˆÙ‡ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ù†Ø¬ 4 (Ú†Ù‡Ø§Ø±Ù…ÛŒÙ† Ø±Ù†Ø¬ØŒ Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø§Ø¶Ø§ÙÛŒ ÛŒØ§ ØªØ³Øª)
// Ø±Ù†Ø¬ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø®Ø§Ù…ÙˆØ´ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ¯Ø§Ø®Ù„
input group "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ù†Ø¬ 4"  // Ø¹Ù†ÙˆØ§Ù† Ú¯Ø±ÙˆÙ‡
input bool InpRange4_Enabled = false; // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø±Ù†Ø¬ 4 (Ø®Ø§Ù…ÙˆØ´ Ù¾ÛŒØ´â€ŒÙØ±Ø¶)
input ENUM_TIMEFRAMES InpRange4_Execution_Timeframe = PERIOD_CURRENT; // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§ Ø±Ù†Ø¬ 4 (CURRENT Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ø®ÙˆØ§Ù†ÛŒ Ø¨Ø§ Ú†Ø§Ø±Øª)
input ENUM_TIMEFRAMES InpRange4_TrendFilter_Timeframe = PERIOD_CURRENT; // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø±Ù†Ø¬ 4
input int InpRange4_Start_Hour = 0; // Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬ 4 (0-23)
input int InpRange4_Start_Minute = 0; // Ø¯Ù‚ÛŒÙ‚Ù‡ Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬ 4 (0-59)
input int InpRange4_End_Hour = 0; // Ø³Ø§Ø¹Øª Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ 4 (0-23)
input int InpRange4_End_Minute = 0; // Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ 4 (0-59)
input int InpRange4_MinRangePoints = 50; // Ø­Ø¯Ø§Ù‚Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ 4 Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª
input int InpRange4_MaxRangePoints = 500; // Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø±ØªÙØ§Ø¹ Ø±Ù†Ø¬ 4 Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª
input ENUM_PLACEMENT_MODE InpRange4_Placement_Mode = PLACEMENT_ATR; // Ø­Ø§Ù„Øª Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 4
input int InpRange4_ATR_Period = 14; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 4
input double InpRange4_ATR_Multiplier = 1.2; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø±Ù†Ø¬ 4
input ENUM_SL_STRATEGY InpRange4_SL_Strategy = SL_OPPOSITE_SIDE; // Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 4
input ENUM_SL_CALC_MODE InpRange4_SL_Calc_Mode = SL_CALC_ATR; // Ø­Ø§Ù„Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 4
input int InpRange4_SL_ATR_Period = 14; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 4
input double InpRange4_SL_ATR_Multiplier = 1.5; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ø±Ù†Ø¬ 4
input ENUM_TRAILING_MODE InpRange4_Trailing_Mode = TRAILING_ATR; // Ø­Ø§Ù„Øª ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾ Ø±Ù†Ø¬ 4
input int InpRange4_Trailing_ATR_Period = 14; // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ù†Ø¬ 4
input double InpRange4_Trailing_ATR_Multiplier = 1.0; // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ù†Ø¬ 4
input double InpRange4_RR_Ratio = 1.5; // Ù†Ø³Ø¨Øª R:R Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø±Ù†Ø¬ 4
input double InpRange4_PartialClosePercent = 50.0; // Ø¯Ø±ØµØ¯ Ø¨Ø³ØªÙ† Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø±Ù†Ø¬ 4
input int InpRange4_Cleanup_Hours = 5; // Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø±Ù†Ø¬ 4 (0-24)
input color InpRange4_Color = clrYellow; // Ø±Ù†Ú¯ Ù…Ø³ØªØ·ÛŒÙ„ Ø±Ù†Ø¬ 4

#endif  // Ù¾Ø§ÛŒØ§Ù† Ú†Ú© include
```

```mql5
//+------------------------------------------------------------------+
//|                                                       Elemento.mq5 |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª Elemento Ø§Ø³Øª Ùˆ Ù†Ù‚Ø·Ù‡ ÙˆØ±ÙˆØ¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ (OnInit, OnDeinit, OnTick, OnTimer) Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª: Elemento Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø´Ú©Ø³Øª Ø±Ù†Ø¬ Ø¹Ù…Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ Ø±Ø§ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ 
// Ù…Ù†ØªØ¸Ø± Ø´Ú©Ø³Øª Ø¨Ø§ Ø§ÙØ³Øª Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ØŒ Ø¨Ø§ ØªØ§ÛŒÛŒØ¯ Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ù‚ÛŒÙ…Øª Ùˆ ÙÛŒÙ„ØªØ± Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ ØªØ£ÛŒÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯ 
// Ùˆ Ø³Ù¾Ø³ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø±Ø§ Ø¨Ø§ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ùˆ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Ø§ÛŒÙ† Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø±Ù†Ø¬ÛŒ Ù…Ø§Ù†Ù†Ø¯ Ø³Ø´Ù† Ø¢Ø³ÛŒØ§ Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³Øª Ùˆ Ø¨Ø§ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø§Ø² Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø®Ù„Ø§Ù Ø¬Ù‡Øª Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ ØªØ§ Ø±ÛŒØ³Ú© Ú©Ø§Ù‡Ø´ ÛŒØ§Ø¨Ø¯. 
// Ø§Ú©Ø³Ù¾Ø±Øª Ø§Ø² Ú†Ù‡Ø§Ø± Ø±Ù†Ø¬ Ù‡Ù…Ø²Ù…Ø§Ù† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ ØªØ§ Ù¾ÙˆØ´Ø´ Ú©Ø§Ù…Ù„ Ø¨Ø§Ø²Ø§Ø± Ø±Ø§ ÙØ±Ø§Ù‡Ù… Ú©Ù†Ø¯.
// Ù…Ù†Ø·Ù‚ ÙØ§ÛŒÙ„ Elemento.mq5: Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù‡Ù…Ø§Ù‡Ù†Ú¯â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø§ØµÙ„ÛŒ Ø§Ø³Øª. 
// Ø¯Ø± OnInit Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù…Ø§Ø¯ Ø±Ø§ Ú©Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ø±Ø§ ÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ú†Ù‡Ø§Ø± Ù†Ù…ÙˆÙ†Ù‡ CRange Ø±Ø§ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ 
// Ù‡Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ ATR Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ùˆ Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´ Ø±Ø§ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Ø¯Ø± OnDeinit ØªÙ…Ø§Ù… Ù…Ù†Ø§Ø¨Ø¹ Ø±Ø§ Ø¢Ø²Ø§Ø¯ Ùˆ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯. 
// Ø¯Ø± OnTick Ú©Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ØªØ´Ø®ÛŒØµ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ØŒ Ø±Ù†Ø¬â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ Ù‡Ø± Ø±Ù†Ø¬ Ø±Ø§ Ø¨Ù‡ Ø·ÙˆØ± Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ 
// Ùˆ Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø³ØªÙ‡ Ø¨ÙˆØ¯Ù† Ø¨Ø§Ø²Ø§Ø± Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Ø¯Ø± OnTimer (Ù‡Ø± Û¶Û° Ø«Ø§Ù†ÛŒÙ‡) Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙØ¹Ø§Ù„ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ ØªØ§ Ø¨Ø§Ø± OnTick Ú©Ø§Ù‡Ø´ ÛŒØ§Ø¨Ø¯. 
// Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ù‡Ø§Ù†ÛŒ Ù…Ø§Ù†Ù†Ø¯ g_ranges Ø¨Ø±Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø±Ù†Ø¬â€ŒÙ‡Ø§ØŒ g_lastBarTime Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ØŒ Ùˆ g_trendFilter Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. 
// ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ù†Ø³Ø®Ù‡ 2.10: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± OnInit Ø¨Ø§ Ù¾Ø§Ø±Ø³ Ú©Ø§Ù…Ù†Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ùˆ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ RestoreState Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ ÙØ¹Ø§Ù„ØŒ 
// Ø¨Ø±Ø§ÛŒ Ø­Ù„ Ø¨Ø§Ú¯ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù†Ø§Ù‚Øµ Ù¾Ø³ Ø§Ø² Ø±ÛŒâ€ŒØ§Ø³ØªØ§Ø±Øª. Ù‡Ù…Ú†Ù†ÛŒÙ† Ú©Ø§Ù…Ù†Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ùˆ Ø­ÙØ¸ Ø³Ø§Ø®ØªØ§Ø± Ù‚Ø¨Ù„ÛŒ.

#property copyright "Copyright 2025, Hipoalgorithm Team"  // Ú©Ù¾ÛŒâ€ŒØ±Ø§ÛŒØª ÙØ§ÛŒÙ„
#property link      "https://hipoalgorithm.com"  // Ù„ÛŒÙ†Ú© ÙˆØ¨â€ŒØ³Ø§ÛŒØª ØªÛŒÙ…
#property version   "2.10"  // ÙˆØ±Ú˜Ù† Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø§ ØªØºÛŒÛŒØ±Ø§Øª Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ùˆ Ù„Ø§Ú¯ Ù‡ÙˆØ´Ù…Ù†Ø¯
#property strict  // Ø­Ø§Ù„ØªåŽ³æ ¼ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø®Ø·Ø§Ù‡Ø§ÛŒ Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„

#include "Settings.mqh"  // ÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ùˆ enums
#include "Logger.mqh"  // Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø¬Ø¯ÛŒØ¯ Ù„Ø§Ú¯ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„â€ŒØ´Ø¯Ù‡
#include "CRange.mqh"  // Ú©Ù„Ø§Ø³ Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ù†Ø¬ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡
#include "TrendFilter.mqh"  // Ú©Ù„Ø§Ø³ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯
#include "VisualManager.mqh"  // Ú©Ù„Ø§Ø³ Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨ØµØ±ÛŒ Ø±ÙˆÛŒ Ú†Ø§Ø±Øª
#include "CActiveTradeManager.mqh"  // Ú©Ù„Ø§Ø³ Ø¬Ø¯ÛŒØ¯ Ù…Ø¯ÛŒØ± Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙØ¹Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø²

// Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Û´ Ø±Ù†Ø¬ (Ù‡Ø± Ú©Ø¯Ø§Ù… ÛŒÚ© Ù†Ù…ÙˆÙ†Ù‡ Ø§Ø² Ú©Ù„Ø§Ø³ CRange Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø³ØªÙ‚Ù„ Ø±Ù†Ø¬â€ŒÙ‡Ø§)
// Ø§ÛŒÙ† Ø¢Ø±Ø§ÛŒÙ‡ Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ú†Ù‡Ø§Ø± Ø±Ù†Ø¬ Ù‡Ù…Ø²Ù…Ø§Ù† Ø¨Ø¯ÙˆÙ† ØªØ¯Ø§Ø®Ù„ Ú©Ø§Ø± Ú©Ù†Ù†Ø¯
CRange g_ranges[4];  // Ø¢Ø±Ø§ÛŒÙ‡ Ø±Ù†Ø¬â€ŒÙ‡Ø§

// Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø²Ù…Ø§Ù† Ø¢Ø®Ø±ÛŒÙ† Ú©Ù†Ø¯Ù„ Ù‡Ø± ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… (Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø¬Ø±Ø§ÛŒ Ù…Ú©Ø±Ø±)
// Ù‡Ø± Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ÛŒÚ© Ø±Ù†Ø¬ Ø§Ø³Øª
datetime g_lastBarTime[4];  // Ø¢Ø±Ø§ÛŒÙ‡ Ø²Ù…Ø§Ù† Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø±

// Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ù‡Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ ATR shared (Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ ÛŒÚ© Ù‡Ù†Ø¯Ù„ ATR Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø§ÙØ³ØªØŒ SL Ùˆ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯)
// Ù‡Ù†Ø¯Ù„â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø§Ù†Ø¯ÛŒÚ©Ø§ØªÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
int g_atrHandles[4];  // Ø¢Ø±Ø§ÛŒÙ‡ Ù‡Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ ATR

// Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ú©Ø´â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ (Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù…Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÛŒØ³Ú©ØŒ Ø­Ø¬Ù… Ùˆ ÙØ§ØµÙ„Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø·ÙˆØ± Ø¯Ù‚ÛŒÙ‚ Ùˆ Ù…Ø³ØªÙ‚Ù„ Ø§Ø² Ù†ÙˆØ¹ Ù†Ù…Ø§Ø¯)
// Ú©Ø´ Ú©Ø±Ø¯Ù† Ø§ÛŒÙ† Ù…Ù‚Ø§Ø¯ÛŒØ± Ø§Ø² ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…Ú©Ø±Ø± SymbolInfoDouble Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
double g_tickValue;  // Ø§Ø±Ø²Ø´ ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø±ÛŒØ³Ú© (Ø¯Ù„Ø§Ø± Ø¨Ù‡ Ø§Ø²Ø§ÛŒ Ù‡Ø± ØªÛŒÚ©)
double g_tickSize;  // Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø¯Ù‚Øª Ù…Ø­Ø§Ø³Ø¨Ø§Øª (ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† ØªÛŒÚ©â€ŒÙ‡Ø§)
double g_volumeStep;  // Ú¯Ø§Ù… Ø­Ø¬Ù… Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù†Ø¯ Ú©Ø±Ø¯Ù† Ù„Ø§Øª (Ù…Ø«Ù„Ø§Ù‹ 0.01)
double g_volumeMin;  // Ø­Ø¯Ø§Ù‚Ù„ Ø­Ø¬Ù… Ù…Ø¬Ø§Ø² (Ù…Ø«Ù„Ø§Ù‹ 0.01)
double g_volumeMax;  // Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… Ù…Ø¬Ø§Ø² (Ù…Ø«Ù„Ø§Ù‹ 100)

// ÙÙ„Ú¯ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø­Ø§Ù„Øª tester (Ø¨Ø±Ø§ÛŒ Ø±ÙØªØ§Ø± Ù…ØªÙØ§ÙˆØª Ù…Ø§Ù†Ù†Ø¯ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ† Ú†Ú© Ø¨Ø§Ø²Ø§Ø± Ø¨Ø³ØªÙ‡ Ø¯Ø± Ø¨Ú©â€ŒØªØ³Øª)
// Ø§ÛŒÙ† ÙÙ„Ú¯ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø±Ø§ Ø¯Ø± Ø¨Ú©â€ŒØªØ³Øª Ùˆ Ù„Ø§ÛŒÙˆ Ù…ØªÙ…Ø§ÛŒØ² Ù…ÛŒâ€ŒÚ©Ù†Ø¯
bool g_isTester = false;  // ÙÙ„Ú¯ ØªØ³ØªØ±

// ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø¬Ù‡Ø§Ù†ÛŒ (Ù†Ù…ÙˆÙ†Ù‡â€ŒØ§ÛŒ Ø§Ø² CTrendFilter Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…Ø´ØªØ±Ú© Ø¯Ø± ØªÙ…Ø§Ù… Ø±Ù†Ø¬â€ŒÙ‡Ø§)
// Ø§ÛŒÙ† Ù†Ù…ÙˆÙ†Ù‡ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø¯Ø± Ù‡Ø± Ø±Ù†Ø¬ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
CTrendFilter g_trendFilter;  // ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø¬Ù‡Ø§Ù†ÛŒ

// Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´ Ø¬Ù‡Ø§Ù†ÛŒ (Ù†Ù…ÙˆÙ†Ù‡â€ŒØ§ÛŒ Ø§Ø² CVisualManager Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨ØµØ±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ Ù‡Ø± Ø±Ù†Ø¬ Ø±ÙˆÛŒ Ú†Ø§Ø±Øª)
// Ø§ÛŒÙ† Ù†Ù…ÙˆÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ØªÙ† Ù†Ù…Ø§ÛŒØ´ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
CVisualManager g_visualManager;  // Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´ Ø¬Ù‡Ø§Ù†ÛŒ

// Ù…Ø¯ÛŒØ± Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙØ¹Ø§Ù„ (Ù†Ù…ÙˆÙ†Ù‡â€ŒØ§ÛŒ Ø§Ø² CActiveTradeManager Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø²)
// Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ØªÙ…Ø§Ù… Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
CActiveTradeManager g_tradeManager;  // Ù…Ø¯ÛŒØ± Ù…Ø¹Ø§Ù…Ù„Ø§Øª

// ØªØ§Ø¨Ø¹ Ø´Ø±ÙˆØ¹ Ø§Ú©Ø³Ù¾Ø±Øª (OnInit): Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ØŒ Ú†Ú© ÙˆÙ„ÛŒØ¯ÛŒØ´Ù† Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ØªØ§ÛŒÙ…Ø±
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¯Ø± Ø´Ø±ÙˆØ¹ Ø§Ú©Ø³Ù¾Ø±Øª ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ ØªÙ…Ø§Ù… Ù…Ù†Ø§Ø¨Ø¹ Ø±Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
int OnInit()  // ØªØ§Ø¨Ø¹ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
{
   // ØªØ´Ø®ÛŒØµ Ø­Ø§Ù„Øª ØªØ³ØªØ± Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø±ÙØªØ§Ø± Ø®Ø§Øµ (Ù…Ø§Ù†Ù†Ø¯ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ† Ú†Ú© Ø¨Ø§Ø²Ø§Ø± Ø¨Ø³ØªÙ‡ Ø¯Ø± Ø¨Ú©â€ŒØªØ³Øª)
   // MQLInfoInteger Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ÛŒØ· Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
   g_isTester = MQLInfoInteger(MQL_TESTER);  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯ ØªØ³ØªØ±
   
   // Ú†Ø§Ù¾ Ù¾ÛŒØ§Ù… Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Print (Ú†ÙˆÙ† ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø± Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
   // Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… ÙÙ‚Ø· Ø¯Ø± Ø­Ø§Ù„Øª Ø¯ÛŒØ¨Ø§Ú¯ Ú†Ø§Ù¾ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   if(InpDebugMode) Print("Ø´Ø±ÙˆØ¹ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª Elemento Ù†Ø³Ø®Ù‡ 2.10...");  // Ú†Ø§Ù¾ Ø´Ø±ÙˆØ¹ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ

   // Ú©Ø´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒÙ…Ø¨Ù„ (Ù†Ù…Ø§Ø¯) Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÛŒØ³Ú©ØŒ Ø­Ø¬Ù… Ùˆ ÙØ§ØµÙ„Ù‡â€ŒÙ‡Ø§
   // SymbolInfoDouble Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ù†Ù…Ø§Ø¯ Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
   g_tickValue = SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_VALUE);  // Ú©Ø´ Ø§Ø±Ø²Ø´ ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø±ÛŒØ³Ú©
   g_tickSize = SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_SIZE);  // Ú©Ø´ Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø¯Ù‚Øª Ù…Ø­Ø§Ø³Ø¨Ø§Øª
   g_volumeStep = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_STEP);  // Ú©Ø´ Ú¯Ø§Ù… Ø­Ø¬Ù… Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù†Ø¯ Ú©Ø±Ø¯Ù† Ù„Ø§Øª
   g_volumeMin = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_MIN);  // Ú©Ø´ Ø­Ø¯Ø§Ù‚Ù„ Ø­Ø¬Ù… Ù…Ø¬Ø§Ø² Ø¨Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ø§Øª
   g_volumeMax = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_MAX);  // Ú©Ø´ Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… Ù…Ø¬Ø§Ø² Ø¨Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ø§Øª

   // Ú†Ú© ÙˆÙ„ÛŒØ¯ Ø¨ÙˆØ¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù…Ø§Ø¯ (Ø§Ú¯Ø± ØµÙØ± ÛŒØ§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯ØŒ Ø§Ú©Ø³Ù¾Ø±Øª Ù…ØªÙˆÙ‚Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø§Ø´ØªØ¨Ø§Ù‡)
   // Ø§ÛŒÙ† Ú†Ú© Ø§Ø² Ø®Ø·Ø§Ù‡Ø§ÛŒ runtime Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   if(g_tickValue <= 0 || g_tickSize <= 0 || g_volumeStep <= 0)  // Ø´Ø±Ø· Ú†Ú© Ù…Ù‚Ø§Ø¯ÛŒØ± Ú©Ø´
   {
      // Ú†Ø§Ù¾ Ø®Ø·Ø§ Ùˆ ØªÙˆÙ‚Ù Ø§Ú©Ø³Ù¾Ø±Øª Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Print (Ú†ÙˆÙ† Ø®Ø·Ø§ÛŒ Ù…Ø±Ú¯Ø¨Ø§Ø± Ø§Ø³Øª)
      Print("Ø®Ø·Ø§ÛŒ Ù…Ø±Ú¯Ø¨Ø§Ø±: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù…Ø§Ø¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª (tickValue/tickSize/volumeStep). Ø§Ú©Ø³Ù¾Ø±Øª Ù…ØªÙˆÙ‚Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§ Ùˆ ØªÙˆÙ‚Ù Ø§Ú©Ø³Ù¾Ø±Øª
      return(INIT_FAILED);  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ
   }

   // ÙˆÙ„ÛŒØ¯ÛŒØ´Ù† ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù…Ø¬Ø§Ø² Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù…Ù†Ø·Ù‚ÛŒ)
   // Ø§ÛŒÙ† Ú†Ú©â€ŒÙ‡Ø§ Ø§Ø² Ø§Ø¬Ø±Ø§ÛŒ Ù†Ø§Ø¯Ø±Ø³Øª Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯
   if(InpRiskPercent <= 0 || InpRiskPercent > 5.0)  // Ú†Ú© Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø±ÛŒØ³Ú©
   {
      Print("Ø®Ø·Ø§: RiskPercent Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 0.1 ØªØ§ 5.0 Ø¨Ø§Ø´Ø¯.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Ú© Ù†Ø§Ù…Ø¹ØªØ¨Ø±
      return(INIT_PARAMETERS_INCORRECT);  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§
   }

   // ÙˆÙ„ÛŒØ¯ÛŒØ´Ù† Inp_Confirmation_Timeout Ø§Ú¯Ø± Ø­Ø§Ù„Øª Ù‚Ø¯ÛŒÙ…ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
   // Ø§ÛŒÙ† Ú†Ú© ÙÙ‚Ø· Ø¯Ø± Ø­Ø§Ù„Øª ØªØ§ÛŒÙ…Ø± Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   if(Inp_Confirmation_Strategy == CONFIRMATION_TIMEOUT && (Inp_Confirmation_Timeout < 1 || Inp_Confirmation_Timeout > 10))  // Ú†Ú© Ù…Ø­Ø¯ÙˆØ¯Ù‡ ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª
   {
      Print("Ø®Ø·Ø§: Confirmation_Timeout Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 1 ØªØ§ 10 Ø¨Ø§Ø´Ø¯ (Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª ØªØ§ÛŒÙ…Ø±).");  // Ú†Ø§Ù¾ Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª Ù†Ø§Ù…Ø¹ØªØ¨Ø±
      return(INIT_PARAMETERS_INCORRECT);  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§
   }

   // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Û´ Ø±Ù†Ø¬ (Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ ÙØ¹Ø§Ù„ØŒ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ Ø±Ø§ Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ú¯Ø±ÙØªÙ‡ØŒ Ù‡Ù†Ø¯Ù„ ATR Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯ Ùˆ Init Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
   // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ú†Ù‡Ø§Ø± Ø±Ù†Ø¬ Ø¨Ù‡ ØµÙˆØ±Øª Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡
   for(int i = 0; i < 4; i++)  // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ú†Ù‡Ø§Ø± Ø±Ù†Ø¬
   {
      // Ú†Ú© ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø±Ù†Ø¬ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡ (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø´Ø±Ø· Ø³Ù‡â€ŒØªØ§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ)
      bool enabled = i == 0 ? InpRange1_Enabled : i == 1 ? InpRange2_Enabled : i == 2 ? InpRange3_Enabled : InpRange4_Enabled;  // Ú†Ú© ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø±Ù†Ø¬ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ±ÙˆØ¯ÛŒ
      if(!enabled)  // Ø´Ø±Ø· ØºÛŒØ±ÙØ¹Ø§Ù„
      {
         // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² CLogger (Ø¨Ø±Ø§ÛŒ Ù„Ø§Ú¯ Ù‡ÙˆØ´Ù…Ù†Ø¯)
         CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(i + 1) + " ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª. Ø±Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.", i + 1);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ ØºÛŒØ±ÙØ¹Ø§Ù„
         continue;  // Ù¾Ø±Ø´ Ø¨Ù‡ Ø±Ù†Ø¬ Ø¨Ø¹Ø¯ÛŒ
      }

      // Ù…Ø¬ÛŒÚ© Ù†Ø§Ù…Ø¨Ø± Ù…Ù†Ø­ØµØ±Ø¨Ù‡â€ŒÙØ±Ø¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ Ø¬Ù‡Øª ØªÙ…Ø§ÛŒØ² Ù…Ø¹Ø§Ù…Ù„Ø§Øª
      long magic = InpBaseMagicNumber + i;  // Ù…Ø¬ÛŒÚ© Ù†Ø§Ù…Ø¨Ø± Ù…Ù†Ø­ØµØ±Ø¨Ù‡â€ŒÙØ±Ø¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ Ø¬Ù‡Øª ØªÙ…Ø§ÛŒØ² Ù…Ø¹Ø§Ù…Ù„Ø§Øª
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø³Ø§Ø¹Øª Ùˆ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø´Ø±ÙˆØ¹ Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
      int startHour = i == 0 ? InpRange1_Start_Hour : i == 1 ? InpRange2_Start_Hour : i == 2 ? InpRange3_Start_Hour : InpRange4_Start_Hour;  // Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬
      int startMinute = i == 0 ? InpRange1_Start_Minute : i == 1 ? InpRange2_Start_Minute : i == 2 ? InpRange3_Start_Minute : InpRange4_Start_Minute;  // Ø¯Ù‚ÛŒÙ‚Ù‡ Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø³Ø§Ø¹Øª Ùˆ Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
      int endHour = i == 0 ? InpRange1_End_Hour : i == 1 ? InpRange2_End_Hour : i == 2 ? InpRange3_End_Hour : InpRange4_End_Hour;  // Ø³Ø§Ø¹Øª Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬
      int endMinute = i == 0 ? InpRange1_End_Minute : i == 1 ? InpRange2_End_Minute : i == 2 ? InpRange3_End_Minute : InpRange4_End_Minute;  // Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬

      // Ú†Ú© ÙˆÙ„ÛŒØ¯ Ø¨ÙˆØ¯Ù† Ø³Ø§Ø¹Ø§Øª Ùˆ Ø¯Ù‚ÛŒÙ‚Ù‡â€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±)
      // Ø§ÛŒÙ† Ú†Ú© Ø§Ø² Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
      if(startHour < 0 || startHour > 23 || startMinute < 0 || startMinute > 59 ||  // Ø´Ø±Ø· Ú†Ú© Ø´Ø±ÙˆØ¹
         endHour < 0 || endHour > 23 || endMinute < 0 || endMinute > 59)  // Ø´Ø±Ø· Ú†Ú© Ù¾Ø§ÛŒØ§Ù†
      {
         Print("Ø®Ø·Ø§: Ø³Ø§Ø¹Ø§Øª ÛŒØ§ Ø¯Ù‚ÛŒÙ‚Ù‡â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(i + 1) + " Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ Ø²Ù…Ø§Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø±
         return(INIT_PARAMETERS_INCORRECT);  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§
      }

      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§ Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
      ENUM_TIMEFRAMES timeframe = i == 0 ? InpRange1_Execution_Timeframe : i == 1 ? InpRange2_Execution_Timeframe : i == 2 ? InpRange3_Execution_Timeframe : InpRange4_Execution_Timeframe;  // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§ Ø±Ù†Ø¬
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¯ÙˆØ±Ù‡ ATR Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
      int atrPeriod = i == 0 ? InpRange1_ATR_Period : i == 1 ? InpRange2_ATR_Period : i == 2 ? InpRange3_ATR_Period : InpRange4_ATR_Period;  // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ Ø§ÙØ³Øª
      // Ø§ÛŒØ¬Ø§Ø¯ Ù‡Ù†Ø¯Ù„ ATR Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ù¾ÙˆÛŒØ§ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² iATR
      g_atrHandles[i] = iATR(_Symbol, timeframe, atrPeriod);  // Ø§ÛŒØ¬Ø§Ø¯ Ù‡Ù†Ø¯Ù„ ATR Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ù¾ÙˆÛŒØ§
      if(g_atrHandles[i] == INVALID_HANDLE)  // Ú†Ú© Ù‡Ù†Ø¯Ù„ Ù…Ø¹ØªØ¨Ø±
      {
         Print("Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù‡Ù†Ø¯Ù„ ATR Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(i + 1));  // Ú†Ø§Ù¾ Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ Ù‡Ù†Ø¯Ù„ Ù†Ø§Ù…Ø¹ØªØ¨Ø±
         return(INIT_FAILED);  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ
      }

      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ SL Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
      ENUM_SL_STRATEGY slStrategy = i == 0 ? InpRange1_SL_Strategy : i == 1 ? InpRange2_SL_Strategy : i == 2 ? InpRange3_SL_Strategy : InpRange4_SL_Strategy;  // Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ SL
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø­Ø§Ù„Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± SL Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
      ENUM_SL_CALC_MODE slCalcMode = i == 0 ? InpRange1_SL_Calc_Mode : i == 1 ? InpRange2_SL_Calc_Mode : i == 2 ? InpRange3_SL_Calc_Mode : InpRange4_SL_Calc_Mode;  // Ø­Ø§Ù„Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± SL
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ SL Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
      int slAtrPeriod = i == 0 ? InpRange1_SL_ATR_Period : i == 1 ? InpRange2_SL_ATR_Period : i == 2 ? InpRange3_SL_ATR_Period : InpRange4_SL_ATR_Period;  // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ SL
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ SL Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
      double slAtrMultiplier = i == 0 ? InpRange1_SL_ATR_Multiplier : i == 1 ? InpRange2_SL_ATR_Multiplier : i == 2 ? InpRange3_SL_ATR_Multiplier : InpRange4_SL_ATR_Multiplier;  // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ SL

      // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Init Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ Ø¨Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡ (Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ú©Ø§Ù…Ù„ Ø±Ù†Ø¬ØŒ Ø´Ø§Ù…Ù„ SL strategy Ø¬Ø¯ÛŒØ¯)
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø´Ø±Ø· Ø³Ù‡â€ŒØªØ§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±
      if(!g_ranges[i].Init(  // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Init Ø±Ù†Ø¬
         i + 1, magic, timeframe, startHour, startMinute, endHour, endMinute,  // Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
         i == 0 ? InpRange1_MinRangePoints : i == 1 ? InpRange2_MinRangePoints : i == 2 ? InpRange3_MinRangePoints : InpRange4_MinRangePoints,  // Ø­Ø¯Ø§Ù‚Ù„ Ø§Ø±ØªÙØ§Ø¹
         i == 0 ? InpRange1_MaxRangePoints : i == 1 ? InpRange2_MaxRangePoints : i == 2 ? InpRange3_MaxRangePoints : InpRange4_MaxRangePoints,  // Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø±ØªÙØ§Ø¹
         i == 0 ? InpRange1_Placement_Mode : i == 1 ? InpRange2_Placement_Mode : i == 2 ? InpRange3_Placement_Mode : InpRange4_Placement_Mode,  // Ø­Ø§Ù„Øª Ø§ÙØ³Øª
         atrPeriod,  // Ø¯ÙˆØ±Ù‡ ATR
         i == 0 ? InpRange1_ATR_Multiplier : i == 1 ? InpRange2_ATR_Multiplier : i == 2 ? InpRange3_ATR_Multiplier : InpRange4_ATR_Multiplier,  // Ø¶Ø±ÛŒØ¨ ATR
         slStrategy, slCalcMode, slAtrPeriod, slAtrMultiplier,  // Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ SL
         i == 0 ? InpRange1_Trailing_Mode : i == 1 ? InpRange2_Trailing_Mode : i == 2 ? InpRange3_Trailing_Mode : InpRange4_Trailing_Mode,  // Ø­Ø§Ù„Øª ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
         i == 0 ? InpRange1_Trailing_ATR_Period : i == 1 ? InpRange2_Trailing_ATR_Period : i == 2 ? InpRange3_Trailing_ATR_Period : InpRange4_Trailing_ATR_Period,  // Ø¯ÙˆØ±Ù‡ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
         i == 0 ? InpRange1_Trailing_ATR_Multiplier : i == 1 ? InpRange2_Trailing_ATR_Multiplier : i == 2 ? InpRange3_Trailing_ATR_Multiplier : InpRange4_Trailing_ATR_Multiplier,  // Ø¶Ø±ÛŒØ¨ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
         i == 0 ? InpRange1_RR_Ratio : i == 1 ? InpRange2_RR_Ratio : i == 2 ? InpRange3_RR_Ratio : InpRange4_RR_Ratio,  // Ù†Ø³Ø¨Øª RR
         i == 0 ? InpRange1_PartialClosePercent : i == 1 ? InpRange2_PartialClosePercent : i == 2 ? InpRange3_PartialClosePercent : InpRange4_PartialClosePercent,  // Ø¯Ø±ØµØ¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
         i == 0 ? InpRange1_Cleanup_Hours : i == 1 ? InpRange2_Cleanup_Hours : i == 2 ? InpRange3_Cleanup_Hours : InpRange4_Cleanup_Hours,  // Ø³Ø§Ø¹Øª Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
         i == 0 ? InpRange1_Color : i == 1 ? InpRange2_Color : i == 2 ? InpRange3_Color : InpRange4_Color,  // Ø±Ù†Ú¯
         i == 0 ? InpRange1_TrendFilter_Timeframe : i == 1 ? InpRange2_TrendFilter_Timeframe : i == 2 ? InpRange3_TrendFilter_Timeframe : InpRange4_TrendFilter_Timeframe,  // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ±
         g_atrHandles[i]  // Ù‡Ù†Ø¯Ù„ ATR
      ))  // Ù¾Ø§ÛŒØ§Ù† ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Init
      {
         Print("Ø®Ø·Ø§ Ø¯Ø± Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø±Ù†Ø¬ " + IntegerToString(i + 1) + ": " + IntegerToString(GetLastError()));  // Ú†Ø§Ù¾ Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ú©Ø³Øª Init
         return(INIT_PARAMETERS_INCORRECT);  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§
      }
   }

   // (Ø¬Ø¯ÛŒØ¯) Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø­Ø§ÙØ¸Ù‡: Ú†Ú© Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø² Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ Ùˆ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø­Ø§Ù„Øª Ø§Ú¯Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø¨Ø§Ø² Ø¨Ø§Ø´Ø¯ (Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§ÙˆÙ…Øª Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ø±ÛŒâ€ŒØ§Ø³ØªØ§Ø±Øª)
   // Ø§ÛŒÙ† Ø­Ù„Ù‚Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø² Ø±Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   // Ø§ÛŒÙ† Ú©Ø¯ Ú©Ø§Ù…Ù„ Ùˆ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø¢Ù† Ø±Ø§ Ø¯Ø± ØªØ§Ø¨Ø¹ OnInit Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø­Ù„Ù‚Ù‡ Ù‚Ø¨Ù„ÛŒ Ú©Ù†.

// (Ø¬Ø¯ÛŒØ¯) Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø­Ø§ÙØ¸Ù‡: Ú†Ú© Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø² Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ Ùˆ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø­Ø§Ù„Øª
for(int i = 0; i < 4; i++)
{
    bool enabled = i == 0 ? InpRange1_Enabled : i == 1 ? InpRange2_Enabled : i == 2 ? InpRange3_Enabled : InpRange4_Enabled;
    if(!enabled) continue;

    long magic = InpBaseMagicNumber + i;
    for(int pos = PositionsTotal() - 1; pos >= 0; pos--)
    {
        if(PositionGetSymbol(pos) == _Symbol && PositionGetInteger(POSITION_MAGIC) == magic)
        {
            ulong ticket = PositionGetInteger(POSITION_TICKET);
            double openPrice = PositionGetDouble(POSITION_PRICE_OPEN);
            double sl = PositionGetDouble(POSITION_SL);

            // Ø¨Ù‡ CRange Ù…ÛŒÚ¯ÛŒÙ… Ú©Ù‡ ÛŒÙ‡ Ù…Ø¹Ø§Ù…Ù„Ù‡ ÙØ¹Ø§Ù„ Ø¯Ø§Ø´ØªÙ‡
            g_ranges[i].SetActiveTicket(ticket);
            g_ranges[i].SetCurrentState(RANGE_TRADE_ACTIVE);
            
            CLogger::Log("Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§Ø² Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(i + 1) + " Ù¾ÛŒØ¯Ø§ Ø´Ø¯. Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª Ø¯Ø± Ù…Ø¯ÛŒØ± Ù…Ø¹Ø§Ù…Ù„Ø§Øª...", i + 1);

            // Û±. Ø®ÙˆÙ†Ø¯Ù† Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆØ±ÙˆØ¯ÛŒ
            double rec_rr_ratio = i == 0 ? InpRange1_RR_Ratio : i == 1 ? InpRange2_RR_Ratio : i == 2 ? InpRange3_RR_Ratio : InpRange4_RR_Ratio;
            double rec_partial_percent = i == 0 ? InpRange1_PartialClosePercent : i == 1 ? InpRange2_PartialClosePercent : i == 2 ? InpRange3_PartialClosePercent : InpRange4_PartialClosePercent;
            ENUM_TRAILING_MODE rec_trailing_mode = i == 0 ? InpRange1_Trailing_Mode : i == 1 ? InpRange2_Trailing_Mode : i == 2 ? InpRange3_Trailing_Mode : InpRange4_Trailing_Mode;
            int rec_trailing_atr_period = i == 0 ? InpRange1_Trailing_ATR_Period : i == 1 ? InpRange2_Trailing_ATR_Period : i == 2 ? InpRange3_Trailing_ATR_Period : InpRange4_Trailing_ATR_Period;
            double rec_trailing_atr_multiplier = i == 0 ? InpRange1_Trailing_ATR_Multiplier : i == 1 ? InpRange2_Trailing_ATR_Multiplier : i == 2 ? InpRange3_Trailing_ATR_Multiplier : InpRange4_Trailing_ATR_Multiplier;
            ENUM_TIMEFRAMES rec_exec_tf = i == 0 ? InpRange1_Execution_Timeframe : i == 1 ? InpRange2_Execution_Timeframe : i == 2 ? InpRange3_Execution_Timeframe : InpRange4_Execution_Timeframe;
            ENUM_TIMEFRAMES rec_trend_tf = i == 0 ? InpRange1_TrendFilter_Timeframe : i == 1 ? InpRange2_TrendFilter_Timeframe : i == 2 ? InpRange3_TrendFilter_Timeframe : InpRange4_TrendFilter_Timeframe;
            
            // Û². Ø®ÙˆÙ†Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­ÛŒØ§ØªÛŒ Ø§Ø² Ú©Ø§Ù…Ù†Øª Ø®ÙˆØ¯ Ù…Ø¹Ø§Ù…Ù„Ù‡
            string comment = PositionGetString(POSITION_COMMENT);
            string parts[];
            double rec_high = 0.0, rec_low = 0.0, initial_sl_dist = 0.0;
            if(StringSplit(comment, ';', parts) >= 4)
            {
                rec_high = StringToDouble(StringSubstr(parts[1], 2));
                rec_low = StringToDouble(StringSubstr(parts[2], 2));
                initial_sl_dist = StringToDouble(StringSubstr(parts[3], 4));
                g_ranges[i].RestoreState(rec_high, rec_low, initial_sl_dist);
            }
            else
            {
               CLogger::Log("Ú©Ø§Ù…Ù†Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.", i+1);
            }

            // Û³. Ø«Ø¨Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¯Ø± Ù…Ø¯ÛŒØ± Ù…Ø¹Ø§Ù…Ù„Ø§Øª (Ø§ÛŒÙ† Ø®Ø· Ø­ÛŒØ§ØªÛŒâ€ŒØªØ±ÛŒÙ† Ø¨Ø®Ø´ Ø§ØµÙ„Ø§Ø­Ù‡)
            g_tradeManager.RegisterTrade(
                ticket,
                magic,
                i + 1, // Range Index
                initial_sl_dist,
                openPrice,
                rec_rr_ratio,
                rec_partial_percent,
                rec_trailing_mode,
                rec_trailing_atr_period,
                rec_trailing_atr_multiplier,
                rec_exec_tf,
                g_ranges[i].m_trailingAtrHandle, // Ù‡Ù†Ø¯Ù„ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ùˆ Ø§Ø² Ø®ÙˆØ¯ Ø±Ù†Ø¬ Ù…ÛŒÚ¯ÛŒØ±ÛŒÙ…
                rec_trend_tf
            );
            CLogger::Log("Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ ActiveTradeManager Ø«Ø¨Øª Ø´Ø¯.", i + 1);

            // Û´. Ú†Ú© Ú©Ø±Ø¯Ù† Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù‚Ø¨Ù„Ø§ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ Ø´Ø¯Ù‡ ÛŒØ§ Ù†Ù‡
            if (MathAbs(sl - openPrice) < (_Point * 5))
            {
               g_tradeManager.SetPartialClosedFlag(ticket, true);
               CLogger::Log("Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø±Ù†Ø¬ " + IntegerToString(i+1) + " Ù‚Ø¨Ù„Ø§Ù‹ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ Ø´Ø¯Ù‡. Ø­Ø§Ù„Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.", i + 1);
            }
            
            break; // Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ù„Ù‚Ù‡ Ø¯Ø§Ø®Ù„ÛŒ Ú†ÙˆÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§ÛŒÙ† Ø±Ù†Ø¬ Ù¾ÛŒØ¯Ø§ Ø´Ø¯
        }
    }
}

   // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø¬Ù‡Ø§Ù†ÛŒ (Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯ Ø¯Ø± ØªÙ…Ø§Ù… Ø±Ù†Ø¬â€ŒÙ‡Ø§)
   // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Init ÙÛŒÙ„ØªØ± (Ú©Ù‡ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª Ø§Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ)
   if(!g_trendFilter.Init())  // Ú†Ú© Ù…ÙˆÙÙ‚ÛŒØª Init
   {
      Print("Ø®Ø·Ø§ Ø¯Ø± Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ú©Ø³Øª Init ÙÛŒÙ„ØªØ±
      return(INIT_FAILED);  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ
   }
   // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´ Ø¬Ù‡Ø§Ù†ÛŒ (Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ Ù‡Ø± Ø±Ù†Ø¬ Ø±ÙˆÛŒ Ú†Ø§Ø±Øª)
   // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Init Ù†Ù…Ø§ÛŒØ´Ú¯Ø±
   if(!g_visualManager.Init())  // Ú†Ú© Ù…ÙˆÙÙ‚ÛŒØª Init
   {
      Print("Ø®Ø·Ø§ Ø¯Ø± Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ú©Ø³Øª Init Ù†Ù…Ø§ÛŒØ´Ú¯Ø±
      return(INIT_FAILED);  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ
   }

   // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø²Ù…Ø§Ù† Ø¢Ø®Ø±ÛŒÙ† Ú©Ù†Ø¯Ù„â€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ Ø¯Ø± OnTick)
   // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Øª Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙØ±
   for(int i = 0; i < 4; i++)  // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Øª Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§
   {
      g_lastBarTime[i] = 0;  // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ù‡ ØµÙØ±
   }

   // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ØªØ§ÛŒÙ…Ø± Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù‡Ø± Û¶Û° Ø«Ø§Ù†ÛŒÙ‡ (Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ OnTick)
   // EventSetTimer ØªØ§ÛŒÙ…Ø± Ø±Ø§ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   EventSetTimer(60);  // ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…Ø± Û¶Û° Ø«Ø§Ù†ÛŒÙ‡

   // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø¨Ø§ Print (Ú†ÙˆÙ† Ù†Ù‡Ø§ÛŒÛŒ Ø§Ø³Øª)
   Print("Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª Elemento Ù†Ø³Ø®Ù‡ 2.10 Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.");  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ
   return(INIT_SUCCEEDED);  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ÛŒØª
}

// ØªØ§Ø¨Ø¹ Ù¾Ø§ÛŒØ§Ù† Ø§Ú©Ø³Ù¾Ø±Øª (OnDeinit): Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù…Ù†Ø§Ø¨Ø¹ Ùˆ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª ØªÙ…Ø§Ù… Ø±Ù†Ø¬â€ŒÙ‡Ø§
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¯Ø± Ù¾Ø§ÛŒØ§Ù† Ø§Ú©Ø³Ù¾Ø±Øª ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…Ù†Ø§Ø¨Ø¹ Ø±Ø§ Ø¢Ø²Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
void OnDeinit(const int reason)  // ØªØ§Ø¨Ø¹ Ø¯ÙØ¹ Ø¨Ø§ Ø¯Ù„ÛŒÙ„
{
   // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø¯Ù„ÛŒÙ„ Ø¯ÙØ¹ Ø¨Ø§ Print (Ú†ÙˆÙ† ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø±)
   if(InpDebugMode) Print("Ø¯ÙØ¹ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª Elemento Ù†Ø³Ø®Ù‡ 2.10. Ø¯Ù„ÛŒÙ„: " + IntegerToString(reason));  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø¯Ù„ÛŒÙ„ Ø¯ÙØ¹

   // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª ØªÙ…Ø§Ù… Ø±Ù†Ø¬â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ Ùˆ Ø±ÛŒØ³Øª (Ø¯Ø± ØµÙˆØ±Øª Ú©Ø±Ø´ ÛŒØ§ Ø®Ø±ÙˆØ¬)
   // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª Ù‡Ø± Ø±Ù†Ø¬
   for(int i = 0; i < 4; i++)  // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª Ù‡Ø± Ø±Ù†Ø¬
   {
      g_ranges[i].HardCleanup();  // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª
   }

   // Ø¯ÙØ¹ Ù‡Ø± Ø±Ù†Ø¬ Ùˆ Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ù‡Ù†Ø¯Ù„ ATR Ù…Ø±Ø¨ÙˆØ·Ù‡
   // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯ÙØ¹ Ø±Ù†Ø¬â€ŒÙ‡Ø§ Ùˆ Ù‡Ù†Ø¯Ù„â€ŒÙ‡Ø§
   for(int i = 0; i < 4; i++)  // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯ÙØ¹ Ø±Ù†Ø¬â€ŒÙ‡Ø§
   {
      g_ranges[i].Deinit();  // Ø¯ÙØ¹ Ø±Ù†Ø¬
      if(g_atrHandles[i] != INVALID_HANDLE)  // Ú†Ú© Ù‡Ù†Ø¯Ù„ Ù…Ø¹ØªØ¨Ø±
      {
         IndicatorRelease(g_atrHandles[i]);  // Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ù‡Ù†Ø¯Ù„ ATR
      }
   }

   // Ø¯ÙØ¹ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ùˆ Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´
   g_trendFilter.Deinit();  // Ø¯ÙØ¹ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯
   g_visualManager.Deinit();  // Ø¯ÙØ¹ Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´
   // Ø­Ø°Ù ØªÙ…Ø§Ù… Ø§Ø´ÛŒØ§Ø¡ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ Ø¨Ø§ Ù¾ÛŒØ´ÙˆÙ†Ø¯ Range_ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ú†Ø§Ø±Øª
   ObjectsDeleteAll(0, "Range_");  // Ø­Ø°Ù ØªÙ…Ø§Ù… Ø§Ø´ÛŒØ§Ø¡ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ Ø¨Ø§ Ù¾ÛŒØ´ÙˆÙ†Ø¯ Range_ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ú†Ø§Ø±Øª
   Print("ØªÙ…Ø§Ù…ÛŒ Ø§Ø´ÛŒØ§Ø¡ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø´Ø¯Ù†Ø¯.");  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø§Ø´ÛŒØ§Ø¡

   // Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† ØªØ§ÛŒÙ…Ø±
   EventKillTimer();  // Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† ØªØ§ÛŒÙ…Ø±
}

// ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ù‡Ø± ØªÛŒÚ© (OnTick): ØªØ´Ø®ÛŒØµ Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ØŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ù†Ø¬â€ŒÙ‡Ø§ Ùˆ Ú†Ú© Ø¨Ø§Ø²Ø§Ø±
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¯Ø± Ù‡Ø± ØªÛŒÚ© Ù‚ÛŒÙ…Øª ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…Ù†Ø·Ù‚ Ø§ØµÙ„ÛŒ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
void OnTick()  // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ù‡Ø± ØªÛŒÚ©
{
   // Ú†Ú© Ø±ÙˆØ² Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù…Ø§Ø¯ (Ø¯Ø± ØµÙˆØ±Øª ØªØºÛŒÛŒØ± Ù…Ø´Ø®ØµØ§Øª Ø¨Ø±ÙˆÚ©Ø±)
   // Ù…ØªØºÛŒØ± Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø±ÙˆØ² Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
   static datetime lastDay = 0;  // Ù…ØªØºÛŒØ± Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø±ÙˆØ² Ø¢Ø®Ø±ÛŒÙ†
   datetime currentDay = TimeCurrent() / 86400;  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆØ² ÙØ¹Ù„ÛŒ (Ø«Ø§Ù†ÛŒÙ‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø±ÙˆØ²)
   if(currentDay != lastDay)  // Ú†Ú© ØªØºÛŒÛŒØ± Ø±ÙˆØ²
   {
      // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù…Ø§Ø¯ Ø¨Ø§ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…Ø¬Ø¯Ø¯ SymbolInfoDouble
      g_tickValue = SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_VALUE);  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø±Ø²Ø´ ØªÛŒÚ©
      g_tickSize = SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_SIZE);  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªÛŒÚ©
      g_volumeStep = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_STEP);  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú¯Ø§Ù… Ø­Ø¬Ù…
      g_volumeMin = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_MIN);  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø­Ø¯Ø§Ù‚Ù„ Ø­Ø¬Ù…
      g_volumeMax = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_MAX);  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù…
      // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¨Ø§ CLogger
      CLogger::Log("Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù…Ø§Ø¯ Ø¯Ø± Ø±ÙˆØ² Ø¬Ø¯ÛŒØ¯.");  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
      lastDay = currentDay;  // Ø°Ø®ÛŒØ±Ù‡ Ø±ÙˆØ² Ø¬Ø¯ÛŒØ¯
   }

   // Ø§Ú¯Ø± ØªØ³ØªØ± Ù†ÛŒØ³Øª Ùˆ Ø¨Ø§Ø²Ø§Ø± Ø¨Ø³ØªÙ‡ Ø§Ø³Øª ÛŒØ§ ÛŒÚ© Ø³Ø§Ø¹Øª Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù†ØŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯
   // Ø§ÛŒÙ† Ø´Ø±Ø· Ø§Ø² Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¯Ø± ØªØ¹Ø·ÛŒÙ„Ø§Øª Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   if(!g_isTester && (IsMarketClosed() || IsOneHourBeforeMarketClose()))  // Ú†Ú© Ø´Ø±Ø§ÛŒØ· Ø¨Ø§Ø²Ø§Ø± Ø¨Ø³ØªÙ‡
   {
      // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ ÙØ¹Ø§Ù„
      for(int i = 0; i < 4; i++)  // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬
      {
         // Ú†Ú© ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø±Ù†Ø¬
         bool enabled = i == 0 ? InpRange1_Enabled : i == 1 ? InpRange2_Enabled : i == 2 ? InpRange3_Enabled : InpRange4_Enabled;  // Ú†Ú© ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù†
         if(enabled)  // Ø´Ø±Ø· ÙØ¹Ø§Ù„
         {
            g_ranges[i].HardCleanup();  // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª Ø±Ù†Ø¬ (Ø¨Ø³ØªÙ† Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ùˆ Ø±ÛŒØ³Øª Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø² Ø¯Ø± ØªØ¹Ø·ÛŒÙ„Ø§Øª)
         }
      }
      return;  // Ø®Ø±ÙˆØ¬ Ø§Ø² ØªØ§Ø¨Ø¹
   }

   // ÙÙ„Ú¯ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´
   bool newBarDetected = false;  // ÙÙ„Ú¯ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´
   string trendDisplayText = "";  // Ù…ØªÙ† Ú©Ø§Ù…Ù„ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ Ù‡Ø± Ø±Ù†Ø¬
   // Ù…ØªØºÛŒØ± Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù„Ø§Ú¯ ØªÚ©Ø±Ø§Ø±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯
   static string lastTrendStatusText = "";  // Ù…ØªØºÛŒØ± Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù„Ø§Ú¯ ØªÚ©Ø±Ø§Ø±ÛŒ

   // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ ÙØ¹Ø§Ù„
   for(int i = 0; i < 4; i++)  // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬
   {
      // Ú†Ú© ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø±Ù†Ø¬
      bool enabled = i == 0 ? InpRange1_Enabled : i == 1 ? InpRange2_Enabled : i == 2 ? InpRange3_Enabled : InpRange4_Enabled;  // Ú†Ú© ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø±Ù†Ø¬
      if(!enabled) continue;  // Ù¾Ø±Ø´ Ø§Ú¯Ø± ØºÛŒØ±ÙØ¹Ø§Ù„

      // Ú¯Ø±ÙØªÙ† ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§ Ø±Ù†Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³ CRange
      ENUM_TIMEFRAMES timeframe = g_ranges[i].GetTimeframe();  // Ú¯Ø±ÙØªÙ† ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§ Ø±Ù†Ø¬

      // Ú†Ú© Ù„ÙˆØ¯ Ú©Ø§ÙÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ (Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§ÛŒ Ø±Ù†Ø¬ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø¬Ø±Ø§ÛŒ Ø²ÙˆØ¯Ø±Ø³)
      // Bars ØªØ¹Ø¯Ø§Ø¯ Ú©Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù„ÙˆØ¯Ø´Ø¯Ù‡ Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
      if(Bars(_Symbol, timeframe) < 200)  // Ú†Ú© ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø±Ù‡Ø§
      {
         CLogger::Log("ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(i + 1) + " Ù„ÙˆØ¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø±Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.", i + 1);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ø§Ú©Ø§ÙÛŒ
         continue;  // Ù¾Ø±Ø´ Ø¨Ù‡ Ø±Ù†Ø¬ Ø¨Ø¹Ø¯ÛŒ
      }

      // Ø²Ù…Ø§Ù† Ú©Ù†Ø¯Ù„ ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø¬Ø¯ÛŒØ¯ Ø¨ÙˆØ¯Ù† Ø¨Ø§ iTime
      datetime currentBarTime = iTime(_Symbol, timeframe, 0);  // Ø²Ù…Ø§Ù† Ú©Ù†Ø¯Ù„ ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø¬Ø¯ÛŒØ¯ Ø¨ÙˆØ¯Ù†
      if(currentBarTime == 0)  // Ú†Ú© Ø²Ù…Ø§Ù† Ù…Ø¹ØªØ¨Ø±
      {
         CLogger::Log("Ø®Ø·Ø§: iTime Ù…Ù‚Ø¯Ø§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(i + 1), i + 1);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         continue;  // Ù¾Ø±Ø´
      }

      // ØªØ´Ø®ÛŒØµ Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ù†Ø¬ (ÙÙ‚Ø· Ø¯Ø± Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§ Ø¨Ø§Ø± Ú©Ø§Ù‡Ø´ ÛŒØ§Ø¨Ø¯)
      if(currentBarTime > g_lastBarTime[i])  // Ú†Ú© Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯
      {
         // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ CLogger
         CLogger::Log("Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(i + 1) + " Ø¯Ø± ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… " + EnumToString(timeframe), i + 1);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯
         g_ranges[i].UpdateOnNewBar();  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø±Ù†Ø¬
         g_lastBarTime[i] = currentBarTime;  // Ø°Ø®ÛŒØ±Ù‡ Ø²Ù…Ø§Ù† Ø¬Ø¯ÛŒØ¯
         newBarDetected = true;  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯ Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯
      }

      // Ú†Ú© Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ Ø¯Ø± ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ± Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ø¯ÛŒØª Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆÙ†Ø¯ Ø¢Ù† Ø±Ù†Ø¬
      // Ú¯Ø±ÙØªÙ† ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ± Ø§Ø² Ú©Ù„Ø§Ø³
      ENUM_TIMEFRAMES trendTf = g_ranges[i].GetTrendFilterTimeframe();  // Ú¯Ø±ÙØªÙ† ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ±
      datetime currentTrendBarTime = iTime(_Symbol, trendTf, 0);  // Ø²Ù…Ø§Ù† Ú©Ù†Ø¯Ù„ ÙÛŒÙ„ØªØ± ÙØ¹Ù„ÛŒ
      if(currentTrendBarTime > g_ranges[i].GetLastFilterBarTime())  // Ú†Ú© Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯ ÙÛŒÙ„ØªØ±
      {
         // Ú¯Ø±ÙØªÙ† Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯ Ø§Ø² ÙÛŒÙ„ØªØ±
         ENUM_TREND_DIRECTION trend = g_trendFilter.GetTrendDirection(trendTf);  // Ú¯Ø±ÙØªÙ† Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯
         // ØªØ¨Ø¯ÛŒÙ„ Ø¬Ù‡Øª Ø¨Ù‡ Ø±Ø´ØªÙ‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´
         string trendStr = trend == TREND_BUY ? "Bullish" : trend == TREND_SELL ? "Bearish" : "Neutral";  // ØªØ¨Ø¯ÛŒÙ„ Ø¬Ù‡Øª Ø¨Ù‡ Ø±Ø´ØªÙ‡
         string tfStr = EnumToString(trendTf);  // ØªØ¨Ø¯ÛŒÙ„ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø¨Ù‡ Ø±Ø´ØªÙ‡
         // Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ Ù…ØªÙ† Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§ ÙØ±Ù…Øª Ù…Ø´Ø®Øµ
         trendDisplayText += "Range " + IntegerToString(i + 1) + " (Filter " + tfStr + "): " + trendStr + "\n";  // Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ Ù…ØªÙ† Ù†Ù…Ø§ÛŒØ´
         g_ranges[i].UpdateLastFilterBarTime(currentTrendBarTime);  // Ø¢Ù¾Ø¯ÛŒØª Ø²Ù…Ø§Ù† Ø¯Ø± Ø±Ù†Ø¬
         // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ø¯ÛŒØª Ø±ÙˆÙ†Ø¯ Ø¨Ø§ CLogger
         CLogger::Log("Ø¢Ù¾Ø¯ÛŒØª Ø±ÙˆÙ†Ø¯ Ø±Ù†Ø¬ " + IntegerToString(i + 1) + ": " + trendStr, i + 1);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ø¯ÛŒØª Ø±ÙˆÙ†Ø¯
      }

      // Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ù‡ OnTimer Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù‡ØŒ Ø§ÛŒÙ†Ø¬Ø§ ÙÙ‚Ø· Ú†Ú© Ø­Ø§Ù„Øª Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
      if(enabled && g_ranges[i].GetCurrentState() == RANGE_TRADE_ACTIVE)  // Ú†Ú© Ø­Ø§Ù„Øª Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡
      {
         // Ù‡ÛŒÚ† Ø¹Ù…Ù„ÛŒ Ø¯Ø± OnTickØŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø± OnTimer Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯
         // Ø§ÛŒÙ† Ú†Ú© ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø­Ø§Ù„Øª Ø§Ø³Øª
      }
   }

   // Ù„Ø§Ú¯ Ú©Ø±Ø¯Ù† ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ ÙÙ‚Ø· Ø§Ú¯Ø± ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ Ùˆ Ù…ØªÙ† Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯
   if(trendDisplayText != "" && trendDisplayText != lastTrendStatusText)  // Ú†Ú© ØªØºÛŒÛŒØ± Ù…ØªÙ†
   {
      CLogger::Log("ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯:\n" + trendDisplayText);  // Ù„Ø§Ú¯ Ú©Ø±Ø¯Ù† ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯
      lastTrendStatusText = trendDisplayText;  // Ø°Ø®ÛŒØ±Ù‡ Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯
   }

   // Ø¢Ù¾Ø¯ÛŒØª Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ø¨Ø§ Ù…ØªÙ† Ú©Ø§Ù…Ù„ ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ Ù‡Ø± Ø±Ù†Ø¬ (Ø§Ú¯Ø± Ù†Ù…Ø§ÛŒØ´ ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯)
   if(Inp_Visual_ShowTrendStatus && trendDisplayText != "")  // Ú†Ú© ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ù†Ù…Ø§ÛŒØ´ Ùˆ Ù…ØªÙ† Ù…ÙˆØ¬ÙˆØ¯
   {
      g_visualManager.UpdateTrendStatus(trendDisplayText);  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´Ú¯Ø±
   }
}

// ØªØ§Ø¨Ø¹ ØªØ§ÛŒÙ…Ø± (OnTimer): Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙØ¹Ø§Ù„ Ù‡Ø± Û¶Û° Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ø¨Ø§Ø± OnTick
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù‡Ø± 60 Ø«Ø§Ù†ÛŒÙ‡ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
void OnTimer()  // ØªØ§Ø¨Ø¹ ØªØ§ÛŒÙ…Ø±
{
   g_tradeManager.ManageAllTrades();  // Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙØ¹Ø§Ù„ Ø¯Ø± Ù…Ø¯ÛŒØ± Ù…Ø¹Ø§Ù…Ù„Ø§Øª
}

// ØªØ§Ø¨Ø¹ Ú†Ú© ÛŒÚ© Ø³Ø§Ø¹Øª Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† Ø¨Ø§Ø²Ø§Ø± (Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø² Ø¯Ø± ØªØ¹Ø·ÛŒÙ„Ø§Øª)
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø²Ù…Ø§Ù† Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† Ø±Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
bool IsOneHourBeforeMarketClose()  // ØªØ§Ø¨Ø¹ Ú†Ú© ÛŒÚ© Ø³Ø§Ø¹Øª Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù†
{
   datetime from = 0, to = 0;  // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø²Ù…Ø§Ù† Ø¬Ù„Ø³Ù‡
   MqlDateTime dt;  // Ø³Ø§Ø®ØªØ§Ø± Ø²Ù…Ø§Ù†
   TimeToStruct(TimeTradeServer(), dt);  // ØªØ¨Ø¯ÛŒÙ„ Ø²Ù…Ø§Ù† Ø³Ø±ÙˆØ± Ø¨Ù‡ Ø³Ø§Ø®ØªØ§Ø±
   ENUM_DAY_OF_WEEK day = (ENUM_DAY_OF_WEEK)dt.day_of_week;  // Ø±ÙˆØ² Ù‡ÙØªÙ‡
   datetime max_to = 0;  // Ø­Ø¯Ø§Ú©Ø«Ø± Ø²Ù…Ø§Ù† Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù†
   uint session = 0;  // Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¬Ù„Ø³Ù‡
   // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¢Ø®Ø±ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ø±ÙˆØ² Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ø²Ù…Ø§Ù† Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù†
   // Ø­Ù„Ù‚Ù‡ Ø¬Ù„Ø³Ø§Øª Ø¨Ø§ SymbolInfoSessionTrade
   while(SymbolInfoSessionTrade(_Symbol, day, session, from, to))  // Ø­Ù„Ù‚Ù‡ Ø¬Ù„Ø³Ø§Øª
   {
      if(to > max_to) max_to = to;  // Ø°Ø®ÛŒØ±Ù‡ Ø­Ø¯Ø§Ú©Ø«Ø± Ø²Ù…Ø§Ù†
      session++;  // Ø§ÙØ²Ø§ÛŒØ´ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡
   }
   if(max_to == 0)  // Ú†Ú© Ø¹Ø¯Ù… ÛŒØ§ÙØªÙ† Ø¬Ù„Ø³Ù‡
   {
      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± SymbolInfoSessionTrade: " + IntegerToString(GetLastError()));  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù†Ø§Ø¯Ø±Ø³Øª
   }
   datetime currentTime = TimeTradeServer();  // Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ Ø³Ø±ÙˆØ±
   // Ú†Ú© Ø§Ú¯Ø± Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ ÛŒÚ© Ø³Ø§Ø¹Øª Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† Ø¨Ø§Ø´Ø¯ (Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù¾ÛŒØ´Ú¯ÛŒØ±Ø§Ù†Ù‡)
   if(currentTime >= (max_to - 3600) && currentTime < max_to)  // Ú†Ú© Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø²Ù…Ø§Ù†
   {
      CLogger::Log("ÛŒÚ© Ø³Ø§Ø¹Øª Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† Ø¨Ø§Ø²Ø§Ø±: Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª ÙØ¹Ø§Ù„ Ø´Ø¯.");  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
      return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¯Ø±Ø³Øª
   }
   return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù†Ø§Ø¯Ø±Ø³Øª
}

// ØªØ§Ø¨Ø¹ Ú†Ú© Ø¨Ø³ØªÙ‡ Ø¨ÙˆØ¯Ù† Ø¨Ø§Ø²Ø§Ø± (Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù… Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¹Ù…Ù„ÛŒØ§Øª Ø¯Ø± ØªØ¹Ø·ÛŒÙ„Ø§Øª)
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²Ø§Ø± Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¬Ù„Ø³Ø§Øª Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯
bool IsMarketClosed()  // ØªØ§Ø¨Ø¹ Ú†Ú© Ø¨Ø³ØªÙ‡ Ø¨ÙˆØ¯Ù† Ø¨Ø§Ø²Ø§Ø±
{
   datetime from = 0, to = 0;  // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø²Ù…Ø§Ù† Ø¬Ù„Ø³Ù‡
   MqlDateTime dt;  // Ø³Ø§Ø®ØªØ§Ø± Ø²Ù…Ø§Ù†
   TimeToStruct(TimeTradeServer(), dt);  // ØªØ¨Ø¯ÛŒÙ„ Ø²Ù…Ø§Ù† Ø³Ø±ÙˆØ± Ø¨Ù‡ Ø³Ø§Ø®ØªØ§Ø±
   ENUM_DAY_OF_WEEK day = (ENUM_DAY_OF_WEEK)dt.day_of_week;  // Ø±ÙˆØ² Ù‡ÙØªÙ‡
   uint session = 0;  // Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¬Ù„Ø³Ù‡
   // Ú†Ú© Ø¬Ù„Ø³Ø§Øª Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ø±ÙˆØ² Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²Ø§Ø±
   // Ø­Ù„Ù‚Ù‡ Ø¬Ù„Ø³Ø§Øª
   while(SymbolInfoSessionTrade(_Symbol, day, session, from, to))  // Ø­Ù„Ù‚Ù‡ Ø¬Ù„Ø³Ø§Øª
   {
      if(TimeTradeServer() >= from && TimeTradeServer() <= to)  // Ú†Ú© Ø¯Ø§Ø®Ù„ Ø¬Ù„Ø³Ù‡
      {
         return false;  // Ø¨Ø§Ø²Ø§Ø± Ø¨Ø§Ø² Ø§Ø³ØªØŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒÛŒØ§Ø¨Ø¯
      }
      session++;  // Ø§ÙØ²Ø§ÛŒØ´ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡
   }
   // Ú†Ú© ØªØ¹Ø·ÛŒÙ„Ø§Øª Ø¢Ø®Ø± Ù‡ÙØªÙ‡ (Ø´Ù†Ø¨Ù‡ Ùˆ ÛŒÚ©Ø´Ù†Ø¨Ù‡)
   if(dt.day_of_week == 6 || dt.day_of_week == 0)  // Ú†Ú© Ø´Ù†Ø¨Ù‡ ÛŒØ§ ÛŒÚ©Ø´Ù†Ø¨Ù‡
   {
      CLogger::Log("Ø¨Ø§Ø²Ø§Ø± ØªØ¹Ø·ÛŒÙ„ Ø§Ø³Øª (weekend).");  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
      return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¯Ø±Ø³Øª
   }
   CLogger::Log("Ø¨Ø§Ø²Ø§Ø± ØªØ¹Ø·ÛŒÙ„ Ø§Ø³Øª (Ø®Ø§Ø±Ø¬ Ø§Ø² Ø¬Ù„Ø³Ù‡).");  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
   return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¯Ø±Ø³Øª
}
```

```mql5
//+------------------------------------------------------------------+
//|                                                          Utils.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø´Ø§Ù…Ù„ ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª Elemento Ø§Ø³Øª.
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ: Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ø³Ø§Ø²ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø´ØªØ±Ú© Ù…Ø§Ù†Ù†Ø¯ Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ùˆ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒâ€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
// Ù…Ù†Ø·Ù‚ ÙØ§ÛŒÙ„ Utils.mqh: Ø­Ø§ÙˆÛŒ ØªÙˆØ§Ø¨Ø¹ Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Tick Size Ù†Ù…Ø§Ø¯. 
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ ØªÙˆØ³Ø· ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ù…Ø§Ù†Ù†Ø¯ CRange.mqh include Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ÙØ±Ø§Ù‡Ù… Ø´ÙˆØ¯. 
// ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ù†Ø³Ø®Ù‡ 2.10: Ø¨Ù‡Ø¨ÙˆØ¯ Ú©Ø§Ù…Ù†Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø®Ø·ØŒ Ø§Ø¶Ø§ÙÙ‡ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ø¨Ø±Ø§ÛŒ NormalizePriceØŒ 
// Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¯Ø± Ù…Ù†Ø·Ù‚ ØªØ§Ø¨Ø¹ Ø§Ù…Ø§ Ø¨Ø§ Ú†Ú© Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ tickSize ØµÙØ±. Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø²ÛŒØ±Ø§ Ø¨Ù„ÙˆÙ¾Ø±ÛŒÙ†Øª ØªØºÛŒÛŒØ±ÛŒ Ù…Ø´Ø®Øµ Ù†Ú©Ø±Ø¯Ù‡.

#ifndef UTILS_MQH  // Ú†Ú© ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„
#define UTILS_MQH  // ØªØ¹Ø±ÛŒÙ Ù…Ø§Ú©Ø±Ùˆ

// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù†Ø±Ù…Ø§Ù„ Ø³Ø§Ø²ÛŒ Ø¯Ù‚ÛŒÙ‚ Ù‚ÛŒÙ…Øª Ø¨Ø± Ø§Ø³Ø§Ø³ TickSize Ù†Ù…Ø§Ø¯
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù‚ÛŒÙ…Øª Ø±Ø§ Ø¨Ù‡ Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ±ÛŒÙ† Ù…Ø¶Ø±Ø¨ tickSize Ø±Ø§Ù†Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ø¨Ù‡ _Digits Ù†Ø±Ù…Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
double NormalizePrice(double price)  // ØªØ§Ø¨Ø¹ Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù‚ÛŒÙ…Øª
{
   // Ú¯Ø±ÙØªÙ† Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªÛŒÚ© Ù†Ù…Ø§Ø¯ Ø¨Ø§ SymbolInfoDouble
   double tickSize = SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_SIZE);  // Ú¯Ø±ÙØªÙ† Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªÛŒÚ© Ù†Ù…Ø§Ø¯
   if(tickSize > 0)  // Ú†Ú© Ø§Ú¯Ø± tickSize Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯ (Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² ØµÙØ±)
   {
      // Ø±Ø§Ù†Ø¯ Ø¨Ù‡ Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ±ÛŒÙ† Ù…Ø¶Ø±Ø¨ tickSize Ø¨Ø§ MathRound Ùˆ Ø³Ù¾Ø³ Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨Ù‡ _Digits Ø¨Ø§ NormalizeDouble
      return NormalizeDouble(MathRound(price / tickSize) * tickSize, _Digits);  // Ø±Ø§Ù†Ø¯ Ø¨Ù‡ Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ±ÛŒÙ† Ù…Ø¶Ø±Ø¨ tickSize Ùˆ Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨Ù‡ _Digits
   }
   // Ø§Ú¯Ø± tickSize ØµÙØ± Ø¨ÙˆØ¯ØŒ Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¨Ø¯ÙˆÙ† Ø±Ø§Ù†Ø¯ ØªÛŒÚ©
   return NormalizeDouble(price, _Digits);  // Ø§Ú¯Ø± tickSize ØµÙØ± Ø¨ÙˆØ¯ØŒ Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯
}

#endif  // Ù¾Ø§ÛŒØ§Ù† Ú†Ú© include
```

```mql5
//+------------------------------------------------------------------+
//|                                                         CRange.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ú©Ù„Ø§Ø³ CRange Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ù‡Ø³ØªÙ‡ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø´Ú©Ø³Øª Ø±Ù†Ø¬ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª: Ù‡Ø± Ø±Ù†Ø¬ Ø²Ù…Ø§Ù†ÛŒ (Ù…Ø§Ù†Ù†Ø¯ Ø³Ø´Ù† Ø¢Ø³ÛŒØ§) Ø±Ø§ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ø³Ù‚Ù Ùˆ Ú©Ù Ø¢Ù† Ø±Ø§ ØªØ¹ÛŒÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ 
// Ø§Ú¯Ø± Ø§Ø±ØªÙØ§Ø¹ Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø§ Ø§ÙØ³Øª (Ø¨Ø± Ø§Ø³Ø§Ø³ ATR ÛŒØ§ Ø¯Ø±ØµØ¯) Ù…Ø³Ù„Ø­ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ù…Ù†ØªØ¸Ø± Ú©Ù†Ø¯Ù„ Ø¨Ø±ÛŒÚ© (Ø´Ú©Ø³Øª) Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ØŒ 
// Ø¨Ù‡ ØµÙˆØ±Øª Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ù‚ÛŒÙ…Øª Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ø§Ú¯Ø± Inp_PriceConfirmation_Enabled ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯)ØŒ 
// ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø±Ø§ Ø¨Ù‡ Ø·ÙˆØ± Ù…Ø³ØªÙ‚Ù„ Ùˆ Ø¯Ø± Ù„Ø­Ø¸Ù‡ Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯ 
// Ùˆ Ø³Ù¾Ø³ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø±Ø§ Ø¨Ø§ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ (Ù‡Ù†Ú¯Ø§Ù… Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ RR)ØŒ Ø§Ù†ØªÙ‚Ø§Ù„ SL Ø¨Ù‡ ÙˆØ±ÙˆØ¯ØŒ Ùˆ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Ø§ÛŒÙ† Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø±Ù†Ø¬ÛŒ Ø¨Ø§ Ø´Ú©Ø³Øª Ù‚ÙˆÛŒ Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³Øª Ùˆ Ø¨Ø§ ÙÛŒÙ„ØªØ± Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ Ø±ÛŒØ³Ú© Ø®Ù„Ø§Ù Ø±ÙˆÙ†Ø¯ Ø±Ø§ Ú©Ø§Ù‡Ø´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.
// Ù…Ù†Ø·Ù‚ ÙØ§ÛŒÙ„ CRange.mqh: Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¹Ù…Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª (ENUM_RANGE_STATE) Ø¬Ø±ÛŒØ§Ù† Ø±Ø§ Ú©Ù†ØªØ±Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯: Ø§Ø² Ø§Ù†ØªØ¸Ø§Ø± Ø±Ù†Ø¬ Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ 
// Ø±Ù†Ø¬ Ø±Ø§ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ùˆ ÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ù…Ø³Ù„Ø­ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ù…Ù†ØªØ¸Ø± Ø¨Ø±ÛŒÚ© Ùˆ ØªØ£ÛŒÛŒØ¯Ù‡Ø§ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ØŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù… Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Øª Ø±ÙˆØ²Ø§Ù†Ù‡ Ùˆ Ø³Ø®Øª Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¯Ø± ØªØ¹Ø·ÛŒÙ„Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. 
// Ú©Ø´ ATR Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§ØªØŒ Ùˆ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…Ø³ØªÙ‚Ù„ g_trendFilter Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ©. 
// ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ù†Ø³Ø®Ù‡ 2.10: Ø­Ø°Ù CleanupPaths Ùˆ Ø§Ø¯ØºØ§Ù… Ø¯Ø± SoftCleanup Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø­Ù„ Ø¨Ø§Ú¯ Ù‚ÙÙ„ Ø´Ø¯Ù†ØŒ 
// Ø§ØµÙ„Ø§Ø­ CheckCleanup Ø¨Ø±Ø§ÛŒ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ SoftCleanupØŒ Ø§ØµÙ„Ø§Ø­ ManageActiveTrade Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Øª ÙÙˆØ±ÛŒ Ø¨Ø§ SoftCleanupØŒ 
// Ø§Ø¶Ø§ÙÙ‡ m_initialSlDistance Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú©Ø§Ù…Ù†Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ØŒ Ø§Ø¶Ø§ÙÙ‡ RestoreState Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒØŒ 
// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² m_initialSlDistance Ø¯Ø± ManageActiveTradeØŒ Ø§ØµÙ„Ø§Ø­ m_slToBeMoved Ø¯Ø± ManageActiveTrade Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Race ConditionØŒ 
// Ú©Ø§Ù…Ù†Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ù‚ÛŒÙ‚ Ù‡Ø± Ø®Ø·ØŒ Ùˆ Ø­ÙØ¸ Ø³Ø§Ø®ØªØ§Ø± Ù‚Ø¨Ù„ÛŒ.

#ifndef CRANGE_MQH  // Ú†Ú© ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„
#define CRANGE_MQH  // ØªØ¹Ø±ÛŒÙ Ù…Ø§Ú©Ø±Ùˆ

#include "TimeHelper.mqh"  // Ú©Ù„Ø§Ø³ Ú©Ù…Ú©â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø²Ù…Ø§Ù† Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø±Ù†Ø¬ Ùˆ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
#include "RiskManager.mqh"  // Ú©Ù„Ø§Ø³ Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÛŒØ³Ú© Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù…
#include "Utils.mqh"  // Ú©Ù„Ø§Ø³ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
#include "Logger.mqh"  // Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù„Ø§Ú¯ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„â€ŒØ´Ø¯Ù‡

// ØªØ¹Ø±ÛŒÙ enum Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ø±Ù†Ø¬ (Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø¬Ø±ÛŒØ§Ù† Ù‡Ø± Ø±Ù†Ø¬ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡)
// Ø§ÛŒÙ† enum Ø¬Ø±ÛŒØ§Ù† Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø±Ø§ Ø§Ø² Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ú©Ù†ØªØ±Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
enum ENUM_RANGE_STATE
{
   RANGE_IDLE,                  // Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ Ø¬Ø¯ÛŒØ¯ (Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ ÛŒØ§ Ù¾Ø³ Ø§Ø² Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒØŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ)
   RANGE_IDENTIFYING,           // Ø¯Ø± Ø­Ø§Ù„ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø±Ù†Ø¬ (Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‚Ù/Ú©Ù Ùˆ Ú†Ú© Ø§Ø±ØªÙØ§Ø¹)
   RANGE_ARMED,                 // Ø±Ù†Ø¬ Ù…Ø³Ù„Ø­ Ø´Ø¯Ù‡ Ùˆ Ù…Ù†ØªØ¸Ø± Ø´Ú©Ø³Øª (Ø®Ø·ÙˆØ· Ø§ÙØ³Øª Ø±Ø³Ù… Ø´Ø¯Ù‡)
   AWAITING_CONFIRMATION,       // Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯ ÙˆØ±ÙˆØ¯ (Ù¾Ø³ Ø§Ø² Ú©Ù†Ø¯Ù„ Ø¨Ø±ÛŒÚ©ØŒ Ú†Ú© Ø§Ø¨Ø·Ø§Ù„ Ùˆ ØªØ§ÛŒÛŒØ¯Ù‡Ø§)
   RANGE_TRADE_ACTIVE,          // Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§ÛŒÙ† Ø±Ù†Ø¬ ÙØ¹Ø§Ù„ Ø§Ø³Øª (Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§Ø² Ø´Ø¯Ù‡ØŒ Ù…Ù†ØªØ¸Ø± Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ)
   RANGE_EXPIRED                // Ø±Ù†Ø¬ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡ (Ù¾Ø³ Ø§Ø² Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÛŒØ§ Ù†Ø§Ù…Ø¹ØªØ¨Ø±ØŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø±Ù†Ø¬ Ø¬Ø¯ÛŒØ¯)
};

// Ú©Ù„Ø§Ø³ CRange Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø± Ø±Ù†Ø¬ Ø²Ù…Ø§Ù†ÛŒ Ø¨Ù‡ Ø·ÙˆØ± Ù…Ø³ØªÙ‚Ù„
// Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ ØªÙ…Ø§Ù… Ù…Ù†Ø·Ù‚ ÛŒÚ© Ø±Ù†Ø¬ Ø±Ø§ Ø§Ø² Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ ØªØ§ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø¹Ø§Ù…Ù„Ù‡ Ú©Ù¾Ø³ÙˆÙ„Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ù‡ CActiveTradeManager Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù‡)
class CRange  // Ú©Ù„Ø§Ø³ Ø§ØµÙ„ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ù†Ø¬
{
private:
   int m_rangeIndex;  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø±Ù†Ø¬ (1 ØªØ§ 4 Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§ÛŒØ²ØŒ Ø¨Ø±Ø§ÛŒ Ù„Ø§Ú¯ Ùˆ Ø§Ø´ÛŒØ§Ø¡)
   long m_magicNumber;  // Ù…Ø¬ÛŒÚ© Ù†Ø§Ù…Ø¨Ø± Ù…Ù†Ø­ØµØ±Ø¨Ù‡â€ŒÙØ±Ø¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§ÛŒÙ† Ø±Ù†Ø¬ (Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§ÛŒØ² Ø¯Ø± PositionsTotal)
   ENUM_TIMEFRAMES m_timeframe;  // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø±Ù†Ø¬ (Ø¨Ø±Ø§ÛŒ iHigh/iLow/iClose)
   int m_startHour;  // Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬ (0-23ØŒ Ø¨Ø± Ø§Ø³Ø§Ø³ GMT Ø³Ø±ÙˆØ±)
   int m_startMinute;  // Ø¯Ù‚ÛŒÙ‚Ù‡ Ø´Ø±ÙˆØ¹ Ø±Ù†Ø¬ (0-59)
   int m_endHour;  // Ø³Ø§Ø¹Øª Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ (0-23)
   int m_endMinute;  // Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ (0-59)
   int m_minRangePoints;  // Ø­Ø¯Ø§Ù‚Ù„ Ø§Ø±ØªÙØ§Ø¹ Ù…Ø¬Ø§Ø² Ø±Ù†Ø¬ Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª (Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú©)
   int m_maxRangePoints;  // Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø±ØªÙØ§Ø¹ Ù…Ø¬Ø§Ø² Ø±Ù†Ø¬ Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª (Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯)
   ENUM_PLACEMENT_MODE m_placementMode;  // Ø­Ø§Ù„Øª Ø§ÙØ³Øª Ø´Ú©Ø³Øª (ATR ÛŒØ§ Ø¯Ø±ØµØ¯ØŒ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø·ÙˆØ­)
   int m_atrPeriod;  // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ Ø§ÙØ³Øª (Ø¨Ø±Ø§ÛŒ iATR)
   double m_atrMultiplier;  // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ Ø§ÙØ³Øª (Ø¨Ø±Ø§ÛŒ Ø­Ø³Ø§Ø³ÛŒØª)
   ENUM_SL_STRATEGY m_slStrategy;  // Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ SL (Ù…Ù‚Ø§Ø¨Ù„ ÛŒØ§ Ø³Ø·Ø­ Ø´Ú©Ø³ØªØŒ Ø¨Ø±Ø§ÛŒ base point)
   ENUM_SL_CALC_MODE m_slCalcMode;  // Ø­Ø§Ù„Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± SL (ATR ÛŒØ§ Ø¯Ø±ØµØ¯)
   int m_slAtrPeriod;  // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± SL
   double m_slAtrMultiplier;  // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± SL
   ENUM_TRAILING_MODE m_trailingMode;  // Ø­Ø§Ù„Øª ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ (ATR ÛŒØ§ Senkou B)
   int m_trailingAtrPeriod;  // Ø¯ÙˆØ±Ù‡ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   double m_trailingAtrMultiplier;  // Ø¶Ø±ÛŒØ¨ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   double m_rrRatio;  // Ù†Ø³Ø¨Øª R:R Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ (Ø³ÙˆØ¯/Ø±ÛŒØ³Ú©)
   double m_partialClosePercent;  // Ø¯Ø±ØµØ¯ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ (0-100)
   int m_cleanupHours;  // Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù¾Ø³ Ø§Ø² Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ (0-24)
   color m_color;  // Ø±Ù†Ú¯ Ù…Ø³ØªØ·ÛŒÙ„ Ø±Ù†Ø¬ (Ø¨Ø±Ø§ÛŒ OBJ_RECTANGLE)
   ENUM_TIMEFRAMES m_trendFilterTimeframe;  // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ (Ø¨Ø±Ø§ÛŒ GetTrendDirection)
   int m_atrHandle;  // Ù‡Ù†Ø¯Ù„ ATR Ø¨Ø±Ø§ÛŒ Ø§ÙØ³Øª (shared Ø§Ø² Elemento)
   int m_slAtrHandle;  // Ù‡Ù†Ø¯Ù„ ATR Ø¨Ø±Ø§ÛŒ SL (Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ±Ù‡ Ù…ØªÙØ§ÙˆØª)
   int m_trailingAtrHandle;  // Ù‡Ù†Ø¯Ù„ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ (Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡)
   ENUM_RANGE_STATE m_currentState;  // Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ Ø±Ù†Ø¬ (Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª)
   double m_rangeHigh;  // Ø³Ù‚Ù Ø±Ù†Ø¬ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒâ€ŒØ´Ø¯Ù‡ (Ø§Ø² iHighest)
   double m_rangeLow;  // Ú©Ù Ø±Ù†Ø¬ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒâ€ŒØ´Ø¯Ù‡ (Ø§Ø² iLowest)
   double m_potentialBuyPrice;  // Ø³Ø·Ø­ Ø®Ø±ÛŒØ¯ Ø¨Ø§ Ø§ÙØ³Øª (Ø¨Ø±Ø§ÛŒ Ú†Ú© Ø¨Ø±ÛŒÚ©)
   double m_potentialSellPrice;  // Ø³Ø·Ø­ ÙØ±ÙˆØ´ Ø¨Ø§ Ø§ÙØ³Øª (Ø¨Ø±Ø§ÛŒ Ú†Ú© Ø¨Ø±ÛŒÚ©)
   double m_breakerCandleLevel;  // Ø³Ø·Ø­ Ú©Ù„ÙˆØ² Ú©Ù†Ø¯Ù„ Ø´Ú©Ù†Ù†Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ ØªØ§ÛŒÛŒØ¯ Ù‚ÛŒÙ…Øª)
   ulong m_activeTicket;  // ØªÛŒÚ©Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ ÙØ¹Ø§Ù„ (Ø§Ø² result.deal)
   double m_cachedATR;  // Ú©Ø´ ATR Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ (Ø«Ø§Ø¨ØªØŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ)
   double m_cachedSlATR;  // Ú©Ø´ ATR Ø¨Ø±Ø§ÛŒ SL (Ø«Ø§Ø¨Øª)
   double m_cachedTrailingATR;  // Ú©Ø´ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ (Ù¾ÙˆÛŒØ§ Ø¯Ø± Ù…Ø¯ÛŒØ±ÛŒØªØŒ Ø§Ù…Ø§ Ú©Ø´ Ø§ÙˆÙ„ÛŒÙ‡)
   int m_waitCounter;  // Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ú©Ù†Ø¯Ù„ Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª ØªØ§ÛŒÙ…Ø± Ù‚Ø¯ÛŒÙ…ÛŒ (ÙÙ‚Ø· Ø§Ú¯Ø± CONFIRMATION_TIMEOUT)
   datetime m_cleanupTime;  // Ø²Ù…Ø§Ù† Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒØ´Ø¯Ù‡ (Ø§Ø² CalculateCleanupTime)
   datetime m_lastEndTime;  // Ø¢Ø®Ø±ÛŒÙ† Ø²Ù…Ø§Ù† Ù¾Ø§ÛŒØ§Ù† Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªÚ©Ø±Ø§Ø± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ)
   bool m_lastInvalid;  // ÙÙ„Ú¯ Ø¢Ø®Ø±ÛŒÙ† Ø±Ù†Ø¬ Ù†Ø§Ù…Ø¹ØªØ¨Ø± (Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªÚ©Ø±Ø§Ø±)
   datetime m_rangeEndTime;  // Ø²Ù…Ø§Ù† Ú©Ø§Ù…Ù„ Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ (Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ù‚ÛŒÙ‚ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ)
   datetime m_lastFilterBarTime;  // Ø²Ù…Ø§Ù† Ø¢Ø®Ø±ÛŒÙ† Ú©Ù†Ø¯Ù„ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ (Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ø¯ÛŒØª Ù†Ù…Ø§ÛŒØ´)
   double m_fixedOffsetValue;  // Ù…Ù‚Ø¯Ø§Ø± Ø«Ø§Ø¨Øª Ø§ÙØ³Øª ATR ÛŒØ§ Ø¯Ø±ØµØ¯ Ø¯Ø± Ù„Ø­Ø¸Ù‡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø±Ù†Ø¬ (Ø¨Ø±Ø§ÛŒ Ø«Ø§Ø¨Øª Ú©Ø±Ø¯Ù† Ø®Ø·ÙˆØ·)
   string m_rangeObjectName;  // Ù†Ø§Ù… Ù…Ø³ØªØ·ÛŒÙ„ Ø±Ù†Ø¬ (Ø¨Ø±Ø§ÛŒ OBJ_RECTANGLE)
   string m_buyLineName;  // Ù†Ø§Ù… Ø®Ø· Ø®Ø±ÛŒØ¯ (Ø¨Ø±Ø§ÛŒ OBJ_HLINE)
   string m_sellLineName;  // Ù†Ø§Ù… Ø®Ø· ÙØ±ÙˆØ´ (Ø¨Ø±Ø§ÛŒ OBJ_HLINE)
   double m_initialSlDistance; // ÙØ§ØµÙ„Ù‡ SL Ø§ÙˆÙ„ÛŒÙ‡ (Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø± Ú©Ø§Ù…Ù†Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ØŒ Ø¨Ø±Ø§ÛŒ Ø­Ù„ Ø¨Ø§Ú¯ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù†Ø§Ù‚Øµ)
   bool m_isCleanedForThisCycle;  // ÙÙ„Ú¯ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù…Ú©Ø±Ø± Ø¯Ø± ÛŒÚ© Ú†Ø±Ø®Ù‡

   // Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ùˆ ÙˆÙ„ÛŒØ¯ Ø±Ù†Ø¬: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‚Ù/Ú©ÙØŒ Ú†Ú© Ø§Ø±ØªÙØ§Ø¹ Ùˆ Ø±Ø³Ù… Ù…Ø³ØªØ·ÛŒÙ„ Ø§Ú¯Ø± Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø±Ù†Ø¬ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù† Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ ÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void IdentifyAndValidateRange();  // Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ùˆ ÙˆÙ„ÛŒØ¯ Ø±Ù†Ø¬

   // Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ú©Ù†Ø¯Ù„ Ø¨Ø±ÛŒÚ©: Ú†Ú© Ú©Ù„ÙˆØ² Ø¨Ø§Ù„Ø§ÛŒ/Ù¾Ø§ÛŒÛŒÙ† Ø§ÙØ³Øª Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ØªØ§ÛŒÛŒØ¯ ÙˆØ±ÙˆØ¯
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø´Ú©Ø³Øª Ø±Ø§ ØªØ´Ø®ÛŒØµ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
   void WaitForBreakerCandle();  // Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ú©Ù†Ø¯Ù„ Ø¨Ø±ÛŒÚ©

   // ÙØ±Ø¢ÛŒÙ†Ø¯ ØªÙ„Ø§Ø´ ÙˆØ±ÙˆØ¯: Ú†Ú© Ø§Ø¨Ø·Ø§Ù„ØŒ ØªØ§ÛŒÛŒØ¯ Ù‚ÛŒÙ…Øª Ùˆ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ØŒ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ú¯Ø± ØªØ§ÛŒÛŒØ¯ Ø´Ø¯
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø§Ø¨Ø·Ø§Ù„ Ùˆ ØªØ§ÛŒÛŒØ¯Ù‡Ø§ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void ProcessEntryAttempt();  // ÙØ±Ø¢ÛŒÙ†Ø¯ ØªÙ„Ø§Ø´ ÙˆØ±ÙˆØ¯

   // Ø±ÛŒØ³Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ù…Ø³Ù„Ø­: Ø±ÛŒØ³Øª Ø³Ø·Ø­ Ø¨Ø±ÛŒÚ© Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù Ø®Ø·ÙˆØ· Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ ÙØ±ØµØªâ€ŒÙ‡Ø§
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§Ø¨Ø·Ø§Ù„ Ø¨Ø¯ÙˆÙ† Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   void ResetToArmedState();  // Ø±ÛŒØ³Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ù…Ø³Ù„Ø­

   // Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡: Ù…Ø­Ø§Ø³Ø¨Ù‡ SL Ø¨Ø§ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¬Ø¯ÛŒØ¯ØŒ Ø­Ø¬Ù… Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´ Ø¨Ø§Ø²Ø§Ø±
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø±Ø§ Ø¨Ø§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void ExecuteTrade(bool isBuy);  // Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡

   // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù…Ø³ÛŒØ± Ù…Ø®Ø§Ù„Ù: Ø­Ø°Ù Ø®Ø· Ùˆ Ø±ÛŒØ³Øª Ù‚ÛŒÙ…Øª Ø¨Ø±Ø§ÛŒ OCO
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù…Ø³ÛŒØ± Ù…Ø®Ø§Ù„Ù Ø±Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void DisableOppositePath(bool isBuy);  // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù…Ø³ÛŒØ± Ù…Ø®Ø§Ù„Ù

   // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù…: Ø±ÛŒØ³Øª Ù…ØªØºÛŒØ±Ù‡Ø§ Ùˆ Ø­Ø°Ù Ø§Ø´ÛŒØ§Ø¡ Ø¨Ø¯ÙˆÙ† Ø¨Ø³ØªÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Øª Ø±ÙˆØ²Ø§Ù†Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   void SoftCleanup();  // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù…

   // Ú¯Ø±ÙØªÙ† ATR Ú©Ø´â€ŒØ´Ø¯Ù‡: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ (Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø«Ø§Ø¨Øª)
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ú©Ø´ ATR Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   double GetCachedATR();  // Ú¯Ø±ÙØªÙ† ATR Ú©Ø´â€ŒØ´Ø¯Ù‡

   // Ú¯Ø±ÙØªÙ† ATR Ø¨Ø±Ø§ÛŒ SL: Ù…Ø´Ø§Ø¨Ù‡ Ø¨Ø±Ø§ÛŒ SL (Ø«Ø§Ø¨Øª)
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ú©Ø´ SL Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   double GetSlATR();  // Ú¯Ø±ÙØªÙ† ATR Ø¨Ø±Ø§ÛŒ SL

   // Ú¯Ø±ÙØªÙ† ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯: Ù…Ø´Ø§Ø¨Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ (Ù¾ÙˆÛŒØ§ Ø¯Ø± Ù…Ø¯ÛŒØ±ÛŒØª)
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ú©Ø´ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   double GetTrailingATR();  // Ú¯Ø±ÙØªÙ† ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯

public:
   // Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² garbage values
   CRange() : m_rangeIndex(0), m_magicNumber(0), m_timeframe(PERIOD_CURRENT), m_startHour(0), m_startMinute(0), m_endHour(0), m_endMinute(0),
              m_minRangePoints(0), m_maxRangePoints(0), m_placementMode(PLACEMENT_ATR), m_atrPeriod(0), m_atrMultiplier(0.0),
              m_slStrategy(SL_OPPOSITE_SIDE), m_slCalcMode(SL_CALC_ATR), m_slAtrPeriod(0), m_slAtrMultiplier(0.0),
              m_trailingMode(TRAILING_ATR), m_trailingAtrPeriod(0), m_trailingAtrMultiplier(0.0), m_rrRatio(0.0), m_partialClosePercent(0.0),
              m_cleanupHours(0), m_color(clrNONE), m_trendFilterTimeframe(PERIOD_CURRENT), m_atrHandle(INVALID_HANDLE),
              m_slAtrHandle(INVALID_HANDLE), m_trailingAtrHandle(INVALID_HANDLE), m_currentState(RANGE_IDLE),
              m_rangeHigh(0), m_rangeLow(0), m_potentialBuyPrice(0), m_potentialSellPrice(0), m_breakerCandleLevel(0),
              m_activeTicket(0), m_cachedATR(0), m_cachedSlATR(0), m_cachedTrailingATR(0),
              m_waitCounter(0), m_cleanupTime(0), m_lastEndTime(0), m_lastInvalid(false), m_rangeEndTime(0), m_lastFilterBarTime(0),
              m_fixedOffsetValue(0.0), m_rangeObjectName(""), m_buyLineName(""), m_sellLineName(""), m_initialSlDistance(0.0), m_isCleanedForThisCycle(false) {}  // Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø§ÙˆÙ„ÛŒÙ‡

   // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø±Ù†Ø¬: ØªÙ†Ø¸ÛŒÙ… Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ØŒ Ø§ÛŒØ¬Ø§Ø¯ Ù‡Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ ATR Ùˆ Ù†Ø§Ù…â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ø´ÛŒØ§Ø¡
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ØªÙ…Ø§Ù… Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ Ø±Ø§ Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯
   bool Init(int index, long magic, ENUM_TIMEFRAMES timeframe, int startHour, int startMinute, int endHour, int endMinute,
             int minRangePoints, int maxRangePoints, ENUM_PLACEMENT_MODE placementMode, int atrPeriod, double atrMultiplier,
             ENUM_SL_STRATEGY slStrategy, ENUM_SL_CALC_MODE slCalcMode, int slAtrPeriod, double slAtrMultiplier,
             ENUM_TRAILING_MODE trailingMode, int trailingAtrPeriod, double trailingAtrMultiplier,
             double rrRatio, double partialClosePercent, int cleanupHours, color col, ENUM_TIMEFRAMES trendTf, int sharedAtrHandle);  // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø±Ù†Ø¬

   // Ø¯ÙØ¹ Ø±Ù†Ø¬: Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ù‡Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ ATR
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù…Ù†Ø§Ø¨Ø¹ Ø±Ø§ Ø¢Ø²Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void Deinit();  // Ø¯ÙØ¹ Ø±Ù†Ø¬

   // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø± Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯: Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ Ø¹Ù…Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void UpdateOnNewBar();  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø± Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯

   // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª: Ø¨Ø³ØªÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ú¯Ø± Ø¨Ø§Ø² Ø¨Ø§Ø´Ø¯ Ùˆ Ø³Ù¾Ø³ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù… (Ø¨Ø±Ø§ÛŒ ØªØ¹Ø·ÛŒÙ„Ø§Øª ÛŒØ§ Ø¯ÙØ¹)
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   void HardCleanup();  // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª

   // Ú†Ú© Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ: Ú†Ú© Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§ Ùˆ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù…Ù†Ø§Ø³Ø¨
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¯Ø± OnTick ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   void CheckCleanup();  // Ú†Ú© Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ

   // Ø±ÛŒØ³Øª Ú©Ø´â€ŒÙ‡Ø§: ØµÙØ± Ú©Ø±Ø¯Ù† Ú©Ø´ ATRÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ Ø¬Ø¯ÛŒØ¯
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ú©Ø´â€ŒÙ‡Ø§ Ø±Ø§ Ø±ÛŒØ³Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void ResetCaches();  // Ø±ÛŒØ³Øª Ú©Ø´â€ŒÙ‡Ø§

   // Ú¯Ø±ÙØªÙ† ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§
   // Ø§ÛŒÙ† Ú¯ØªØ± ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
   ENUM_TIMEFRAMES GetTimeframe() const { return m_timeframe; }  // Ø¨Ø§Ø²Ú¯Ø´Øª ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§

   // Ú¯Ø±ÙØªÙ† ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯
   // Ø§ÛŒÙ† Ú¯ØªØ± ÙÛŒÙ„ØªØ± Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
   ENUM_TIMEFRAMES GetTrendFilterTimeframe() const { return m_trendFilterTimeframe; }  // Ø¨Ø§Ø²Ú¯Ø´Øª ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ±

   // Ú¯Ø±ÙØªÙ† Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ
   // Ø§ÛŒÙ† Ú¯ØªØ± Ø­Ø§Ù„Øª Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
   ENUM_RANGE_STATE GetCurrentState() const { return m_currentState; }  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ

   // ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ (Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø§Ø®Ù„ÛŒ ÛŒØ§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø­Ø§ÙØ¸Ù‡)
   // Ø§ÛŒÙ† Ø³ØªØ± Ø­Ø§Ù„Øª Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void SetCurrentState(ENUM_RANGE_STATE state) { m_currentState = state; }  // ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª

   // Ú¯Ø±ÙØªÙ† Ø²Ù…Ø§Ù† Ø¢Ø®Ø±ÛŒÙ† Ú©Ù†Ø¯Ù„ ÙÛŒÙ„ØªØ±
   // Ø§ÛŒÙ† Ú¯ØªØ± Ø²Ù…Ø§Ù† ÙÛŒÙ„ØªØ± Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
   datetime GetLastFilterBarTime() const { return m_lastFilterBarTime; }  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø²Ù…Ø§Ù† ÙÛŒÙ„ØªØ±

   // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø²Ù…Ø§Ù† Ø¢Ø®Ø±ÛŒÙ† Ú©Ù†Ø¯Ù„ ÙÛŒÙ„ØªØ±
   // Ø§ÛŒÙ† Ø³ØªØ± Ø²Ù…Ø§Ù† Ø±Ø§ Ø¢Ù¾Ø¯ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void UpdateLastFilterBarTime(datetime time) { m_lastFilterBarTime = time; }  // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† ÙÛŒÙ„ØªØ±

   // ØªÙ†Ø¸ÛŒÙ… ØªÛŒÚ©Øª ÙØ¹Ø§Ù„ (Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø­Ø§ÙØ¸Ù‡)
   // Ø§ÛŒÙ† Ø³ØªØ± ØªÛŒÚ©Øª Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void SetActiveTicket(ulong ticket) { m_activeTicket = ticket; }  // ØªÙ†Ø¸ÛŒÙ… ØªÛŒÚ©Øª

   // (Ø¬Ø¯ÛŒØ¯) Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª: Ø°Ø®ÛŒØ±Ù‡ Ø³Ù‚ÙØŒ Ú©Ù Ùˆ ÙØ§ØµÙ„Ù‡ SL Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù¾Ø³ Ø§Ø² Ø±ÛŒâ€ŒØ§Ø³ØªØ§Ø±Øª
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ÙˆØ¶Ø¹ÛŒØª Ø±Ø§ Ø§Ø² Ú©Ø§Ù…Ù†Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void RestoreState(double range_high, double range_low, double initial_sl_distance)  // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª
   {
      m_rangeHigh = range_high;  // Ø°Ø®ÛŒØ±Ù‡ Ø³Ù‚Ù
      m_rangeLow = range_low;  // Ø°Ø®ÛŒØ±Ù‡ Ú©Ù
      m_initialSlDistance = initial_sl_distance;  // Ø°Ø®ÛŒØ±Ù‡ ÙØ§ØµÙ„Ù‡ SL
      CLogger::Log("ÙˆØ¶Ø¹ÛŒØª Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.", m_rangeIndex);  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª
   }
};

// Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªÙˆØ§Ø¨Ø¹ Ú©Ù„Ø§Ø³ CRange (Ø®Ø§Ø±Ø¬ Ø§Ø² ØªØ¹Ø±ÛŒÙ Ú©Ù„Ø§Ø³ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ)
// ØªÙ…Ø§Ù… ØªÙˆØ§Ø¨Ø¹ private/public Ø¯Ø± Ø§Ø¯Ø§Ù…Ù‡ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯

// Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø±Ù†Ø¬: ØªÙ†Ø¸ÛŒÙ… Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ØŒ Ø§ÛŒØ¬Ø§Ø¯ Ù‡Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ ATR Ùˆ Ù†Ø§Ù…â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ø´ÛŒØ§Ø¡
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ private Ø±Ø§ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
bool CRange::Init(int index, long magic, ENUM_TIMEFRAMES timeframe, int startHour, int startMinute, int endHour, int endMinute,
                  int minRangePoints, int maxRangePoints, ENUM_PLACEMENT_MODE placementMode, int atrPeriod, double atrMultiplier,
                  ENUM_SL_STRATEGY slStrategy, ENUM_SL_CALC_MODE slCalcMode, int slAtrPeriod, double slAtrMultiplier,
                  ENUM_TRAILING_MODE trailingMode, int trailingAtrPeriod, double trailingAtrMultiplier,
                  double rrRatio, double partialClosePercent, int cleanupHours, color col, ENUM_TIMEFRAMES trendTf, int sharedAtrHandle)  // Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ
{
   // ØªÙ†Ø¸ÛŒÙ… Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø±Ù†Ø¬ Ø¨Ø±Ø§ÛŒ Ù„Ø§Ú¯ Ùˆ Ø§Ø´ÛŒØ§Ø¡
   m_rangeIndex = index;  // ØªÙ†Ø¸ÛŒÙ… Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø±Ù†Ø¬
   // ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬ÛŒÚ© Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§ÛŒØ² Ù…Ø¹Ø§Ù…Ù„Ø§Øª
   m_magicNumber = magic;  // ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬ÛŒÚ©
   // ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§
   m_timeframe = timeframe;  // ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… Ø§Ø¬Ø±Ø§
   // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹
   m_startHour = startHour;  // ØªÙ†Ø¸ÛŒÙ… Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹
   m_startMinute = startMinute;  // ØªÙ†Ø¸ÛŒÙ… Ø¯Ù‚ÛŒÙ‚Ù‡ Ø´Ø±ÙˆØ¹
   // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ù¾Ø§ÛŒØ§Ù†
   m_endHour = endHour;  // ØªÙ†Ø¸ÛŒÙ… Ø³Ø§Ø¹Øª Ù¾Ø§ÛŒØ§Ù†
   m_endMinute = endMinute;  // ØªÙ†Ø¸ÛŒÙ… Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾Ø§ÛŒØ§Ù†
   // ØªÙ†Ø¸ÛŒÙ… Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø±ØªÙØ§Ø¹
   m_minRangePoints = minRangePoints;  // ØªÙ†Ø¸ÛŒÙ… Ø­Ø¯Ø§Ù‚Ù„ Ø§Ø±ØªÙØ§Ø¹
   m_maxRangePoints = maxRangePoints;  // ØªÙ†Ø¸ÛŒÙ… Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø±ØªÙØ§Ø¹
   // ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª Ø§ÙØ³Øª
   m_placementMode = placementMode;  // ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª Ø§ÙØ³Øª
   // ØªÙ†Ø¸ÛŒÙ… Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ ATR Ø§ÙØ³Øª
   m_atrPeriod = atrPeriod;  // ØªÙ†Ø¸ÛŒÙ… Ø¯ÙˆØ±Ù‡ ATR Ø§ÙØ³Øª
   m_atrMultiplier = atrMultiplier;  // ØªÙ†Ø¸ÛŒÙ… Ø¶Ø±ÛŒØ¨ ATR Ø§ÙØ³Øª
   // ØªÙ†Ø¸ÛŒÙ… Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ SL
   m_slStrategy = slStrategy;  // ØªÙ†Ø¸ÛŒÙ… Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ SL
   m_slCalcMode = slCalcMode;  // ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª Ø¨Ø§ÙØ± SL
   m_slAtrPeriod = slAtrPeriod;  // ØªÙ†Ø¸ÛŒÙ… Ø¯ÙˆØ±Ù‡ ATR SL
   m_slAtrMultiplier = slAtrMultiplier;  // ØªÙ†Ø¸ÛŒÙ… Ø¶Ø±ÛŒØ¨ ATR SL
   // ØªÙ†Ø¸ÛŒÙ… Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   m_trailingMode = trailingMode;  // ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   m_trailingAtrPeriod = trailingAtrPeriod;  // ØªÙ†Ø¸ÛŒÙ… Ø¯ÙˆØ±Ù‡ ATR ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   m_trailingAtrMultiplier = trailingAtrMultiplier;  // ØªÙ†Ø¸ÛŒÙ… Ø¶Ø±ÛŒØ¨ ATR ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   // ØªÙ†Ø¸ÛŒÙ… Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡
   m_rrRatio = rrRatio;  // ØªÙ†Ø¸ÛŒÙ… Ù†Ø³Ø¨Øª RR
   m_partialClosePercent = partialClosePercent;  // ØªÙ†Ø¸ÛŒÙ… Ø¯Ø±ØµØ¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
   m_cleanupHours = cleanupHours;  // ØªÙ†Ø¸ÛŒÙ… Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
   m_color = col;  // ØªÙ†Ø¸ÛŒÙ… Ø±Ù†Ú¯
   m_trendFilterTimeframe = trendTf;  // ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ±
   m_atrHandle = sharedAtrHandle;  // Ù‡Ù†Ø¯Ù„ ATR Ø§ÙØ³Øª (Ù…Ø´ØªØ±Ú©)

   // Ø§ÛŒØ¬Ø§Ø¯ Ù‡Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ SL Ùˆ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ (Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ØªÙØ§ÙˆØª)
   // iATR Ù‡Ù†Ø¯Ù„ Ø§Ù†Ø¯ÛŒÚ©Ø§ØªÙˆØ± Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   m_slAtrHandle = iATR(_Symbol, timeframe, m_slAtrPeriod);  // Ù‡Ù†Ø¯Ù„ ATR Ø¨Ø±Ø§ÛŒ SL
   if(m_slAtrHandle == INVALID_HANDLE)  // Ú†Ú© Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯
   {
      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù‡Ù†Ø¯Ù„ ATR Ø¨Ø±Ø§ÛŒ SL Ø±Ù†Ø¬ " + IntegerToString(index), index);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
   }
   m_trailingAtrHandle = iATR(_Symbol, timeframe, m_trailingAtrPeriod);  // Ù‡Ù†Ø¯Ù„ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   if(m_trailingAtrHandle == INVALID_HANDLE)  // Ú†Ú© Ù…ÙˆÙÙ‚ÛŒØª
   {
      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù‡Ù†Ø¯Ù„ ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ù†Ø¬ " + IntegerToString(index), index);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
   }

   // Ù†Ø§Ù…â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ø´ÛŒØ§Ø¡ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ Ø¨Ø§ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§ÛŒØ²
   m_rangeObjectName = "Range_Rect_" + IntegerToString(index);  // Ù†Ø§Ù… Ù…Ø³ØªØ·ÛŒÙ„ Ø±Ù†Ø¬
   m_buyLineName = "Range_BuyLine_" + IntegerToString(index);  // Ù†Ø§Ù… Ø®Ø· Ø®Ø±ÛŒØ¯
   m_sellLineName = "Range_SellLine_" + IntegerToString(index);  // Ù†Ø§Ù… Ø®Ø· ÙØ±ÙˆØ´

   ResetCaches();  // Ø±ÛŒØ³Øª Ú©Ø´â€ŒÙ‡Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹
   m_currentState = RANGE_IDLE;  // Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ù†ØªØ¸Ø§Ø±
   m_lastFilterBarTime = 0;  // Ø±ÛŒØ³Øª Ø²Ù…Ø§Ù† ÙÛŒÙ„ØªØ±
   m_isCleanedForThisCycle = false;  // Ø±ÛŒØ³Øª ÙÙ„Ú¯ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ú†Ø±Ø®Ù‡
   // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§ CLogger
   CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(index) + " Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø´Ø¯.", index);  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª
   return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ÛŒØª
}

// Ø¯ÙØ¹ Ø±Ù†Ø¬: Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ù‡Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ ATR
// IndicatorRelease Ù‡Ù†Ø¯Ù„â€ŒÙ‡Ø§ Ø±Ø§ Ø¢Ø²Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
void CRange::Deinit()  // ØªØ§Ø¨Ø¹ Ø¯ÙØ¹
{
   if(m_slAtrHandle != INVALID_HANDLE) IndicatorRelease(m_slAtrHandle);  // Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ù‡Ù†Ø¯Ù„ SL
   if(m_trailingAtrHandle != INVALID_HANDLE) IndicatorRelease(m_trailingAtrHandle);  // Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ù‡Ù†Ø¯Ù„ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " Ø¯ÙØ¹ Ø´Ø¯.", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
}

// Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø± Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯: Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª
// Ø³ÙˆØ¦ÛŒÚ† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø¬Ø±ÛŒØ§Ù†
void CRange::UpdateOnNewBar()  // ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
{
   // Ù„Ø§Ú¯ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø±Ø¯ÛŒØ§Ø¨ÛŒ
   CLogger::Log("------ Ø¯Ø± Ø­Ø§Ù„Øª " + EnumToString(m_currentState) + " ------", m_rangeIndex);  // Ø¹Ù†ÙˆØ§Ù† Ø­Ø§Ù„Øª

   // Ø³ÙˆØ¦ÛŒÚ† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ ØªØ§Ø¨Ø¹ Ù…Ø±Ø¨ÙˆØ·Ù‡
   switch(m_currentState)  // Ø³ÙˆØ¦ÛŒÚ† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ
   {
      case RANGE_IDLE:  // Ø­Ø§Ù„Øª Ø¨ÛŒÚ©Ø§Ø±
         // Ú†Ú© Ø§Ú¯Ø± Ø²Ù…Ø§Ù† ÙˆØ§Ø±Ø¯ Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø±Ù†Ø¬ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
         datetime currentTime = TimeCurrent();  // Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ
         datetime startTime, endTime;  // Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ Ùˆ Ù¾Ø§ÛŒØ§Ù†
         if(CTimeHelper::CalculateRangeTimes(m_startHour, m_startMinute, m_endHour, m_endMinute, startTime, endTime))  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§
         {
            if(currentTime >= startTime && currentTime < endTime)  // Ú†Ú© Ø¯Ø§Ø®Ù„ Ù…Ø­Ø¯ÙˆØ¯Ù‡
            {
               CLogger::Log("Ø²Ù…Ø§Ù† Ø±Ù†Ø¬ ÙØ±Ø§ Ø±Ø³ÛŒØ¯. Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ RANGE_IDENTIFYING.", m_rangeIndex);  // Ù„Ø§Ú¯ Ø§Ù†ØªÙ‚Ø§Ù„
               m_currentState = RANGE_IDENTIFYING;  // ØªØºÛŒÛŒØ± Ø¨Ù‡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ
            }
         }
         break;  // Ø®Ø±ÙˆØ¬ Ø§Ø² Ú©ÛŒØ³
      case RANGE_IDENTIFYING:  // Ø¯Ø± Ø­Ø§Ù„ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ
         IdentifyAndValidateRange();  // Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø±Ù†Ø¬
         break;  // Ø®Ø±ÙˆØ¬
      case RANGE_ARMED:  // Ù…Ø³Ù„Ø­ Ùˆ Ø§Ù†ØªØ¸Ø§Ø±
         WaitForBreakerCandle();  // Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±ÛŒÚ©
         break;  // Ø®Ø±ÙˆØ¬
      case AWAITING_CONFIRMATION:  // Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯
         ProcessEntryAttempt();  // ÙØ±Ø¢ÛŒÙ†Ø¯ ÙˆØ±ÙˆØ¯
         break;  // Ø®Ø±ÙˆØ¬
      case RANGE_TRADE_ACTIVE:  // Ù…Ø¹Ø§Ù…Ù„Ù‡ ÙØ¹Ø§Ù„
         // Ù‡ÛŒÚ† Ø¹Ù…Ù„ÛŒØŒ Ù…Ù†ØªØ¸Ø± Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
         CLogger::Log("Ù…Ø¹Ø§Ù…Ù„Ù‡ ÙØ¹Ø§Ù„ Ø§Ø³Øª. Ù…Ù†ØªØ¸Ø± Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ.", m_rangeIndex);  // Ù„Ø§Ú¯ ÙˆØ¶Ø¹ÛŒØª
         break;  // Ø®Ø±ÙˆØ¬
      case RANGE_EXPIRED:  // Ù…Ù†Ù‚Ø¶ÛŒ
         SoftCleanup();  // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù…
         m_currentState = RANGE_IDLE;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¨ÛŒÚ©Ø§Ø±
         break;  // Ø®Ø±ÙˆØ¬
   }

   CheckCleanup();  // Ú†Ú© Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø¯Ø± Ù‡Ø± Ú©Ù†Ø¯Ù„ Ø¬Ø¯ÛŒØ¯
}

// Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ùˆ ÙˆÙ„ÛŒØ¯ Ø±Ù†Ø¬: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‚Ù/Ú©ÙØŒ Ú†Ú© Ø§Ø±ØªÙØ§Ø¹ØŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø«Ø§Ø¨Øª Ø§ÙØ³Øª Ùˆ Ø±Ø³Ù… Ù…Ø³ØªØ·ÛŒÙ„ Ø§Ú¯Ø± Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø±Ù†Ø¬ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù† Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†Ø¯Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ ÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
void CRange::IdentifyAndValidateRange()  // ØªØ§Ø¨Ø¹ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ
{
   CLogger::Log("Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + "...", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ

   datetime startTime, endTime;  // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ Ùˆ Ù¾Ø§ÛŒØ§Ù†
   // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ Ø¨Ø§ CTimeHelper
   if(!CTimeHelper::CalculateRangeTimes(m_startHour, m_startMinute, m_endHour, m_endMinute, startTime, endTime))  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§
   {
      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      m_currentState = RANGE_EXPIRED;  // ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ
      return;  // Ø®Ø±ÙˆØ¬
   }

   // Ú†Ú© Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªÚ©Ø±Ø§Ø±ÛŒ Ø±Ù†Ø¬ Ø¯Ø± ÛŒÚ© Ø±ÙˆØ² (Ø¨Ø§ Ú†Ú© Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Ø¢Ø®Ø±ÛŒÙ†)
   // Ø§ÛŒÙ† Ø´Ø±Ø· Ø§Ø² Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ù…Ú©Ø±Ø± Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   if(endTime == m_lastEndTime && !m_lastInvalid) return;  // Ø§Ú¯Ø± Ù‡Ù…Ø§Ù† Ù¾Ø§ÛŒØ§Ù† Ù‚Ø¨Ù„ÛŒ Ùˆ Ù…Ø¹ØªØ¨Ø±ØŒ Ù¾Ø±Ø´
   if(endTime == m_lastEndTime && m_lastInvalid) return;  // Ø§Ú¯Ø± Ù‡Ù…Ø§Ù† Ùˆ Ù†Ø§Ù…Ø¹ØªØ¨Ø±ØŒ Ù¾Ø±Ø´
   if(TimeCurrent() < endTime) return;  // Ø§Ú¯Ø± Ù‡Ù†ÙˆØ² Ù¾Ø§ÛŒØ§Ù† Ù†Ø±Ø³ÛŒØ¯Ù‡ØŒ Ù¾Ø±Ø´

   m_rangeEndTime = endTime;  // Ø°Ø®ÛŒØ±Ù‡ Ø²Ù…Ø§Ù† Ù¾Ø§ÛŒØ§Ù† Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø¯Ù‚ÛŒÙ‚

   // iBarShift Ø´ÛŒÙØª Ú©Ù†Ø¯Ù„ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù† Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
   int startShift = iBarShift(_Symbol, m_timeframe, startTime);  // Ø´ÛŒÙØª Ø´Ø±ÙˆØ¹
   int endShift = iBarShift(_Symbol, m_timeframe, endTime);  // Ø´ÛŒÙØª Ù¾Ø§ÛŒØ§Ù†

   if(startShift < 0 || endShift < 0)  // Ú†Ú© Ø´ÛŒÙØª Ù…Ø¹ØªØ¨Ø± (Ø¨Ø±Ø§ÛŒ Edge Case Ø¨Ø¯ÙˆÙ† Ú©Ù†Ø¯Ù„)
   {
      CLogger::Log("Ø®Ø·Ø§: Ú©Ù†Ø¯Ù„ÛŒ Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ù…Ø´Ø®Øµ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " ÛŒØ§ÙØª Ù†Ø´Ø¯.", m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      m_lastInvalid = true;  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø±
      m_lastEndTime = endTime;  // Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø§ÛŒØ§Ù†
      m_currentState = RANGE_EXPIRED;  // ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ
      return;  // Ø®Ø±ÙˆØ¬
   }

   int bars = startShift - endShift + 1;  // ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø±Ù‡Ø§ Ø¯Ø± Ø±Ù†Ø¬
   if(bars <= 0)  // Ú†Ú© ØªØ¹Ø¯Ø§Ø¯ Ù…Ø¹ØªØ¨Ø±
   {
      CLogger::Log("Ø®Ø·Ø§: ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø±Ù‡Ø§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      m_lastInvalid = true;  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯
      m_lastEndTime = endTime;  // Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø§ÛŒØ§Ù†
      m_currentState = RANGE_EXPIRED;  // ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ
      return;  // Ø®Ø±ÙˆØ¬
   }

   // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‚Ù Ùˆ Ú©Ù Ø±Ù†Ø¬ Ø¨Ø§ iHighest/iLowest
   int highestIdx = iHighest(_Symbol, m_timeframe, MODE_HIGH, bars, endShift);  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø³Ù‚Ù
   int lowestIdx = iLowest(_Symbol, m_timeframe, MODE_LOW, bars, endShift);  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ú©Ù
   m_rangeHigh = iHigh(_Symbol, m_timeframe, highestIdx);  // Ø³Ù‚Ù Ø±Ù†Ø¬
   m_rangeLow = iLow(_Symbol, m_timeframe, lowestIdx);  // Ú©Ù Ø±Ù†Ø¬

   double rangeHeight = (m_rangeHigh - m_rangeLow) / _Point;  // Ø§Ø±ØªÙØ§Ø¹ Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª
   CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": Ø³Ù‚Ù=" + DoubleToString(m_rangeHigh, _Digits) + ", Ú©Ù=" + DoubleToString(m_rangeLow, _Digits) + ", Ø§Ø±ØªÙØ§Ø¹=" + DoubleToString(rangeHeight, 0) + " Ù¾ÙˆÛŒÙ†Øª", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯

   // Ú†Ú© Ú©ÛŒÙÛŒØª Ø±Ù†Ø¬ (Ø§Ø±ØªÙØ§Ø¹ Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù…Ø¬Ø§Ø²)
   if(rangeHeight < m_minRangePoints || rangeHeight > m_maxRangePoints)  // Ø´Ø±Ø· Ú†Ú© Ø§Ø±ØªÙØ§Ø¹
   {
      CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " Ø¨ÛŒâ€ŒÚ©ÛŒÙÛŒØª Ø§Ø³Øª. Ø§Ø±ØªÙØ§Ø¹ Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù…Ø¬Ø§Ø².", m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      m_lastInvalid = true;  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯
      m_lastEndTime = endTime;  // Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø§ÛŒØ§Ù†
      m_currentState = RANGE_EXPIRED;  // ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ
      return;  // Ø®Ø±ÙˆØ¬
   }

   // --- START: Calculate and Fix Offset Value --- (Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø«Ø§Ø¨Øª Ø§ÙØ³Øª Ø¯Ø± Ù„Ø­Ø¸Ù‡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ)
   // Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø§ÙØ³Øª Ø±Ø§ Ø«Ø§Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   if(m_placementMode == PLACEMENT_ATR)  // Ø­Ø§Ù„Øª ATR
   {
      double atr_buffer[];  // Ø¨Ø§ÙØ± ATR (Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø¨Ø¯ÙˆÙ† Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø«Ø§Ø¨Øª)
      ArraySetAsSeries(atr_buffer, true);  // ØªÙ†Ø¸ÛŒÙ… Ø³Ø±ÛŒ Ø¢Ø±Ø§ÛŒÙ‡
      if(CopyBuffer(m_atrHandle, 0, 1, 1, atr_buffer) > 0)  // Ú©Ù¾ÛŒ ATR ÙØ¹Ù„ÛŒ (shift 1 Ø¨Ø±Ø§ÛŒ Ú©Ù†Ø¯Ù„ Ø¨Ø³ØªÙ‡)
      {
         m_fixedOffsetValue = atr_buffer[0] * m_atrMultiplier;  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ø«Ø§Ø¨Øª
      }
      else  // Ø´Ø±Ø· Ø´Ú©Ø³Øª Ú©Ù¾ÛŒ
      {
         CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ú¯Ø±ÙØªÙ† ATR Ø¨Ø±Ø§ÛŒ ØªØ«Ø¨ÛŒØª Ø§ÙØ³Øª Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         m_currentState = RANGE_EXPIRED;  // ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ
         return;  // Ø®Ø±ÙˆØ¬
      }
   }
   else  // Ø­Ø§Ù„Øª Ø¯Ø±ØµØ¯
   {
      m_fixedOffsetValue = (m_rangeHigh - m_rangeLow) * m_atrMultiplier / 100.0;  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø«Ø§Ø¨Øª Ø¯Ø±ØµØ¯
   }
   // --- END: Calculate and Fix Offset Value ---

   // Ø±Ø³Ù… Ù…Ø³ØªØ·ÛŒÙ„ Ø±Ù†Ø¬ Ø§Ú¯Ø± Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯ Ø¨Ø§ ObjectCreate
   if(!ObjectCreate(0, m_rangeObjectName, OBJ_RECTANGLE, 0, startTime, m_rangeHigh, endTime, m_rangeLow))  // Ø±Ø³Ù… Ù…Ø³ØªØ·ÛŒÙ„
   {
      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø±Ø³Ù… Ù…Ø³ØªØ·ÛŒÙ„ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
   }
   else  // Ø´Ø±Ø· Ù…ÙˆÙÙ‚ÛŒØª Ø±Ø³Ù…
   {
      ObjectSetInteger(0, m_rangeObjectName, OBJPROP_COLOR, m_color);  // ØªÙ†Ø¸ÛŒÙ… Ø±Ù†Ú¯
      ObjectSetInteger(0, m_rangeObjectName, OBJPROP_STYLE, STYLE_SOLID);  // ØªÙ†Ø¸ÛŒÙ… Ø§Ø³ØªØ§ÛŒÙ„
      ObjectSetInteger(0, m_rangeObjectName, OBJPROP_WIDTH, 1);  // ØªÙ†Ø¸ÛŒÙ… Ø¹Ø±Ø¶
      ObjectSetInteger(0, m_rangeObjectName, OBJPROP_FILL, true);  // ØªÙˆÙ¾Ø± Ú©Ø±Ø¯Ù† Ù…Ø³ØªØ·ÛŒÙ„ (Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ)
      ObjectSetInteger(0, m_rangeObjectName, OBJPROP_BACK, true);  // Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ø´ÙØ§ÙÛŒØª
   }
   
   // ++++++++++++++++ START: Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø§Ø² ArmAndWait ++++++++++++++++
   CLogger::Log("Ù…Ø³Ù„Ø­ Ú©Ø±Ø¯Ù† Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + "...", m_rangeIndex);

   // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÙØ³Øª Ø«Ø§Ø¨Øª Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒØ´Ø¯Ù‡ Ø¯Ø± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ (Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ø®Ø·ÙˆØ·)
   m_potentialBuyPrice = NormalizePrice(m_rangeHigh + m_fixedOffsetValue);
   m_potentialSellPrice = NormalizePrice(m_rangeLow - m_fixedOffsetValue);

   datetime currentTime = TimeCurrent();
   // Ø±Ø³Ù… Ø®Ø· Ø®Ø±ÛŒØ¯
   if(!ObjectCreate(0, m_buyLineName, OBJ_HLINE, 0, currentTime, m_potentialBuyPrice))
   {
      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø±Ø³Ù… Ø®Ø· BUY Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex), m_rangeIndex);
   }
   else
   {
      ObjectSetInteger(0, m_buyLineName, OBJPROP_COLOR, clrGreen);
      ObjectSetInteger(0, m_buyLineName, OBJPROP_STYLE, STYLE_DASH);
   }
   // Ø±Ø³Ù… Ø®Ø· ÙØ±ÙˆØ´
   if(!ObjectCreate(0, m_sellLineName, OBJ_HLINE, 0, currentTime, m_potentialSellPrice))
   {
      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø±Ø³Ù… Ø®Ø· SELL Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex), m_rangeIndex);
   }
   else
   {
      ObjectSetInteger(0, m_sellLineName, OBJPROP_COLOR, clrRed);
      ObjectSetInteger(0, m_sellLineName, OBJPROP_STYLE, STYLE_DASH);
   }

   // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
   m_cleanupTime = CTimeHelper::CalculateCleanupTime(m_rangeEndTime, m_cleanupHours);
   CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " Ù…Ø³Ù„Ø­ Ø´Ø¯. Potential Buy: " + DoubleToString(m_potentialBuyPrice, _Digits) + ", Sell: " + DoubleToString(m_potentialSellPrice, _Digits), m_rangeIndex);
   // ++++++++++++++++ END: Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø§Ø² ArmAndWait ++++++++++++++++

   m_lastInvalid = false;  // Ø±ÛŒØ³Øª ÙÙ„Ú¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø±
   m_lastEndTime = endTime;  // Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø§ÛŒØ§Ù†
   m_currentState = RANGE_ARMED;  // ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ø¨Ù‡ Ù…Ø³Ù„Ø­
   CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ø¨Ù‡ ARMED.", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
}

// Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ú©Ù†Ø¯Ù„ Ø¨Ø±ÛŒÚ©: Ú†Ú© Ú©Ù„ÙˆØ² Ø¨Ø§Ù„Ø§ÛŒ/Ù¾Ø§ÛŒÛŒÙ† Ø§ÙØ³Øª Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ØªØ§ÛŒÛŒØ¯ ÙˆØ±ÙˆØ¯ (Ø¨Ø¯ÙˆÙ† ØªØ§ÛŒÙ…Ø±ØŒ ÙÙ‚Ø· ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯)
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø´Ú©Ø³Øª Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©Ù„ÙˆØ² Ú©Ù†Ø¯Ù„ Ù‚Ø¨Ù„ÛŒ Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯
void CRange::WaitForBreakerCandle()  // ØªØ§Ø¨Ø¹ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±ÛŒÚ©
{
   // iClose Ú©Ù„ÙˆØ² Ú©Ù†Ø¯Ù„ Ù‚Ø¨Ù„ÛŒ (shift 1) Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
   double close1 = iClose(_Symbol, m_timeframe, 1);  // Ú©Ù„ÙˆØ² Ú©Ù†Ø¯Ù„ Ù‚Ø¨Ù„ÛŒ
   if(close1 == 0)  // Ú†Ú© Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø±
   {
      CLogger::Log("Ø®Ø·Ø§: iClose Ù…Ù‚Ø¯Ø§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      return;  // Ø®Ø±ÙˆØ¬
   }

   if(close1 > m_potentialBuyPrice)  // Ú†Ú© Ø´Ú©Ø³Øª Ø®Ø±ÛŒØ¯
   {
      m_breakerCandleLevel = iHigh(_Symbol, m_timeframe, 1);  // Ø³Ø·Ø­ Ù‡Ø§ÛŒ Ú©Ù†Ø¯Ù„ Ø´Ú©Ø³Øª
      CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " - BUY Breaker Candle detected! Level: " + DoubleToString(m_breakerCandleLevel, _Digits), m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
      m_waitCounter = 0;  // Ø±ÛŒØ³Øª Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª Ù‚Ø¯ÛŒÙ…ÛŒ
      m_currentState = AWAITING_CONFIRMATION;  // ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ø¨Ù‡ Ø§Ù†ØªØ¸Ø§Ø± ÙˆØ±ÙˆØ¯
   }
   else if(close1 < m_potentialSellPrice)  // Ú†Ú© Ø´Ú©Ø³Øª ÙØ±ÙˆØ´
   {
      m_breakerCandleLevel = iLow(_Symbol, m_timeframe, 1);  // Ø³Ø·Ø­ Ù„Ùˆ Ú©Ù†Ø¯Ù„ Ø´Ú©Ø³Øª
      CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " - SELL Breaker Candle detected! Level: " + DoubleToString(m_breakerCandleLevel, _Digits), m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
      m_waitCounter = 0;  // Ø±ÛŒØ³Øª Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª Ù‚Ø¯ÛŒÙ…ÛŒ
      m_currentState = AWAITING_CONFIRMATION;  // ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ø¨Ù‡ Ø§Ù†ØªØ¸Ø§Ø± ÙˆØ±ÙˆØ¯
   }
}

// ÙØ±Ø¢ÛŒÙ†Ø¯ ØªÙ„Ø§Ø´ ÙˆØ±ÙˆØ¯: Ú†Ú© Ø§Ø¨Ø·Ø§Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨Ø§Ø²Ú¯Ø´Øª Ù‚ÛŒÙ…ØªØŒ ØªØ§ÛŒÛŒØ¯ Ù‚ÛŒÙ…Øª Ùˆ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ØŒ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ú¯Ø± ØªØ§ÛŒÛŒØ¯ Ø´Ø¯ (Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø²Ù…Ø§Ù†ÛŒ)
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø§Ø¨Ø·Ø§Ù„ØŒ ØªØ§ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
void CRange::ProcessEntryAttempt()  // ØªØ§Ø¨Ø¹ ÙØ±Ø¢ÛŒÙ†Ø¯ ÙˆØ±ÙˆØ¯
{
   // ØªØ´Ø®ÛŒØµ Ø¬Ù‡Øª ØªÙ„Ø§Ø´ (Ø®Ø±ÛŒØ¯ ÛŒØ§ ÙØ±ÙˆØ´) Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø·Ø­ Ø¨Ø±ÛŒÚ©
   bool isBuyAttempt = (m_breakerCandleLevel == iHigh(_Symbol, m_timeframe, 1));  // ØªØ´Ø®ÛŒØµ Ø®Ø±ÛŒØ¯ Ø§Ú¯Ø± Ø³Ø·Ø­ Ù‡Ø§ÛŒ Ø¨Ø§Ø´Ø¯
   double close1 = iClose(_Symbol, m_timeframe, 1);  // Ú©Ù„ÙˆØ² Ú©Ù†Ø¯Ù„ Ù‚Ø¨Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ú†Ú© Ø§Ø¨Ø·Ø§Ù„ Ùˆ ØªØ§ÛŒÛŒØ¯
   bool isInvalid = false;  // ÙÙ„Ú¯ Ø¨Ø±Ø§ÛŒ Ø´Ø±Ø· Ø§Ø¨Ø·Ø§Ù„ (Ø¨Ø±Ø§ÛŒ ØªÙ…ÛŒØ²ØªØ± Ø´Ø¯Ù† Ú©Ø¯)

   // Ø§Ú¯Ø± Ø­Ø§Ù„Øª Ù‚Ø¯ÛŒÙ…ÛŒ (ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª) Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ØŒ Ú†Ú© Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ú©Ù†Ø¯Ù„â€ŒÙ‡Ø§
   // Ø§ÛŒÙ† Ù…Ù†Ø·Ù‚ ÙÙ‚Ø· Ø¯Ø± CONFIRMATION_TIMEOUT ÙØ¹Ø§Ù„ Ø§Ø³Øª
   if(Inp_Confirmation_Strategy == CONFIRMATION_TIMEOUT)  // Ø­Ø§Ù„Øª Ù‚Ø¯ÛŒÙ…ÛŒ Ø¨Ø§ ØªØ§ÛŒÙ…Ø±
   {
      m_waitCounter++;  // Ø§ÙØ²Ø§ÛŒØ´ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ú©Ù†Ø¯Ù„â€ŒÙ‡Ø§
      if(m_waitCounter >= Inp_Confirmation_Timeout)  // Ú†Ú© Ù…Ù‡Ù„Øª ØªÙ…Ø§Ù… Ø´Ø¯Ù‡
      {
         CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": Ù…Ù‡Ù„Øª ØªØ§ÛŒÛŒØ¯ ØªÙ…Ø§Ù… Ø´Ø¯. Ø§Ø¨Ø·Ø§Ù„.", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
         ResetToArmedState();  // Ø±ÛŒØ³Øª Ø¨Ù‡ Ù…Ø³Ù„Ø­
         return;  // Ø®Ø±ÙˆØ¬
      }
   }

   // Û±. Ø´Ø±Ø· Ø§Ø¨Ø·Ø§Ù„ Ùˆ Ø±ÛŒØ³Øª (Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Inp_Invalidation_Mode - ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯)
   // Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø§Ø¨Ø·Ø§Ù„ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   if(Inp_Confirmation_Strategy == CONFIRMATION_PRICE_INVALIDATION)  // Ø­Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù‚ÛŒÙ…Øª
   {
      if(Inp_Invalidation_Mode == INVALIDATION_RANGE_REENTRY)  // Ø­Ø§Ù„Øª ØµØ¨ÙˆØ±: Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø®Ù„ Ø±Ù†Ø¬ Ø§ØµÙ„ÛŒ
      {
         if(isBuyAttempt && close1 < m_rangeHigh) isInvalid = true;  // Ø§Ø¨Ø·Ø§Ù„ Ø®Ø±ÛŒØ¯ Ø§Ú¯Ø± Ú©Ù„ÙˆØ² Ø²ÛŒØ± Ø³Ù‚Ù Ø±Ù†Ø¬
         if(!isBuyAttempt && close1 > m_rangeLow) isInvalid = true;  // Ø§Ø¨Ø·Ø§Ù„ ÙØ±ÙˆØ´ Ø§Ú¯Ø± Ú©Ù„ÙˆØ² Ø¨Ø§Ù„Ø§ÛŒ Ú©Ù Ø±Ù†Ø¬
      }
      else  // Ø­Ø§Ù„Øª ØªÙ‡Ø§Ø¬Ù…ÛŒ: INVALIDATION_BREAKOUT_LINE_CROSS - Ø¹Ø¨ÙˆØ± Ø§Ø² Ø®Ø· Ø´Ú©Ø³Øª (Ø§ÙØ³Øª)
      {
         if(isBuyAttempt && close1 < m_potentialBuyPrice) isInvalid = true;  // Ø§Ø¨Ø·Ø§Ù„ Ø®Ø±ÛŒØ¯ Ø§Ú¯Ø± Ú©Ù„ÙˆØ² Ø²ÛŒØ± Ø®Ø· Ø®Ø±ÛŒØ¯
         if(!isBuyAttempt && close1 > m_potentialSellPrice) isInvalid = true;  // Ø§Ø¨Ø·Ø§Ù„ ÙØ±ÙˆØ´ Ø§Ú¯Ø± Ú©Ù„ÙˆØ² Ø¨Ø§Ù„Ø§ÛŒ Ø®Ø· ÙØ±ÙˆØ´
      }

      // Ø§Ú¯Ø± Ø´Ø±Ø· Ø§Ø¨Ø·Ø§Ù„ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø¨ÙˆØ¯ØŒ Ø±ÛŒØ³Øª Ú©Ù† Ùˆ Ø§Ø² ØªØ§Ø¨Ø¹ Ø®Ø§Ø±Ø¬ Ø´Ùˆ
      if(isInvalid)  // Ú†Ú© ÙÙ„Ú¯ Ø§Ø¨Ø·Ø§Ù„
      {
         ResetToArmedState();  // Ø±ÛŒØ³Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ù…Ø³Ù„Ø­ Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù Ù…Ø³ÛŒØ±Ù‡Ø§
         return;  // Ø®Ø±ÙˆØ¬ Ø§Ø² ØªØ§Ø¨Ø¹
      }
   }

   // Û². Ú†Ú© Ú©Ø±Ø¯Ù† Ø´Ø±Ø§ÛŒØ· ÙˆØ±ÙˆØ¯
   // Ø§Ù„Ù) ØªØ§ÛŒÛŒØ¯ÛŒÙ‡ Ù‚ÛŒÙ…Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ: Ú†Ú© Ú©Ù„ÙˆØ² Ø¨Ø§Ù„Ø§ÛŒ/Ù¾Ø§ÛŒÛŒÙ† Ø³Ø·Ø­ Ø¨Ø±ÛŒÚ©)
   // Inp_PriceConfirmation_Enabled Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø§Ø³Øª
   bool priceConfirmed = !Inp_PriceConfirmation_Enabled ||  // Ø§Ú¯Ø± ØªØ§ÛŒÛŒØ¯ Ù‚ÛŒÙ…Øª Ø®Ø§Ù…ÙˆØ´ØŒ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø±Ø³Øª
                         (isBuyAttempt ? (close1 > m_breakerCandleLevel) : (close1 < m_breakerCandleLevel));  // Ú†Ú© ØªØ§ÛŒÛŒØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¬Ù‡Øª

   if(!priceConfirmed) return;  // Ø§Ú¯Ø± ØªØ§ÛŒÛŒØ¯ Ù‚ÛŒÙ…Øª Ù„Ø§Ø²Ù… Ø¨ÙˆØ¯ Ùˆ Ù†Ú¯Ø±ÙØªÛŒÙ…ØŒ Ù…Ù†ØªØ¸Ø± Ú©Ù†Ø¯Ù„ Ø¨Ø¹Ø¯ÛŒ Ø¨Ù…ÙˆÙ†

   // Ø¨) ØªØ§ÛŒÛŒØ¯ÛŒÙ‡ ÙÛŒÙ„ØªØ± Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ (Ø¨Ù‡ ØµÙˆØ±Øª Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ùˆ Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø²Ù…Ø§Ù†ÛŒ)
   // g_trendFilter.GetTrendDirection Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§Ø³Øª
   ENUM_TREND_DIRECTION currentTrend = g_trendFilter.GetTrendDirection(m_trendFilterTimeframe);  // Ú¯Ø±ÙØªÙ† Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯ ÙØ¹Ù„ÛŒ
   bool filterConfirmed = !Inp_IchimokuFilter_Enabled ||  // Ø§Ú¯Ø± ÙÛŒÙ„ØªØ± Ø®Ø§Ù…ÙˆØ´ØŒ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø±Ø³Øª
                          (isBuyAttempt && (currentTrend == TREND_BUY || currentTrend == TREND_NEUTRAL)) ||  // Ú†Ú© Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯
                          (!isBuyAttempt && (currentTrend == TREND_SELL || currentTrend == TREND_NEUTRAL));  // Ú†Ú© Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´

   // Û³. Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ú¯Ø± ÙÛŒÙ„ØªØ± ØªØ§ÛŒÛŒØ¯ Ø´Ø¯
   if(filterConfirmed)  // Ú†Ú© ØªØ§ÛŒÛŒØ¯ ÙÛŒÙ„ØªØ±
   {
      ExecuteTrade(isBuyAttempt);  // Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ± Ø¬Ù‡Øª (Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´)
   }
}

// Ø±ÛŒØ³Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ù…Ø³Ù„Ø­: Ø±ÛŒØ³Øª Ø³Ø·Ø­ Ø¨Ø±ÛŒÚ© Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù Ø®Ø·ÙˆØ· Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ ÛŒØ§ Ù…Ø³ÛŒØ±Ù‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ ÙØ±ØµØªâ€ŒÙ‡Ø§)
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§Ø¨Ø·Ø§Ù„ Ù…ÙˆÙ‚Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
void CRange::ResetToArmedState()  // ØªØ§Ø¨Ø¹ Ø±ÛŒØ³Øª
{
   CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": Ø´Ø±Ø· Ø§Ø¨Ø·Ø§Ù„ Ø±Ø® Ø¯Ø§Ø¯. Ø±ÛŒØ³Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ù…Ø³Ù„Ø­.", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø§Ø¨Ø·Ø§Ù„
   m_breakerCandleLevel = 0;  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø³Ø·Ø­ Ú©Ù†Ø¯Ù„ Ø´Ú©Ù†Ù†Ø¯Ù‡
   m_waitCounter = 0;  // Ø±ÛŒØ³Øª Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª Ø¨Ø¹Ø¯ÛŒ
   m_currentState = RANGE_ARMED;  // Ø±ÛŒØ³Øª Ø­Ø§Ù„Øª Ø¨Ù‡ Ù…Ø³Ù„Ø­ Ùˆ Ø§Ù†ØªØ¸Ø§Ø±
   // Ù†Ú©ØªÙ‡ Ú©Ù„ÛŒØ¯ÛŒ: Ù‡ÛŒÚ† Ø®Ø· Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ ÛŒØ§ Ù…Ø³ÛŒØ±ÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ø­Ø°Ù Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§ ÙØ±ØµØª Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø´Ú©Ù„ Ú¯ÛŒØ±Ø¯
}

// Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡: Ù…Ø­Ø§Ø³Ø¨Ù‡ SL Ø¨Ø± Ø§Ø³Ø§Ø³ SL strategy Ø¬Ø¯ÛŒØ¯ (base point + Ø¨Ø§ÙØ±)ØŒ Ø­Ø¬Ù… Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´ Ø¨Ø§Ø²Ø§Ø±
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø±Ø§ Ø¨Ø§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯
void CRange::ExecuteTrade(bool isBuy)  // ØªØ§Ø¨Ø¹ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡
{
   // Ù‚ÛŒÙ…Øª ÙˆØ±ÙˆØ¯ ÙØ¹Ù„ÛŒ (ASK Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ØŒ BID Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´)
   double entryPrice = isBuy ? SymbolInfoDouble(_Symbol, SYMBOL_ASK) : SymbolInfoDouble(_Symbol, SYMBOL_BID);  // Ù‚ÛŒÙ…Øª ÙˆØ±ÙˆØ¯ ÙØ¹Ù„ÛŒ (ASK Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ØŒ BID Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´)
   double adjustment;  // Ø¨Ø§ÙØ± SL

   // Ú†Ú© Ø­Ø§Ù„Øª ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± SL
   if(m_slCalcMode == SL_CALC_ATR)  // Ú†Ú© Ø­Ø§Ù„Øª ATR Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÙØ± SL
   {
      double atr_buffer[];  // Ø¢Ø±Ø§ÛŒÙ‡ ATR (Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø¨Ø¯ÙˆÙ† Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø«Ø§Ø¨Øª)
      ArraySetAsSeries(atr_buffer, true);  // ØªÙ†Ø¸ÛŒÙ… Ø³Ø±ÛŒ Ø¢Ø±Ø§ÛŒÙ‡
      if(CopyBuffer(m_slAtrHandle, 0, 1, 1, atr_buffer) <= 0)  // Ú©Ù¾ÛŒ Ø¨Ø§ÙØ± (shift 1)
      {
         CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ú¯Ø±ÙØªÙ† ATR Ø¨Ø±Ø§ÛŒ SL Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return;  // Ø®Ø±ÙˆØ¬
      }
      adjustment = atr_buffer[0] * m_slAtrMultiplier;  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± ATR
   }
   else  // Ø­Ø§Ù„Øª Ø¯Ø±ØµØ¯
   {
      adjustment = (m_rangeHigh - m_rangeLow) * m_slAtrMultiplier / 100.0;  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ÙØ± Ø¯Ø±ØµØ¯
   }

   // Ø§Ù†ØªØ®Ø§Ø¨ base point Ø¨Ø± Ø§Ø³Ø§Ø³ SL strategy
   double basePoint;  // Ù¾Ø§ÛŒÙ‡ SL
   if(m_slStrategy == SL_OPPOSITE_SIDE)  // Ø­Ø§Ù„Øª Ù…Ù‚Ø§Ø¨Ù„ Ø±Ù†Ø¬
   {
      basePoint = isBuy ? m_rangeLow : m_rangeHigh;  // Ù…Ù‚Ø§Ø¨Ù„ Ø±Ù†Ø¬ Ø¨Ø±Ø§ÛŒ BUY/SELL
   }
   else  // SL_BREAKOUT_LEVEL - Ø³Ø·Ø­ Ø´Ú©Ø³Øª
   {
      basePoint = isBuy ? m_rangeHigh : m_rangeLow;  // Ø³Ø·Ø­ Ø´Ú©Ø³Øª Ø¨Ø±Ø§ÛŒ BUY/SELL
   }

   // Ù…Ø­Ø§Ø³Ø¨Ù‡ SL Ø¨Ø± Ø§Ø³Ø§Ø³ base point Ø¨Ø§ NormalizePrice
   double slPrice = isBuy ? NormalizePrice(basePoint - adjustment) : NormalizePrice(basePoint + adjustment);  // Ù‚ÛŒÙ…Øª SL Ù†Ø±Ù…Ø§Ù„Ø§ÛŒØ² Ø´Ø¯Ù‡
   double slDistance = MathAbs(entryPrice - slPrice);  // ÙØ§ØµÙ„Ù‡ SL Ø§Ø² ÙˆØ±ÙˆØ¯
   m_initialSlDistance = slDistance;  // Ø°Ø®ÛŒØ±Ù‡ ÙØ§ØµÙ„Ù‡ SL Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ

   // Ø³Ø·Ø­ Ø­Ø¯Ø§Ù‚Ù„ ÙØ§ØµÙ„Ù‡ Ø§Ø² SYMBOL_TRADE_STOPS_LEVEL
   long stops_level = SymbolInfoInteger(_Symbol, SYMBOL_TRADE_STOPS_LEVEL);  // Ø³Ø·Ø­ Ø­Ø¯Ø§Ù‚Ù„ ÙØ§ØµÙ„Ù‡
   double minStop = stops_level * _Point + _Point;  // Ø­Ø¯Ø§Ù‚Ù„ ÙØ§ØµÙ„Ù‡ Ø¨Ø§ Ø¨Ø§ÙØ±
   if(slDistance <= 0 || slDistance < minStop)  // Ú†Ú© ÙØ§ØµÙ„Ù‡ Ù…Ø¹ØªØ¨Ø±
   {
      CLogger::Log("Ø®Ø·Ø§: slDistance Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ú©Ù…ØªØ± Ø§Ø² Ø­Ø¯Ø§Ù‚Ù„ ÙØ§ØµÙ„Ù‡ Ù…Ø¬Ø§Ø² Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " (slDistance=" + DoubleToString(slDistance, _Digits) + ")", m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      m_currentState = RANGE_EXPIRED;  // ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ
      return;  // Ø®Ø±ÙˆØ¬
   }

   CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": SL Strategy=" + EnumToString(m_slStrategy) + ", slDistance=" + DoubleToString(slDistance, _Digits) + ", slPrice=" + DoubleToString(slPrice, _Digits), m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ SL

   // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù… Ø¨Ø§ CRiskManager
   double lotSize = CRiskManager::CalculateLotSize(InpRiskPercent, slDistance);  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù… Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÛŒØ³Ú©
   if(lotSize == 0)  // Ú†Ú© Ø­Ø¬Ù… Ù…Ø¹ØªØ¨Ø±
   {
      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù… Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      m_currentState = RANGE_EXPIRED;  // ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ
      return;  // Ø®Ø±ÙˆØ¬
   }

   CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": lotSize=" + DoubleToString(lotSize, 2), m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø­Ø¬Ù…

   // --- START: Margin Pre-validation --- (Ú†Ú© Ù¾ÛŒØ´-Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…Ø§Ø±Ø¬ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø¯ÙˆÙ† Ù…Ø§Ø±Ø¬ÛŒÙ† Ú©Ø§ÙÛŒ)
   double margin_required;  // Ù…ØªØºÛŒØ± Ø¨Ø±Ø§ÛŒ Ù…Ø§Ø±Ø¬ÛŒÙ† Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
   // OrderCalcMargin Ù…Ø§Ø±Ø¬ÛŒÙ† Ø±Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   if(!OrderCalcMargin(isBuy ? ORDER_TYPE_BUY : ORDER_TYPE_SELL, _Symbol, lotSize, entryPrice, margin_required))  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø§Ø±Ø¬ÛŒÙ†
   {
      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø§Ø±Ø¬ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ". Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù„ØºÙˆ Ø´Ø¯.", m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      m_currentState = RANGE_EXPIRED;  // ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ
      return;  // Ø®Ø±ÙˆØ¬
   }
   // AccountInfoDouble Ù…Ø§Ø±Ø¬ÛŒÙ† Ø¢Ø²Ø§Ø¯ Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
   if(margin_required > AccountInfoDouble(ACCOUNT_MARGIN_FREE))  // Ú†Ú© Ù…Ø§Ø±Ø¬ÛŒÙ† Ú©Ø§ÙÛŒ
   {
      CLogger::Log("Ù…Ø§Ø±Ø¬ÛŒÙ† Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª. Ù†ÛŒØ§Ø²: " + DoubleToString(margin_required, 2) + ", Ù…ÙˆØ¬ÙˆØ¯: " + DoubleToString(AccountInfoDouble(ACCOUNT_MARGIN_FREE), 2), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      m_currentState = RANGE_EXPIRED;  // ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ
      return;  // Ø®Ø±ÙˆØ¬
   }
   // --- END: Margin Pre-validation ---

   // Ù†Ù…ÙˆÙ†Ù‡ CTrade Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´
   CTrade trade;  // Ù†Ù…ÙˆÙ†Ù‡ Ú©Ù„Ø§Ø³ Ù…Ø¹Ø§Ù…Ù„Ù‡
   MqlTradeRequest request;  // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¹Ø§Ù…Ù„Ù‡
   MqlTradeResult result;  // Ù†ØªÛŒØ¬Ù‡ Ù…Ø¹Ø§Ù…Ù„Ù‡
   ZeroMemory(request);  // ØµÙØ± Ú©Ø±Ø¯Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª
   request.action = TRADE_ACTION_DEAL;  // Ø¹Ù…Ù„ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§Ø²Ø§Ø±
   request.symbol = _Symbol;  // Ù†Ù…Ø§Ø¯
   request.volume = lotSize;  // Ø­Ø¬Ù…
   request.type = isBuy ? ORDER_TYPE_BUY : ORDER_TYPE_SELL;  // Ù†ÙˆØ¹ Ø³ÙØ§Ø±Ø´
   request.price = entryPrice;  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚ÛŒÙ…Øª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Ø´ Ø¨Ø§Ø²Ø§Ø±
   request.sl = slPrice;  // SL
   request.tp = 0.0;  // TP Ø¨Ù‡ 0.0 Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø­Ø¯ Ø³ÙˆØ¯ Ø§ÙˆÙ„ÛŒÙ‡ (Ø§Ø¬Ø§Ø²Ù‡ Ø±ÙˆÙ†Ø¯ Ø§Ø¯Ø§Ù…Ù‡)
   request.magic = m_magicNumber;  // Ù…Ø¬ÛŒÚ©
   request.comment = StringFormat("R%d;H:%.5f;L:%.5f;SLD:%.5f", m_rangeIndex, m_rangeHigh, m_rangeLow, m_initialSlDistance);  // Ú©Ø§Ù…Ù†Øª Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­ÛŒØ§ØªÛŒ
   request.deviation = 10;  // Ø§Ù†Ø­Ø±Ø§Ù Ù…Ø¬Ø§Ø²
   // OrderSend Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   if(!trade.OrderSend(request, result) || result.deal == 0)  // Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´
   {
      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(result.retcode), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      m_currentState = RANGE_EXPIRED;  // ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ
      return;  // Ø®Ø±ÙˆØ¬
   }
   m_activeTicket = result.deal;  // Ø°Ø®ÛŒØ±Ù‡ ØªÛŒÚ©Øª

   CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " - " + (isBuy ? "BUY" : "SELL") + " Trade Opened! Ticket: " + (string)m_activeTicket, m_rangeIndex);  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª

   // Ø«Ø¨Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¯Ø± Ù…Ø¯ÛŒØ± Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¢ÛŒÙ†Ø¯Ù‡
   g_tradeManager.RegisterTrade(m_activeTicket, m_magicNumber, m_rangeIndex, m_initialSlDistance, entryPrice, m_rrRatio, m_partialClosePercent, m_trailingMode, m_trailingAtrPeriod, m_trailingAtrMultiplier, m_timeframe, m_trailingAtrHandle, m_trendFilterTimeframe);  // Ø«Ø¨Øª Ù…Ø¹Ø§Ù…Ù„Ù‡

   DisableOppositePath(isBuy);  // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù…Ø³ÛŒØ± Ù…Ø®Ø§Ù„Ù Ø¨Ø±Ø§ÛŒ OCO
   m_currentState = RANGE_TRADE_ACTIVE;  // ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ø¨Ù‡ Ù…Ø¹Ø§Ù…Ù„Ù‡ ÙØ¹Ø§Ù„
}

// ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù…Ø³ÛŒØ± Ù…Ø®Ø§Ù„Ù: Ø­Ø°Ù Ø®Ø· Ùˆ Ø±ÛŒØ³Øª Ù‚ÛŒÙ…Øª Ø¨Ø§Ù„Ù‚ÙˆÙ‡ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø¯ÙˆÚ¯Ø§Ù†Ù‡
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ OCO Ø±Ø§ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
void CRange::DisableOppositePath(bool isBuy)  // ØªØ§Ø¨Ø¹ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†
{
   if(isBuy)  // Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯
   {
      m_potentialSellPrice = 0;  // Ø±ÛŒØ³Øª Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´
      ObjectDelete(0, m_sellLineName);  // Ø­Ø°Ù Ø®Ø· ÙØ±ÙˆØ´
      CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " - SELL path deactivated (OCO).", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
   }
   else  // Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´
   {
      m_potentialBuyPrice = 0;  // Ø±ÛŒØ³Øª Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯
      ObjectDelete(0, m_buyLineName);  // Ø­Ø°Ù Ø®Ø· Ø®Ø±ÛŒØ¯
      CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " - BUY path deactivated (OCO).", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
   }
}

// Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù…: Ø±ÛŒØ³Øª Ù…ØªØºÛŒØ±Ù‡Ø§ Ùˆ Ø­Ø°Ù Ø§Ø´ÛŒØ§Ø¡ Ø¨Ø¯ÙˆÙ† Ø¨Ø³ØªÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø±Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø±Ù†Ø¬ Ø¨Ø¹Ø¯ÛŒ
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Øª Ø±ÙˆØ²Ø§Ù†Ù‡ Ø¨Ø¯ÙˆÙ† Ø¨Ø³ØªÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ø³Øª
void CRange::SoftCleanup()  // ØªØ§Ø¨Ø¹ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù…
{
   CLogger::Log("Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù… Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + "...", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù…

   // Û±. Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯
   m_potentialBuyPrice = 0;  // Ø±ÛŒØ³Øª Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯
   m_potentialSellPrice = 0;  // Ø±ÛŒØ³Øª Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´
   m_breakerCandleLevel = 0;  // Ø±ÛŒØ³Øª Ø³Ø·Ø­ Ø¨Ø±ÛŒÚ©
   m_waitCounter = 0;  // Ø±ÛŒØ³Øª Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡

   // Û². Ø­Ø°Ù ØªÙ…Ø§Ù… Ø§Ø´ÛŒØ§Ø¡ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø±Ù†Ø¬
   ObjectDelete(0, m_buyLineName);  // Ø­Ø°Ù Ø®Ø· Ø®Ø±ÛŒØ¯
   ObjectDelete(0, m_sellLineName);  // Ø­Ø°Ù Ø®Ø· ÙØ±ÙˆØ´
   ObjectDelete(0, m_rangeObjectName);  // Ø­Ø°Ù Ù…Ø³ØªØ·ÛŒÙ„ Ø±Ù†Ø¬

   // Û³. Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø±Ù†Ø¬ Ø¨Ø¹Ø¯ÛŒ
   m_lastEndTime = 0;  // << Ø¨Ø³ÛŒØ§Ø± Ù…Ù‡Ù…: Ø§ÛŒÙ† Ø®Ø· Ø¨Ø§Ú¯ Ø§ØµÙ„ÛŒ Ù‚ÙÙ„ Ø´Ø¯Ù† Ø±Ø§ Ø­Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   m_lastInvalid = false;  // Ø±ÛŒØ³Øª ÙÙ„Ú¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø±

   // Û´. Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ú©Ø´â€ŒÙ‡Ø§
   ResetCaches();  // Ø±ÛŒØ³Øª Ú©Ø´â€ŒÙ‡Ø§

   // Ø±ÛŒØ³Øª Ù…ØªØºÛŒØ± Ù…Ø¹Ø§Ù…Ù„Ù‡
   m_activeTicket = 0;  // Ø±ÛŒØ³Øª ØªÛŒÚ©Øª
   
   // Ûµ. Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ù„Ø§Ù…Øª Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø±ÙˆÛŒ Ú©Ù†Ø¯Ù„ ÙØ¹Ù„ÛŒ (Ú©Ø¯ 217 Ø¨Ø±Ø§ÛŒ OBJ_ARROW)
   string cleanupMarkerName = "Cleanup_Marker_" + IntegerToString(m_rangeIndex);  // Ù†Ø§Ù… Ø¹Ù„Ø§Ù…Øª Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
   datetime currentTime = TimeCurrent();  // Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ù„Ø§Ù…Øª
   double currentPrice = SymbolInfoDouble(_Symbol, SYMBOL_BID);  // Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ù„Ø§Ù…Øª
   if(!ObjectCreate(0, cleanupMarkerName, OBJ_ARROW, 0, currentTime, currentPrice))  // Ø±Ø³Ù… Ø¹Ù„Ø§Ù…Øª
   {
      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø±Ø³Ù… Ø¹Ù„Ø§Ù…Øª Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
   }
   else  // Ø´Ø±Ø· Ù…ÙˆÙÙ‚ÛŒØª
   {
      ObjectSetInteger(0, cleanupMarkerName, OBJPROP_ARROWCODE, 217);  // Ú©Ø¯ Ø¹Ù„Ø§Ù…Øª (217)
      ObjectSetInteger(0, cleanupMarkerName, OBJPROP_COLOR, clrYellow);  // Ø±Ù†Ú¯ Ø²Ø±Ø¯ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§ÛŒØ²
   }

   // 6. ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ú†Ø±Ø®Ù‡
   m_isCleanedForThisCycle = true;  // ÙÙ„Ú¯ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡
   m_cleanupTime = 0;  // Ø³Ø§Ø¹Øª Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø±Ø§ ØµÙØ± Ú©Ù† ØªØ§ Ø§ÛŒÙ† ÙØ±Ø¢ÛŒÙ†Ø¯ ØªÚ©Ø±Ø§Ø± Ù†Ø´ÙˆØ¯
   CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù… Ø´Ø¯.", m_rangeIndex);  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª
}

// Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª: Ø¨Ø³ØªÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ú¯Ø± Ø¨Ø§Ø² Ø¨Ø§Ø´Ø¯ Ùˆ Ø³Ù¾Ø³ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù… (Ø¨Ø±Ø§ÛŒ ØªØ¹Ø·ÛŒÙ„Ø§Øª ÛŒØ§ Ø¯ÙØ¹)
// ØªØºÛŒÛŒØ±Ø§Øª 2.10: Ø±ÛŒØ³Øª Ø¯Ø³ØªÛŒ ÙÙ„Ú¯â€ŒÙ‡Ø§ Ù‚Ø¨Ù„ Ø§Ø² SoftCleanup
void CRange::HardCleanup()  // ØªØ§Ø¨Ø¹ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª
{
   CLogger::Log("Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + "...", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª

   if(m_activeTicket != 0)  // Ú†Ú© Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§Ø²
   {
      if(g_tradeManager.ClosePosition(m_activeTicket))  // Ø¨Ø³ØªÙ† Ú©Ø§Ù…Ù„ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ø² Ù…Ø¯ÛŒØ± Ù…Ø¹Ø§Ù…Ù„Ø§Øª
      {
         CLogger::Log("Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§ ØªÛŒÚ©Øª " + (string)m_activeTicket + " Ø¨Ø³ØªÙ‡ Ø´Ø¯ (Ø³Ø®Øª).", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
      }
      // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§Ø² Ù‚Ø¨Ù„ Ø§Ø² SoftCleanup
      m_activeTicket = 0;  // Ø±ÛŒØ³Øª ØªÛŒÚ©Øª Ù¾Ø³ Ø§Ø² Ø¨Ø³ØªÙ†
   }

   SoftCleanup();  // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ù… Ù¾Ø³ Ø§Ø² Ø¨Ø³ØªÙ† Ùˆ Ø±ÛŒØ³Øª Ù…ØªØºÛŒØ±Ù‡Ø§
   CLogger::Log("Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª Ø´Ø¯.", m_rangeIndex);  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª
}

// Ú†Ú© Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ: Ú†Ú© Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§ Ùˆ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø­Ø§Ù„Øª (Ø¨Ø§ Ù…Ø¹Ø§Ù…Ù„Ù‡: ÙÙ‚Ø· Ù…Ø³ÛŒØ±Ù‡Ø§ØŒ Ø¨Ø¯ÙˆÙ†: Ù†Ø±Ù…)
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¯Ø± OnTick ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
void CRange::CheckCleanup()  // ØªØ§Ø¨Ø¹ Ú†Ú© Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
{
   // Ø§Ú¯Ø± Ø²Ù…Ø§Ù† Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø±Ø³ÛŒØ¯Ù‡ ÛŒØ§ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ØŒ Ø®Ø§Ø±Ø¬ Ø´Ùˆ
   if(m_cleanupTime == 0 || TimeCurrent() < m_cleanupTime || m_isCleanedForThisCycle) return;  // Ú†Ú© Ø²Ù…Ø§Ù† Ùˆ ÙÙ„Ú¯

   CLogger::Log("Ø²Ù…Ø§Ù† Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙØ±Ø§ Ø±Ø³ÛŒØ¯...", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
   m_currentState = RANGE_EXPIRED;  // ØªØºÛŒÛŒØ± Ø¨Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
}

// Ø±ÛŒØ³Øª Ú©Ø´â€ŒÙ‡Ø§: ØµÙØ± Ú©Ø±Ø¯Ù† Ú©Ø´ ATRÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ Ø¬Ø¯ÛŒØ¯ (Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù‡Ù†Ù‡)
// Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ú©Ø´â€ŒÙ‡Ø§ Ø±Ø§ ØµÙØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
void CRange::ResetCaches()  // ØªØ§Ø¨Ø¹ Ø±ÛŒØ³Øª Ú©Ø´
{
   m_cachedATR = 0;  // Ø±ÛŒØ³Øª Ú©Ø´ ATR Ø§ÙØ³Øª
   m_cachedSlATR = 0;  // Ø±ÛŒØ³Øª Ú©Ø´ ATR SL
   m_cachedTrailingATR = 0;  // Ø±ÛŒØ³Øª Ú©Ø´ ATR ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   CLogger::Log("Ú©Ø´â€ŒÙ‡Ø§ÛŒ ATR Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + " Ø±ÛŒØ³Øª Ø´Ø¯Ù†Ø¯.", m_rangeIndex);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
}

// Ú¯Ø±ÙØªÙ† ATR Ú©Ø´â€ŒØ´Ø¯Ù‡ Ø§ØµÙ„ÛŒ: Ø§Ú¯Ø± Ú©Ø´ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ø§Ø² Ù‡Ù†Ø¯Ù„ Ú©Ù¾ÛŒ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯)
// CopyBuffer Ø¨Ø§ÙØ± Ø±Ø§ Ú©Ù¾ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
double CRange::GetCachedATR()  // ØªØ§Ø¨Ø¹ Ú¯Ø±ÙØªÙ† ATR
{
   if(m_cachedATR <= 0)  // Ú†Ú© Ú©Ø´ Ø®Ø§Ù„ÛŒ
   {
      double atr[];  // Ø¢Ø±Ø§ÛŒÙ‡ ATR (Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø¨Ø¯ÙˆÙ† Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø«Ø§Ø¨Øª)
      ArraySetAsSeries(atr, true);  // ØªÙ†Ø¸ÛŒÙ… Ø³Ø±ÛŒ
      if(CopyBuffer(m_atrHandle, 0, 1, 1, atr) <= 0)  // Ú©Ù¾ÛŒ Ø¨Ø§ÙØ±
      {
         CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ú¯Ø±ÙØªÙ† ATR Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return 0;  // Ø¨Ø§Ø²Ú¯Ø´Øª ØµÙØ±
      }
      m_cachedATR = atr[0];  // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú©Ø´
   }
   return m_cachedATR;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ú©Ø´
}

// Ú¯Ø±ÙØªÙ† ATR Ú©Ø´â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ SL: Ù…Ø´Ø§Ø¨Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª SL (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯)
double CRange::GetSlATR()  // ØªØ§Ø¨Ø¹ Ú¯Ø±ÙØªÙ† SL ATR
{
   if(m_cachedSlATR <= 0)  // Ú†Ú© Ú©Ø´ Ø®Ø§Ù„ÛŒ
   {
      double atr[];  // Ø¢Ø±Ø§ÛŒÙ‡ ATR (Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø¨Ø¯ÙˆÙ† Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø«Ø§Ø¨Øª)
      ArraySetAsSeries(atr, true);  // ØªÙ†Ø¸ÛŒÙ… Ø³Ø±ÛŒ
      if(CopyBuffer(m_slAtrHandle, 0, 1, 1, atr) <= 0)  // Ú©Ù¾ÛŒ Ø¨Ø§ÙØ±
      {
         CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ú¯Ø±ÙØªÙ† ATR Ø¨Ø±Ø§ÛŒ SL Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return 0;  // Ø¨Ø§Ø²Ú¯Ø´Øª ØµÙØ±
      }
      m_cachedSlATR = atr[0];  // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú©Ø´
   }
   return m_cachedSlATR;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ú©Ø´
}

// Ú¯Ø±ÙØªÙ† ATR Ú©Ø´â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯: Ù…Ø´Ø§Ø¨Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯ØŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÙˆÛŒØ§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ø´ÙˆØ¯)
double CRange::GetTrailingATR()  // ØªØ§Ø¨Ø¹ Ú¯Ø±ÙØªÙ† ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ ATR
{
   if(m_cachedTrailingATR <= 0)  // Ú†Ú© Ú©Ø´ Ø®Ø§Ù„ÛŒ
   {
      double atr[];  // Ø¢Ø±Ø§ÛŒÙ‡ ATR (Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø¨Ø¯ÙˆÙ† Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø«Ø§Ø¨Øª)
      ArraySetAsSeries(atr, true);  // ØªÙ†Ø¸ÛŒÙ… Ø³Ø±ÛŒ
      if(CopyBuffer(m_trailingAtrHandle, 0, 1, 1, atr) <= 0)  // Ú©Ù¾ÛŒ Ø¨Ø§ÙØ±
      {
         CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ú¯Ø±ÙØªÙ† ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø±Ù†Ø¬ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return 0;  // Ø¨Ø§Ø²Ú¯Ø´Øª ØµÙØ±
      }
      m_cachedTrailingATR = atr[0];  // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú©Ø´
   }
   return m_cachedTrailingATR;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ú©Ø´
}

#endif // Ù¾Ø§ÛŒØ§Ù† Ú†Ú© include
```

```mql5
//+------------------------------------------------------------------+
//|                                                     TradeManager.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ú©Ù„Ø§Ø³ CTradeManager Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª: Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø¨Ø®Ø´ÛŒ Ø§Ø² Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¯Ø± Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø´Ú©Ø³Øª Ø±Ù†Ø¬ Ø§Ø³ØªØŒ 
// Ø¬Ø§ÛŒÛŒ Ú©Ù‡ Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø² Ø´Ø¯Ù† Ù…Ø¹Ø§Ù…Ù„Ù‡ØŒ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ (Ù‡Ù†Ú¯Ø§Ù… Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ RR)ØŒ Ø§Ù†ØªÙ‚Ø§Ù„ SL Ø¨Ù‡ ÙˆØ±ÙˆØ¯ (Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ Ø³Ø±Ù…Ø§ÛŒÙ‡)ØŒ 
// ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ (Ø¨Ø±Ø§ÛŒ Ù‚ÙÙ„ Ø³ÙˆØ¯) Ùˆ Ø¨Ø³ØªÙ† Ú©Ø§Ù…Ù„ (Ø¯Ø± Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø®Øª) Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯. 
// Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÛŒØ³Ú© Ø±Ø§ Ú©Ù†ØªØ±Ù„ Ùˆ Ø³ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ø­Ø¯Ø§Ú©Ø«Ø± Ù…ÛŒâ€ŒØ±Ø³Ø§Ù†Ø¯.
// Ù…Ù†Ø·Ù‚ ÙØ§ÛŒÙ„ TradeManager.mqh: Ú©Ù„Ø§Ø³ Ø´Ø§Ù…Ù„ Ù…ØªØ¯Ù‡Ø§ÛŒ Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ø¬Ø²Ø¦ÛŒ (PartialClose Ø¨Ø§ Ú†Ú© Ø­Ø¬Ù… Ù…Ø¬Ø§Ø²)ØŒ 
// Ø§Ù†ØªÙ‚Ø§Ù„ SL Ø¨Ù‡ Ø¨Ø±ÛŒÚ©â€ŒØ§ÙˆÙ† (MoveSLToBreakEven Ø¨Ø§ Ù†Ø±Ù…Ø§Ù„Ø§ÛŒØ² Ù‚ÛŒÙ…Øª)ØŒ 
// ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾ (TrailingStop Ø¨Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡ ATR ÛŒØ§ Senkou Span B Ùˆ Ú†Ú© Ø­Ø¯Ø§Ù‚Ù„ ØªØºÛŒÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ‡ÙˆØ¯Ù‡)ØŒ 
// Ùˆ Ø¨Ø³ØªÙ† Ú©Ø§Ù…Ù„ (ClosePosition). 
// ØªÙ…Ø§Ù… Ù…ØªØ¯Ù‡Ø§ PositionSelectByTicket Ø±Ø§ Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯ Ùˆ Ø§Ø² CTrade Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯. 
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ ØªÙˆØ³Ø· CRange Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¯Ø± ManageActiveTrade ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù‡ÛŒÚ† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ø®Ø§Ø±Ø¬ÛŒ Ù†Ø¯Ø§Ø±Ø¯ Ø¬Ø² Trade.mqh. 
// ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯: Ø§Ø¶Ø§ÙÙ‡ Ù…Ù†Ø·Ù‚ TRAILING_ICHIMOKU_B Ø¯Ø± TrailingStop Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² GetSenkouSpanB Ùˆ Ø¨Ø§ÙØ± Ø«Ø§Ø¨Øª (10 * _Point). 
// Ù‡Ù…Ú†Ù†ÛŒÙ† ØªØºÛŒÛŒØ± PartialClose Ø¨Ù‡ Ø±ÙˆØ´ Ø¨Ø³ØªÙ† Ù…Ø®Ø§Ù„Ù Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ Ø¨Ø±ÙˆÚ©Ø±Ù‡Ø§.
// ØªØºÛŒÛŒØ±Ø§Øª Ù†Ø³Ø®Ù‡ 2.10: Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Print Ø¨Ø§ CLogger::LogØŒ Ú©Ø§Ù…Ù†Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ù‚ÛŒÙ‚ Ù‡Ø± Ø®Ø·ØŒ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¯Ø± Ù…Ù†Ø·Ù‚. Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø²ÛŒØ±Ø§ Ø¨Ù„ÙˆÙ¾Ø±ÛŒÙ†Øª ØªØºÛŒÛŒØ±ÛŒ Ù…Ø´Ø®Øµ Ù†Ú©Ø±Ø¯Ù‡.

#ifndef TRADE_MANAGER_MQH  // Ú†Ú© ÙˆØ¬ÙˆØ¯
#define TRADE_MANAGER_MQH  // ØªØ¹Ø±ÛŒÙ Ù…Ø§Ú©Ø±Ùˆ

#include <Trade\Trade.mqh>  // Ú©Ù„Ø§Ø³ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª

// Ú©Ù„Ø§Ø³ CTradeManager Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ø§Ø³ØªØ§ØªÛŒÚ© (Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù†Ù…ÙˆÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ)
// ØªÙ…Ø§Ù… Ù…ØªØ¯Ù‡Ø§ Ø§Ø³ØªØ§ØªÛŒÚ© Ù‡Ø³ØªÙ†Ø¯ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ
class CTradeManager  // Ú©Ù„Ø§Ø³ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡
{
public:
   // Ø¨Ø³ØªÙ† Ø¬Ø²Ø¦ÛŒ Ù¾ÙˆØ²ÛŒØ´Ù†: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø¨Ø³ØªÙ† Ø­Ø¬Ù… Ù…Ø´Ø®Øµ Ø¨Ø§ Ú†Ú© Ø§Ø¶Ø§ÙÛŒ Magic Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª
   // Ø§ÛŒÙ† Ù…ØªØ¯ Ø¨Ø§ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù…Ø®Ø§Ù„Ù Ø¬Ø²Ø¦ÛŒ Ù…ÛŒâ€ŒØ¨Ù†Ø¯Ø¯
   static bool PartialClose(ulong ticket, double volume)  // Ø¨Ø³ØªÙ† Ø¬Ø²Ø¦ÛŒ Ø¨Ø§ ØªÛŒÚ©Øª Ùˆ Ø­Ø¬Ù…
   {
      if(!PositionSelectByTicket(ticket))  // Ú†Ú© Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÙˆØ²ÛŒØ´Ù†
      {
         CLogger::Log("Ø®Ø·Ø§: Ù¾ÙˆØ²ÛŒØ´Ù† Ø¨Ø§ ØªÛŒÚ©Øª " + (string)ticket + " Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ø¬Ø²Ø¦ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
      }

      // Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø² Ù¾ÙˆØ²ÛŒØ´Ù† Ø§ØµÙ„ÛŒ
      ENUM_POSITION_TYPE posType = (ENUM_POSITION_TYPE)PositionGetInteger(POSITION_TYPE);  // Ù†ÙˆØ¹ Ù¾ÙˆØ²ÛŒØ´Ù†
      string symbolName = PositionGetString(POSITION_SYMBOL);  // Ù†Ù…Ø§Ø¯

      // Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ø±Ø¯Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯ (Ù…Ø®Ø§Ù„Ù Ù¾ÙˆØ²ÛŒØ´Ù† Ø§ØµÙ„ÛŒ)
      CTrade trade;  // Ù†Ù…ÙˆÙ†Ù‡ Ú©Ù„Ø§Ø³ Ù…Ø¹Ø§Ù…Ù„Ù‡
      MqlTradeRequest request;  // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¹Ø§Ù…Ù„Ù‡
      MqlTradeResult result;  // Ù†ØªÛŒØ¬Ù‡ Ù…Ø¹Ø§Ù…Ù„Ù‡
      ZeroMemory(request);  // ØµÙØ± Ú©Ø±Ø¯Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª
      ZeroMemory(result);  // ØµÙØ± Ú©Ø±Ø¯Ù† Ù†ØªÛŒØ¬Ù‡

      request.action   = TRADE_ACTION_DEAL;              // Ù†ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª: Ù…Ø¹Ø§Ù…Ù„Ù‡
      request.symbol   = symbolName;                     // Ù†Ù…Ø§Ø¯ Ù…Ø¹Ø§Ù…Ù„Ù‡
      request.volume   = volume;                         // Ø­Ø¬Ù…ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒÙ… Ø¨Ø¨Ù†Ø¯ÛŒÙ…
      request.deviation = 10;                            // Ø§Ù†Ø­Ø±Ø§Ù Ù…Ø¬Ø§Ø² Ù‚ÛŒÙ…Øª
      request.magic    = (long)PositionGetInteger(POSITION_MAGIC); // Ù…Ø¬ÛŒÚ© Ù†Ø§Ù…Ø¨Ø± Ø¨Ø§ÛŒØ¯ ÛŒÚ©ÛŒ Ø¨Ø§Ø´Ù‡

      // Ù„ÛŒÙ†Ú© Ú©Ø±Ø¯Ù† Ø§ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ù¾ÙˆØ²ÛŒØ´Ù† Ø¨Ø§Ø² Ù…ÙˆØ¬ÙˆØ¯
      request.position = ticket; // Ù„ÛŒÙ†Ú© Ø¨Ù‡ Ù¾ÙˆØ²ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ø¬Ø²Ø¦ÛŒ

      // ØªØ¹ÛŒÛŒÙ† Ù†ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù…Ø®Ø§Ù„Ù
      if(posType == POSITION_TYPE_BUY)  // Ø§Ú¯Ø± Ù¾ÙˆØ²ÛŒØ´Ù† Ø®Ø±ÛŒØ¯ØŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ø¬Ø²Ø¦ÛŒ ÙØ±ÙˆØ´ Ù…ÛŒâ€ŒØ²Ù†ÛŒÙ…
      {
         request.price = SymbolInfoDouble(symbolName, SYMBOL_BID);  // Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ø®Ø±ÛŒØ¯ØŒ Ø¨Ø§ Ù‚ÛŒÙ…Øª BID Ù…ÛŒâ€ŒÙØ±ÙˆØ´ÛŒÙ…
         request.type = ORDER_TYPE_SELL;  // Ù†ÙˆØ¹ ÙØ±ÙˆØ´
      }
      else  // Ø§Ú¯Ø± Ù¾ÙˆØ²ÛŒØ´Ù† ÙØ±ÙˆØ´ØŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ø¬Ø²Ø¦ÛŒ Ø®Ø±ÛŒØ¯ Ù…ÛŒâ€ŒØ²Ù†ÛŒÙ…
      {
         request.price = SymbolInfoDouble(symbolName, SYMBOL_ASK);  // Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† ÙØ±ÙˆØ´ØŒ Ø¨Ø§ Ù‚ÛŒÙ…Øª ASK Ù…ÛŒâ€ŒØ®Ø±ÛŒÙ…
         request.type = ORDER_TYPE_BUY;  // Ù†ÙˆØ¹ Ø®Ø±ÛŒØ¯
      }

      // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ù†ØªÛŒØ¬Ù‡
      if(trade.OrderSend(request, result))  // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù…Ø®Ø§Ù„Ù
      {
         if(result.retcode == TRADE_RETCODE_DONE || result.retcode == TRADE_RETCODE_PLACED)  // Ú†Ú© Ù…ÙˆÙÙ‚ÛŒØª
         {
            if(InpDebugMode) CLogger::Log("Ø¨Ø®Ø´ÛŒ Ø§Ø² Ù¾ÙˆØ²ÛŒØ´Ù† Ø¨Ø§ ØªÛŒÚ©Øª " + (string)ticket + " (Ø­Ø¬Ù… " + DoubleToString(volume, 2) + ") Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø³ØªÙ‡ Ø´Ø¯.");  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª
            return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ÛŒØª
         }
      }

      CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø³ØªÙ† Ø¨Ø®Ø´ÛŒ Ø§Ø² Ù¾ÙˆØ²ÛŒØ´Ù† Ø¨Ø§ ØªÛŒÚ©Øª " + (string)ticket + ": " + IntegerToString(result.retcode) + " - " + result.comment);  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
   }

   // Ø§Ù†ØªÙ‚Ø§Ù„ SL Ø¨Ù‡ Ø¨Ø±ÛŒÚ©â€ŒØ§ÙˆÙ†: Ù†Ø±Ù…Ø§Ù„Ø§ÛŒØ² Ù‚ÛŒÙ…Øª Ùˆ ØªØºÛŒÛŒØ± SL Ø¨Ù‡ Ù†Ù‚Ø·Ù‡ ÙˆØ±ÙˆØ¯
   // NormalizeDouble Ù‚ÛŒÙ…Øª Ø±Ø§ Ù†Ø±Ù…Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   static bool MoveSLToBreakEven(ulong ticket, double breakEvenPrice)  // Ø§Ù†ØªÙ‚Ø§Ù„ SL Ø¨Ù‡ ÙˆØ±ÙˆØ¯
   {
      if(!PositionSelectByTicket(ticket))  // Ú†Ú© Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÙˆØ²ÛŒØ´Ù†
      {
         CLogger::Log("Ø®Ø·Ø§: Ù¾ÙˆØ²ÛŒØ´Ù† Ø¨Ø§ ØªÛŒÚ©Øª " + (string)ticket + " ÛŒØ§ÙØª Ù†Ø´Ø¯.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
      }

      CTrade trade;  // Ù†Ù…ÙˆÙ†Ù‡ Ú©Ù„Ø§Ø³ Ù…Ø¹Ø§Ù…Ù„Ù‡
      breakEvenPrice = NormalizeDouble(breakEvenPrice, _Digits);  // Ù†Ø±Ù…Ø§Ù„Ø§ÛŒØ² Ù‚ÛŒÙ…Øª
      if(trade.PositionModify(ticket, breakEvenPrice, PositionGetDouble(POSITION_TP)))  // ØªØºÛŒÛŒØ± SL
      {
         CLogger::Log("Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ù¾ÙˆØ²ÛŒØ´Ù† " + (string)ticket + " Ø¨Ù‡ Ù†Ù‚Ø·Ù‡ ÙˆØ±ÙˆØ¯ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯.");  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª
         return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ÛŒØª
      }
      else  // Ø´Ø±Ø· Ø´Ú©Ø³Øª
      {
         CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ Ù¾ÙˆØ²ÛŒØ´Ù† " + (string)ticket + ": " + IntegerToString(trade.ResultRetcode()));  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
      }
   }

   // Ø§Ø¹Ù…Ø§Ù„ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾: Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡ Ø¬Ø¯ÛŒØ¯ØŒ Ú†Ú© Ø­Ø¯Ø§Ù‚Ù„ ØªØºÛŒÛŒØ± Ùˆ ØªØºÛŒÛŒØ± SL (Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾ÙˆÛŒØ§ ATR ÛŒØ§ Senkou Span B Ù‡Ø± Ø¨Ø§Ø±)
   // Ø§ÛŒÙ† Ù…ØªØ¯ Ù¾ÙˆÛŒØ§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   static bool TrailingStop(ulong ticket, ENUM_TRAILING_MODE mode, int atrPeriod, double atrMultiplier, ENUM_TIMEFRAMES timeframe, int atrHandle, ENUM_TIMEFRAMES trendTf)  // ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø¨Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ Ùˆ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ±
   {
      if(!PositionSelectByTicket(ticket))  // Ú†Ú© Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÙˆØ²ÛŒØ´Ù†
      {
         CLogger::Log("Ø®Ø·Ø§: Ù¾ÙˆØ²ÛŒØ´Ù† Ø¨Ø§ ØªÛŒÚ©Øª " + (string)ticket + " ÛŒØ§ÙØª Ù†Ø´Ø¯.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
      }

      double sl = PositionGetDouble(POSITION_SL);  // SL ÙØ¹Ù„ÛŒ
      if(sl == 0)  // Ú†Ú© SL ØµÙØ±
      {
         CLogger::Log("Ù‡Ø´Ø¯Ø§Ø±: SL Ø§ÙˆÙ„ÛŒÙ‡ ØµÙØ± Ø§Ø³Øª Ø¨Ø±Ø§ÛŒ Ù¾ÙˆØ²ÛŒØ´Ù† " + (string)ticket + ". ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ skip Ø´Ø¯.");  // Ú†Ø§Ù¾ Ù‡Ø´Ø¯Ø§Ø±
         return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
      }

      ENUM_POSITION_TYPE posType = (ENUM_POSITION_TYPE)PositionGetInteger(POSITION_TYPE);  // Ù†ÙˆØ¹ Ù¾ÙˆØ²ÛŒØ´Ù†
      double currentPrice = posType == POSITION_TYPE_BUY ? SymbolInfoDouble(_Symbol, SYMBOL_BID) : SymbolInfoDouble(_Symbol, SYMBOL_ASK);  // Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ

      double trailingDistance;  // ÙØ§ØµÙ„Ù‡ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
      if(mode == TRAILING_ATR)  // Ú†Ú© Ø­Ø§Ù„Øª ATR
      {
         double atr[];  // Ø¢Ø±Ø§ÛŒÙ‡ ATR (Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø¨Ø¯ÙˆÙ† Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø«Ø§Ø¨Øª)
         ArraySetAsSeries(atr, true);  // ØªÙ†Ø¸ÛŒÙ… Ø³Ø±ÛŒ
         if(CopyBuffer(atrHandle, 0, 1, 1, atr) <= 0)  // Ú©Ù¾ÛŒ Ø¨Ø§ÙØ±
         {
            CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ú¯Ø±ÙØªÙ† ATR Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯: " + IntegerToString(GetLastError()));  // Ú†Ø§Ù¾ Ø®Ø·Ø§
            return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
         }
         trailingDistance = atr[0] * atrMultiplier;  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾ÙˆÛŒØ§ Ù‡Ø± Ø¨Ø§Ø± Ø¨Ø¯ÙˆÙ† Ú©Ø´
      }
      else if(mode == TRAILING_ICHIMOKU_B)  // Ø­Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯: TRIALING Ø¨Ø± Ø§Ø³Ø§Ø³ Senkou Span B
      {
         double senkouB = g_trendFilter.GetSenkouSpanB(trendTf);  // Ú¯Ø±ÙØªÙ† Senkou Span B Ø§Ø² ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯
         if(senkouB == 0)  // Ú†Ú© Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø±
         {
            CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ú¯Ø±ÙØªÙ† Senkou Span B Ø¨Ø±Ø§ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§
            return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
         }
         double buffer = 10 * _Point;  // Ø¨Ø§ÙØ± Ø«Ø§Ø¨Øª (10 Ù¾ÙˆÛŒÙ†Øª) Ø¨Ø±Ø§ÛŒ ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø®Ø·
         trailingDistance = buffer;  // ÙØ§ØµÙ„Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨Ø§ÙØ± (Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… SL Ù†Ø³Ø¨Øª Ø¨Ù‡ Senkou B)
         // Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯: SL Ú©Ù…ÛŒ Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ± Ø§Ø² Senkou B
         // Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´: SL Ú©Ù…ÛŒ Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Senkou B
      }
      else  // Ø­Ø§Ù„Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± (Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ…Ù†ÛŒ)
      {
         return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
      }

      double newSL;  // SL Ø¬Ø¯ÛŒØ¯
      if(posType == POSITION_TYPE_BUY)  // Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯
      {
         if(mode == TRAILING_ICHIMOKU_B)  // Ø­Ø§Ù„Øª Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ
         {
            newSL = NormalizeDouble(g_trendFilter.GetSenkouSpanB(trendTf) - trailingDistance, _Digits);  // SL Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ± Ø§Ø² Senkou B
         }
         else  // ATR
         {
            newSL = NormalizeDouble(currentPrice - trailingDistance, _Digits);  // Ù…Ø­Ø§Ø³Ø¨Ù‡ SL Ø¬Ø¯ÛŒØ¯
         }
         if(newSL > sl)  // Ú†Ú© Ø¨Ù‡Ø¨ÙˆØ¯ SL (Ø¨Ø§Ù„Ø§ØªØ± Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯)
         {
            // Ú†Ú© Ø­Ø¯Ø§Ù‚Ù„ ØªØºÛŒÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ‡ÙˆØ¯Ù‡ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
            if(MathAbs(newSL - sl) < _Point * 5) return true;  // Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø§Ú¯Ø± Ú©Ù…
            CTrade trade;  // Ù†Ù…ÙˆÙ†Ù‡ Ù…Ø¹Ø§Ù…Ù„Ù‡
            if(trade.PositionModify(ticket, newSL, PositionGetDouble(POSITION_TP)))  // ØªØºÛŒÛŒØ± SL
            {
               CLogger::Log("ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾ Ø¨Ø±Ø§ÛŒ Ù¾ÙˆØ²ÛŒØ´Ù† " + (string)ticket + " Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯. SL Ø¬Ø¯ÛŒØ¯=" + DoubleToString(newSL, _Digits));  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª
               return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ÛŒØª
            }
            else  // Ø´Ø±Ø· Ø´Ú©Ø³Øª
            {
               CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾: " + IntegerToString(trade.ResultRetcode()));  // Ú†Ø§Ù¾ Ø®Ø·Ø§
               return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
            }
         }
      }
      else  // Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´
      {
         if(mode == TRAILING_ICHIMOKU_B)  // Ø­Ø§Ù„Øª Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ
         {
            newSL = NormalizeDouble(g_trendFilter.GetSenkouSpanB(trendTf) + trailingDistance, _Digits);  // SL Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Senkou B
         }
         else  // ATR
         {
            newSL = NormalizeDouble(currentPrice + trailingDistance, _Digits);  // Ù…Ø­Ø§Ø³Ø¨Ù‡ SL Ø¬Ø¯ÛŒØ¯
         }
         if(newSL < sl)  // Ú†Ú© Ø¨Ù‡Ø¨ÙˆØ¯ SL (Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ± Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´)
         {
            // Ú†Ú© Ø­Ø¯Ø§Ù‚Ù„ ØªØºÛŒÛŒØ± Ù…Ø´Ø§Ø¨Ù‡
            if(MathAbs(newSL - sl) < _Point * 5) return true;  // Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø§Ú¯Ø± Ú©Ù…
            CTrade trade;  // Ù†Ù…ÙˆÙ†Ù‡ Ù…Ø¹Ø§Ù…Ù„Ù‡
            if(trade.PositionModify(ticket, newSL, PositionGetDouble(POSITION_TP)))  // ØªØºÛŒÛŒØ± SL
            {
               CLogger::Log("ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾ Ø¨Ø±Ø§ÛŒ Ù¾ÙˆØ²ÛŒØ´Ù† " + (string)ticket + " Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯. SL Ø¬Ø¯ÛŒØ¯=" + DoubleToString(newSL, _Digits));  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª
               return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ÛŒØª
            }
            else  // Ø´Ø±Ø· Ø´Ú©Ø³Øª
            {
               CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯ Ø§Ø³ØªØ§Ù¾: " + IntegerToString(trade.ResultRetcode()));  // Ú†Ø§Ù¾ Ø®Ø·Ø§
               return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
            }
         }
      }
      return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ÛŒØª Ù¾ÛŒØ´â€ŒÙØ±Ø¶
   }

   // Ø¨Ø³ØªÙ† Ú©Ø§Ù…Ù„ Ù¾ÙˆØ²ÛŒØ´Ù†: Ø§Ù†ØªØ®Ø§Ø¨ Ùˆ Ø¨Ø³ØªÙ† Ø¨Ø§ Ú†Ú© Ù†ØªÛŒØ¬Ù‡
   // PositionClose Ù¾ÙˆØ²ÛŒØ´Ù† Ø±Ø§ Ù…ÛŒâ€ŒØ¨Ù†Ø¯Ø¯
   static bool ClosePosition(ulong ticket)  // Ø¨Ø³ØªÙ† Ú©Ø§Ù…Ù„ Ø¨Ø§ ØªÛŒÚ©Øª
   {
      if(!PositionSelectByTicket(ticket))  // Ú†Ú© Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÙˆØ²ÛŒØ´Ù†
      {
         CLogger::Log("Ø®Ø·Ø§: Ù¾ÙˆØ²ÛŒØ´Ù† Ø¨Ø§ ØªÛŒÚ©Øª " + (string)ticket + " ÛŒØ§ÙØª Ù†Ø´Ø¯.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
      }

      CTrade trade;  // Ù†Ù…ÙˆÙ†Ù‡ Ù…Ø¹Ø§Ù…Ù„Ù‡
      if(trade.PositionClose(ticket))  // Ø¨Ø³ØªÙ† Ú©Ø§Ù…Ù„
      {
         CLogger::Log("Ù¾ÙˆØ²ÛŒØ´Ù† Ø¨Ø§ ØªÛŒÚ©Øª " + (string)ticket + " Ø¨Ø³ØªÙ‡ Ø´Ø¯.");  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª
         return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ÛŒØª
      }
      else  // Ø´Ø±Ø· Ø´Ú©Ø³Øª
      {
         CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø³ØªÙ† Ù¾ÙˆØ²ÛŒØ´Ù† Ø¨Ø§ ØªÛŒÚ©Øª " + (string)ticket + ": " + IntegerToString(trade.ResultRetcode()));  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
      }
   }
};

#endif  // Ù¾Ø§ÛŒØ§Ù†
```

```mql5
//+------------------------------------------------------------------+
//|                                             CActiveTradeManager.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ú©Ù„Ø§Ø³ CActiveTradeManager Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø² Ø±Ø§ Ø¨Ø± Ø¹Ù‡Ø¯Ù‡ Ø¯Ø§Ø±Ø¯.
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ: Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø² Ø±Ø§ Ø§Ø² CRange Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ù¾Ù„Ù‡â€ŒØ§ÛŒØŒ Ø±ÛŒØ³Ú©-ÙØ±ÛŒØŒ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯).
// Ù…Ù†Ø·Ù‚ ÙØ§ÛŒÙ„: Ø¢Ø±Ø§ÛŒÙ‡ ManagedTrade Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ØŒ Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ (TRADE_PARTIAL_CLOSE, TRADE_RISK_FREE, TRADE_TRAILING).
// RegisterTrade Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ ManageAllTrades ØªÙ…Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
// ClosePosition Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ú©Ø§Ù…Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
// ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯: Ú©Ù„Ø§Ø³ Ø¬Ø¯ÛŒØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨Ù„ÙˆÙ¾Ø±ÛŒÙ†ØªØŒ Ø¨Ø§ Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡.

#ifndef ACTIVE_TRADE_MANAGER_MQH
#define ACTIVE_TRADE_MANAGER_MQH

#include "TradeManager.mqh"  // Ø¨Ø±Ø§ÛŒ PartialClose, MoveSLToBreakEven, TrailingStop
#include "Logger.mqh"  // Ø¨Ø±Ø§ÛŒ Ù„Ø§Ú¯

// enum Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ (Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø¯Ø§Ø®Ù„ÛŒ)
enum ENUM_TRADE_MANAGEMENT_STATE
{
   TRADE_PARTIAL_CLOSE,   // Ù…Ø±Ø­Ù„Ù‡ Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
   TRADE_RISK_FREE,       // Ù…Ø±Ø­Ù„Ù‡ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ
   TRADE_TRAILING         // Ù…Ø±Ø­Ù„Ù‡ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
};

// Ø³Ø§Ø®ØªØ§Ø± Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù…Ø¯ÛŒØ±ÛŒØªâ€ŒØ´Ø¯Ù‡
struct ManagedTrade
{
   ulong ticket;  // ØªÛŒÚ©Øª Ù…Ø¹Ø§Ù…Ù„Ù‡
   long magicNumber;  // Ù…Ø¬ÛŒÚ© Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§ÛŒØ²
   int rangeIndex;  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø±Ù†Ø¬ (1-4)
   double initialSlDistance;  // ÙØ§ØµÙ„Ù‡ SL Ø§ÙˆÙ„ÛŒÙ‡
   double entryPrice;  // Ù‚ÛŒÙ…Øª ÙˆØ±ÙˆØ¯
   bool isPartialClosed;  // ÙÙ„Ú¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
   bool isRiskFree;  // ÙÙ„Ú¯ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ
   double rrRatio;  // Ù†Ø³Ø¨Øª RR
   double partialClosePercent;  // Ø¯Ø±ØµØ¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
   ENUM_TRAILING_MODE trailingMode;  // Ø­Ø§Ù„Øª ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   int trailingAtrPeriod;  // Ø¯ÙˆØ±Ù‡ ATR ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   double trailingAtrMultiplier;  // Ø¶Ø±ÛŒØ¨ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   ENUM_TIMEFRAMES timeframe;  // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…
   int atrHandle;  // Ù‡Ù†Ø¯Ù„ ATR
   ENUM_TIMEFRAMES trendTf;  // ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ±
   ENUM_TRADE_MANAGEMENT_STATE currentState;  // Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª
};

// Ú©Ù„Ø§Ø³ CActiveTradeManager Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø²
class CActiveTradeManager
{
private:
   ManagedTrade m_managedTrades[];  // Ø¢Ø±Ø§ÛŒÙ‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ø¯ÛŒØ±ÛŒØªâ€ŒØ´Ø¯Ù‡

public:
   CActiveTradeManager() {}  // Ø³Ø§Ø²Ù†Ø¯Ù‡

   // Ø«Ø¨Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯: Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ Ø¢Ø±Ø§ÛŒÙ‡ Ùˆ ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡
   void RegisterTrade(ulong ticket, long magicNumber, int rangeIndex, double initialSlDistance, double entryPrice, double rrRatio, double partialClosePercent,
                      ENUM_TRAILING_MODE trailingMode, int trailingAtrPeriod, double trailingAtrMultiplier, ENUM_TIMEFRAMES timeframe, int atrHandle, ENUM_TIMEFRAMES trendTf)
   {
      int size = ArraySize(m_managedTrades);  // Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙØ¹Ù„ÛŒ Ø¢Ø±Ø§ÛŒÙ‡
      ArrayResize(m_managedTrades, size + 1);  // Ø§ÙØ²Ø§ÛŒØ´ Ø§Ù†Ø¯Ø§Ø²Ù‡
      ManagedTrade &trade = m_managedTrades[size];  // Ù…Ø±Ø¬Ø¹ Ø¨Ù‡ Ø¢Ø®Ø±ÛŒÙ†
      trade.ticket = ticket;  // ØªÙ†Ø¸ÛŒÙ… ØªÛŒÚ©Øª
      trade.magicNumber = magicNumber;  // ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬ÛŒÚ©
      trade.rangeIndex = rangeIndex;  // ØªÙ†Ø¸ÛŒÙ… Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø±Ù†Ø¬
      trade.initialSlDistance = initialSlDistance;  // ØªÙ†Ø¸ÛŒÙ… ÙØ§ØµÙ„Ù‡ SL
      trade.entryPrice = entryPrice;  // ØªÙ†Ø¸ÛŒÙ… Ù‚ÛŒÙ…Øª ÙˆØ±ÙˆØ¯
      trade.isPartialClosed = false;  // Ø±ÛŒØ³Øª ÙÙ„Ú¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
      trade.isRiskFree = false;  // Ø±ÛŒØ³Øª ÙÙ„Ú¯ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ
      trade.rrRatio = rrRatio;  // ØªÙ†Ø¸ÛŒÙ… RR
      trade.partialClosePercent = partialClosePercent;  // ØªÙ†Ø¸ÛŒÙ… Ø¯Ø±ØµØ¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
      trade.trailingMode = trailingMode;  // ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
      trade.trailingAtrPeriod = trailingAtrPeriod;  // ØªÙ†Ø¸ÛŒÙ… Ø¯ÙˆØ±Ù‡ ATR
      trade.trailingAtrMultiplier = trailingAtrMultiplier;  // ØªÙ†Ø¸ÛŒÙ… Ø¶Ø±ÛŒØ¨
      trade.timeframe = timeframe;  // ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…
      trade.atrHandle = atrHandle;  // ØªÙ†Ø¸ÛŒÙ… Ù‡Ù†Ø¯Ù„ ATR
      trade.trendTf = trendTf;  // ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… ÙÛŒÙ„ØªØ±
      trade.currentState = TRADE_PARTIAL_CLOSE;  // Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡: Ù¾Ù„Ù‡â€ŒØ§ÛŒ
      CLogger::Log("Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯ Ø«Ø¨Øª Ø´Ø¯. ØªÛŒÚ©Øª: " + (string)ticket + ", Ø±Ù†Ø¬: " + IntegerToString(rangeIndex));  // Ù„Ø§Ú¯ Ø«Ø¨Øª
   }

   // Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª: Ø­Ù„Ù‚Ù‡ Ø±ÙˆÛŒ Ø¢Ø±Ø§ÛŒÙ‡ØŒ Ú†Ú© Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù†ØŒ Ùˆ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø¯Ø§Ø®Ù„ÛŒ
   void ManageAllTrades()
   {
      for(int i = ArraySize(m_managedTrades) - 1; i >= 0; i--)  // Ø­Ù„Ù‚Ù‡ Ø§Ø² Ø§Ù†ØªÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø§ÛŒÙ…Ù†
      {
         ManagedTrade &trade = m_managedTrades[i];  // Ù…Ø±Ø¬Ø¹ Ù…Ø¹Ø§Ù…Ù„Ù‡
         if(!PositionSelectByTicket(trade.ticket))  // Ú†Ú© Ø¨Ø§Ø² Ø¨ÙˆØ¯Ù†
         {
            CLogger::Log("Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§ ØªÛŒÚ©Øª " + (string)trade.ticket + " Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡. Ø­Ø°Ù Ø§Ø² Ù„ÛŒØ³Øª.", trade.rangeIndex);  // Ù„Ø§Ú¯ Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù†
            ArrayRemove(m_managedTrades, i, 1);  // Ø­Ø°Ù Ø§Ø² Ø¢Ø±Ø§ÛŒÙ‡
            g_ranges[trade.rangeIndex - 1].SetCurrentState(RANGE_IDLE);  // Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ø±Ù†Ø¬ Ù…Ø±Ø¨ÙˆØ·Ù‡
            continue;  // Ù¾Ø±Ø´
         }

         // Ù„Ø§Ú¯ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡
         CLogger::Log("------ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ù‡ ØªÛŒÚ©Øª " + (string)trade.ticket + " Ø¯Ø± Ø­Ø§Ù„Øª " + EnumToString(trade.currentState) + " ------", trade.rangeIndex);  // Ø¹Ù†ÙˆØ§Ù† Ø­Ø§Ù„Øª Ù…Ø¯ÛŒØ±ÛŒØª

         switch(trade.currentState)  // Ù…Ø§Ø´ÛŒÙ† Ø­Ø§Ù„Øª Ø¯Ø§Ø®Ù„ÛŒ
         {
            case TRADE_PARTIAL_CLOSE:  // Ù…Ø±Ø­Ù„Ù‡ Ù¾Ù„Ù‡â€ŒØ§ÛŒ
               double currentPrice = PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY ? SymbolInfoDouble(_Symbol, SYMBOL_BID) : SymbolInfoDouble(_Symbol, SYMBOL_ASK);  // Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ
               double currentProfit = (PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY ? (currentPrice - trade.entryPrice) : (trade.entryPrice - currentPrice));  // Ø³ÙˆØ¯ Ù‚ÛŒÙ…Øª
               double targetProfit = trade.initialSlDistance * trade.rrRatio;  // Ù‡Ø¯Ù Ø³ÙˆØ¯
               if(currentProfit >= targetProfit)  // Ú†Ú© Ø±Ø³ÛŒØ¯Ù†
               {
                  double volume = PositionGetDouble(POSITION_VOLUME);  // Ø­Ø¬Ù… ÙØ¹Ù„ÛŒ
                  double closeVolume = MathFloor((volume * trade.partialClosePercent / 100.0) / g_volumeStep) * g_volumeStep;  // Ø­Ø¬Ù… Ù¾Ù„Ù‡â€ŒØ§ÛŒ
                  if(closeVolume >= g_volumeMin && closeVolume < volume)  // Ú†Ú© Ù…Ø¹ØªØ¨Ø±
                  {
                     if(CTradeManager::PartialClose(trade.ticket, closeVolume))  // Ø¨Ø³ØªÙ† Ù¾Ù„Ù‡â€ŒØ§ÛŒ
                     {
                        trade.isPartialClosed = true;  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯
                        trade.currentState = TRADE_RISK_FREE;  // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ
                        CLogger::Log("Ø®Ø±ÙˆØ¬ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ RISK_FREE.", trade.rangeIndex);  // Ù„Ø§Ú¯ Ø§Ù†ØªÙ‚Ø§Ù„
                     }
                  }
               }
               break;
            case TRADE_RISK_FREE:  // Ù…Ø±Ø­Ù„Ù‡ Ø±ÛŒØ³Ú©-ÙØ±ÛŒ
               if(!trade.isRiskFree)  // Ú†Ú© ÙÙ„Ú¯
               {
                  double breakEvenBuffer = _Point * 3;  // Ø¨Ø§ÙØ±
                  double newSL = (PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY) ? trade.entryPrice + breakEvenBuffer : trade.entryPrice - breakEvenBuffer;  // SL Ø¬Ø¯ÛŒØ¯
                  if(CTradeManager::MoveSLToBreakEven(trade.ticket, newSL))  // Ø§Ù†ØªÙ‚Ø§Ù„
                  {
                     trade.isRiskFree = true;  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯
                     trade.currentState = TRADE_TRAILING;  // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
                     CLogger::Log("Ø±ÛŒØ³Ú©-ÙØ±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ TRAILING.", trade.rangeIndex);  // Ù„Ø§Ú¯ Ø§Ù†ØªÙ‚Ø§Ù„
                  }
               }
               break;
            case TRADE_TRAILING:  // Ù…Ø±Ø­Ù„Ù‡ ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
               CTradeManager::TrailingStop(trade.ticket, trade.trailingMode, trade.trailingAtrPeriod, trade.trailingAtrMultiplier, trade.timeframe, trade.atrHandle, trade.trendTf);  // ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
               break;
         }
      }
   }

   // Ø¨Ø³ØªÙ† Ú©Ø§Ù…Ù„ Ù…Ø¹Ø§Ù…Ù„Ù‡: ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø§Ø² HardCleanup
   bool ClosePosition(ulong ticket)
   {
      return CTradeManager::ClosePosition(ticket);  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² TradeManager Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ†
   }

   // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
   void SetPartialClosedFlag(ulong ticket, bool value)
   {
      for(int i = 0; i < ArraySize(m_managedTrades); i++)
      {
         if(m_managedTrades[i].ticket == ticket)
         {
            m_managedTrades[i].isPartialClosed = value;  // ØªÙ†Ø¸ÛŒÙ… ÙÙ„Ú¯
            break;
         }
      }
   }
};

// Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…ØªØºÛŒØ± Ø§Ø³ØªØ§ØªÛŒÚ©
string CLogger::m_lastMessage = "";  // Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ù„Ø§Ú¯

#endif
```

```mql5
//+------------------------------------------------------------------+
//|                                                     RiskManager.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ú©Ù„Ø§Ø³ CRiskManager Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÛŒØ³Ú© Ùˆ Ø­Ø¬Ù… Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª: Ø±ÛŒØ³Ú© Ù‡Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø±ØµØ¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø­Ø³Ø§Ø¨ Ùˆ ÙØ§ØµÙ„Ù‡ SL Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§ Ø²ÛŒØ§Ù† Ù…Ø­Ø¯ÙˆØ¯ Ø´ÙˆØ¯. 
// Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ø­Ø¬Ù… Ø±Ø§ Ø·ÙˆØ±ÛŒ ØªØ¹ÛŒÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø²ÛŒØ§Ù† SL Ø¨Ø±Ø§Ø¨Ø± Ø¯Ø±ØµØ¯ Ø±ÛŒØ³Ú© Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø³ØªÙ‚Ù„ Ø§Ø² Ù†ÙˆØ¹ Ù†Ù…Ø§Ø¯ (ÙØ§Ø±Ú©Ø³ØŒ Ø´Ø§Ø®ØµØŒ JPY).
// Ù…Ù†Ø·Ù‚ ÙØ§ÛŒÙ„ RiskManager.mqh: Ù…ØªØ¯ Ø§Ø³ØªØ§ØªÛŒÚ© CalculateLotSize ÙØ§ØµÙ„Ù‡ SL (Ù‚ÛŒÙ…Øª ÙˆØ§Ù‚Ø¹ÛŒ) Ø±Ø§ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ØŒ 
// Ø±ÛŒØ³Ú© Ø¨Ù‡ Ø§Ø²Ø§ÛŒ Ù‡Ø± Ù„Ø§Øª Ø±Ø§ Ø¨Ø§ ÙØ±Ù…ÙˆÙ„ slDistance * (g_tickValue / g_tickSize) Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ 
// (Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ Ù†Ù…Ø§Ø¯Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù)ØŒ Ø­Ø¬Ù… Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÛŒØ³Ú© Ù…Ø·Ù„ÙˆØ¨ ØªØ¹ÛŒÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ø¨Ù‡ Ú¯Ø§Ù… Ø­Ø¬Ù… Ø±Ø§Ù†Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Ú†Ú©â€ŒÙ‡Ø§ÛŒ ÙˆÙ„ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø­Ø¬Ù… Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡. 
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ ØªÙˆØ³Ø· CRange Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù… Ø¯Ø± ExecuteTrade ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯. 
// ØªØºÛŒÛŒØ±Ø§Øª: Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ù„Ø§Ø²Ù… Ù†Ø¨ÙˆØ¯ØŒ Ø§Ù…Ø§ Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.
// ØªØºÛŒÛŒØ±Ø§Øª Ù†Ø³Ø®Ù‡ 2.10: Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Print Ø¨Ø§ CLogger::LogØŒ Ú©Ø§Ù…Ù†Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ù‚ÛŒÙ‚. Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø²ÛŒØ±Ø§ Ø¨Ù„ÙˆÙ¾Ø±ÛŒÙ†Øª ØªØºÛŒÛŒØ±ÛŒ Ù…Ø´Ø®Øµ Ù†Ú©Ø±Ø¯Ù‡.

#ifndef RISK_MANAGER_MQH  // Ú†Ú©
#define RISK_MANAGER_MQH  // ØªØ¹Ø±ÛŒÙ

extern double g_tickValue;  // Ø§Ø±Ø²Ø´ ØªÛŒÚ© Ø®Ø§Ø±Ø¬ÛŒ (Ø§Ø² Elemento Ú©Ø´â€ŒØ´Ø¯Ù‡)
extern double g_tickSize;  // Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªÛŒÚ© Ø®Ø§Ø±Ø¬ÛŒ
extern double g_volumeStep;  // Ú¯Ø§Ù… Ø­Ø¬Ù… Ø®Ø§Ø±Ø¬ÛŒ
extern double g_volumeMin;  // Ø­Ø¯Ø§Ù‚Ù„ Ø­Ø¬Ù… Ø®Ø§Ø±Ø¬ÛŒ
extern double g_volumeMax;  // Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… Ø®Ø§Ø±Ø¬ÛŒ

// Ú©Ù„Ø§Ø³ CRiskManager Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù… Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÛŒØ³Ú©
// Ù…ØªØ¯ Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ
class CRiskManager  // Ú©Ù„Ø§Ø³ Ø±ÛŒØ³Ú©
{
public:
   // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù…: Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø±ØµØ¯ Ø±ÛŒØ³Ú© Ùˆ ÙØ§ØµÙ„Ù‡ SLØŒ Ø¨Ø§ ÙØ±Ù…ÙˆÙ„ Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ù†Ù…Ø§Ø¯Ù‡Ø§
   static double CalculateLotSize(double riskPercent, double slDistance)  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù„Ø§Øª Ø¨Ø§ Ø±ÛŒØ³Ú© Ùˆ ÙØ§ØµÙ„Ù‡ SL
   {
      if(g_tickValue == 0 || g_tickSize == 0)  // Ú†Ú© Ù…Ù‚Ø§Ø¯ÛŒØ± Ú©Ø´ Ù…Ø¹ØªØ¨Ø±
      {
         CLogger::Log("Ø®Ø·Ø§: tickValue ÛŒØ§ tickSize ØµÙØ± Ø§Ø³Øª. Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù… Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return 0;  // Ø¨Ø§Ø²Ú¯Ø´Øª ØµÙØ±
      }

      // Ø§Ú¯Ø± g_tickSize ØµÙØ± Ø¨Ø§Ø´Ø¯ (Ù†Ø§Ø¯Ø±)ØŒ default Ø¨Ù‡ _Point Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ
      if(g_tickSize == 0) g_tickSize = _Point;  // ØªÙ†Ø¸ÛŒÙ… Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªÛŒÚ©

      double accountBalance = AccountInfoDouble(ACCOUNT_BALANCE);  // Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø­Ø³Ø§Ø¨
      double riskPerLot = slDistance * (g_tickValue / g_tickSize);  // Ø±ÛŒØ³Ú© Ø¨Ù‡ Ø§Ø²Ø§ÛŒ Ù‡Ø± Ù„Ø§Øª

      if (riskPerLot <= 0)  // Ú†Ú© Ø±ÛŒØ³Ú© Ù…Ø¹ØªØ¨Ø±
      {
          CLogger::Log("Ø®Ø·Ø§: Ø±ÛŒØ³Ú© Ø¨Ù‡ Ø§Ø²Ø§ÛŒ Ù‡Ø± Ù„Ø§Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. slDistance=" + DoubleToString(slDistance, _Digits));  // Ú†Ø§Ù¾ Ø®Ø·Ø§
          return 0;  // Ø¨Ø§Ø²Ú¯Ø´Øª ØµÙØ±
      }

      double riskAmount = riskPercent / 100.0 * accountBalance;  // Ù…Ù‚Ø¯Ø§Ø± Ø±ÛŒØ³Ú© Ù…Ø·Ù„Ù‚
      double lotSize = riskAmount / riskPerLot;  // Ø­Ø¬Ù… Ø§ÙˆÙ„ÛŒÙ‡

      lotSize = MathRound(lotSize / g_volumeStep) * g_volumeStep;  // Ø±Ø§Ù†Ø¯ Ø¨Ù‡ Ú¯Ø§Ù… Ø­Ø¬Ù…
      lotSize = MathMax(g_volumeMin, MathMin(g_volumeMax, lotSize));  // Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ù‡ min/max

      if(lotSize < g_volumeMin)  // Ú†Ú© Ú©Ù…ØªØ± Ø§Ø² Ø­Ø¯Ø§Ù‚Ù„
      {
         CLogger::Log("Ø®Ø·Ø§: Ø­Ø¬Ù… Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡ (" + DoubleToString(lotSize, 2) + ") Ú©Ù…ØªØ± Ø§Ø² Ø­Ø¯Ø§Ù‚Ù„ (" + DoubleToString(g_volumeMin, 2) + ") Ø§Ø³Øª.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§
         return 0;  // Ø¨Ø§Ø²Ú¯Ø´Øª ØµÙØ±
      }

      if(InpDebugMode) CLogger::Log("Ø­Ø¬Ù… Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡: " + DoubleToString(lotSize, 2) + ", slDistance=" + DoubleToString(slDistance, _Digits) + ", riskPerLot=" + DoubleToString(riskPerLot, 2));  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
      return lotSize;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø­Ø¬Ù…
   }
};

#endif  // Ù¾Ø§ÛŒØ§Ù†
```

```mql5
//+------------------------------------------------------------------+
//|                                                     TimeHelper.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ú©Ù„Ø§Ø³ CTimeHelper Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø²Ù…Ø§Ù†ÛŒ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª: Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ø¬ Ùˆ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø§Ø¹Ø§Øª Ù…Ø­Ù„ÛŒ Ø³Ø±ÙˆØ± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§ Ø±Ù†Ø¬â€ŒÙ‡Ø§ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ø¯Ø± Ø¨Ø§Ø²Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ¹Ø±ÛŒÙâ€ŒØ´Ø¯Ù‡ Ø¹Ù…Ù„ Ú©Ù†Ù†Ø¯ Ùˆ Ù¾Ø³ Ø§Ø² Ø§Ù†Ù‚Ø¶Ø§ Ù¾Ø§Ú© Ø´ÙˆÙ†Ø¯.
// Ù…Ù†Ø·Ù‚ ÙØ§ÛŒÙ„ TimeHelper.mqh: Ù…ØªØ¯Ù‡Ø§ÛŒ Ø§Ø³ØªØ§ØªÛŒÚ© CalculateRangeTimes Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹/Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬ Ø±Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ 
// (Ø¨Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ø´Ø¨Ø§Ù†Ù‡ Ùˆ ØªÙ†Ø¸ÛŒÙ… Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÙˆØ² ÙØ¹Ù„ÛŒ)ØŒ 
// Ùˆ CalculateCleanupTime Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ ØªÙˆØ³Ø· CRange Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ø¨Ù‡ TimeCurrent Ø¯Ø§Ø±Ø¯. 
// ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ù†Ø³Ø®Ù‡ 2.10: Ø§ØµÙ„Ø§Ø­ CalculateRangeTimes Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª DST Ø¨Ø§ GMT offset Ùˆ Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ø±ÙˆØ² Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ù‚Ø¨Ù„ÛŒØŒ 
// Ø§ØµÙ„Ø§Ø­ CalculateCleanupTime Ø¨Ø±Ø§ÛŒ Ù¾Ø°ÛŒØ±Ø´ datetime rangeEndTime Ùˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø§Ø¯Ù‡ cleanupTime = rangeEndTime + cleanupHours * 3600 
// Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ø§Ú¯ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø± Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ø´Ø¨Ø§Ù†Ù‡.
// ØªØºÛŒÛŒØ±Ø§Øª Ù†Ø³Ø®Ù‡ 2.10: Ú©Ø§Ù…Ù†Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ù‚ÛŒÙ‚ØŒ Ø¨Ø¯ÙˆÙ† Print (Ø§Ø³ØªØ§ØªÛŒÚ©).

#ifndef TIME_HELPER_MQH  // Ú†Ú©
#define TIME_HELPER_MQH  // ØªØ¹Ø±ÛŒÙ

// Ú©Ù„Ø§Ø³ CTimeHelper Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø²Ù…Ø§Ù†ÛŒ Ø±Ù†Ø¬ Ùˆ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
// Ù…ØªØ¯Ù‡Ø§ Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ
class CTimeHelper  // Ú©Ù„Ø§Ø³ Ø²Ù…Ø§Ù†
{
public:
   // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ Ùˆ Ù¾Ø§ÛŒØ§Ù† Ø±Ù†Ø¬: ØªÙ†Ø¸ÛŒÙ… Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÙˆØ² ÙØ¹Ù„ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ù†Ø¬â€ŒÙ‡Ø§ÛŒ Ø¹Ø¨ÙˆØ± Ø§Ø² Ù†ÛŒÙ…Ù‡â€ŒØ´Ø¨
   // TimeToStruct Ø²Ù…Ø§Ù† Ø±Ø§ Ø¨Ù‡ Ø³Ø§Ø®ØªØ§Ø± ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   static bool CalculateRangeTimes(int startHour, int startMinute, int endHour, int endMinute, datetime &startTime, datetime &endTime)  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø±Ù†Ø¬
   {
      long server_gmt_offset = SymbolInfoInteger(_Symbol, SYMBOL_TIME_BIAS);  // Ú¯Ø±ÙØªÙ† Ø§ÙØ³Øª GMT Ø³Ø±ÙˆØ± (Ø¨Ø±Ø§ÛŒ DST)
      datetime gmt_now = TimeGMT();  // Ø²Ù…Ø§Ù† GMT ÙØ¹Ù„ÛŒ
      MqlDateTime dt_gmt;  // Ø³Ø§Ø®ØªØ§Ø± Ø²Ù…Ø§Ù† GMT
      TimeToStruct(gmt_now, dt_gmt);  // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø³Ø§Ø®ØªØ§Ø±

      datetime gmt_today_start = gmt_now - (dt_gmt.hour * 3600 + dt_gmt.min * 60 + dt_gmt.sec);  // Ø´Ø±ÙˆØ¹ Ø±ÙˆØ² GMT

      datetime gmt_start_time = gmt_today_start + startHour * 3600 + startMinute * 60;  // Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ GMT
      datetime gmt_end_time = gmt_today_start + endHour * 3600 + endMinute * 60;  // Ø²Ù…Ø§Ù† Ù¾Ø§ÛŒØ§Ù† GMT

      if(gmt_end_time <= gmt_start_time)  // Ú†Ú© Ø±Ù†Ø¬ Ø´Ø¨Ø§Ù†Ù‡
      {
         gmt_end_time += 86400;  // Ø§Ø¶Ø§ÙÙ‡ Ø±ÙˆØ²
      }

      // Ø­Ù„Ù‚Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¢Ø®Ø±ÛŒÙ† Ø±ÙˆØ² Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ (Ø¨Ø±Ø§ÛŒ Ø¢Ø®Ø± Ù‡ÙØªÙ‡â€ŒÙ‡Ø§ Ùˆ Ú©Ø±ÛŒÙ¾ØªÙˆ)
      while(gmt_now < gmt_start_time)  // Ú†Ú© Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø´Ø±ÙˆØ¹
      {
         gmt_start_time -= 86400;  // Ø¹Ù‚Ø¨ Ø¨Ø±Ø¯Ù† Ø¨Ù‡ Ø±ÙˆØ² Ù‚Ø¨Ù„
         gmt_end_time -= 86400;  // Ø¹Ù‚Ø¨ Ø¨Ø±Ø¯Ù† Ù¾Ø§ÛŒØ§Ù†

         MqlDateTime check_day_dt;  // Ø³Ø§Ø®ØªØ§Ø± Ø±ÙˆØ² Ú†Ú©
         TimeToStruct(gmt_start_time, check_day_dt);  // ØªØ¨Ø¯ÛŒÙ„
         datetime session_from, session_to;  // Ø²Ù…Ø§Ù† Ø¬Ù„Ø³Ù‡

         // Ø§Ú¯Ø± Ø§ÛŒÙ† Ø±ÙˆØ² Ø¬Ù„Ø³Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ù†Ø¯Ø§Ø±Ø¯ (Ù…Ø«Ù„ Ø´Ù†Ø¨Ù‡ Ø¨Ø±Ø§ÛŒ ÙØ§Ø±Ú©Ø³)ØŒ ÛŒÚ© Ø±ÙˆØ² Ø¯ÛŒÚ¯Ø± Ø¹Ù‚Ø¨ Ø¨Ø±Ùˆ
         if(!SymbolInfoSessionTrade(_Symbol, (ENUM_DAY_OF_WEEK)check_day_dt.day_of_week, 0, session_from, session_to))  // Ú†Ú© Ø¬Ù„Ø³Ù‡
         {
            CLogger::Log("Ø±ÙˆØ² ØºÛŒØ± Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯: " + TimeToString(gmt_start_time, TIME_DATE) + ". Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙˆØ² Ù‚Ø¨Ù„...", 0);  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
            continue;  // Ù¾Ø±Ø´
         }
         break;  // Ø±ÙˆØ² Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ù¾ÛŒØ¯Ø§ Ø´Ø¯
      }

      startTime = gmt_start_time + server_gmt_offset;  // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ù…Ø­Ù„ÛŒ Ø´Ø±ÙˆØ¹
      endTime = gmt_end_time + server_gmt_offset;  // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ù…Ø­Ù„ÛŒ Ù¾Ø§ÛŒØ§Ù†

      if(InpDebugMode) CLogger::Log("Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø±Ù†Ø¬ (GMT Aware): Start=" + TimeToString(startTime) + ", End=" + TimeToString(endTime));  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
      return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ÛŒØª
   }

   // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø¨Ù‡ Ø²Ù…Ø§Ù† Ù¾Ø§ÛŒØ§Ù† Ø¨Ø±Ø§ÛŒ Ø§Ù†Ù‚Ø¶Ø§ (Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡)
   // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ù‚Øª
   static datetime CalculateCleanupTime(datetime rangeEndTime, int cleanupHours)  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
   {
      datetime cleanupTime = rangeEndTime + cleanupHours * 3600;  // Ø¨Ù‡ Ù‡Ù…ÛŒÙ† Ø³Ø§Ø¯Ú¯ÛŒ!
      if(InpDebugMode) CLogger::Log("Ø²Ù…Ø§Ù† Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯: " + TimeToString(cleanupTime));  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
      return cleanupTime;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø²Ù…Ø§Ù†
   }
};

#endif  // Ù¾Ø§ÛŒØ§Ù†
```

```mql5
//+------------------------------------------------------------------+
//|                                                     TrendFilter.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ú©Ù„Ø§Ø³ CTrendFilter Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª: ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø®Ù„Ø§Ù Ø¬Ù‡Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯Ø› 
// Ø§Ú¯Ø± Ø§Ø¨Ø± Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ ÙÙ„Øª (Ø®Ù†Ø«ÛŒ) ÛŒØ§ Ù‡Ù…â€ŒØ¬Ù‡Øª Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù…Ø¬Ø§Ø² Ø§Ø³ØªØŒ Ð¸Ð½Ð°Ñ‡Ðµ Ø±Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
// Ù…Ù†Ø·Ù‚ ÙØ§ÛŒÙ„ TrendFilter.mqh: enum ENUM_TREND_DIRECTION Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ (BUY/SELL/NEUTRAL). 
// ØªØ§Ø¨Ø¹ GetTrendDirection Ø³Ù†Ú©Ùˆ A/B Ø±Ø§ Ø¨Ù‡ Ø·ÙˆØ± Ø¯Ø³ØªÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ 
// (Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² iHigh/iLow Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ†Ú©Ø§Ù†ØŒ Ú©ÛŒØ¬ÙˆÙ† Ùˆ Ø³Ù†Ú©Ùˆ B)ØŒ 
// ØªÙØ§ÙˆØª Ø±Ø§ Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ø§Ú¯Ø± Ú©Ù…ØªØ± Ø§Ø² Ø¢Ø³ØªØ§Ù†Ù‡ØŒ Ø®Ù†Ø«ÛŒ)ØŒ 
// Ùˆ Ø¬Ù‡Øª Ø±Ø§ ØªØ¹ÛŒÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (A > B Ø¨Ø±Ø§ÛŒ BUY). 
// Ø§ÛŒÙ† Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø³ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø´Ú©Ù„Ø§Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ú©Ù†Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ Ø¯Ø± MT5 Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯. 
// Init/Deinit Ø®Ø§Ù„ÛŒ Ù‡Ø³ØªÙ†Ø¯ Ø²ÛŒØ±Ø§ Ù‡ÛŒÚ† Ù‡Ù†Ø¯Ù„ÛŒ Ø«Ø§Ø¨Øª Ù†ÛŒØ³Øª. 
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ ØªÙˆØ³Ø· CRange Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ ÙÛŒÙ„ØªØ± Ù…Ø³ØªÙ‚Ù„ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯. 
// ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯: Ø§Ø¶Ø§ÙÙ‡ ØªØ§Ø¨Ø¹ GetSenkouSpanB Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ù…Ù‚Ø¯Ø§Ø± Senkou Span B Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± ØªØ±ÛŒÙ„ÛŒÙ†Ú¯.
// ØªØºÛŒÛŒØ±Ø§Øª Ù†Ø³Ø®Ù‡ 2.10: Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Print Ø¨Ø§ CLogger::LogØŒ Ú©Ø§Ù…Ù†Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ù‚ÛŒÙ‚. Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø²ÛŒØ±Ø§ Ø¨Ù„ÙˆÙ¾Ø±ÛŒÙ†Øª ØªØºÛŒÛŒØ±ÛŒ Ù…Ø´Ø®Øµ Ù†Ú©Ø±Ø¯Ù‡.

#ifndef TREND_FILTER_MQH  // Ú†Ú©
#define TREND_FILTER_MQH  // ØªØ¹Ø±ÛŒÙ

// ØªØ¹Ø±ÛŒÙ enum Ø¨Ø±Ø§ÛŒ Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯ (Ø¨Ø±Ø§ÛŒ ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø± ÙÛŒÙ„ØªØ±)
// Ø§ÛŒÙ† enum Ø®Ø±ÙˆØ¬ÛŒ ÙÛŒÙ„ØªØ± Ø±Ø§ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
enum ENUM_TREND_DIRECTION
{
   TREND_BUY,     // Ø±ÙˆÙ†Ø¯ ØµØ¹ÙˆØ¯ÛŒ (Ø³Ù†Ú©Ùˆ A Ø¨Ø§Ù„Ø§ÛŒ B) - Ø¬Ù‡Øª Ø®Ø±ÛŒØ¯ Ù…Ø¬Ø§Ø²
   TREND_SELL,    // Ø±ÙˆÙ†Ø¯ Ù†Ø²ÙˆÙ„ÛŒ (Ø³Ù†Ú©Ùˆ A Ù¾Ø§ÛŒÛŒÙ† B) - Ø¬Ù‡Øª ÙØ±ÙˆØ´ Ù…Ø¬Ø§Ø²
   TREND_NEUTRAL  // Ø±ÙˆÙ†Ø¯ Ø®Ù†Ø«ÛŒ (Ø§Ø¨Ø± ÙÙ„Øª ÛŒØ§ ÙÛŒÙ„ØªØ± Ø®Ø§Ù…ÙˆØ´) - Ù‡Ø± Ø¬Ù‡ØªÛŒ Ù…Ø¬Ø§Ø²
};

// Ú©Ù„Ø§Ø³ CTrendFilter Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯ Ù¾ÙˆÛŒØ§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ
// Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø¯Ø³ØªÛŒ Ø¨Ø¯ÙˆÙ† Ù‡Ù†Ø¯Ù„
class CTrendFilter  // Ú©Ù„Ø§Ø³ ÙÛŒÙ„ØªØ± Ø±ÙˆÙ†Ø¯
{
public:
   CTrendFilter() {}  // Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ - Ù‡ÛŒÚ† Ù…Ù‚Ø¯Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù†Ø¯Ø§Ø±Ø¯

   // Init Ø®Ø§Ù„ÛŒ (Ù‡ÛŒÚ† Ù‡Ù†Ø¯Ù„ÛŒ Ø«Ø§Ø¨Øª Ø³Ø§Ø®ØªÙ‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø³ØªÛŒ Ø¯Ø± GetTrendDirection)
   bool Init() { return true; }  // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ - Ù‡Ù…ÛŒØ´Ù‡ Ù…ÙˆÙÙ‚ÛŒØª

   // Deinit Ø®Ø§Ù„ÛŒ (Ù‡ÛŒÚ† Ù…Ù†Ø¨Ø¹ÛŒ Ø«Ø§Ø¨Øª Ø¨Ø±Ø§ÛŒ Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ù†ÛŒØ³Øª)
   void Deinit() {}  // Ø¯ÙØ¹ - Ù‡ÛŒÚ† Ø¹Ù…Ù„ÛŒ

   // Ú¯Ø±ÙØªÙ† Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø³ØªÛŒ Ø³Ù†Ú©Ùˆ A/B Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø°Ø´ØªÙ‡ (Ø¨Ø±Ø§ÛŒ Ø§Ø¨Ø± Ø¢ÛŒÙ†Ø¯Ù‡ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ú©Ù†Ø¯Ù„ Ø¢ÛŒÙ†Ø¯Ù‡)
   // iHighest/iLowest Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯
   ENUM_TREND_DIRECTION GetTrendDirection(ENUM_TIMEFRAMES timeframe)  // Ú¯Ø±ÙØªÙ† Ø¬Ù‡Øª Ø¨Ø§ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…
   {
      if(!Inp_IchimokuFilter_Enabled)  // Ú†Ú© ÙÛŒÙ„ØªØ± Ø®Ø§Ù…ÙˆØ´
      {
         return TREND_NEUTRAL;  // Ø§Ú¯Ø± ÙÛŒÙ„ØªØ± Ø®Ø§Ù…ÙˆØ´ Ø¨Ø§Ø´Ø¯ØŒ Ù‡Ù…ÛŒØ´Ù‡ Ø®Ù†Ø«ÛŒ ÙØ±Ø¶ Ù…ÛŒâ€ŒØ´ÙˆØ¯
      }

      // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªÙ†Ú©Ø§Ù†-Ø³Ù† (Ø¨Ø±Ø§ÛŒ Ú©Ù†Ø¯Ù„ Ø¨Ø³ØªÙ‡ Ø¢Ø®Ø±ØŒ shift 1)
      int tenkanHighIdx = iHighest(_Symbol, timeframe, MODE_HIGH, Inp_Ichimoku_Tenkan, 1);  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø³Ù‚Ù ØªÙ†Ú©Ø§Ù†
      int tenkanLowIdx = iLowest(_Symbol, timeframe, MODE_LOW, Inp_Ichimoku_Tenkan, 1);  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ú©Ù ØªÙ†Ú©Ø§Ù†
      double tenkanHigh = iHigh(_Symbol, timeframe, tenkanHighIdx);  // Ù‡Ø§ÛŒ ØªÙ†Ú©Ø§Ù†
      double tenkanLow = iLow(_Symbol, timeframe, tenkanLowIdx);  // Ù„Ùˆ ØªÙ†Ú©Ø§Ù†
      double tenkan = (tenkanHigh + tenkanLow) / 2.0;  // ØªÙ†Ú©Ø§Ù†-Ø³Ù†

      // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©ÛŒØ¬ÙˆÙ†-Ø³Ù†
      int kijunHighIdx = iHighest(_Symbol, timeframe, MODE_HIGH, Inp_Ichimoku_Kijun, 1);  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø³Ù‚Ù Ú©ÛŒØ¬ÙˆÙ†
      int kijunLowIdx = iLowest(_Symbol, timeframe, MODE_LOW, Inp_Ichimoku_Kijun, 1);  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ú©Ù Ú©ÛŒØ¬ÙˆÙ†
      double kijunHigh = iHigh(_Symbol, timeframe, kijunHighIdx);  // Ù‡Ø§ÛŒ Ú©ÛŒØ¬ÙˆÙ†
      double kijunLow = iLow(_Symbol, timeframe, kijunLowIdx);  // Ù„Ùˆ Ú©ÛŒØ¬ÙˆÙ†
      double kijun = (kijunHigh + kijunLow) / 2.0;  // Ú©ÛŒØ¬ÙˆÙ†-Ø³Ù†

      // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù†Ú©Ùˆ Ø§Ø³Ù¾Ù† A (Ø¨Ø±Ø§ÛŒ Ø§Ø¨Ø± Ø¢ÛŒÙ†Ø¯Ù‡)
      double senkouA = (tenkan + kijun) / 2.0;  // Ø³Ù†Ú©Ùˆ A

      // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù†Ú©Ùˆ Ø§Ø³Ù¾Ù† B (Ø¨Ø±Ø§ÛŒ Ø§Ø¨Ø± Ø¢ÛŒÙ†Ø¯Ù‡)
      int senkouBHighIdx = iHighest(_Symbol, timeframe, MODE_HIGH, Inp_Ichimoku_SenkouB, 1);  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø³Ù‚Ù Ø³Ù†Ú©Ùˆ B
      int senkouBLowIdx = iLowest(_Symbol, timeframe, MODE_LOW, Inp_Ichimoku_SenkouB, 1);  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ú©Ù Ø³Ù†Ú©Ùˆ B
      double senkouBHigh = iHigh(_Symbol, timeframe, senkouBHighIdx);  // Ù‡Ø§ÛŒ Ø³Ù†Ú©Ùˆ B
      double senkouBLow = iLow(_Symbol, timeframe, senkouBLowIdx);  // Ù„Ùˆ Ø³Ù†Ú©Ùˆ B
      double senkouB = (senkouBHigh + senkouBLow) / 2.0;  // Ø³Ù†Ú©Ùˆ B

      double diff = MathAbs(senkouA - senkouB) / _Point;  // ØªÙØ§ÙˆØª Ø¨Ù‡ Ù¾ÙˆÛŒÙ†Øª
      if(diff < Inp_Ichimoku_FlatThreshold_Points)  // Ú†Ú© ÙÙ„Øª Ø¨ÙˆØ¯Ù†
      {
         if(InpDebugMode) CLogger::Log("Ø§Ø¨Ø± Ø§ÛŒÚ†ÛŒÙ…ÙˆÚ©Ùˆ ÙÙ„Øª Ø§Ø³Øª. Ø¬Ù‡Øª: NEUTRAL");  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
         return TREND_NEUTRAL;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø®Ù†Ø«ÛŒ
      }

      if(senkouA > senkouB)  // Ú†Ú© ØµØ¹ÙˆØ¯ÛŒ
      {
         if(InpDebugMode) CLogger::Log("Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯: BUY");  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
         return TREND_BUY;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø®Ø±ÛŒØ¯
      }
      else  // Ú†Ú© Ù†Ø²ÙˆÙ„ÛŒ
      {
         if(InpDebugMode) CLogger::Log("Ø¬Ù‡Øª Ø±ÙˆÙ†Ø¯: SELL");  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
         return TREND_SELL;  // Ø¨Ø§Ø²Ú¯Ø´Øª ÙØ±ÙˆØ´
      }
   }

   // (Ø¬Ø¯ÛŒØ¯) Ú¯Ø±ÙØªÙ† Senkou Span B: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø³ØªÛŒ Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± ØªØ±ÛŒÙ„ÛŒÙ†Ú¯
   // Ù…Ø´Ø§Ø¨Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø± GetTrendDirection
   double GetSenkouSpanB(ENUM_TIMEFRAMES timeframe)  // Ú¯Ø±ÙØªÙ† Senkou B Ø¨Ø§ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…
   {
      // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù†Ú©Ùˆ Ø§Ø³Ù¾Ù† B (Ø¨Ø±Ø§ÛŒ Ø§Ø¨Ø± Ø¢ÛŒÙ†Ø¯Ù‡)
      int senkouBHighIdx = iHighest(_Symbol, timeframe, MODE_HIGH, Inp_Ichimoku_SenkouB, 1);  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø³Ù‚Ù Ø³Ù†Ú©Ùˆ B
      int senkouBLowIdx = iLowest(_Symbol, timeframe, MODE_LOW, Inp_Ichimoku_SenkouB, 1);  // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ú©Ù Ø³Ù†Ú©Ùˆ B
      double senkouBHigh = iHigh(_Symbol, timeframe, senkouBHighIdx);  // Ù‡Ø§ÛŒ Ø³Ù†Ú©Ùˆ B
      double senkouBLow = iLow(_Symbol, timeframe, senkouBLowIdx);  // Ù„Ùˆ Ø³Ù†Ú©Ùˆ B
      double senkouB = (senkouBHigh + senkouBLow) / 2.0;  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Senkou B

      if(senkouB == 0)  // Ú†Ú© Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø± (Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ…Ù†ÛŒ)
      {
         if(InpDebugMode) CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Senkou Span B.");  // Ú†Ø§Ù¾ Ø®Ø·Ø§
      }
      return senkouB;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù…Ù‚Ø¯Ø§Ø±
   }
};

#endif  // Ù¾Ø§ÛŒØ§Ù†
```

```mql5
//+------------------------------------------------------------------+
//|                                                   VisualManager.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ú©Ù„Ø§Ø³ CVisualManager Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¨ØµØ±ÛŒ Ø±ÙˆÛŒ Ú†Ø§Ø±Øª Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ú©Ù„ÛŒ Ø§Ú©Ø³Ù¾Ø±Øª: Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ (Bullish/Bearish/Neutral) Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ù†Ø¬ ÙØ¹Ø§Ù„ Ø¨Ù‡ Ø·ÙˆØ± Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ 
// Ø¨Ø±Ø§ÛŒ Ú©Ù…Ú© Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ù†Ø¸Ø§Ø±ØªØŒ Ø¨Ø¯ÙˆÙ† ØªØ£Ø«ÛŒØ± Ø¨Ø± Ù…Ù†Ø·Ù‚ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ.
// Ù…Ù†Ø·Ù‚ ÙØ§ÛŒÙ„ VisualManager.mqh: Ú©Ù„Ø§Ø³ Ø´ÛŒØ¡ LABEL Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙ† Ú©Ø§Ù…Ù„ ÙˆØ¶Ø¹ÛŒØª Ù‡Ø± Ø±Ù†Ø¬ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ 
// Ù…ÙˆÙ‚Ø¹ÛŒØªØŒ ÙÙˆÙ†Øª Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// ØªØ§Ø¨Ø¹ UpdateTrendStatus Ù…ØªÙ† Ú†Ù†Ø¯Ø®Ø·ÛŒ Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ùˆ Ú†Ø§Ø±Øª Ø±Ø§ redraw Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Init Ø´ÛŒØ¡ Ø±Ø§ Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯ Ùˆ Deinit Ø­Ø°Ù Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ ØªÙˆØ³Ø· Elemento.mq5 Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± OnTick ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø§Ø³Øª 
// (Ø§Ú¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø®Ø§Ù…ÙˆØ´ Ø¨Ø§Ø´Ø¯ØŒ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯). 
// ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯: Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ù…ØªÙ† Ú†Ù†Ø¯Ø®Ø·ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù‡Ø± Ø±Ù†Ø¬ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡.
// ØªØºÛŒÛŒØ±Ø§Øª Ù†Ø³Ø®Ù‡ 2.10: Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Print Ø¨Ø§ CLogger::LogØŒ Ú©Ø§Ù…Ù†Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ù‚ÛŒÙ‚. Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø²ÛŒØ±Ø§ Ø¨Ù„ÙˆÙ¾Ø±ÛŒÙ†Øª ØªØºÛŒÛŒØ±ÛŒ Ù…Ø´Ø®Øµ Ù†Ú©Ø±Ø¯Ù‡.

#ifndef VISUAL_MANAGER_MQH  // Ú†Ú©
#define VISUAL_MANAGER_MQH  // ØªØ¹Ø±ÛŒÙ

// Ú©Ù„Ø§Ø³ CVisualManager Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙ† Ø±ÙˆÙ†Ø¯ Ù‡Ø± Ø±Ù†Ø¬ Ø±ÙˆÛŒ Ú†Ø§Ø±Øª
// OBJ_LABEL Ø¨Ø±Ø§ÛŒ Ù…ØªÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
class CVisualManager  // Ú©Ù„Ø§Ø³ Ù†Ù…Ø§ÛŒØ´
{
private:
   string m_trendStatusObjectName;  // Ù†Ø§Ù… Ù…Ù†Ø­ØµØ±Ø¨Ù‡â€ŒÙØ±Ø¯ Ø´ÛŒØ¡ LABEL Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ - Ø«Ø§Ø¨Øª "TrendStatus"

public:
   CVisualManager() : m_trendStatusObjectName("TrendStatus") {}  // Ø³Ø§Ø²Ù†Ø¯Ù‡ - ØªÙ†Ø¸ÛŒÙ… Ù†Ø§Ù… Ø´ÛŒØ¡

   // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ: Ø§ÛŒØ¬Ø§Ø¯ Ø´ÛŒØ¡ LABEL Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙÙˆÙ†ØªØŒ Ø±Ù†Ú¯ Ùˆ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ú¯Ø± Ù†Ù…Ø§ÛŒØ´ ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯
   // ObjectCreate Ø´ÛŒØ¡ Ø±Ø§ Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯
   bool Init()  // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´
   {
      if(InpDebugMode) CLogger::Log("Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´...");  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹
      if(Inp_Visual_ShowTrendStatus)  // Ú†Ú© ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ù†Ù…Ø§ÛŒØ´
      {
         if(!ObjectCreate(0, m_trendStatusObjectName, OBJ_LABEL, 0, 0, 0))  // Ø§ÛŒØ¬Ø§Ø¯ LABEL
         {
            CLogger::Log("Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø´ÛŒØ¡ Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆÙ†Ø¯: " + IntegerToString(GetLastError()));  // Ú†Ø§Ù¾ Ø®Ø·Ø§
            return false;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ú©Ø³Øª
         }

         ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_XDISTANCE, Inp_Visual_X_Offset);  // ØªÙ†Ø¸ÛŒÙ… ÙØ§ØµÙ„Ù‡ Ø§ÙÙ‚ÛŒ
         ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_YDISTANCE, Inp_Visual_Y_Offset);  // ØªÙ†Ø¸ÛŒÙ… ÙØ§ØµÙ„Ù‡ Ø¹Ù…ÙˆØ¯ÛŒ
         ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_CORNER, CORNER_LEFT_UPPER);  // ØªÙ†Ø¸ÛŒÙ… Ú¯ÙˆØ´Ù‡ Ú†Ù¾ Ø¨Ø§Ù„Ø§
         ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_FONTSIZE, Inp_Visual_FontSize);  // ØªÙ†Ø¸ÛŒÙ… Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙÙˆÙ†Øª
         ObjectSetString(0, m_trendStatusObjectName, OBJPROP_FONT, "Arial");  // ØªÙ†Ø¸ÛŒÙ… ÙÙˆÙ†Øª
         ObjectSetString(0, m_trendStatusObjectName, OBJPROP_TEXT, "Initializing...");  // Ù…ØªÙ† Ø§ÙˆÙ„ÛŒÙ‡
         ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_COLOR, Inp_Visual_FontColor_Neutral);  // Ø±Ù†Ú¯ Ø®Ù†Ø«ÛŒ
      }
      if(InpDebugMode) CLogger::Log("Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø´Ø¯.");  // Ú†Ø§Ù¾ Ù…ÙˆÙÙ‚ÛŒØª
      return true;  // Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ÛŒØª
   }

   // Ø¯ÙØ¹: Ø­Ø°Ù Ø´ÛŒØ¡ LABEL Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ú†Ø§Ø±Øª
   // ObjectDelete Ø´ÛŒØ¡ Ø±Ø§ Ø­Ø°Ù Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void Deinit()  // Ø¯ÙØ¹ Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´
   {
      ObjectDelete(0, m_trendStatusObjectName);  // Ø­Ø°Ù Ø´ÛŒØ¡
      if(InpDebugMode) CLogger::Log("Ø´ÛŒØ¡ Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆÙ†Ø¯ Ø­Ø°Ù Ø´Ø¯.");  // Ú†Ø§Ù¾ Ø¯ÛŒØ¨Ø§Ú¯
   }

   // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´: ØªØºÛŒÛŒØ± Ù…ØªÙ† Ú©Ø§Ù…Ù„ ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆÙ†Ø¯ Ù‡Ø± Ø±Ù†Ø¬ Ùˆ redraw Ú†Ø§Ø±Øª
   // ChartRedraw Ú†Ø§Ø±Øª Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   void UpdateTrendStatus(string fullText)  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ØªÙ† Ù†Ù…Ø§ÛŒØ´
   {
      if(!Inp_Visual_ShowTrendStatus) return;  // Ø®Ø±ÙˆØ¬ Ø§Ú¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø®Ø§Ù…ÙˆØ´

      ObjectSetString(0, m_trendStatusObjectName, OBJPROP_TEXT, fullText);  // ØªÙ†Ø¸ÛŒÙ… Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯
      ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_COLOR, Inp_Visual_FontColor_Neutral);  // Ø±Ù†Ú¯ Ø®Ù†Ø«ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ØªÙ† Ú†Ù†Ø¯Ø®Ø·ÛŒ
      ChartRedraw();  // redraw Ú†Ø§Ø±Øª
   }
};

#endif  // Ù¾Ø§ÛŒØ§Ù†
```

```mql5
//+------------------------------------------------------------------+
//|                                                        Logger.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ÛŒÚ© Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø³Ø§Ø¯Ù‡ Ùˆ Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§Ú¯â€ŒÙ†ÙˆÛŒØ³ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯
// Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù„Ø§Ú¯ ØªÚ©Ø±Ø§Ø±ÛŒ Ùˆ Ù†ÙˆÛŒØ² Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.
// ØªØºÛŒÛŒØ±Ø§Øª Ù†Ø³Ø®Ù‡ 2.10: ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ CLogger Ø§Ø³ØªØ§ØªÛŒÚ©ØŒ m_lastMessage Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªÚ©Ø±Ø§Ø±ØŒ 
// ÙØ±Ù…Øª Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¨Ø§ Ù¾ÛŒØ´ÙˆÙ†Ø¯ [Elemento] [Range X] >> Ù¾ÛŒØ§Ù…. Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø²ÛŒØ±Ø§ Ø¨Ù„ÙˆÙ¾Ø±ÛŒÙ†Øª ØªØºÛŒÛŒØ±ÛŒ Ù…Ø´Ø®Øµ Ù†Ú©Ø±Ø¯Ù‡.

#ifndef LOGGER_MQH  // Ú†Ú© ÙˆØ¬ÙˆØ¯
#define LOGGER_MQH  // ØªØ¹Ø±ÛŒÙ Ù…Ø§Ú©Ø±Ùˆ

// Ú©Ù„Ø§Ø³ CLogger Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ù„Ø§Ú¯ Ø¨Ø¯ÙˆÙ† Ù†Ù…ÙˆÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ
class CLogger  // Ú©Ù„Ø§Ø³ Ù„Ø§Ú¯
{
private:
   static string m_lastMessage;  // Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù… Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªÚ©Ø±Ø§Ø± (Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø§Ø´ØªØ±Ø§Ú©)

public:
   // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ù„Ø§Ú¯â€ŒÙ†ÙˆÛŒØ³ÛŒ
   // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù¾ÛŒØ§Ù… Ø±Ø§ Ø¨Ø§ Ú†Ú© ØªÚ©Ø±Ø§Ø± Ú†Ø§Ù¾ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   static void Log(string message, int rangeIndex = 0)  // ØªØ§Ø¨Ø¹ Ù„Ø§Ú¯ Ø¨Ø§ Ù¾ÛŒØ§Ù… Ùˆ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø§Ø®ØªÛŒØ§Ø±ÛŒ
   {
      // ÙÙ‚Ø· Ø§Ú¯Ø± Ø­Ø§Ù„Øª Ø¯ÛŒØ¨Ø§Ú¯ ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯ Ù„Ø§Ú¯ Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³Ø¯
      if(!InpDebugMode)  // Ø´Ø±Ø· Ø¯ÛŒØ¨Ø§Ú¯
         return;  // Ø®Ø±ÙˆØ¬ Ø¨Ø¯ÙˆÙ† Ú†Ø§Ù¾
         
      // Ø§Ú¯Ø± Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù¾ÛŒØ§Ù… Ù‚Ø¨Ù„ÛŒ ÛŒÚ©ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯
      if(message == m_lastMessage)  // Ú†Ú© ØªÚ©Ø±Ø§Ø±
         return;  // Ø®Ø±ÙˆØ¬

      string prefix = "[Elemento]";  // Ù¾ÛŒØ´ÙˆÙ†Ø¯ Ú©Ù„ÛŒ
      
      if(rangeIndex > 0)  // Ø§Ú¯Ø± Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ÛŒÚ© Ø±Ù†Ø¬ Ø®Ø§Øµ Ø¨Ø§Ø´Ø¯
      {
         prefix += " [Range " + IntegerToString(rangeIndex) + "]";  // Ø§Ø¶Ø§ÙÙ‡ Ø§ÛŒÙ†Ø¯Ú©Ø³
      }
      
      Print(prefix + " >> " + message);  // Ú†Ø§Ù¾ Ù¾ÛŒØ§Ù… Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø§ Print (MT5 Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯)
      
      m_lastMessage = message;  // Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù… ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø¹Ø¯ÛŒ
   }
};

// Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…ØªØºÛŒØ± Ø§Ø³ØªØ§ØªÛŒÚ© (Ø®Ø§Ø±Ø¬ Ø§Ø² Ú©Ù„Ø§Ø³)
string CLogger::m_lastMessage = "";  // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…ØªØºÛŒØ± Ø§Ø³ØªØ§ØªÛŒÚ©

#endif  // Ù¾Ø§ÛŒØ§Ù†
```



