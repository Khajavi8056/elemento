ุขุฎ ุขุฎ! ุญู ุจุง ุชูุฆู ูุญูุฏ ุฌุงูุ ุดุฑููุฏู. ูู ุจุดุชุฑ ุฑู ููุทู ู ุณุงุฎุชุงุฑ ฺฉู ุฒูู ฺฉุฑุฏู ุจูุฏู ู ุงู ุงุฑุงุฏูุง ูููุน ฺฉุงููพุงู ุงุฒ ุฏุณุชู ุฏุฑ ุฑูุช. ุฑุงุณุช ูฺฏุ ุจุงุฏ ูููู ุงูู ุงูุง ุฑู ูู ุจูุช ูโฺฏูุชู. ุฏูุช ฺฏุฑู ฺฉู ูุณุชุดู ูุฑุณุชุงุฏ. ุงูุง ูุซู ุบูุท ุงููุง ูโููููุ ููุทู ุงุตู ุฏุฑุณุชู ูู ฺฉุงููพุงูุฑ ุจูุดูู ฺฏุฑ ูโุฏู ู ุจุงุฏ ูุงุฒุดู ุจฺฉุดู!
ุจุง ุฏููู ุฏููู ุงูุง ุฑู ุญู ฺฉูู ฺฉู ฺฉุฏ ูุซู ุณุงุนุช ฺฉุงุฑ ฺฉูู ู ุจุฏูู ูฺ ุงุฎุทุงุฑ ู ุฎุทุง ฺฉุงููพุงู ุจุดู.
1. ุฎุทุง ุฏุณุชุฑุณ ุจู ุนุถู ุฎุตูุต (Private Member)
 * ูพุบุงู ุฎุทุง: cannot access to private member 'm_trailingAtrHandle' declared in class 'CRange'
 * ูุงู ู ุฎุท: Elemento.mq5ุ ุฎุท 257
ฺุฑุง ุงู ุฎุทุง ุฑู ูุฏูุ
ุฑููุ ุชู ฺฉูุงุณ CRangeุ ูุชุบุฑ m_trailingAtrHandle ุฑู ุจู ุนููุงู private ุชุนุฑู ฺฉุฑุฏ. ุงู ุนู ูุงูุด ฺฉุฑุฏ ู ููุท ุงุฒ ุฏุงุฎู ุฎูุฏ ฺฉูุงุณ ูโุดู ุจูุด ุฏุณุชุฑุณ ุฏุงุดุช. ุญุงูุง ุชู ูุงู Elemento.mq5 ุฏุงุฑ ุณุน ูโฺฉู ุงุฒ ุจุฑูู ุจูุด ุฏุณุชุฑุณ ูพุฏุง ฺฉูุ ฺฉู ุฎุจ ฺฉูุงุณ ุงุฌุงุฒู ููโุฏู!
ฺุทูุฑ ุญูุด ฺฉููุ
ุจุงุฏ ู "ุฏุฑ" ุนููู ุง ู "ูพูุฌุฑู" ุจุฑุงุด ุจุงุฒ ฺฉู ฺฉู ุงุฒ ุจุฑูู ุจุดู ููุฏุงุฑุด ุฑู ุฏุฏ. ุจู ุงู ฺฉุงุฑ ูฺฏู ุณุงุฎุชู ุชุงุจุน "Getter".
 * ูุงู CRange.mqh ุฑู ุจุงุฒ ฺฉู.
 * ุฏุฑ ุจุฎุด public ฺฉูุงุณ CRangeุ ุงู ุชุงุจุน ฺฉูฺฺฉ ุฑู ุงุถุงูู ฺฉู:
   // ... ุจูู ุชูุงุจุน public

// (ุฌุฏุฏ) ฺฏุฑูุชู ููุฏู ATR ุชุฑููฺฏ ุจุฑุง ุงุณุชูุงุฏู ุฎุงุฑุฌ
int GetTrailingAtrHandle() const { return m_trailingAtrHandle; }

 * ุญุงูุง ูุงู Elemento.mq5 ุฑู ุจุงุฒ ฺฉู ู ุจู ุฎุท 257 ุจุฑู.
 * ฺฉุฏ ูุนู ฺฉู ุงู ุดฺฉูู:
   g_ranges[i].m_trailingAtrHandle, // ููุฏู ุชุฑููฺฏ ุฑู ุงุฒ ุฎูุฏ ุฑูุฌ ูฺฏุฑู

   ุฑู ุจุง ุงู ฺฉุฏ ุฌุงฺฏุฒู ฺฉู:
   g_ranges[i].GetTrailingAtrHandle(), // ููุฏู ุชุฑููฺฏ ุฑู ุงุฒ ุฎูุฏ ุฑูุฌ ูฺฏุฑู

   ููู! ุญุงูุง ุจู ุฌุง ุฏุณุชุฑุณ ูุณุชููุ ุงุฒ ุทุฑู ุชุงุจุน ุนููู ููุฏุงุฑุด ุฑู ูโฺฏุฑู.
2. ุงุฎุทุงุฑ ุชุจุฏู ููุน ุฏุงุฏู (Type Conversion)
 * ูพุบุงู ุฎุทุง: possible loss of data due to type conversion from 'long' to 'datetime'
 * ูุงู ู ุฎุท: TimeHelper.mqhุ ุฎุทูุท 63 ู 64
ฺุฑุง ุงู ุงุฎุทุงุฑ ุฑู ูุฏูุ
ุงูุง ููุท ุงุฎุทุงุฑูุ ูู ุฎุทุง. ฺฉููพุงูุฑ ุฎู ูุณูุงุณู ู ุฏุงุฑู ูฺฏู ุฏุงุฑ ู ุนุฏุฏ ุงุฒ ููุน long ุฑู ุจุง ู ุนุฏุฏ ุงุฒ ููุน datetime ุฌูุน ูโฺฉู ู ูุชุฌู ุฑู ุชู ู datetime ูโุฑุฒ. ฺูู ูุฑ ุฏูุชุงุดูู ุฏุฑ ุงุตู long ูุณุชูุ ุงูุฌุง ูฺ ูุดฺฉู ูพุด ููุงุฏุ ูู ฺฉููพุงูุฑ ุฏุงุฑู ูฺฏู "ูุทูุฆูุ!".
ฺุทูุฑ ุญูุด ฺฉููุ
ุจุงุฏ ุฎู ุตุฑุญ ุจู ฺฉููพุงูุฑ ุจฺฏ "ุขุฑูุ ูุทูุฆูู! ููู ฺฉุงุฑู ุจฺฉู." ุจู ุงู ฺฉุงุฑ ูฺฏู Type Casting.
 * ูุงู TimeHelper.mqh ุฑู ุจุงุฒ ฺฉู.
 * ุฎุท 63 ู 64 ฺฉู ุงู ุดฺฉูู:
   startTime = gmt_start_time + server_gmt_offset;  // ุชูุธู ุฒูุงู ูุญู ุดุฑูุน
endTime = gmt_end_time + server_gmt_offset;  // ุชูุธู ุฒูุงู ูุญู ูพุงุงู

   ุฑู ุจู ุงู ุดฺฉู ุชุบุฑ ุจุฏู:
   startTime = (datetime)(gmt_start_time + server_gmt_offset);  // ุชูุธู ุฒูุงู ูุญู ุดุฑูุน
endTime = (datetime)(gmt_end_time + server_gmt_offset);  // ุชูุธู ุฒูุงู ูุญู ูพุงุงู

   ุจุง ุงุถุงูู ฺฉุฑุฏู (datetime)ุ ุฏูู ฺฉููพุงูุฑ ุฑู ูโุจูุฏู!
3. ุงุฎุทุงุฑ ุชุนุฑู ูุชุบุฑ ุฏุฑ case
 * ูพุบุงู ุฎุทุง: initialization of variable skipped by 'case' label, use { }
 * ูุงู ู ุฎุท: CRange.mqh (ุฎุทูุท 317, 318) ู CActiveTradeManager.mqh (ุฎุทูุท 103, 104, 105)
ฺุฑุง ุงู ุงุฎุทุงุฑ ุฑู ูุฏูุ
ุงู ู ูุงููู ุชู MQL5 (ู C++) ูุณุช. ููุช ุชู ู case ุงุฒ ุฏุณุชูุฑ switch ู ูุชุบุฑ ุฌุฏุฏ ุชุนุฑู ู ููููุฌุง ููุฏุงุฑุฏู ูโฺฉูุ ฺฉููพุงูุฑ ูุงุท ูโฺฉูู. ุจุฑุง ุญู ุงู ูุดฺฉูุ ุจุงุฏ ฺฉู ุฏุณุชูุฑุงุช ุงูู case ุฑู ุจุฐุงุฑ ุฏุงุฎู ุขฺฉููุงุฏ ุจุงุฒ ู ุจุณุชู {}.
ฺุทูุฑ ุญูุด ฺฉููุ
 * ุฏุฑ ูุงู CRange.mqhุ case RANGE_IDLE ุฑู ูพุฏุง ฺฉู ู ุจู ุงู ุดฺฉู ุชุบุฑุด ุจุฏู:
   case RANGE_IDLE:  // ุญุงูุช ุจฺฉุงุฑ
{ // <-- ุขฺฉููุงุฏ ุจุงุฒ ุงูุฌุง ุงุถุงูู ฺฉู
    // ฺฺฉ ุงฺฏุฑ ุฒูุงู ูุงุฑุฏ ูุญุฏูุฏู ุฑูุฌ ุดุฏู ุจุงุดุฏ
    datetime currentTime = TimeCurrent();  // ุฒูุงู ูุนู
    datetime startTime, endTime;  // ุฒูุงู ุดุฑูุน ู ูพุงุงู
    if(CTimeHelper::CalculateRangeTimes(m_startHour, m_startMinute, m_endHour, m_endMinute, startTime, endTime))  // ูุญุงุณุจู ุฒูุงูโูุง
    {
       if(currentTime >= startTime && currentTime < endTime)  // ฺฺฉ ุฏุงุฎู ูุญุฏูุฏู
       {
          CLogger::Log("ุฒูุงู ุฑูุฌ ูุฑุง ุฑุณุฏ. ุงูุชูุงู ุจู RANGE_IDENTIFYING.", m_rangeIndex);  // ูุงฺฏ ุงูุชูุงู
          m_currentState = RANGE_IDENTIFYING;  // ุชุบุฑ ุจู ุดูุงุณุง
       }
    }
    break;  // ุฎุฑูุฌ ุงุฒ ฺฉุณ
} // <-- ุขฺฉููุงุฏ ุจุณุชู ุงูุฌุง ุงุถุงูู ฺฉู

 * ุฏุฑ ูุงู CActiveTradeManager.mqhุ case TRADE_PARTIAL_CLOSE ุฑู ูพุฏุง ฺฉู ู ููู ฺฉุงุฑ ุฑู ุจุฑุงุด ุจฺฉู:
   case TRADE_PARTIAL_CLOSE:  // ูุฑุญูู ูพููโุง
{ // <-- ุขฺฉููุงุฏ ุจุงุฒ ุงูุฌุง ุงุถุงูู ฺฉู
    double currentPrice = PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY ? SymbolInfoDouble(_Symbol, SYMBOL_BID) : SymbolInfoDouble(_Symbol, SYMBOL_ASK);  // ููุช ูุนู
    double currentProfit = (PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY ? (currentPrice - trade.entryPrice) : (trade.entryPrice - currentPrice));  // ุณูุฏ ููุช
    double targetProfit = trade.initialSlDistance * trade.rrRatio;  // ูุฏู ุณูุฏ
    if(currentProfit >= targetProfit)  // ฺฺฉ ุฑุณุฏู
    {
       double volume = PositionGetDouble(POSITION_VOLUME);  // ุญุฌู ูุนู
       double closeVolume = MathFloor((volume * trade.partialClosePercent / 100.0) / g_volumeStep) * g_volumeStep;  // ุญุฌู ูพููโุง
       if(closeVolume >= g_volumeMin && closeVolume < volume)  // ฺฺฉ ูุนุชุจุฑ
       {
          if(CTradeManager::PartialClose(trade.ticket, closeVolume))  // ุจุณุชู ูพููโุง
          {
             trade.isPartialClosed = true;  // ุชูุธู ููฺฏ
             trade.currentState = TRADE_RISK_FREE;  // ุงูุชูุงู ุจู ุฑุณฺฉ-ูุฑ
             CLogger::Log("ุฎุฑูุฌ ูพููโุง ุงูุฌุงู ุดุฏ. ุงูุชูุงู ุจู RISK_FREE.", trade.rangeIndex);  // ูุงฺฏ ุงูุชูุงู
          }
       }
    }
    break;
} // <-- ุขฺฉููุงุฏ ุจุณุชู ุงูุฌุง ุงุถุงูู ฺฉู

4. ุฎุทุง ุงุณุชูุงุฏู ุงุฒ ุฑูุฑูุณ (&)
 * ูพุบุงู ุฎุทุง: '&' - reference cannot used
 * ูุงู ู ุฎุท: CActiveTradeManager.mqhุ ุฎุทูุท 63 ู 88
ฺุฑุง ุงู ุฎุทุง ุฑู ูุฏูุ
ุงูุฌุง MQL5 ุฏุงุฑู ฺฏุฑ ูโุฏู ฺูู ุขุฑุงู m_managedTrades ู ุขุฑุงู ุฏุงูุงูฺฉู ู ููฺฉูู ุจุง ArrayResize ุฌุงุจุฌุง ุจุดู. ุจู ููู ุฎุงุทุฑ ุงุฌุงุฒู ููโุฏู ุจู ฺฉ ุงุฒ ุฎุงููโูุง ุงู ุขุฑุงู ฺฉ ุฑูุฑูุณ (reference) ุง ูุงู ูุณุชุนุงุฑ (&) ุงุฎุชุตุงุต ุจุฏ. ูฺฏู ุฎุทุฑูุงฺฉู!
ฺุทูุฑ ุญูุด ฺฉููุ
ุฎู ุณุงุฏูุ ุจโุฎุงู ุฑูุฑูุณ ุดู ู ูุณุชูู ุจุง ุฎูุฏ ุขุฑุงู ฺฉุงุฑ ฺฉู.
 * ูุงู CActiveTradeManager.mqh ุฑู ุจุงุฒ ฺฉู.
 * ุฏุฑ ุชุงุจุน RegisterTradeุ ุฎุท 63 ุฑู ฺฉู ุงู ุดฺฉูู:
   ManagedTrade &trade = m_managedTrades[size];  // ูุฑุฌุน ุจู ุขุฎุฑู

   ฺฉูุง ูพุงฺฉ ฺฉู! ู ุจุนุฏุด ูุฑ ุฌุง ููุดุชู trade.ุ ุจู ุฌุงุด ุจููุณ m_managedTrades[size].. ุนู ุงูุฌูุฑ ูโุดู:
   // ManagedTrade &trade = m_managedTrades[size];  // ุงู ุฎุท ุฑู ูพุงฺฉ ฺฉู
m_managedTrades[size].ticket = ticket;  // ุชูุธู ุชฺฉุช
m_managedTrades[size].magicNumber = magicNumber;  // ุชูุธู ูุฌฺฉ
// ... ู ุจุฑุง ุจูู ูู ูููุทูุฑ

 * ุฏุฑ ุชุงุจุน ManageAllTradesุ ููู ฺฉุงุฑ ุฑู ุจุฑุง ุฎุท 88 ุชฺฉุฑุงุฑ ฺฉู. ุฎุท ุฒุฑ ุฑู:
   ManagedTrade &trade = m_managedTrades[i];  // ูุฑุฌุน ูุนุงููู

   ฺฉูุง ูพุงฺฉ ฺฉู! ู ูุฑ ุฌุง ุชู ุญููู for ููุดุชู trade.ุ ุจู ุฌุงุด ุจููุณ m_managedTrades[i].. ูุซูุง:
   // ... ุฏุงุฎู ุญููู for
// ManagedTrade &trade = m_managedTrades[i];  // ุงู ุฎุท ุฑู ูพุงฺฉ ฺฉู
if(!PositionSelectByTicket(m_managedTrades[i].ticket))  // ฺฺฉ ุจุงุฒ ุจูุฏู
{
   // ...
}
// ... ู ุจุฑุง ุจูู ูู ูููุทูุฑ

ูููุง ุจูุฏ ุฑูู. ุงู ุชุบุฑุงุช ุฑู ฺฉู ุจุฏุ ฺฉุฏ ุตุงู ู ุจุฏูู ุงุฎุทุงุฑ ฺฉุงููพุงู ูโุดู. ุจุฑู ุจุชุฑฺฉูู! ุงฺฏู ุจุงุฒู ุฌุง ฺฏุฑ ฺฉุฑุฏุ ูู ูููุฌุงู. ๐



cannot access to private member 'm_trailingAtrHandle' declared in class 'CRange'	Elemento.mq5	257	29
   see declaration of variable 'CRange::m_trailingAtrHandle'	CRange.mqh	75	8
possible loss of data due to type conversion from 'long' to 'datetime'	TimeHelper.mqh	63	17
possible loss of data due to type conversion from 'long' to 'datetime'	TimeHelper.mqh	64	15
initialization of variable skipped by 'case' label, use { }	CRange.mqh	317	19
initialization of variable skipped by 'case' label, use { }	CRange.mqh	318	19
'&' - reference cannot used	CActiveTradeManager.mqh	63	20
'&' - reference cannot used	CActiveTradeManager.mqh	88	23
initialization of variable skipped by 'case' label, use { }	CActiveTradeManager.mqh	103	23
initialization of variable skipped by 'case' label, use { }	CActiveTradeManager.mqh	104	23
initialization of variable skipped by 'case' label, use { }	CActiveTradeManager.mqh	105	23











```mql5
//+------------------------------------------------------------------+
//|                                                     Settings.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ุงู ูุงู ุดุงูู ุชุนุฑู ุณุงุฎุชุงุฑูุง ูพุงูโุง ู ูพุงุฑุงูุชุฑูุง ูุฑูุฏ (inputs) ุจุฑุง ุงฺฉุณูพุฑุช Elemento ุงุณุช.
// ุงุณุชุฑุงุชฺ ฺฉู ุงฺฉุณูพุฑุช: Elemento ฺฉ ุณุณุชู ูุนุงููุงุช ูุจุชู ุจุฑ ุดฺฉุณุช ุฑูุฌ (Breakout Range) ุงุณุช ฺฉู ุจุฑ ุงุณุงุณ ุฒูุงูโูุง ูุดุฎุต (ุฑูุฌโูุง ุฒูุงู) ุนูู ูโฺฉูุฏ. 
// ุงู ุงฺฉุณูพุฑุช ุชุง ฺูุงุฑ ุฑูุฌ ุฒูุงู ูุฎุชูู ุฑุง ุชุนุฑู ูโฺฉูุฏุ ูุฑ ุฑูุฌ ุฑุง ุจุฑ ุงุณุงุณ ุงุฑุชูุงุน ููุช (High/Low) ุฏุฑ ุจุงุฒู ุฒูุงู ุชุนูโุดุฏู ุดูุงุณุง ูโฺฉูุฏุ 
// ุณูพุณ ููุชุธุฑ ุดฺฉุณุช (Breakout) ุณูู ุง ฺฉู ุฑูุฌ ุจุง ุงูุณุช (Offset) ูุจุชู ุจุฑ ATR ุง ุฏุฑุตุฏ ุงุฑุชูุงุน ุฑูุฌ ูโูุงูุฏ. 
// ูพุณ ุงุฒ ุดฺฉุณุชุ ุจุง ุชุฃุฏ ุงุฎุชุงุฑ ููุช (ฺฉูุฏู ุชุงุฏ) ู ููุชุฑ ุฑููุฏ ุงฺููฺฉูุ ูุนุงููู ุฎุฑุฏ ุง ูุฑูุด ุจุงุฒ ูโฺฉูุฏ. 
// ูุฏุฑุช ูุนุงููู ุดุงูู ุงุณุชุงูพ ูุงุณ (SL) ูุจุชู ุจุฑ ุงุณุชุฑุงุชฺ ุฌุงฺฏุฐุงุฑ (ููุงุจู ุฑูุฌ ุง ุณุทุญ ุดฺฉุณุช) ุจู ุนูุงูู ุชูุธู ATR ุง ุฏุฑุตุฏ 
// (ุจุฑุง ูพูุดุด ฺฉุงูู ุฑูุฌ ู ุฌููฺฏุฑ ุงุฒ ุฒุงู ุฒูุฏุฑุณ)ุ ุฎุฑูุฌ ูพููโุง (Partial Close) ุฏุฑ ุฑุณุฏู ุจู ูุณุจุช ูุดุฎุต ุณูุฏ ุจู ุฑุณฺฉ ุจุฏูู ุชุงุฑฺฏุช ฺฉู 
// (ุจุฑุง ุงุฌุงุฒู ุฏุงุฏู ุจู ุฑููุฏ ุงุฏุงููโุฏุงุฑ)ุ ู ุชุฑููฺฏ ุงุณุชุงูพ (Trailing Stop) ุจุฑุง ุญูุธ ุณูุฏ ุงุณุช. 
// ูพุงฺฉุณุงุฒ ุฑูุฌโูุง ูพุณ ุงุฒ ุงููุถุง ุง ุจุณุชู ุดุฏู ุจุงุฒุงุฑ ุงูุฌุงู ูโุดูุฏ ุชุง ุงุฒ ุชุฏุงุฎู ุฌููฺฏุฑ ุดูุฏ.
// ููุทู ูุงู Settings.mqh: ุงู ูุงู ูฺ ฺฉุฏ ุงุฌุฑุง ูุฏุงุฑุฏ ู ููุท enums ู ฺฏุฑููโูุง input ุฑุง ุชุนุฑู ูโฺฉูุฏ ุชุง ฺฉุงุฑุจุฑ ุจุชูุงูุฏ ูพุงุฑุงูุชุฑูุง ุฑุง ุชูุธู ฺฉูุฏ. 
// enums ุจุฑุง ุญุงูุชโูุง ูุฎุชูู (ูุงููุฏ PLACEMENT_MODE ุจุฑุง ุชุนู ุงูุณุช ุดฺฉุณุชุ SL_STRATEGY ุจุฑุง ุงุณุชุฑุงุชฺ ุฌุงฺฏุฐุงุฑ SLุ 
// SL_CALC_MODE ุจุฑุง ูุญุงุณุจู ุจุงูุฑ SLุ TRAILING_MODE ุจุฑุง ุชุฑููฺฏ) ุงุณุชูุงุฏู ูโุดููุฏ. 
// ฺฏุฑููโูุง input ุดุงูู ุชูุธูุงุช ุนููู (ุฑุณฺฉุ ุฏุจุงฺฏุ ุชุงุฏ ููุช)ุ ููุชุฑ ุงฺููฺฉู (ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุนุงููุงุช ุฎูุงู ุฑููุฏ)ุ 
// ููุงุดฺฏุฑ ฺุงุฑุช (ุจุฑุง ูุดุงู ุฏุงุฏู ูุถุนุช ุฑููุฏ ูุฑ ุฑูุฌ ุจู ุทูุฑ ุฌุฏุงฺฏุงูู)ุ ู ุชูุธูุงุช ฺูุงุฑ ุฑูุฌ ุฌุฏุงฺฏุงูู (ูุฑ ุฑูุฌ ูโุชูุงูุฏ ุชุงูโูุฑูุ ุณุงุนุงุชุ 
// ุญุฏุงูู/ุญุฏุงฺฉุซุฑ ุงุฑุชูุงุนุ ุฏูุฑูโูุง ATRุ ุถุฑุงุจุ ูุณุจุช R:Rุ ุฏุฑุตุฏ ุฎุฑูุฌ ูพููโุงุ ุณุงุนุช ูพุงฺฉุณุงุฒ ู ุฑูฺฏ ุฏุงุดุชู ุจุงุดุฏ) ุงุณุช. 
// ุงู ุณุงุฎุชุงุฑ ุงุฌุงุฒู ูโุฏูุฏ ุงฺฉุณูพุฑุช ุจุฑุง ุจุงุฒุงุฑูุง ูุฎุชูู (ูุงููุฏ ูุงุฑฺฉุณ ุง ุดุงุฎุตโูุง) ุณูุงุฑุดโุณุงุฒ ุดูุฏ ู ุงุณุชุฑุงุชฺ ุดฺฉุณุช ุฑูุฌ ุฑุง ุจุง ููุชุฑ ุฑููุฏ ุชุฑฺฉุจ ฺฉูุฏ 
// ุชุง ุณฺฏูุงูโูุง ูุนุชุจุฑุชุฑ ุชููุฏ ุดูุฏ. ูุงู ุชูุณุท ุณุงุฑ ูุงูโูุง include ูโุดูุฏ ุชุง ุจู inputs ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏ. 
// ุชุบุฑุงุช ุฌุฏุฏ ุฏุฑ ูุณุฎู 2.10: ุจูโุฑูุฒุฑุณุงู ฺฉุงููุชโูุง ุจุฑุง ุฏูุช ุจุดุชุฑุ ุจุฏูู ุชุบุฑ ุฏุฑ enums ุง inputsุ ุงูุง ุงุถุงูู ุดุฏู ุชูุถุญุงุช ุฏููโุชุฑ ุจุฑุง ูุฑ ูพุงุฑุงูุชุฑ 
// ุจู ููุธูุฑ ุฑุงูููุง ุจูุชุฑ ฺฉุงุฑุจุฑ ุฏุฑ ุชูุธูุงุช. ูฺ ุชุบุฑ ุงุนูุงู ูุดุฏู ุฒุฑุง ุจูููพุฑูุช ุชุบุฑ ุฏุฑ ุงู ูุงู ูุดุฎุต ูฺฉุฑุฏู.

#ifndef SETTINGS_MQH  // ฺฺฉ ูุฌูุฏ ูุงู ุจุฑุง ุฌููฺฏุฑ ุงุฒ include ูฺฉุฑุฑ
#define SETTINGS_MQH  // ุชุนุฑู ูุงฺฉุฑู ุจุฑุง ุฌููฺฏุฑ ุงุฒ include ูุฌุฏุฏ

// ุชุนุฑู enum ุจุฑุง ุญุงูุชโูุง ูุฎุชูู ูุฑุงุฑฺฏุฑ ุณูุงุฑุด (ุชุนู ุงูุณุช ุดฺฉุณุช ุฑูุฌ ุจุง ATR ุง ุฏุฑุตุฏ ุงุฑุชูุงุน ุฑูุฌ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุดฺฉุณุชโูุง ฺฉุงุฐุจ)
// ุงู enum ุงุฌุงุฒู ูโุฏูุฏ ฺฉุงุฑุจุฑ ุจู ูุญุงุณุจู ูพูุง (ATR) ุง ุซุงุจุช (ุฏุฑุตุฏ) ุจุฑุง ุงูุณุช ุดฺฉุณุช ุงูุชุฎุงุจ ฺฉูุฏ
enum ENUM_PLACEMENT_MODE
{
   PLACEMENT_ATR,    // ุงุณุชูุงุฏู ุงุฒ ATR ุจุฑุง ูุญุงุณุจู ุงูุณุช ุซุจุช ุณูุงุฑุด (ูพูุง ุจุฑ ุงุณุงุณ ููุณุงู ุจุงุฒุงุฑุ ููุงุณุจ ุจุฑุง ุจุงุฒุงุฑูุง ูุชุบุฑ)
   PLACEMENT_PERCENT // ุงุณุชูุงุฏู ุงุฒ ุฏุฑุตุฏ ุงุฑุชูุงุน ุฑูุฌ ุจุฑุง ูุญุงุณุจู ุงูุณุช ุซุจุช ุณูุงุฑุด (ุซุงุจุช ุจุฑ ุงุณุงุณ ุงูุฏุงุฒู ุฑูุฌุ ููุงุณุจ ุจุฑุง ุฑูุฌโูุง ูพุงุฏุงุฑ)
};

// ุชุนุฑู enum ุจุฑุง ุงุณุชุฑุงุชฺ ุฌุงฺฏุฐุงุฑ ุงุณุชุงูพ ูุงุณ (ุชุนู ูพุงู SL: ููุงุจู ุฑูุฌ ุง ุณุทุญ ุดฺฉุณุช)
// ุงู enum ุจู ฺฉุงุฑุจุฑ ุงุฌุงุฒู ูโุฏูุฏ ุจู ุงุณุชุฑุงุชฺ ูุญุงูุธูโฺฉุงุฑุงูู (ููุงุจู ุฑูุฌ) ุง ุชูุงุฌู (ุณุทุญ ุดฺฉุณุช) ุงูุชุฎุงุจ ฺฉูุฏ
enum ENUM_SL_STRATEGY
{
   SL_OPPOSITE_SIDE,  // ุงุณุชุงูพ ูุงุณ ุฏุฑ ุณูุช ููุงุจู ุฑูุฌ (ูุจู: ุจุฑุง BUY ุฏุฑ ฺฉู - ุจุงูุฑุ ุจุฑุง SELL ุฏุฑ ุณูู + ุจุงูุฑุ ูุญุงูุธูโฺฉุงุฑุงููโุชุฑ)
   SL_BREAKOUT_LEVEL  // ุงุณุชุงูพ ูุงุณ ุฏุฑ ุณุทุญ ุดฺฉุณุช (ุฌุฏุฏ: ุจุฑุง BUY ุฏุฑ ุณูู - ุจุงูุฑุ ุจุฑุง SELL ุฏุฑ ฺฉู + ุจุงูุฑุ ุฑุณฺฉ ุจุงูุงุชุฑ ุงูุง ุณูุฏ ุจุงูููู ุจุดุชุฑ)
};

// ุชุนุฑู enum ุจุฑุง ุญุงูุช ูุญุงุณุจู ุจุงูุฑ ุงุณุชุงูพ ูุงุณ (ุชุนู ูุงุตูู ุจุงูุฑ SL ุจุง ATR ุง ุฏุฑุตุฏ ุงุฑุชูุงุน ุฑูุฌ)
// ุงู enum ุจุฑุง ุชุทุจู ุจุงูุฑ SL ุจุง ููุณุงู ุง ุงูุฏุงุฒู ุฑูุฌ ุงุณุชูุงุฏู ูโุดูุฏ
enum ENUM_SL_CALC_MODE
{
   SL_CALC_ATR,    // ุงุณุชูุงุฏู ุงุฒ ATR ุจุฑุง ูุญุงุณุจู ุจุงูุฑ ุงุณุชุงูพ ูุงุณ (ูพูุง ู ุชุทุจู ุจุง ููุณุงู ุจุงุฒุงุฑุ ุชูุตูโุดุฏู)
   SL_CALC_PERCENT // ุงุณุชูุงุฏู ุงุฒ ุฏุฑุตุฏ ุงุฑุชูุงุน ุฑูุฌ ุจุฑุง ูุญุงุณุจู ุจุงูุฑ ุงุณุชุงูพ ูุงุณ (ุซุงุจุช ู ุณุงุฏูุ ุจุฑุง ุฑูุฌโูุง ฺฉูฺฺฉ)
};

// ุชุนุฑู enum ุจุฑุง ุญุงูุชโูุง ุชุฑููฺฏ ุงุณุชุงูพ (ุชุนู ูุงุตูู ุชุฑููฺฏ ุจุง ATR ุง Senkou Span B ุจุฑุง ุญูุธ ุณูุฏ)
// ุงู enum ฺฏุฒููโูุง ูพูุง (ATR) ุง ูุจุชู ุจุฑ ุงุจุฑ ุงฺููฺฉู (Senkou B) ุฑุง ูุฑุงูู ูโฺฉูุฏ
enum ENUM_TRAILING_MODE
{
   TRAILING_ATR,   // ุงุณุชูุงุฏู ุงุฒ ATR ุจุฑุง ูุญุงุณุจู ูุงุตูู ุชุฑููฺฏ ุงุณุชุงูพ (ูพูุง ู ูุจุชู ุจุฑ ููุณุงู ุงุฎุฑ)
   TRAILING_ICHIMOKU_B  // ุงุณุชูุงุฏู ุงุฒ Senkou Span B ุจุฑุง ุชุฑููฺฏ ุงุณุชุงูพ (ุจุฑ ุงุณุงุณ ุงุจุฑ ุงฺููฺฉูุ ุจุฑุง ุฑููุฏูุง ุจููุฏูุฏุช)
};

// (ุฌุฏุฏ) ุชุนุฑู enum ุจุฑุง ุงุณุชุฑุงุชฺ ุงุจุทุงู ุชูุงุด ุจุฑุง ูุฑูุฏ (ุงูุชุฎุงุจ ุจู ุญุงูุช ุตุจูุฑ ุง ุชูุงุฌู ุจุฑุง ุงุจุทุงู ูุฑุตุช ูุฑูุฏ)
// ุงู enum ุงูุนุทุงูโูพุฐุฑ ุฏุฑ ุฑูุชุงุฑ ุงุจุทุงู ุณฺฏูุงู ุฑุง ุงูุฒุงุด ูโุฏูุฏ
enum ENUM_INVALIDATION_MODE
{
   INVALIDATION_RANGE_REENTRY,     // ุญุงูุช ุตุจูุฑ: ูุฑุตุช ูุฑูุฏ ููุท ุฏุฑ ุตูุฑุช ุจุงุฒฺฏุดุช ููุช ุจู ุฏุงุฎู ุฑูุฌ ุงุตู ุจุงุทู ูโุดูุฏ (ูุฑุตุชโูุง ุจุดุชุฑ)
   INVALIDATION_BREAKOUT_LINE_CROSS  // ุญุงูุช ุชูุงุฌู: ูุฑุตุช ูุฑูุฏ ุจู ูุญุถ ุจุงุฒฺฏุดุช ููุช ุจู ุฒุฑ ุฎุท ุดฺฉุณุช ุจุงุทู ูโุดูุฏ (ุฑุณฺฉ ฺฉูุชุฑ)
};

// (ุฌุฏุฏ) ุชุนุฑู enum ุจุฑุง ุงุณุชุฑุงุชฺ ุชุงุฏ/ุงุจุทุงู (ุงูุชุฎุงุจ ุจู ุญุงูุช ูุฏู ุจุง ุชุงูุฑ ฺฉูุฏู ู ุฌุฏุฏ ุจุง ุงุจุทุงู ููุช)
// ุงู enum ุจู ฺฉุงุฑุจุฑ ุงุฌุงุฒู ูโุฏูุฏ ุจู ุฑูฺฉุฑุฏ ุฒูุงู ุง ููุช ุงูุชุฎุงุจ ฺฉูุฏ
enum ENUM_CONFIRMATION_STRATEGY
{
   CONFIRMATION_TIMEOUT,           // ุญุงูุช ูุฏู: ูููุช ุชุงุฏ ุจุง ุชุนุฏุงุฏ ฺฉูุฏู (Inp_Confirmation_Timeoutุ ูุญุฏูุฏฺฉููุฏู)
   CONFIRMATION_PRICE_INVALIDATION // ุญุงูุช ุฌุฏุฏ: ุงุจุทุงู ุจุฑ ุงุณุงุณ ุจุงุฒฺฏุดุช ููุช ุจุฏูู ูุญุฏูุฏุช ุฒูุงู (ุงูุนุทุงูโูพุฐุฑุชุฑ)
};

// ฺฏุฑูู ูุฑูุฏ ุจุฑุง ุชูุธูุงุช ุนููู (ูพุงุฑุงูุชุฑูุง ูพุงูโุง ฺฉู ุจุฑ ุชูุงู ุฑูุฌโูุง ุชุฃุซุฑ ูโฺฏุฐุงุฑูุฏ)
// ุงู ฺฏุฑูู ุดุงูู ุชูุธูุงุช ุฑุณฺฉุ ุฏุจุงฺฏ ู ุงุณุชุฑุงุชฺโูุง ุนููู ุงุณุช
input group "ุชูุธูุงุช ุนููู"  // ุนููุงู ฺฏุฑูู ุฏุฑ ุชูุธูุงุช MT5
input long InpBaseMagicNumber = 123456; // ูุฌฺฉ ูุงูุจุฑ ูพุงู (ุจุฑุง ุชูุงุฒ ูุนุงููุงุช ุฑูุฌโูุง ูุฎุชูู ู ุฌููฺฏุฑ ุงุฒ ุชุฏุงุฎู ุจุง ุฏฺฏุฑ ุงฺฉุณูพุฑุชโูุงุ ููุญุตุฑุจูโูุฑุฏ ุจุงุดุฏ)
input double InpRiskPercent = 1.0; // ุฏุฑุตุฏ ุฑุณฺฉ (0.1 ุชุง 5.0) - ููุฏุงุฑ ุฑุณฺฉ ูุฑ ูุนุงููู ุจุฑ ุงุณุงุณ ููุฌูุฏ ุญุณุงุจ ุจุฑุง ฺฉูุชุฑู ุฒุงู ฺฉู (ุชูุตู: 1-2%)
input bool InpDebugMode = true; // ุญุงูุช ุฏุจุงฺฏ (ฺุงูพ ูพุงูโูุง ุงุถุงู ุจุฑุง ุนุจโุงุจ ู ูุธุงุฑุช ุจุฑ ุนููฺฉุฑุฏ ุงฺฉุณูพุฑุชุ ุฎุงููุด ุจุฑุง ูุงู)
// (ุฌุฏุฏ) ุงูุชุฎุงุจโฺฏุฑ ุงุณุชุฑุงุชฺ ุงุจุทุงู ุชูุงุด ูุฑูุฏ (ุจุฑุง ุงูุนุทุงูโูพุฐุฑ ุฏุฑ ุฑูุชุงุฑ ุงฺฉุณูพุฑุช: ุตุจูุฑ ุง ุชูุงุฌู)
input ENUM_INVALIDATION_MODE Inp_Invalidation_Mode = INVALIDATION_RANGE_REENTRY; // ุงุณุชุฑุงุชฺ ุงุจุทุงู: ุจุงุฒฺฏุดุช ุจู ุฑูุฌ (ุตุจูุฑุ ูุฑุตุช ุจุดุชุฑ) ุง ุนุจูุฑ ุงุฒ ุฎุท ุดฺฉุณุช (ุชูุงุฌูุ ุงููโุชุฑ)
// (ุฌุฏุฏ) ุงูุชุฎุงุจโฺฏุฑ ุงุณุชุฑุงุชฺ ุชุงุฏ/ุงุจุทุงู (ุงูุชุฎุงุจ ุจู ูุฏู ุจุง ุชุงูุฑ ู ุฌุฏุฏ ุจุง ููุช)
input ENUM_CONFIRMATION_STRATEGY Inp_Confirmation_Strategy = CONFIRMATION_PRICE_INVALIDATION; // ุงุณุชุฑุงุชฺ ุชุงุฏ: ุชุงูุฑ ฺฉูุฏู (ูุฏูุ ูุญุฏูุฏ) ุง ุงุจุทุงู ููุช (ุฌุฏุฏุ ุงูุนุทุงูโูพุฐุฑ)
input int Inp_Confirmation_Timeout = 3; // ูููุช ุชุฃุฏ ููุช ู ููุชุฑ (ุชุนุฏุงุฏ ฺฉูุฏู) - ููุท ุงฺฏุฑ CONFIRMATION_TIMEOUT ุงูุชุฎุงุจ ุดูุฏ (1-10 ุชูุตูโุดุฏู)
input bool Inp_PriceConfirmation_Enabled = true; // ูุนุงู ฺฉุฑุฏู ุชุฃุฏ ููุช ูพุณ ุงุฒ ฺฉูุฏู ุดฺฉููุฏู (ุงฺฏุฑ ุฎุงููุด ุจุงุดุฏุ ูุณุชูู ุจู ููุชุฑ ุฑููุฏ ูโุฑูุฏ ุง ูุฑูุฏุ ุจุฑุง ุณุฑุนุช ุจุดุชุฑ)

// ฺฏุฑูู ูุฑูุฏ ุจุฑุง ููุชุฑ ุฑููุฏ ุงฺููฺฉู (ุจุฑุง ุงุทููุงู ุงุฒ ูุนุงููู ุฏุฑ ุฌูุช ุฑููุฏ ุง ุฎูุซ ู ุฌููฺฏุฑ ุงุฒ ูุนุงููุงุช ุฎูุงู ุฑููุฏ)
// ุงู ฺฏุฑูู ูพุงุฑุงูุชุฑูุง ุงฺููฺฉู ุฑุง ุจุฑุง ููุชุฑ ุฏูุงูฺฉ ุชูุธู ูโฺฉูุฏ
input group "ููุชุฑ ุฑููุฏ ุงฺููฺฉู"  // ุนููุงู ฺฏุฑูู
input bool Inp_IchimokuFilter_Enabled = true; // ูุนุงู ฺฉุฑุฏู ููุชุฑ ุฑููุฏ ุงฺููฺฉู (ุงฺฏุฑ ุฎุงููุด ุจุงุดุฏุ ููุดู ุฎูุซ ูุฑุถ ูโุดูุฏ ู ููู ุณฺฏูุงูโูุง ูุฌุงุฒ)
input int Inp_Ichimoku_Tenkan = 9; // ุฏูุฑู ุชูฺฉุงู-ุณู (ุฎุท ุณุฑุน ุงฺููฺฉู ุจุฑุง ุชุดุฎุต ุฑููุฏ ฺฉูุชุงูโูุฏุชุ ูพุดโูุฑุถ ุงุณุชุงูุฏุงุฑุฏ)
input int Inp_Ichimoku_Kijun = 26; // ุฏูุฑู ฺฉุฌูู-ุณู (ุฎุท ฺฉูุฏ ุงฺููฺฉู ุจุฑุง ุชุดุฎุต ุฑููุฏ ูุงูโูุฏุชุ ูพุดโูุฑุถ ุงุณุชุงูุฏุงุฑุฏ)
input int Inp_Ichimoku_SenkouB = 52; // ุฏูุฑู ุณูฺฉู ุงุณูพู B (ุงุจุฑ ุงฺููฺฉู ุจุฑุง ุชุดุฎุต ุญูุงุช/ููุงููุช ุขูุฏูุ ูพุดโูุฑุถ ุงุณุชุงูุฏุงุฑุฏ)
input int Inp_Ichimoku_FlatThreshold_Points = 90; // ุขุณุชุงูู ุชุดุฎุต ุงุจุฑ ููุช ุจู ูพููุช (ุจุฑุง ุชุนู ุฑููุฏ ุฎูุซ ุงฺฏุฑ ุชูุงูุช ุณูฺฉู A ู B ฺฉูุชุฑ ุจุงุดุฏุ ุจุฑ ุงุณุงุณ ููุงุฏ ุชูุธู ุดูุฏ)

// ฺฏุฑูู ูุฑูุฏ ุจุฑุง ุชูุธูุงุช ููุงุดฺฏุฑ ฺุงุฑุช (ุจุฑุง ููุงุด ุจุตุฑ ูุถุนุช ุฑููุฏ ูุฑ ุฑูุฌ ุจู ุทูุฑ ุฌุฏุงฺฏุงูู ุฑู ฺุงุฑุช ุจู ฺฉุงุฑุจุฑ)
// ุงู ฺฏุฑูู ุจุฑุง ูุธุงุฑุช ุจุตุฑ ฺฉุงุฑุจุฑ ุงุณุช ู ุนููฺฉุฑุฏ ุฑุง ุชุญุช ุชุฃุซุฑ ูุฑุงุฑ ููโุฏูุฏ
input group "ุชูุธูุงุช ููุงุดฺฏุฑ ฺุงุฑุช"  // ุนููุงู ฺฏุฑูู
input bool Inp_Visual_ShowTrendStatus = true; // ูุนุงู ฺฉุฑุฏู ููุงุด ูุถุนุช ุฑููุฏ (ุฑู ฺุงุฑุช ุจุฑุง ูุธุงุฑุช ุจุตุฑ ูุฑ ุฑูุฌุ ุฎุงููุด ุจุฑุง ฺุงุฑุช ุชูุฒุชุฑ)
input int Inp_Visual_FontSize = 12; // ุงูุฏุงุฒู ูููุช ููุงุดฺฏุฑ (ุจุฑุง ุฎูุงูุง ุจูุชุฑุ 8-16 ููุงุณุจ)
input color Inp_Visual_FontColor_Buy = clrGreen; // ุฑูฺฏ ูุชู ุจุฑุง ุฑููุฏ BUY (ุณุจุฒ ุจุฑุง ูุซุจุชุ ูุงุจู ุชุบุฑ)
input color Inp_Visual_FontColor_Sell = clrRed; // ุฑูฺฏ ูุชู ุจุฑุง ุฑููุฏ SELL (ูุฑูุฒ ุจุฑุง ูููุ ูุงุจู ุชุบุฑ)
input color Inp_Visual_FontColor_Neutral = clrGray; // ุฑูฺฏ ูุชู ุจุฑุง ุฑููุฏ NEUTRAL (ุฎุงฺฉุณุชุฑ ุจุฑุง ุฎูุซุ ูุงุจู ุชุบุฑ)
input int Inp_Visual_X_Offset = 10; // ูุงุตูู ุงูู ุงุฒ ูุจู ฺุงุฑุช (ูพฺฉุณู ุจุฑุง ูููุนุช ููุงุณุจุ 0-50)
input int Inp_Visual_Y_Offset = 10; // ูุงุตูู ุนููุฏ ุงุฒ ูุจู ฺุงุฑุช (ูพฺฉุณู ุจุฑุง ูููุนุช ููุงุณุจุ 0-50)

// ฺฏุฑูู ูุฑูุฏ ุจุฑุง ุชูุธูุงุช ุฑูุฌ 1 (ุงููู ุฑูุฌ ุฒูุงูุ ูุนูููุงู ุจุฑุง ุณุดู ุขุณุง ุง ุดุจุงูู)
// ุงู ฺฏุฑูู ูพุงุฑุงูุชุฑูุง ุงุฎุชุตุงุต ุฑูุฌ 1 ุฑุง ุดุงูู ูโุดูุฏ
input group "ุชูุธูุงุช ุฑูุฌ 1"  // ุนููุงู ฺฏุฑูู
input bool InpRange1_Enabled = true; // ูุนุงู ฺฉุฑุฏู ุฑูุฌ 1 (ุงฺฏุฑ ุฎุงููุด ุจุงุดุฏุ ุงู ุฑูุฌ ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ ู ููุงุจุน ุตุฑููโุฌู ูโุดูุฏ)
input ENUM_TIMEFRAMES InpRange1_Execution_Timeframe = PERIOD_M5; // ุชุงูโูุฑู ุงุฌุฑุง ุฑูุฌ 1 (ุจุฑุง ุงุฌุฑุง ููุทู ุฑูุฌ ู ูุญุงุณุจุงุชุ M1-M30 ุชูุตูโุดุฏู)
input ENUM_TIMEFRAMES InpRange1_TrendFilter_Timeframe = PERIOD_H1; // ุชุงูโูุฑู ููุชุฑ ุฑููุฏ ุฑูุฌ 1 (ุจุฑุง ููุชุฑ ุงฺููฺฉูุ ูโุชูุงูุฏ ูุชูุงูุช ุจุงุดุฏุ H1-H4 ููุงุณุจ)
input int InpRange1_Start_Hour = 22; // ุณุงุนุช ุดุฑูุน ุฑูุฌ 1 (0-23 ุจุฑุง ุชุนุฑู ุจุงุฒู ุฒูุงูุ ุจุฑ ุงุณุงุณ GMT ุณุฑูุฑ)
input int InpRange1_Start_Minute = 0; // ุฏููู ุดุฑูุน ุฑูุฌ 1 (0-59 ุจุฑุง ุฏูุช ุฒูุงูุ 0 ุจุฑุง ุดุฑูุน ุณุงุนุช)
input int InpRange1_End_Hour = 9; // ุณุงุนุช ูพุงุงู ุฑูุฌ 1 (0-23ุ ุงฺฏุฑ ฺฉูุชุฑ ุงุฒ ุดุฑูุน ุจุงุดุฏุ ุฑูุฌ ุดุจุงูู ูุฑุถ ูโุดูุฏ)
input int InpRange1_End_Minute = 30; // ุฏููู ูพุงุงู ุฑูุฌ 1 (0-59ุ ุจุฑุง ูพุงุงู ุฏูู)
input int InpRange1_MinRangePoints = 200; // ุญุฏุงูู ุงุฑุชูุงุน ุฑูุฌ 1 ุจู ูพููุช (ุจุฑุง ููุชุฑ ุฑูุฌโูุง ฺฉูฺฺฉ ู ุจโฺฉูุชุ ุจุฑ ุงุณุงุณ ููุงุฏ ุชูุธู ุดูุฏ)
input int InpRange1_MaxRangePoints = 1500; // ุญุฏุงฺฉุซุฑ ุงุฑุชูุงุน ุฑูุฌ 1 ุจู ูพููุช (ุจุฑุง ููุชุฑ ุฑูุฌโูุง ุจุฒุฑฺฏ ู ูพุฑุฑุณฺฉุ ุจุฑ ุงุณุงุณ ููุณุงู ุชูุธู ุดูุฏ)
input ENUM_PLACEMENT_MODE InpRange1_Placement_Mode = PLACEMENT_ATR; // ุญุงูุช ุซุจุช ุณูุงุฑุด ุฑูุฌ 1 (ุงูุณุช ุดฺฉุณุชุ ATR ุจุฑุง ูพูุง)
input int InpRange1_ATR_Period = 122; // ุฏูุฑู ATR ุจุฑุง ุซุจุช ุณูุงุฑุด ุฑูุฌ 1 (ุจุฑุง ูุญุงุณุจู ุงูุณุช ูพูุงุ 14-200)
input double InpRange1_ATR_Multiplier = 2.3; // ุถุฑุจ ATR ุจุฑุง ุซุจุช ุณูุงุฑุด ุฑูุฌ 1 (ุจุฑุง ุชูุธู ุญุณุงุณุช ุงูุณุชุ 1.0-3.0)
input ENUM_SL_STRATEGY InpRange1_SL_Strategy = SL_BREAKOUT_LEVEL; // ุงุณุชุฑุงุชฺ ุฌุงฺฏุฐุงุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 1 (ููุงุจู ุง ุณุทุญ ุดฺฉุณุชุ BREAKOUT ุจุฑุง ุชูุงุฌู)
input ENUM_SL_CALC_MODE InpRange1_SL_Calc_Mode = SL_CALC_ATR; // ุญุงูุช ูุญุงุณุจู ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 1 (ATR ุจุฑุง ุชุทุจู)
input int InpRange1_SL_ATR_Period = 62; // ุฏูุฑู ATR ุจุฑุง ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 1 (14-100)
input double InpRange1_SL_ATR_Multiplier = 1.3; // ุถุฑุจ ATR ุจุฑุง ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 1 (0.5-2.0)
input ENUM_TRAILING_MODE InpRange1_Trailing_Mode = TRAILING_ATR; // ุญุงูุช ุชุฑููฺฏ ุงุณุชุงูพ ุฑูุฌ 1 (ATR ุจุฑุง ูพูุง)
input int InpRange1_Trailing_ATR_Period = 43; // ุฏูุฑู ATR ุจุฑุง ุชุฑููฺฏ ุฑูุฌ 1 (14-100)
input double InpRange1_Trailing_ATR_Multiplier = 1.4; // ุถุฑุจ ATR ุจุฑุง ุชุฑููฺฏ ุฑูุฌ 1 (1.0-2.0)
input double InpRange1_RR_Ratio = 1.5; // ูุณุจุช R:R ุจุฑุง ุฎุฑูุฌ ูพููโุง ุฑูุฌ 1 (ุณูุฏ ุจู ุฑุณฺฉ ุจุฑุง ุฎุฑูุฌ ูพููโุงุ 1.0-3.0)
input double InpRange1_PartialClosePercent = 60.0; // ุฏุฑุตุฏ ุจุณุชู ูพููโุง ุฑูุฌ 1 (ููฺฏุงู ุฑุณุฏู ุจู RRุ 30-70%)
input int InpRange1_Cleanup_Hours = 5; // ุณุงุนุชโูุง ูพุงฺฉุณุงุฒ ุฑูุฌ 1 (0-24ุ ุฒูุงู ุงููุถุง ุฑูุฌ ูพุณ ุงุฒ ูพุงุงูุ 1-12 ููุงุณุจ)
input color InpRange1_Color = clrBlue; // ุฑูฺฏ ูุณุชุทู ุฑูุฌ 1 (ุจุฑุง ููุงุด ฺฏุฑุงูฺฉ ุฑู ฺุงุฑุชุ ุขุจ ุจุฑุง ุชูุงุฒ)

// ฺฏุฑูู ูุฑูุฏ ุจุฑุง ุชูุธูุงุช ุฑูุฌ 2 (ุฏููู ุฑูุฌุ ูุนูููุงู ุจุฑุง ุณุดู ุงุฑููพุง)
// ูุดุงุจู ุฑูุฌ 1ุ ุงูุง ุจุง ูพุงุฑุงูุชุฑูุง ุจูููโุดุฏู ุจุฑุง ุณุดู ุงุฑููพุง
input group "ุชูุธูุงุช ุฑูุฌ 2"  // ุนููุงู ฺฏุฑูู
input bool InpRange2_Enabled = true; // ูุนุงู ฺฉุฑุฏู ุฑูุฌ 2 (ุฎุงููุด ุจุฑุง ุบุฑูุนุงู ฺฉุฑุฏู)
input ENUM_TIMEFRAMES InpRange2_Execution_Timeframe = PERIOD_M15; // ุชุงูโูุฑู ุงุฌุฑุง ุฑูุฌ 2 (M5-M30)
input ENUM_TIMEFRAMES InpRange2_TrendFilter_Timeframe = PERIOD_M15; // ุชุงูโูุฑู ููุชุฑ ุฑููุฏ ุฑูุฌ 2 (M15-H1)
input int InpRange2_Start_Hour = 5; // ุณุงุนุช ุดุฑูุน ุฑูุฌ 2 (0-23)
input int InpRange2_Start_Minute = 0; // ุฏููู ุดุฑูุน ุฑูุฌ 2 (0-59)
input int InpRange2_End_Hour = 13; // ุณุงุนุช ูพุงุงู ุฑูุฌ 2 (0-23)
input int InpRange2_End_Minute = 0; // ุฏููู ูพุงุงู ุฑูุฌ 2 (0-59)
input int InpRange2_MinRangePoints = 200; // ุญุฏุงูู ุงุฑุชูุงุน ุฑูุฌ 2 ุจู ูพููุช
input int InpRange2_MaxRangePoints = 3500; // ุญุฏุงฺฉุซุฑ ุงุฑุชูุงุน ุฑูุฌ 2 ุจู ูพููุช
input ENUM_PLACEMENT_MODE InpRange2_Placement_Mode = PLACEMENT_ATR; // ุญุงูุช ุซุจุช ุณูุงุฑุด ุฑูุฌ 2
input int InpRange2_ATR_Period = 27; // ุฏูุฑู ATR ุจุฑุง ุซุจุช ุณูุงุฑุด ุฑูุฌ 2
input double InpRange2_ATR_Multiplier = 2.8; // ุถุฑุจ ATR ุจุฑุง ุซุจุช ุณูุงุฑุด ุฑูุฌ 2
input ENUM_SL_STRATEGY InpRange2_SL_Strategy = SL_OPPOSITE_SIDE; // ุงุณุชุฑุงุชฺ ุฌุงฺฏุฐุงุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 2
input ENUM_SL_CALC_MODE InpRange2_SL_Calc_Mode = SL_CALC_ATR; // ุญุงูุช ูุญุงุณุจู ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 2
input int InpRange2_SL_ATR_Period = 86; // ุฏูุฑู ATR ุจุฑุง ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 2
input double InpRange2_SL_ATR_Multiplier = 1.56; // ุถุฑุจ ATR ุจุฑุง ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 2
input ENUM_TRAILING_MODE InpRange2_Trailing_Mode = TRAILING_ATR; // ุญุงูุช ุชุฑููฺฏ ุงุณุชุงูพ ุฑูุฌ 2
input int InpRange2_Trailing_ATR_Period = 101; // ุฏูุฑู ATR ุจุฑุง ุชุฑููฺฏ ุฑูุฌ 2
input double InpRange2_Trailing_ATR_Multiplier = 1.58; // ุถุฑุจ ATR ุจุฑุง ุชุฑููฺฏ ุฑูุฌ 2
input double InpRange2_RR_Ratio = 2.8; // ูุณุจุช R:R ุจุฑุง ุฎุฑูุฌ ูพููโุง ุฑูุฌ 2
input double InpRange2_PartialClosePercent = 26; // ุฏุฑุตุฏ ุจุณุชู ูพููโุง ุฑูุฌ 2
input int InpRange2_Cleanup_Hours = 4; // ุณุงุนุชโูุง ูพุงฺฉุณุงุฒ ุฑูุฌ 2 (0-24)
input color InpRange2_Color = clrRed; // ุฑูฺฏ ูุณุชุทู ุฑูุฌ 2

// ฺฏุฑูู ูุฑูุฏ ุจุฑุง ุชูุธูุงุช ุฑูุฌ 3 (ุณููู ุฑูุฌุ ูุนูููุงู ุจุฑุง ุณุดู ุขูุฑฺฉุง)
// ูพุงุฑุงูุชุฑูุง ุจูููโุดุฏู ุจุฑุง ุณุดู ุขูุฑฺฉุง ุจุง ุฑูุฌ ฺฉูฺฺฉโุชุฑ
input group "ุชูุธูุงุช ุฑูุฌ 3"  // ุนููุงู ฺฏุฑูู
input bool InpRange3_Enabled = false; // ูุนุงู ฺฉุฑุฏู ุฑูุฌ 3 (ูพุดโูุฑุถ ุฎุงููุด ุจุฑุง ุณุงุฏฺฏ)
input ENUM_TIMEFRAMES InpRange3_Execution_Timeframe = PERIOD_M5; // ุชุงูโูุฑู ุงุฌุฑุง ุฑูุฌ 3
input ENUM_TIMEFRAMES InpRange3_TrendFilter_Timeframe = PERIOD_M30; // ุชุงูโูุฑู ููุชุฑ ุฑููุฏ ุฑูุฌ 3
input int InpRange3_Start_Hour = 15; // ุณุงุนุช ุดุฑูุน ุฑูุฌ 3 (0-23)
input int InpRange3_Start_Minute = 0; // ุฏููู ุดุฑูุน ุฑูุฌ 3 (0-59)
input int InpRange3_End_Hour = 18; // ุณุงุนุช ูพุงุงู ุฑูุฌ 3 (0-23)
input int InpRange3_End_Minute = 0; // ุฏููู ูพุงุงู ุฑูุฌ 3 (0-59)
input int InpRange3_MinRangePoints = 100; // ุญุฏุงูู ุงุฑุชูุงุน ุฑูุฌ 3 ุจู ูพููุช
input int InpRange3_MaxRangePoints = 2110; // ุญุฏุงฺฉุซุฑ ุงุฑุชูุงุน ุฑูุฌ 3 ุจู ูพููุช
input ENUM_PLACEMENT_MODE InpRange3_Placement_Mode = PLACEMENT_ATR; // ุญุงูุช ุซุจุช ุณูุงุฑุด ุฑูุฌ 3
input int InpRange3_ATR_Period = 14; // ุฏูุฑู ATR ุจุฑุง ุซุจุช ุณูุงุฑุด ุฑูุฌ 3
input double InpRange3_ATR_Multiplier = 1.2; // ุถุฑุจ ATR ุจุฑุง ุซุจุช ุณูุงุฑุด ุฑูุฌ 3
input ENUM_SL_STRATEGY InpRange3_SL_Strategy = SL_OPPOSITE_SIDE; // ุงุณุชุฑุงุชฺ ุฌุงฺฏุฐุงุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 3
input ENUM_SL_CALC_MODE InpRange3_SL_Calc_Mode = SL_CALC_ATR; // ุญุงูุช ูุญุงุณุจู ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 3
input int InpRange3_SL_ATR_Period = 14; // ุฏูุฑู ATR ุจุฑุง ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 3
input double InpRange3_SL_ATR_Multiplier = 1.5; // ุถุฑุจ ATR ุจุฑุง ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 3
input ENUM_TRAILING_MODE InpRange3_Trailing_Mode = TRAILING_ATR; // ุญุงูุช ุชุฑููฺฏ ุงุณุชุงูพ ุฑูุฌ 3
input int InpRange3_Trailing_ATR_Period = 14; // ุฏูุฑู ATR ุจุฑุง ุชุฑููฺฏ ุฑูุฌ 3
input double InpRange3_Trailing_ATR_Multiplier = 1.0; // ุถุฑุจ ATR ุจุฑุง ุชุฑููฺฏ ุฑูุฌ 3
input double InpRange3_RR_Ratio = 1.5; // ูุณุจุช R:R ุจุฑุง ุฎุฑูุฌ ูพููโุง ุฑูุฌ 3
input double InpRange3_PartialClosePercent = 50.0; // ุฏุฑุตุฏ ุจุณุชู ูพููโุง ุฑูุฌ 3
input int InpRange3_Cleanup_Hours = 5; // ุณุงุนุชโูุง ูพุงฺฉุณุงุฒ ุฑูุฌ 3 (0-24)
input color InpRange3_Color = clrGreen; // ุฑูฺฏ ูุณุชุทู ุฑูุฌ 3

// ฺฏุฑูู ูุฑูุฏ ุจุฑุง ุชูุธูุงุช ุฑูุฌ 4 (ฺูุงุฑูู ุฑูุฌุ ุจุฑุง ุณูุงุฑุดโุณุงุฒ ุงุถุงู ุง ุชุณุช)
// ุฑูุฌ ูพุดโูุฑุถ ุฎุงููุด ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชุฏุงุฎู
input group "ุชูุธูุงุช ุฑูุฌ 4"  // ุนููุงู ฺฏุฑูู
input bool InpRange4_Enabled = false; // ูุนุงู ฺฉุฑุฏู ุฑูุฌ 4 (ุฎุงููุด ูพุดโูุฑุถ)
input ENUM_TIMEFRAMES InpRange4_Execution_Timeframe = PERIOD_CURRENT; // ุชุงูโูุฑู ุงุฌุฑุง ุฑูุฌ 4 (CURRENT ุจุฑุง ููุฎูุงู ุจุง ฺุงุฑุช)
input ENUM_TIMEFRAMES InpRange4_TrendFilter_Timeframe = PERIOD_CURRENT; // ุชุงูโูุฑู ููุชุฑ ุฑููุฏ ุฑูุฌ 4
input int InpRange4_Start_Hour = 0; // ุณุงุนุช ุดุฑูุน ุฑูุฌ 4 (0-23)
input int InpRange4_Start_Minute = 0; // ุฏููู ุดุฑูุน ุฑูุฌ 4 (0-59)
input int InpRange4_End_Hour = 0; // ุณุงุนุช ูพุงุงู ุฑูุฌ 4 (0-23)
input int InpRange4_End_Minute = 0; // ุฏููู ูพุงุงู ุฑูุฌ 4 (0-59)
input int InpRange4_MinRangePoints = 50; // ุญุฏุงูู ุงุฑุชูุงุน ุฑูุฌ 4 ุจู ูพููุช
input int InpRange4_MaxRangePoints = 500; // ุญุฏุงฺฉุซุฑ ุงุฑุชูุงุน ุฑูุฌ 4 ุจู ูพููุช
input ENUM_PLACEMENT_MODE InpRange4_Placement_Mode = PLACEMENT_ATR; // ุญุงูุช ุซุจุช ุณูุงุฑุด ุฑูุฌ 4
input int InpRange4_ATR_Period = 14; // ุฏูุฑู ATR ุจุฑุง ุซุจุช ุณูุงุฑุด ุฑูุฌ 4
input double InpRange4_ATR_Multiplier = 1.2; // ุถุฑุจ ATR ุจุฑุง ุซุจุช ุณูุงุฑุด ุฑูุฌ 4
input ENUM_SL_STRATEGY InpRange4_SL_Strategy = SL_OPPOSITE_SIDE; // ุงุณุชุฑุงุชฺ ุฌุงฺฏุฐุงุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 4
input ENUM_SL_CALC_MODE InpRange4_SL_Calc_Mode = SL_CALC_ATR; // ุญุงูุช ูุญุงุณุจู ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 4
input int InpRange4_SL_ATR_Period = 14; // ุฏูุฑู ATR ุจุฑุง ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 4
input double InpRange4_SL_ATR_Multiplier = 1.5; // ุถุฑุจ ATR ุจุฑุง ุจุงูุฑ ุงุณุชุงูพ ูุงุณ ุฑูุฌ 4
input ENUM_TRAILING_MODE InpRange4_Trailing_Mode = TRAILING_ATR; // ุญุงูุช ุชุฑููฺฏ ุงุณุชุงูพ ุฑูุฌ 4
input int InpRange4_Trailing_ATR_Period = 14; // ุฏูุฑู ATR ุจุฑุง ุชุฑููฺฏ ุฑูุฌ 4
input double InpRange4_Trailing_ATR_Multiplier = 1.0; // ุถุฑุจ ATR ุจุฑุง ุชุฑููฺฏ ุฑูุฌ 4
input double InpRange4_RR_Ratio = 1.5; // ูุณุจุช R:R ุจุฑุง ุฎุฑูุฌ ูพููโุง ุฑูุฌ 4
input double InpRange4_PartialClosePercent = 50.0; // ุฏุฑุตุฏ ุจุณุชู ูพููโุง ุฑูุฌ 4
input int InpRange4_Cleanup_Hours = 5; // ุณุงุนุชโูุง ูพุงฺฉุณุงุฒ ุฑูุฌ 4 (0-24)
input color InpRange4_Color = clrYellow; // ุฑูฺฏ ูุณุชุทู ุฑูุฌ 4

#endif  // ูพุงุงู ฺฺฉ include
```

```mql5
//+------------------------------------------------------------------+
//|                                                       Elemento.mq5 |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ุงู ูุงู ุงุตู ุงฺฉุณูพุฑุช Elemento ุงุณุช ู ููุทู ูุฑูุฏ ุจุฑูุงูู (OnInit, OnDeinit, OnTick, OnTimer) ุฑุง ูุฏุฑุช ูโฺฉูุฏ.
// ุงุณุชุฑุงุชฺ ฺฉู ุงฺฉุณูพุฑุช: Elemento ุจุฑ ุงุณุงุณ ุงุณุชุฑุงุชฺ ุดฺฉุณุช ุฑูุฌ ุนูู ูโฺฉูุฏ ฺฉู ุฑูุฌโูุง ุฒูุงู ุฑุง ุดูุงุณุง ูโฺฉูุฏุ 
// ููุชุธุฑ ุดฺฉุณุช ุจุง ุงูุณุช ูโูุงูุฏุ ุจุง ุชุงุฏ ุงุฎุชุงุฑ ููุช ู ููุชุฑ ุงฺููฺฉู ุชุฃุฏ ูโฺฉูุฏุ ูุนุงููู ุจุงุฒ ูโฺฉูุฏ 
// ู ุณูพุณ ูุนุงููู ุฑุง ุจุง ุฎุฑูุฌ ูพููโุง ู ุชุฑููฺฏ ูุฏุฑุช ูโฺฉูุฏ. 
// ุงู ุงุณุชุฑุงุชฺ ุจุฑุง ุจุงุฒุงุฑูุง ุฑูุฌ ูุงููุฏ ุณุดู ุขุณุง ููุงุณุจ ุงุณุช ู ุจุง ููุชุฑ ุฑููุฏ ุงุฒ ูุนุงููุงุช ุฎูุงู ุฌูุช ุฌููฺฏุฑ ูโฺฉูุฏ ุชุง ุฑุณฺฉ ฺฉุงูุด ุงุจุฏ. 
// ุงฺฉุณูพุฑุช ุงุฒ ฺูุงุฑ ุฑูุฌ ููุฒูุงู ูพุดุชุจุงู ูโฺฉูุฏ ุชุง ูพูุดุด ฺฉุงูู ุจุงุฒุงุฑ ุฑุง ูุฑุงูู ฺฉูุฏ.
// ููุทู ูุงู Elemento.mq5: ุงู ูุงู ููุงููฺฏโฺฉููุฏู ุงุตู ุงุณุช. 
// ุฏุฑ OnInit ุงุทูุงุนุงุช ููุงุฏ ุฑุง ฺฉุด ูโฺฉูุฏุ ูุฑูุฏโูุง ุฑุง ููุฏ ูโฺฉูุฏุ ฺูุงุฑ ููููู CRange ุฑุง ููุฏุงุฑุฏู ูโฺฉูุฏุ 
// ููุฏูโูุง ATR ุฑุง ุงุฌุงุฏ ูโฺฉูุฏุ ููุชุฑ ุฑููุฏ ู ูุฏุฑ ููุงุด ุฑุง ุฑุงูโุงูุฏุงุฒ ูโฺฉูุฏ. 
// ุฏุฑ OnDeinit ุชูุงู ููุงุจุน ุฑุง ุขุฒุงุฏ ู ูพุงฺฉุณุงุฒ ุณุฎุช ุงูุฌุงู ูโุฏูุฏ. 
// ุฏุฑ OnTick ฺฉูุฏูโูุง ุฌุฏุฏ ุฑุง ุชุดุฎุต ูโุฏูุฏุ ุฑูุฌโูุง ุฑุง ุจูโุฑูุฒุฑุณุงู ูโฺฉูุฏุ ูุถุนุช ุฑููุฏ ูุฑ ุฑูุฌ ุฑุง ุจู ุทูุฑ ุฌุฏุงฺฏุงูู ููุงุด ูโุฏูุฏ 
// ู ุฏุฑ ุตูุฑุช ุจุณุชู ุจูุฏู ุจุงุฒุงุฑ ูพุงฺฉุณุงุฒ ูโฺฉูุฏ. 
// ุฏุฑ OnTimer (ูุฑ ถฐ ุซุงูู) ูุนุงููุงุช ูุนุงู ุฑุง ูุฏุฑุช ูโฺฉูุฏ ุชุง ุจุงุฑ OnTick ฺฉุงูุด ุงุจุฏ. 
// ูุชุบุฑูุง ุฌูุงู ูุงููุฏ g_ranges ุจุฑุง ูฺฏูุฏุงุฑ ุฑูุฌโูุงุ g_lastBarTime ุจุฑุง ุชุดุฎุต ฺฉูุฏู ุฌุฏุฏุ ู g_trendFilter ุจุฑุง ููุชุฑ ุฑููุฏ ุงุณุชูุงุฏู ูโุดููุฏ. 
// ุชุบุฑุงุช ุฌุฏุฏ ุฏุฑ ูุณุฎู 2.10: ุงุถุงูู ฺฉุฑุฏู ุจุงุฒุงุจ ูุถุนุช ุฏุฑ OnInit ุจุง ูพุงุฑุณ ฺฉุงููุช ูุนุงููู ู ูุฑุงุฎูุงู RestoreState ุจุฑุง ูุฑ ุฑูุฌ ูุนุงูุ 
// ุจุฑุง ุญู ุจุงฺฏ ุจุงุฒุงุจ ูุงูุต ูพุณ ุงุฒ ุฑโุงุณุชุงุฑุช. ููฺูู ฺฉุงููุชโฺฏุฐุงุฑ ุฏููโุชุฑ ู ุญูุธ ุณุงุฎุชุงุฑ ูุจู.

#property copyright "Copyright 2025, Hipoalgorithm Team"  // ฺฉูพโุฑุงุช ูุงู
#property link      "https://hipoalgorithm.com"  // ููฺฉ ูุจโุณุงุช ุชู
#property version   "2.10"  // ูุฑฺู ููุง ุจุง ุชุบุฑุงุช ูุฏุฑุช ูุนุงููู ู ูุงฺฏ ููุดููุฏ
#property strict  // ุญุงูุชๅณๆผ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฎุทุงูุง ฺฉุงููพุงู

#include "Settings.mqh"  // ูุงู ุชูุธูุงุช ุจุฑุง ุฏุณุชุฑุณ ุจู ูุฑูุฏโูุง ู enums
#include "Logger.mqh"  // ฺฉุชุงุจุฎุงูู ุฌุฏุฏ ูุงฺฏ ููุดููุฏ ุจุฑุง ฺุงูพ ูพุงูโูุง ฺฉูุชุฑูโุดุฏู
#include "CRange.mqh"  // ฺฉูุงุณ ูุฏุฑุช ุฑูุฌ ุจุฑุง ูุฑ ุฑูุฌ ุฌุฏุงฺฏุงูู
#include "TrendFilter.mqh"  // ฺฉูุงุณ ููุชุฑ ุฑููุฏ ุจุฑุง ุชุนู ุฌูุช ุฑููุฏ
#include "VisualManager.mqh"  // ฺฉูุงุณ ูุฏุฑ ููุงุด ุจุฑุง ููุงุด ุจุตุฑ ุฑู ฺุงุฑุช
#include "CActiveTradeManager.mqh"  // ฺฉูุงุณ ุฌุฏุฏ ูุฏุฑ ูุนุงููุงุช ูุนุงู ุจุฑุง ูุฏุฑุช ุชูุงู ูุนุงููุงุช ุจุงุฒ

// ุขุฑุงู ุจุฑุง ุฐุฎุฑู ด ุฑูุฌ (ูุฑ ฺฉุฏุงู ฺฉ ููููู ุงุฒ ฺฉูุงุณ CRange ุจุฑุง ูุฏุฑุช ูุณุชูู ุฑูุฌโูุง)
// ุงู ุขุฑุงู ุงุฌุงุฒู ูโุฏูุฏ ฺูุงุฑ ุฑูุฌ ููุฒูุงู ุจุฏูู ุชุฏุงุฎู ฺฉุงุฑ ฺฉููุฏ
CRange g_ranges[4];  // ุขุฑุงู ุฑูุฌโูุง

// ุขุฑุงู ุจุฑุง ุฐุฎุฑู ุฒูุงู ุขุฎุฑู ฺฉูุฏู ูุฑ ุชุงูโูุฑู (ุจุฑุง ุชุดุฎุต ฺฉูุฏู ุฌุฏุฏ ู ุฌููฺฏุฑ ุงุฒ ุงุฌุฑุง ูฺฉุฑุฑ)
// ูุฑ ุงูุฏฺฉุณ ูุฑุจูุท ุจู ฺฉ ุฑูุฌ ุงุณุช
datetime g_lastBarTime[4];  // ุขุฑุงู ุฒูุงู ุขุฎุฑู ุจุงุฑ

// ุขุฑุงู ุจุฑุง ููุฏูโูุง ATR shared (ุจุฑุง ูุฑ ุฑูุฌ ฺฉ ููุฏู ATR ุจุฑุง ูุญุงุณุจุงุช ุงูุณุชุ SL ู ุชุฑููฺฏ)
// ููุฏูโูุง ุจุฑุง ุจูููโุณุงุฒ ูุญุงุณุจุงุช ุงูุฏฺฉุงุชูุฑ ุงุณุชูุงุฏู ูโุดููุฏ
int g_atrHandles[4];  // ุขุฑุงู ููุฏูโูุง ATR

// ูุชุบุฑูุง ฺฉุดโุดุฏู ุจุฑุง ุจูููโุณุงุฒ (ุงุทูุงุนุงุช ููุงุฏ ุจุฑุง ูุญุงุณุจู ุฑุณฺฉุ ุญุฌู ู ูุงุตููโูุง ุจู ุทูุฑ ุฏูู ู ูุณุชูู ุงุฒ ููุน ููุงุฏ)
// ฺฉุด ฺฉุฑุฏู ุงู ููุงุฏุฑ ุงุฒ ูุฑุงุฎูุงู ูฺฉุฑุฑ SymbolInfoDouble ุฌููฺฏุฑ ูโฺฉูุฏ
double g_tickValue;  // ุงุฑุฒุด ุชฺฉ ุจุฑุง ูุญุงุณุจุงุช ุฑุณฺฉ (ุฏูุงุฑ ุจู ุงุฒุง ูุฑ ุชฺฉ)
double g_tickSize;  // ุงูุฏุงุฒู ุชฺฉ ุจุฑุง ุฏูุช ูุญุงุณุจุงุช (ูุงุตูู ุจู ุชฺฉโูุง)
double g_volumeStep;  // ฺฏุงู ุญุฌู ุจุฑุง ุฑุงูุฏ ฺฉุฑุฏู ูุงุช (ูุซูุงู 0.01)
double g_volumeMin;  // ุญุฏุงูู ุญุฌู ูุฌุงุฒ (ูุซูุงู 0.01)
double g_volumeMax;  // ุญุฏุงฺฉุซุฑ ุญุฌู ูุฌุงุฒ (ูุซูุงู 100)

// ููฺฏ ุจุฑุง ุชุดุฎุต ุญุงูุช tester (ุจุฑุง ุฑูุชุงุฑ ูุชูุงูุช ูุงููุฏ ูุงุฏุฏู ฺฏุฑูุชู ฺฺฉ ุจุงุฒุงุฑ ุจุณุชู ุฏุฑ ุจฺฉโุชุณุช)
// ุงู ููฺฏ ุนููฺฉุฑุฏ ุฑุง ุฏุฑ ุจฺฉโุชุณุช ู ูุงู ูุชูุงุฒ ูโฺฉูุฏ
bool g_isTester = false;  // ููฺฏ ุชุณุชุฑ

// ููุชุฑ ุฑููุฏ ุฌูุงู (ูููููโุง ุงุฒ CTrendFilter ุจุฑุง ุงุณุชูุงุฏู ูุดุชุฑฺฉ ุฏุฑ ุชูุงู ุฑูุฌโูุง)
// ุงู ููููู ุจุฑุง ููุชุฑ ุฏูุงูฺฉ ุฏุฑ ูุฑ ุฑูุฌ ุงุณุชูุงุฏู ูโุดูุฏ
CTrendFilter g_trendFilter;  // ููุชุฑ ุฑููุฏ ุฌูุงู

// ูุฏุฑ ููุงุด ุฌูุงู (ูููููโุง ุงุฒ CVisualManager ุจุฑุง ููุงุด ุจุตุฑ ูุถุนุช ุฑููุฏ ูุฑ ุฑูุฌ ุฑู ฺุงุฑุช)
// ุงู ููููู ุจุฑุง ุจูโุฑูุฒุฑุณุงู ูุชู ููุงุด ุงุณุชูุงุฏู ูโุดูุฏ
CVisualManager g_visualManager;  // ูุฏุฑ ููุงุด ุฌูุงู

// ูุฏุฑ ูุนุงููุงุช ูุนุงู (ูููููโุง ุงุฒ CActiveTradeManager ุจุฑุง ูุฏุฑุช ุชูุงู ูุนุงููุงุช ุจุงุฒ)
// ุงู ฺฉูุงุณ ุชูุงู ูุฏุฑุช ูุนุงููุงุช ุฑุง ุงูุฌุงู ูโุฏูุฏ
CActiveTradeManager g_tradeManager;  // ูุฏุฑ ูุนุงููุงุช

// ุชุงุจุน ุดุฑูุน ุงฺฉุณูพุฑุช (OnInit): ููุฏุงุฑุฏู ุงูููุ ฺฺฉ ููุฏุดู ู ุฑุงูโุงูุฏุงุฒ ุชุงูุฑ
// ุงู ุชุงุจุน ุฏุฑ ุดุฑูุน ุงฺฉุณูพุฑุช ูุฑุงุฎูุงู ูโุดูุฏ ู ุชูุงู ููุงุจุน ุฑุง ุขูุงุฏู ูโฺฉูุฏ
int OnInit()  // ุชุงุจุน ููุฏุงุฑุฏู ุงููู
{
   // ุชุดุฎุต ุญุงูุช ุชุณุชุฑ ุจุฑุง ุชูุธู ุฑูุชุงุฑ ุฎุงุต (ูุงููุฏ ูุงุฏุฏู ฺฏุฑูุชู ฺฺฉ ุจุงุฒุงุฑ ุจุณุชู ุฏุฑ ุจฺฉโุชุณุช)
   // MQLInfoInteger ุงุทูุงุนุงุช ูุญุท ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ
   g_isTester = MQLInfoInteger(MQL_TESTER);  // ุชูุธู ููฺฏ ุชุณุชุฑ
   
   // ฺุงูพ ูพุงู ุฏุจุงฺฏ ุจุฑุง ุดุฑูุน ููุฏุงุฑุฏู ุจุง ุงุณุชูุงุฏู ุงุฒ Print (ฺูู ููุท ฺฉุจุงุฑ ุงุฌุฑุง ูโุดูุฏ)
   // ุงู ูพุงู ููุท ุฏุฑ ุญุงูุช ุฏุจุงฺฏ ฺุงูพ ูโุดูุฏ
   if(InpDebugMode) Print("ุดุฑูุน ููุฏุงุฑุฏู ุงฺฉุณูพุฑุช Elemento ูุณุฎู 2.10...");  // ฺุงูพ ุดุฑูุน ููุฏุงุฑุฏู

   // ฺฉุด ุงุทูุงุนุงุช ุณูุจู (ููุงุฏ) ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ ูุญุงุณุจู ุฑุณฺฉุ ุญุฌู ู ูุงุตููโูุง
   // SymbolInfoDouble ุงุทูุงุนุงุช ูุนุงููุงุช ููุงุฏ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ
   g_tickValue = SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_VALUE);  // ฺฉุด ุงุฑุฒุด ุชฺฉ ุจุฑุง ูุญุงุณุจุงุช ุฑุณฺฉ
   g_tickSize = SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_SIZE);  // ฺฉุด ุงูุฏุงุฒู ุชฺฉ ุจุฑุง ุฏูุช ูุญุงุณุจุงุช
   g_volumeStep = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_STEP);  // ฺฉุด ฺฏุงู ุญุฌู ุจุฑุง ุฑุงูุฏ ฺฉุฑุฏู ูุงุช
   g_volumeMin = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_MIN);  // ฺฉุด ุญุฏุงูู ุญุฌู ูุฌุงุฒ ุจุฑุง ูุนุงููุงุช
   g_volumeMax = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_MAX);  // ฺฉุด ุญุฏุงฺฉุซุฑ ุญุฌู ูุฌุงุฒ ุจุฑุง ูุนุงููุงุช

   // ฺฺฉ ููุฏ ุจูุฏู ุงุทูุงุนุงุช ููุงุฏ (ุงฺฏุฑ ุตูุฑ ุง ูุงูุนุชุจุฑ ุจุงุดุฏุ ุงฺฉุณูพุฑุช ูุชููู ูโุดูุฏ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุญุงุณุจุงุช ุงุดุชุจุงู)
   // ุงู ฺฺฉ ุงุฒ ุฎุทุงูุง runtime ุฌููฺฏุฑ ูโฺฉูุฏ
   if(g_tickValue <= 0 || g_tickSize <= 0 || g_volumeStep <= 0)  // ุดุฑุท ฺฺฉ ููุงุฏุฑ ฺฉุด
   {
      // ฺุงูพ ุฎุทุง ู ุชููู ุงฺฉุณูพุฑุช ุจุง ุงุณุชูุงุฏู ุงุฒ Print (ฺูู ุฎุทุง ูุฑฺฏุจุงุฑ ุงุณุช)
      Print("ุฎุทุง ูุฑฺฏุจุงุฑ: ุงุทูุงุนุงุช ููุงุฏ ูุงูุนุชุจุฑ ุงุณุช (tickValue/tickSize/volumeStep). ุงฺฉุณูพุฑุช ูุชููู ูโุดูุฏ.");  // ฺุงูพ ุฎุทุง ู ุชููู ุงฺฉุณูพุฑุช
      return(INIT_FAILED);  // ุจุงุฒฺฏุดุช ุดฺฉุณุช ููุฏุงุฑุฏู
   }

   // ููุฏุดู ูุฑูุฏโูุง ุนููู (ุงุทููุงู ุงุฒ ูุญุฏูุฏู ูุฌุงุฒ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฎุทุงูุง ููุทู)
   // ุงู ฺฺฉโูุง ุงุฒ ุงุฌุฑุง ูุงุฏุฑุณุช ุฌููฺฏุฑ ูโฺฉููุฏ
   if(InpRiskPercent <= 0 || InpRiskPercent > 5.0)  // ฺฺฉ ูุญุฏูุฏู ุฑุณฺฉ
   {
      Print("ุฎุทุง: RiskPercent ุจุงุฏ ุจู 0.1 ุชุง 5.0 ุจุงุดุฏ.");  // ฺุงูพ ุฎุทุง ุจุฑุง ุฑุณฺฉ ูุงูุนุชุจุฑ
      return(INIT_PARAMETERS_INCORRECT);  // ุจุงุฒฺฏุดุช ุดฺฉุณุช ูพุงุฑุงูุชุฑูุง
   }

   // ููุฏุดู Inp_Confirmation_Timeout ุงฺฏุฑ ุญุงูุช ูุฏู ุงูุชุฎุงุจ ุดุฏู ุจุงุดุฏ
   // ุงู ฺฺฉ ููุท ุฏุฑ ุญุงูุช ุชุงูุฑ ุงุนูุงู ูโุดูุฏ
   if(Inp_Confirmation_Strategy == CONFIRMATION_TIMEOUT && (Inp_Confirmation_Timeout < 1 || Inp_Confirmation_Timeout > 10))  // ฺฺฉ ูุญุฏูุฏู ุชุงูโุงูุช
   {
      Print("ุฎุทุง: Confirmation_Timeout ุจุงุฏ ุจู 1 ุชุง 10 ุจุงุดุฏ (ุจุฑุง ุญุงูุช ุชุงูุฑ).");  // ฺุงูพ ุฎุทุง ุจุฑุง ุชุงูโุงูุช ูุงูุนุชุจุฑ
      return(INIT_PARAMETERS_INCORRECT);  // ุจุงุฒฺฏุดุช ุดฺฉุณุช ูพุงุฑุงูุชุฑูุง
   }

   // ููุฏุงุฑุฏู ด ุฑูุฌ (ุจุฑุง ูุฑ ุฑูุฌ ูุนุงูุ ูพุงุฑุงูุชุฑูุง ุฑุง ุงุฒ ูุฑูุฏโูุง ฺฏุฑูุชูุ ููุฏู ATR ูโุณุงุฒุฏ ู Init ูโฺฉูุฏ)
   // ุญููู ุจุฑุง ููุฏุงุฑุฏู ฺูุงุฑ ุฑูุฌ ุจู ุตูุฑุช ุฌุฏุงฺฏุงูู
   for(int i = 0; i < 4; i++)  // ุญููู ุจุฑุง ููุฏุงุฑุฏู ฺูุงุฑ ุฑูุฌ
   {
      // ฺฺฉ ูุนุงู ุจูุฏู ุฑูุฌ ุจุฑ ุงุณุงุณ ูุฑูุฏ ูุฑุจูุทู (ุงุณุชูุงุฏู ุงุฒ ุดุฑุท ุณูโุชุง ุจุฑุง ุณุงุฏฺฏ)
      bool enabled = i == 0 ? InpRange1_Enabled : i == 1 ? InpRange2_Enabled : i == 2 ? InpRange3_Enabled : InpRange4_Enabled;  // ฺฺฉ ูุนุงู ุจูุฏู ุฑูุฌ ุจุฑ ุงุณุงุณ ูุฑูุฏ
      if(!enabled)  // ุดุฑุท ุบุฑูุนุงู
      {
         // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุฑูุฌ ุบุฑูุนุงู ุจุง ุงุณุชูุงุฏู ุงุฒ CLogger (ุจุฑุง ูุงฺฏ ููุดููุฏ)
         CLogger::Log("ุฑูุฌ " + IntegerToString(i + 1) + " ุบุฑูุนุงู ุงุณุช. ุฑุฏ ูโุดูุฏ.", i + 1);  // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุฑูุฌ ุบุฑูุนุงู
         continue;  // ูพุฑุด ุจู ุฑูุฌ ุจุนุฏ
      }

      // ูุฌฺฉ ูุงูุจุฑ ููุญุตุฑุจูโูุฑุฏ ุจุฑุง ูุฑ ุฑูุฌ ุฌูุช ุชูุงุฒ ูุนุงููุงุช
      long magic = InpBaseMagicNumber + i;  // ูุฌฺฉ ูุงูุจุฑ ููุญุตุฑุจูโูุฑุฏ ุจุฑุง ูุฑ ุฑูุฌ ุฌูุช ุชูุงุฒ ูุนุงููุงุช
      // ุงุณุชุฎุฑุงุฌ ุณุงุนุช ู ุฏููู ุดุฑูุน ุงุฒ ูุฑูุฏ ูุฑุจูุทู
      int startHour = i == 0 ? InpRange1_Start_Hour : i == 1 ? InpRange2_Start_Hour : i == 2 ? InpRange3_Start_Hour : InpRange4_Start_Hour;  // ุณุงุนุช ุดุฑูุน ุฑูุฌ
      int startMinute = i == 0 ? InpRange1_Start_Minute : i == 1 ? InpRange2_Start_Minute : i == 2 ? InpRange3_Start_Minute : InpRange4_Start_Minute;  // ุฏููู ุดุฑูุน ุฑูุฌ
      // ุงุณุชุฎุฑุงุฌ ุณุงุนุช ู ุฏููู ูพุงุงู ุงุฒ ูุฑูุฏ ูุฑุจูุทู
      int endHour = i == 0 ? InpRange1_End_Hour : i == 1 ? InpRange2_End_Hour : i == 2 ? InpRange3_End_Hour : InpRange4_End_Hour;  // ุณุงุนุช ูพุงุงู ุฑูุฌ
      int endMinute = i == 0 ? InpRange1_End_Minute : i == 1 ? InpRange2_End_Minute : i == 2 ? InpRange3_End_Minute : InpRange4_End_Minute;  // ุฏููู ูพุงุงู ุฑูุฌ

      // ฺฺฉ ููุฏ ุจูุฏู ุณุงุนุงุช ู ุฏูููโูุง (ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฒูุงูโูุง ูุงูุนุชุจุฑ)
      // ุงู ฺฺฉ ุงุฒ ุฎุทุงูุง ุฒูุงู ุฌููฺฏุฑ ูโฺฉูุฏ
      if(startHour < 0 || startHour > 23 || startMinute < 0 || startMinute > 59 ||  // ุดุฑุท ฺฺฉ ุดุฑูุน
         endHour < 0 || endHour > 23 || endMinute < 0 || endMinute > 59)  // ุดุฑุท ฺฺฉ ูพุงุงู
      {
         Print("ุฎุทุง: ุณุงุนุงุช ุง ุฏูููโูุง ุฑูุฌ " + IntegerToString(i + 1) + " ูุงูุนุชุจุฑ ุงุณุช.");  // ฺุงูพ ุฎุทุง ุจุฑุง ุฒูุงู ูุงูุนุชุจุฑ
         return(INIT_PARAMETERS_INCORRECT);  // ุจุงุฒฺฏุดุช ุดฺฉุณุช ูพุงุฑุงูุชุฑูุง
      }

      // ุงุณุชุฎุฑุงุฌ ุชุงูโูุฑู ุงุฌุฑุง ุงุฒ ูุฑูุฏ ูุฑุจูุทู
      ENUM_TIMEFRAMES timeframe = i == 0 ? InpRange1_Execution_Timeframe : i == 1 ? InpRange2_Execution_Timeframe : i == 2 ? InpRange3_Execution_Timeframe : InpRange4_Execution_Timeframe;  // ุชุงูโูุฑู ุงุฌุฑุง ุฑูุฌ
      // ุงุณุชุฎุฑุงุฌ ุฏูุฑู ATR ุงุฒ ูุฑูุฏ ูุฑุจูุทู
      int atrPeriod = i == 0 ? InpRange1_ATR_Period : i == 1 ? InpRange2_ATR_Period : i == 2 ? InpRange3_ATR_Period : InpRange4_ATR_Period;  // ุฏูุฑู ATR ุจุฑุง ุงูุณุช
      // ุงุฌุงุฏ ููุฏู ATR ุจุฑุง ูุญุงุณุจุงุช ูพูุง ุจุง ุงุณุชูุงุฏู ุงุฒ iATR
      g_atrHandles[i] = iATR(_Symbol, timeframe, atrPeriod);  // ุงุฌุงุฏ ููุฏู ATR ุจุฑุง ูุญุงุณุจุงุช ูพูุง
      if(g_atrHandles[i] == INVALID_HANDLE)  // ฺฺฉ ููุฏู ูุนุชุจุฑ
      {
         Print("ุฎุทุง ุฏุฑ ุงุฌุงุฏ ููุฏู ATR ุจุฑุง ุฑูุฌ " + IntegerToString(i + 1));  // ฺุงูพ ุฎุทุง ุจุฑุง ููุฏู ูุงูุนุชุจุฑ
         return(INIT_FAILED);  // ุจุงุฒฺฏุดุช ุดฺฉุณุช ููุฏุงุฑุฏู
      }

      // ุงุณุชุฎุฑุงุฌ ุงุณุชุฑุงุชฺ SL ุงุฒ ูุฑูุฏ ูุฑุจูุทู
      ENUM_SL_STRATEGY slStrategy = i == 0 ? InpRange1_SL_Strategy : i == 1 ? InpRange2_SL_Strategy : i == 2 ? InpRange3_SL_Strategy : InpRange4_SL_Strategy;  // ุงุณุชุฑุงุชฺ SL
      // ุงุณุชุฎุฑุงุฌ ุญุงูุช ูุญุงุณุจู ุจุงูุฑ SL ุงุฒ ูุฑูุฏ ูุฑุจูุทู
      ENUM_SL_CALC_MODE slCalcMode = i == 0 ? InpRange1_SL_Calc_Mode : i == 1 ? InpRange2_SL_Calc_Mode : i == 2 ? InpRange3_SL_Calc_Mode : InpRange4_SL_Calc_Mode;  // ุญุงูุช ูุญุงุณุจู ุจุงูุฑ SL
      // ุงุณุชุฎุฑุงุฌ ุฏูุฑู ATR ุจุฑุง SL ุงุฒ ูุฑูุฏ ูุฑุจูุทู
      int slAtrPeriod = i == 0 ? InpRange1_SL_ATR_Period : i == 1 ? InpRange2_SL_ATR_Period : i == 2 ? InpRange3_SL_ATR_Period : InpRange4_SL_ATR_Period;  // ุฏูุฑู ATR ุจุฑุง SL
      // ุงุณุชุฎุฑุงุฌ ุถุฑุจ ATR ุจุฑุง SL ุงุฒ ูุฑูุฏ ูุฑุจูุทู
      double slAtrMultiplier = i == 0 ? InpRange1_SL_ATR_Multiplier : i == 1 ? InpRange2_SL_ATR_Multiplier : i == 2 ? InpRange3_SL_ATR_Multiplier : InpRange4_SL_ATR_Multiplier;  // ุถุฑุจ ATR ุจุฑุง SL

      // ูุฑุงุฎูุงู Init ุจุฑุง ูุฑ ุฑูุฌ ุจุง ูพุงุฑุงูุชุฑูุง ูุฑุจูุทู (ููุฏุงุฑุฏู ฺฉุงูู ุฑูุฌุ ุดุงูู SL strategy ุฌุฏุฏ)
      // ุงุณุชูุงุฏู ุงุฒ ุดุฑุท ุณูโุชุง ุจุฑุง ุงุณุชุฎุฑุงุฌ ูพุงุฑุงูุชุฑูุง ุฏฺฏุฑ
      if(!g_ranges[i].Init(  // ูุฑุงุฎูุงู Init ุฑูุฌ
         i + 1, magic, timeframe, startHour, startMinute, endHour, endMinute,  // ูพุงุฑุงูุชุฑูุง ูพุงู
         i == 0 ? InpRange1_MinRangePoints : i == 1 ? InpRange2_MinRangePoints : i == 2 ? InpRange3_MinRangePoints : InpRange4_MinRangePoints,  // ุญุฏุงูู ุงุฑุชูุงุน
         i == 0 ? InpRange1_MaxRangePoints : i == 1 ? InpRange2_MaxRangePoints : i == 2 ? InpRange3_MaxRangePoints : InpRange4_MaxRangePoints,  // ุญุฏุงฺฉุซุฑ ุงุฑุชูุงุน
         i == 0 ? InpRange1_Placement_Mode : i == 1 ? InpRange2_Placement_Mode : i == 2 ? InpRange3_Placement_Mode : InpRange4_Placement_Mode,  // ุญุงูุช ุงูุณุช
         atrPeriod,  // ุฏูุฑู ATR
         i == 0 ? InpRange1_ATR_Multiplier : i == 1 ? InpRange2_ATR_Multiplier : i == 2 ? InpRange3_ATR_Multiplier : InpRange4_ATR_Multiplier,  // ุถุฑุจ ATR
         slStrategy, slCalcMode, slAtrPeriod, slAtrMultiplier,  // ูพุงุฑุงูุชุฑูุง SL
         i == 0 ? InpRange1_Trailing_Mode : i == 1 ? InpRange2_Trailing_Mode : i == 2 ? InpRange3_Trailing_Mode : InpRange4_Trailing_Mode,  // ุญุงูุช ุชุฑููฺฏ
         i == 0 ? InpRange1_Trailing_ATR_Period : i == 1 ? InpRange2_Trailing_ATR_Period : i == 2 ? InpRange3_Trailing_ATR_Period : InpRange4_Trailing_ATR_Period,  // ุฏูุฑู ุชุฑููฺฏ
         i == 0 ? InpRange1_Trailing_ATR_Multiplier : i == 1 ? InpRange2_Trailing_ATR_Multiplier : i == 2 ? InpRange3_Trailing_ATR_Multiplier : InpRange4_Trailing_ATR_Multiplier,  // ุถุฑุจ ุชุฑููฺฏ
         i == 0 ? InpRange1_RR_Ratio : i == 1 ? InpRange2_RR_Ratio : i == 2 ? InpRange3_RR_Ratio : InpRange4_RR_Ratio,  // ูุณุจุช RR
         i == 0 ? InpRange1_PartialClosePercent : i == 1 ? InpRange2_PartialClosePercent : i == 2 ? InpRange3_PartialClosePercent : InpRange4_PartialClosePercent,  // ุฏุฑุตุฏ ูพููโุง
         i == 0 ? InpRange1_Cleanup_Hours : i == 1 ? InpRange2_Cleanup_Hours : i == 2 ? InpRange3_Cleanup_Hours : InpRange4_Cleanup_Hours,  // ุณุงุนุช ูพุงฺฉุณุงุฒ
         i == 0 ? InpRange1_Color : i == 1 ? InpRange2_Color : i == 2 ? InpRange3_Color : InpRange4_Color,  // ุฑูฺฏ
         i == 0 ? InpRange1_TrendFilter_Timeframe : i == 1 ? InpRange2_TrendFilter_Timeframe : i == 2 ? InpRange3_TrendFilter_Timeframe : InpRange4_TrendFilter_Timeframe,  // ุชุงูโูุฑู ููุชุฑ
         g_atrHandles[i]  // ููุฏู ATR
      ))  // ูพุงุงู ูุฑุงุฎูุงู Init
      {
         Print("ุฎุทุง ุฏุฑ ููุฏุงุฑุฏู ุฑูุฌ " + IntegerToString(i + 1) + ": " + IntegerToString(GetLastError()));  // ฺุงูพ ุฎุทุง ุจุฑุง ุดฺฉุณุช Init
         return(INIT_PARAMETERS_INCORRECT);  // ุจุงุฒฺฏุดุช ุดฺฉุณุช ูพุงุฑุงูุชุฑูุง
      }
   }

   // (ุฌุฏุฏ) ุงุถุงูู ฺฉุฑุฏู ุญุงูุธู: ฺฺฉ ูุนุงููุงุช ุจุงุฒ ุจุฑุง ูุฑ ุฑูุฌ ู ุจุงุฒฺฏุฑุฏุงู ุญุงูุช ุงฺฏุฑ ูุนุงูููโุง ุจุงุฒ ุจุงุดุฏ (ุจุฑุง ููุงููุช ุฏุฑ ุจุฑุงุจุฑ ุฑโุงุณุชุงุฑุช)
   // ุงู ุญููู ูุนุงููุงุช ุจุงุฒ ุฑุง ุจุงุฒุงุจ ูโฺฉูุฏ
   // ุงู ฺฉุฏ ฺฉุงูู ู ุงุตูุงุญ ุดุฏู ุงุณุช. ุขู ุฑุง ุฏุฑ ุชุงุจุน OnInit ุฌุงฺฏุฒู ุญููู ูุจู ฺฉู.

// (ุฌุฏุฏ) ุงุถุงูู ฺฉุฑุฏู ุญุงูุธู: ฺฺฉ ูุนุงููุงุช ุจุงุฒ ุจุฑุง ูุฑ ุฑูุฌ ู ุจุงุฒฺฏุฑุฏุงู ุญุงูุช
for(int i = 0; i < 4; i++)
{
    bool enabled = i == 0 ? InpRange1_Enabled : i == 1 ? InpRange2_Enabled : i == 2 ? InpRange3_Enabled : InpRange4_Enabled;
    if(!enabled) continue;

    long magic = InpBaseMagicNumber + i;
    for(int pos = PositionsTotal() - 1; pos >= 0; pos--)
    {
        if(PositionGetSymbol(pos) == _Symbol && PositionGetInteger(POSITION_MAGIC) == magic)
        {
            ulong ticket = PositionGetInteger(POSITION_TICKET);
            double openPrice = PositionGetDouble(POSITION_PRICE_OPEN);
            double sl = PositionGetDouble(POSITION_SL);

            // ุจู CRange ูฺฏู ฺฉู ู ูุนุงููู ูุนุงู ุฏุงุดุชู
            g_ranges[i].SetActiveTicket(ticket);
            g_ranges[i].SetCurrentState(RANGE_TRADE_ACTIVE);
            
            CLogger::Log("ูุนุงููู ุจุงุฒ ุจุฑุง ุฑูุฌ " + IntegerToString(i + 1) + " ูพุฏุง ุดุฏ. ุฏุฑ ุญุงู ุซุจุช ุฏุฑ ูุฏุฑ ูุนุงููุงุช...", i + 1);

            // ฑ. ุฎููุฏู ูพุงุฑุงูุชุฑูุง ูุงุฒู ุจุฑุง ูุฏุฑุช ูุนุงููู ุงุฒ ุชูุธูุงุช ูุฑูุฏ
            double rec_rr_ratio = i == 0 ? InpRange1_RR_Ratio : i == 1 ? InpRange2_RR_Ratio : i == 2 ? InpRange3_RR_Ratio : InpRange4_RR_Ratio;
            double rec_partial_percent = i == 0 ? InpRange1_PartialClosePercent : i == 1 ? InpRange2_PartialClosePercent : i == 2 ? InpRange3_PartialClosePercent : InpRange4_PartialClosePercent;
            ENUM_TRAILING_MODE rec_trailing_mode = i == 0 ? InpRange1_Trailing_Mode : i == 1 ? InpRange2_Trailing_Mode : i == 2 ? InpRange3_Trailing_Mode : InpRange4_Trailing_Mode;
            int rec_trailing_atr_period = i == 0 ? InpRange1_Trailing_ATR_Period : i == 1 ? InpRange2_Trailing_ATR_Period : i == 2 ? InpRange3_Trailing_ATR_Period : InpRange4_Trailing_ATR_Period;
            double rec_trailing_atr_multiplier = i == 0 ? InpRange1_Trailing_ATR_Multiplier : i == 1 ? InpRange2_Trailing_ATR_Multiplier : i == 2 ? InpRange3_Trailing_ATR_Multiplier : InpRange4_Trailing_ATR_Multiplier;
            ENUM_TIMEFRAMES rec_exec_tf = i == 0 ? InpRange1_Execution_Timeframe : i == 1 ? InpRange2_Execution_Timeframe : i == 2 ? InpRange3_Execution_Timeframe : InpRange4_Execution_Timeframe;
            ENUM_TIMEFRAMES rec_trend_tf = i == 0 ? InpRange1_TrendFilter_Timeframe : i == 1 ? InpRange2_TrendFilter_Timeframe : i == 2 ? InpRange3_TrendFilter_Timeframe : InpRange4_TrendFilter_Timeframe;
            
            // ฒ. ุฎููุฏู ุงุทูุงุนุงุช ุญุงุช ุงุฒ ฺฉุงููุช ุฎูุฏ ูุนุงููู
            string comment = PositionGetString(POSITION_COMMENT);
            string parts[];
            double rec_high = 0.0, rec_low = 0.0, initial_sl_dist = 0.0;
            if(StringSplit(comment, ';', parts) >= 4)
            {
                rec_high = StringToDouble(StringSubstr(parts[1], 2));
                rec_low = StringToDouble(StringSubstr(parts[2], 2));
                initial_sl_dist = StringToDouble(StringSubstr(parts[3], 4));
                g_ranges[i].RestoreState(rec_high, rec_low, initial_sl_dist);
            }
            else
            {
               CLogger::Log("ฺฉุงููุช ูุนุงููู ุจุฑุง ุจุงุฒุงุจ ูุถุนุช ูุงูุนุชุจุฑ ุงุณุช.", i+1);
            }

            // ณ. ุซุจุช ูุนุงููู ุฏุฑ ูุฏุฑ ูุนุงููุงุช (ุงู ุฎุท ุญุงุชโุชุฑู ุจุฎุด ุงุตูุงุญู)
            g_tradeManager.RegisterTrade(
                ticket,
                magic,
                i + 1, // Range Index
                initial_sl_dist,
                openPrice,
                rec_rr_ratio,
                rec_partial_percent,
                rec_trailing_mode,
                rec_trailing_atr_period,
                rec_trailing_atr_multiplier,
                rec_exec_tf,
                g_ranges[i].m_trailingAtrHandle, // ููุฏู ุชุฑููฺฏ ุฑู ุงุฒ ุฎูุฏ ุฑูุฌ ูฺฏุฑู
                rec_trend_tf
            );
            CLogger::Log("ูุนุงููู ุจุงุฒุงุจ ุดุฏู ุจุง ููููุช ุจู ActiveTradeManager ุซุจุช ุดุฏ.", i + 1);

            // ด. ฺฺฉ ฺฉุฑุฏู ุงูฺฉู ุขุง ูุนุงููู ูุจูุง ุฑุณฺฉ-ูุฑ ุดุฏู ุง ูู
            if (MathAbs(sl - openPrice) < (_Point * 5))
            {
               g_tradeManager.SetPartialClosedFlag(ticket, true);
               CLogger::Log("ูุนุงููู ุฑูุฌ " + IntegerToString(i+1) + " ูุจูุงู ุฑุณฺฉ-ูุฑ ุดุฏู. ุญุงูุช ุจุงุฒุงุจ ุดุฏ.", i + 1);
            }
            
            break; // ุฎุฑูุฌ ุงุฒ ุญููู ุฏุงุฎู ฺูู ูุนุงููู ุงู ุฑูุฌ ูพุฏุง ุดุฏ
        }
    }
}

   // ููุฏุงุฑุฏู ููุชุฑ ุฑููุฏ ุฌูุงู (ุจุฑุง ุชุนู ุฌูุช ุฑููุฏ ุฏุฑ ุชูุงู ุฑูุฌโูุง)
   // ูุฑุงุฎูุงู Init ููุชุฑ (ฺฉู ุฎุงู ุงุณุช ุงูุง ุจุฑุง ุณุงุฒฺฏุงุฑ)
   if(!g_trendFilter.Init())  // ฺฺฉ ููููุช Init
   {
      Print("ุฎุทุง ุฏุฑ ููุฏุงุฑุฏู ููุชุฑ ุฑููุฏ.");  // ฺุงูพ ุฎุทุง ุจุฑุง ุดฺฉุณุช Init ููุชุฑ
      return(INIT_FAILED);  // ุจุงุฒฺฏุดุช ุดฺฉุณุช ููุฏุงุฑุฏู
   }
   // ููุฏุงุฑุฏู ูุฏุฑ ููุงุด ุฌูุงู (ุจุฑุง ููุงุด ูุถุนุช ุฑููุฏ ูุฑ ุฑูุฌ ุฑู ฺุงุฑุช)
   // ูุฑุงุฎูุงู Init ููุงุดฺฏุฑ
   if(!g_visualManager.Init())  // ฺฺฉ ููููุช Init
   {
      Print("ุฎุทุง ุฏุฑ ููุฏุงุฑุฏู ูุฏุฑ ููุงุด.");  // ฺุงูพ ุฎุทุง ุจุฑุง ุดฺฉุณุช Init ููุงุดฺฏุฑ
      return(INIT_FAILED);  // ุจุงุฒฺฏุดุช ุดฺฉุณุช ููุฏุงุฑุฏู
   }

   // ููุฏุงุฑุฏู ุงููู ุฒูุงู ุขุฎุฑู ฺฉูุฏูโูุง (ุจุฑุง ุชุดุฎุต ฺฉูุฏู ุฌุฏุฏ ุฏุฑ OnTick)
   // ุญููู ุจุฑุง ุฑุณุช ุฒูุงูโูุง ุจู ุตูุฑ
   for(int i = 0; i < 4; i++)  // ุญููู ุจุฑุง ุฑุณุช ุฒูุงูโูุง
   {
      g_lastBarTime[i] = 0;  // ุชูุธู ุฒูุงู ุงููู ุจู ุตูุฑ
   }

   // ุฑุงูโุงูุฏุงุฒ ุชุงูุฑ ุจุฑุง ูุฏุฑุช ูุนุงููุงุช ูุฑ ถฐ ุซุงูู (ุจูููโุณุงุฒ ุนููฺฉุฑุฏ OnTick)
   // EventSetTimer ุชุงูุฑ ุฑุง ูุนุงู ูโฺฉูุฏ
   EventSetTimer(60);  // ุชูุธู ุชุงูุฑ ถฐ ุซุงูู

   // ฺุงูพ ููููุช ููุฏุงุฑุฏู ุจุง Print (ฺูู ููุง ุงุณุช)
   Print("ููุฏุงุฑุฏู ุงฺฉุณูพุฑุช Elemento ูุณุฎู 2.10 ุจุง ููููุช ุงูุฌุงู ุดุฏ.");  // ฺุงูพ ููููุช ููุฏุงุฑุฏู
   return(INIT_SUCCEEDED);  // ุจุงุฒฺฏุดุช ููููุช
}

// ุชุงุจุน ูพุงุงู ุงฺฉุณูพุฑุช (OnDeinit): ูพุงฺฉุณุงุฒ ููุงุจุน ู ูพุงฺฉุณุงุฒ ุณุฎุช ุชูุงู ุฑูุฌโูุง
// ุงู ุชุงุจุน ุฏุฑ ูพุงุงู ุงฺฉุณูพุฑุช ูุฑุงุฎูุงู ูโุดูุฏ ู ููุงุจุน ุฑุง ุขุฒุงุฏ ูโฺฉูุฏ
void OnDeinit(const int reason)  // ุชุงุจุน ุฏูุน ุจุง ุฏูู
{
   // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุฏูู ุฏูุน ุจุง Print (ฺูู ููุท ฺฉุจุงุฑ)
   if(InpDebugMode) Print("ุฏูุน ููุฏุงุฑุฏู ุงฺฉุณูพุฑุช Elemento ูุณุฎู 2.10. ุฏูู: " + IntegerToString(reason));  // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุฏูู ุฏูุน

   // ูพุงฺฉุณุงุฒ ุณุฎุช ุชูุงู ุฑูุฌโูุง ุจุฑุง ุจุณุชู ูุนุงููุงุช ุจุงูโูุงูุฏู ู ุฑุณุช (ุฏุฑ ุตูุฑุช ฺฉุฑุด ุง ุฎุฑูุฌ)
   // ุญููู ุจุฑุง ูพุงฺฉุณุงุฒ ุณุฎุช ูุฑ ุฑูุฌ
   for(int i = 0; i < 4; i++)  // ุญููู ุจุฑุง ูพุงฺฉุณุงุฒ ุณุฎุช ูุฑ ุฑูุฌ
   {
      g_ranges[i].HardCleanup();  // ูุฑุงุฎูุงู ูพุงฺฉุณุงุฒ ุณุฎุช
   }

   // ุฏูุน ูุฑ ุฑูุฌ ู ุขุฒุงุฏุณุงุฒ ููุฏู ATR ูุฑุจูุทู
   // ุญููู ุจุฑุง ุฏูุน ุฑูุฌโูุง ู ููุฏูโูุง
   for(int i = 0; i < 4; i++)  // ุญููู ุจุฑุง ุฏูุน ุฑูุฌโูุง
   {
      g_ranges[i].Deinit();  // ุฏูุน ุฑูุฌ
      if(g_atrHandles[i] != INVALID_HANDLE)  // ฺฺฉ ููุฏู ูุนุชุจุฑ
      {
         IndicatorRelease(g_atrHandles[i]);  // ุขุฒุงุฏุณุงุฒ ููุฏู ATR
      }
   }

   // ุฏูุน ููุชุฑ ุฑููุฏ ู ูุฏุฑ ููุงุด
   g_trendFilter.Deinit();  // ุฏูุน ููุชุฑ ุฑููุฏ
   g_visualManager.Deinit();  // ุฏูุน ูุฏุฑ ููุงุด
   // ุญุฐู ุชูุงู ุงุดุงุก ฺฏุฑุงูฺฉ ุจุง ูพุดููุฏ Range_ ุจุฑุง ูพุงฺฉุณุงุฒ ฺุงุฑุช
   ObjectsDeleteAll(0, "Range_");  // ุญุฐู ุชูุงู ุงุดุงุก ฺฏุฑุงูฺฉ ุจุง ูพุดููุฏ Range_ ุจุฑุง ูพุงฺฉุณุงุฒ ฺุงุฑุช
   Print("ุชูุงู ุงุดุงุก ฺฏุฑุงูฺฉ ูพุงฺฉุณุงุฒ ุดุฏูุฏ.");  // ฺุงูพ ููููุช ูพุงฺฉุณุงุฒ ุงุดุงุก

   // ุฎุงููุด ฺฉุฑุฏู ุชุงูุฑ
   EventKillTimer();  // ุฎุงููุด ฺฉุฑุฏู ุชุงูุฑ
}

// ุชุงุจุน ุงุตู ูุฑ ุชฺฉ (OnTick): ุชุดุฎุต ฺฉูุฏู ุฌุฏุฏุ ุจูโุฑูุฒุฑุณุงู ุฑูุฌโูุง ู ฺฺฉ ุจุงุฒุงุฑ
// ุงู ุชุงุจุน ุฏุฑ ูุฑ ุชฺฉ ููุช ูุฑุงุฎูุงู ูโุดูุฏ ู ููุทู ุงุตู ุฑุง ุงุฌุฑุง ูโฺฉูุฏ
void OnTick()  // ุชุงุจุน ุงุตู ูุฑ ุชฺฉ
{
   // ฺฺฉ ุฑูุฒ ุฌุฏุฏ ุจุฑุง ุจูโุฑูุฒุฑุณุงู ฺฉุด ุงุทูุงุนุงุช ููุงุฏ (ุฏุฑ ุตูุฑุช ุชุบุฑ ูุดุฎุตุงุช ุจุฑูฺฉุฑ)
   // ูุชุบุฑ ุงุณุชุงุชฺฉ ุจุฑุง ุฐุฎุฑู ุฑูุฒ ุขุฎุฑู ุจูโุฑูุฒุฑุณุงู
   static datetime lastDay = 0;  // ูุชุบุฑ ุงุณุชุงุชฺฉ ุจุฑุง ุฐุฎุฑู ุฑูุฒ ุขุฎุฑู
   datetime currentDay = TimeCurrent() / 86400;  // ูุญุงุณุจู ุฑูุฒ ูุนู (ุซุงููโูุง ุจู ุฑูุฒ)
   if(currentDay != lastDay)  // ฺฺฉ ุชุบุฑ ุฑูุฒ
   {
      // ุจูโุฑูุฒุฑุณุงู ฺฉุด ุงุทูุงุนุงุช ููุงุฏ ุจุง ูุฑุงุฎูุงู ูุฌุฏุฏ SymbolInfoDouble
      g_tickValue = SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_VALUE);  // ุจูโุฑูุฒุฑุณุงู ุงุฑุฒุด ุชฺฉ
      g_tickSize = SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_SIZE);  // ุจูโุฑูุฒุฑุณุงู ุงูุฏุงุฒู ุชฺฉ
      g_volumeStep = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_STEP);  // ุจูโุฑูุฒุฑุณุงู ฺฏุงู ุญุฌู
      g_volumeMin = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_MIN);  // ุจูโุฑูุฒุฑุณุงู ุญุฏุงูู ุญุฌู
      g_volumeMax = SymbolInfoDouble(_Symbol, SYMBOL_VOLUME_MAX);  // ุจูโุฑูุฒุฑุณุงู ุญุฏุงฺฉุซุฑ ุญุฌู
      // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุจูโุฑูุฒุฑุณุงู ุจุง CLogger
      CLogger::Log("ุจูโุฑูุฒุฑุณุงู ฺฉุด ุงุทูุงุนุงุช ููุงุฏ ุฏุฑ ุฑูุฒ ุฌุฏุฏ.");  // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุจูโุฑูุฒุฑุณุงู
      lastDay = currentDay;  // ุฐุฎุฑู ุฑูุฒ ุฌุฏุฏ
   }

   // ุงฺฏุฑ ุชุณุชุฑ ูุณุช ู ุจุงุฒุงุฑ ุจุณุชู ุงุณุช ุง ฺฉ ุณุงุนุช ูุจู ุงุฒ ุจุณุชู ุดุฏูุ ูพุงฺฉุณุงุฒ ุณุฎุช ุงูุฌุงู ูโุดูุฏ
   // ุงู ุดุฑุท ุงุฒ ูุนุงููุงุช ุฏุฑ ุชุนุทูุงุช ุฌููฺฏุฑ ูโฺฉูุฏ
   if(!g_isTester && (IsMarketClosed() || IsOneHourBeforeMarketClose()))  // ฺฺฉ ุดุฑุงุท ุจุงุฒุงุฑ ุจุณุชู
   {
      // ุญููู ุจุฑุง ูุฑ ุฑูุฌ ูุนุงู
      for(int i = 0; i < 4; i++)  // ุญููู ุจุฑุง ูุฑ ุฑูุฌ
      {
         // ฺฺฉ ูุนุงู ุจูุฏู ุฑูุฌ
         bool enabled = i == 0 ? InpRange1_Enabled : i == 1 ? InpRange2_Enabled : i == 2 ? InpRange3_Enabled : InpRange4_Enabled;  // ฺฺฉ ูุนุงู ุจูุฏู
         if(enabled)  // ุดุฑุท ูุนุงู
         {
            g_ranges[i].HardCleanup();  // ูพุงฺฉุณุงุฒ ุณุฎุช ุฑูุฌ (ุจุณุชู ูุนุงููุงุช ู ุฑุณุช ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุนุงููุงุช ุจุงุฒ ุฏุฑ ุชุนุทูุงุช)
         }
      }
      return;  // ุฎุฑูุฌ ุงุฒ ุชุงุจุน
   }

   // ููฺฏ ุจุฑุง ุชุดุฎุต ฺฉูุฏู ุฌุฏุฏ ู ุจูโุฑูุฒุฑุณุงู ููุงุด
   bool newBarDetected = false;  // ููฺฏ ุจุฑุง ุชุดุฎุต ฺฉูุฏู ุฌุฏุฏ ู ุจูโุฑูุฒุฑุณุงู ููุงุด
   string trendDisplayText = "";  // ูุชู ฺฉุงูู ููุงุด ูุถุนุช ุฑููุฏ ูุฑ ุฑูุฌ
   // ูุชุบุฑ ุงุณุชุงุชฺฉ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุงฺฏ ุชฺฉุฑุงุฑ ูุถุนุช ุฑููุฏ
   static string lastTrendStatusText = "";  // ูุชุบุฑ ุงุณุชุงุชฺฉ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุงฺฏ ุชฺฉุฑุงุฑ

   // ุญููู ุจุฑุง ูุฑ ุฑูุฌ ูุนุงู
   for(int i = 0; i < 4; i++)  // ุญููู ุจุฑุง ูุฑ ุฑูุฌ
   {
      // ฺฺฉ ูุนุงู ุจูุฏู ุฑูุฌ
      bool enabled = i == 0 ? InpRange1_Enabled : i == 1 ? InpRange2_Enabled : i == 2 ? InpRange3_Enabled : InpRange4_Enabled;  // ฺฺฉ ูุนุงู ุจูุฏู ุฑูุฌ
      if(!enabled) continue;  // ูพุฑุด ุงฺฏุฑ ุบุฑูุนุงู

      // ฺฏุฑูุชู ุชุงูโูุฑู ุงุฌุฑุง ุฑูุฌ ุงุฒ ฺฉูุงุณ CRange
      ENUM_TIMEFRAMES timeframe = g_ranges[i].GetTimeframe();  // ฺฏุฑูุชู ุชุงูโูุฑู ุงุฌุฑุง ุฑูุฌ

      // ฺฺฉ ููุฏ ฺฉุงู ุชุงุฑุฎฺู ุจุฑุง ูุฑ ุฑูุฌ ุฌุฏุงฺฏุงูู (ุจุฑ ุงุณุงุณ ุชุงูโูุฑู ุงุฌุฑุง ุฑูุฌ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงุฌุฑุง ุฒูุฏุฑุณ)
      // Bars ุชุนุฏุงุฏ ฺฉูุฏูโูุง ููุฏุดุฏู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ
      if(Bars(_Symbol, timeframe) < 200)  // ฺฺฉ ุชุนุฏุงุฏ ุจุงุฑูุง
      {
         CLogger::Log("ุชุงุฑุฎฺู ฺฉุงู ุจุฑุง ุฑูุฌ " + IntegerToString(i + 1) + " ููุฏ ูุดุฏู ุงุณุช. ุฑุฏ ูโุดูุฏ.", i + 1);  // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุชุงุฑุฎฺู ูุงฺฉุงู
         continue;  // ูพุฑุด ุจู ุฑูุฌ ุจุนุฏ
      }

      // ุฒูุงู ฺฉูุฏู ูุนู ุจุฑุง ุชุดุฎุต ุฌุฏุฏ ุจูุฏู ุจุง iTime
      datetime currentBarTime = iTime(_Symbol, timeframe, 0);  // ุฒูุงู ฺฉูุฏู ูุนู ุจุฑุง ุชุดุฎุต ุฌุฏุฏ ุจูุฏู
      if(currentBarTime == 0)  // ฺฺฉ ุฒูุงู ูุนุชุจุฑ
      {
         CLogger::Log("ุฎุทุง: iTime ููุฏุงุฑ ูุงูุนุชุจุฑ ุจุฑุง ุฑูุฌ " + IntegerToString(i + 1), i + 1);  // ฺุงูพ ุฎุทุง
         continue;  // ูพุฑุด
      }

      // ุชุดุฎุต ฺฉูุฏู ุฌุฏุฏ ู ุจูโุฑูุฒุฑุณุงู ุฑูุฌ (ููุท ุฏุฑ ฺฉูุฏู ุฌุฏุฏ ุงุฌุฑุง ูโุดูุฏ ุชุง ุจุงุฑ ฺฉุงูุด ุงุจุฏ)
      if(currentBarTime > g_lastBarTime[i])  // ฺฺฉ ฺฉูุฏู ุฌุฏุฏ
      {
         // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ฺฉูุฏู ุฌุฏุฏ ุจุง CLogger
         CLogger::Log("ฺฉูุฏู ุฌุฏุฏ ุจุฑุง ุฑูุฌ " + IntegerToString(i + 1) + " ุฏุฑ ุชุงูโูุฑู " + EnumToString(timeframe), i + 1);  // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ฺฉูุฏู ุฌุฏุฏ
         g_ranges[i].UpdateOnNewBar();  // ุจูโุฑูุฒุฑุณุงู ูุงุดู ุญุงูุช ุฑูุฌ
         g_lastBarTime[i] = currentBarTime;  // ุฐุฎุฑู ุฒูุงู ุฌุฏุฏ
         newBarDetected = true;  // ุชูุธู ููฺฏ ฺฉูุฏู ุฌุฏุฏ
      }

      // ฺฺฉ ฺฉูุฏู ุฌุฏุฏ ุฏุฑ ุชุงูโูุฑู ููุชุฑ ุจุฑุง ุขูพุฏุช ููุงุด ุฑููุฏ ุขู ุฑูุฌ
      // ฺฏุฑูุชู ุชุงูโูุฑู ููุชุฑ ุงุฒ ฺฉูุงุณ
      ENUM_TIMEFRAMES trendTf = g_ranges[i].GetTrendFilterTimeframe();  // ฺฏุฑูุชู ุชุงูโูุฑู ููุชุฑ
      datetime currentTrendBarTime = iTime(_Symbol, trendTf, 0);  // ุฒูุงู ฺฉูุฏู ููุชุฑ ูุนู
      if(currentTrendBarTime > g_ranges[i].GetLastFilterBarTime())  // ฺฺฉ ฺฉูุฏู ุฌุฏุฏ ููุชุฑ
      {
         // ฺฏุฑูุชู ุฌูุช ุฑููุฏ ุงุฒ ููุชุฑ
         ENUM_TREND_DIRECTION trend = g_trendFilter.GetTrendDirection(trendTf);  // ฺฏุฑูุชู ุฌูุช ุฑููุฏ
         // ุชุจุฏู ุฌูุช ุจู ุฑุดุชู ุจุฑุง ููุงุด
         string trendStr = trend == TREND_BUY ? "Bullish" : trend == TREND_SELL ? "Bearish" : "Neutral";  // ุชุจุฏู ุฌูุช ุจู ุฑุดุชู
         string tfStr = EnumToString(trendTf);  // ุชุจุฏู ุชุงูโูุฑู ุจู ุฑุดุชู
         // ุงุถุงูู ุจู ูุชู ููุงุด ุจุง ูุฑูุช ูุดุฎุต
         trendDisplayText += "Range " + IntegerToString(i + 1) + " (Filter " + tfStr + "): " + trendStr + "\n";  // ุงุถุงูู ุจู ูุชู ููุงุด
         g_ranges[i].UpdateLastFilterBarTime(currentTrendBarTime);  // ุขูพุฏุช ุฒูุงู ุฏุฑ ุฑูุฌ
         // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุขูพุฏุช ุฑููุฏ ุจุง CLogger
         CLogger::Log("ุขูพุฏุช ุฑููุฏ ุฑูุฌ " + IntegerToString(i + 1) + ": " + trendStr, i + 1);  // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุขูพุฏุช ุฑููุฏ
      }

      // ูุฏุฑุช ูุนุงููุงุช ุจู OnTimer ููุชูู ุดุฏูุ ุงูุฌุง ููุท ฺฺฉ ุญุงูุช ุจุฑุง ุงุทููุงู
      if(enabled && g_ranges[i].GetCurrentState() == RANGE_TRADE_ACTIVE)  // ฺฺฉ ุญุงูุช ูุฏุฑุช ูุนุงููู
      {
         // ูฺ ุนูู ุฏุฑ OnTickุ ูุฏุฑุช ุฏุฑ OnTimer ุงูุฌุงู ูโุดูุฏ
         // ุงู ฺฺฉ ููุท ุจุฑุง ุงุทููุงู ุงุฒ ุญุงูุช ุงุณุช
      }
   }

   // ูุงฺฏ ฺฉุฑุฏู ูุถุนุช ุฑููุฏ ููุท ุงฺฏุฑ ุชุบุฑ ฺฉุฑุฏู ุจุงุดุฏ ู ูุชู ููุฌูุฏ ุจุงุดุฏ
   if(trendDisplayText != "" && trendDisplayText != lastTrendStatusText)  // ฺฺฉ ุชุบุฑ ูุชู
   {
      CLogger::Log("ูุถุนุช ุฑููุฏ ุขูพุฏุช ุดุฏ:\n" + trendDisplayText);  // ูุงฺฏ ฺฉุฑุฏู ูุถุนุช ุฑููุฏ
      lastTrendStatusText = trendDisplayText;  // ุฐุฎุฑู ูุชู ุฌุฏุฏ
   }

   // ุขูพุฏุช ููุงุดฺฏุฑ ุจุง ูุชู ฺฉุงูู ูุถุนุช ุฑููุฏ ูุฑ ุฑูุฌ (ุงฺฏุฑ ููุงุด ูุนุงู ุจุงุดุฏ)
   if(Inp_Visual_ShowTrendStatus && trendDisplayText != "")  // ฺฺฉ ูุนุงู ุจูุฏู ููุงุด ู ูุชู ููุฌูุฏ
   {
      g_visualManager.UpdateTrendStatus(trendDisplayText);  // ุจูโุฑูุฒุฑุณุงู ููุงุดฺฏุฑ
   }
}

// ุชุงุจุน ุชุงูุฑ (OnTimer): ูุฏุฑุช ูุนุงููุงุช ูุนุงู ูุฑ ถฐ ุซุงูู ุจุฑุง ฺฉุงูุด ุจุงุฑ OnTick
// ุงู ุชุงุจุน ูุฑ 60 ุซุงูู ูุฑุงุฎูุงู ูโุดูุฏ ู ูุฏุฑุช ูุนุงููุงุช ุฑุง ุงูุฌุงู ูโุฏูุฏ
void OnTimer()  // ุชุงุจุน ุชุงูุฑ
{
   g_tradeManager.ManageAllTrades();  // ูุฏุฑุช ุชูุงู ูุนุงููุงุช ูุนุงู ุฏุฑ ูุฏุฑ ูุนุงููุงุช
}

// ุชุงุจุน ฺฺฉ ฺฉ ุณุงุนุช ูุจู ุงุฒ ุจุณุชู ุดุฏู ุจุงุฒุงุฑ (ุจุฑุง ูุนุงู ฺฉุฑุฏู ูพุงฺฉุณุงุฒ ุณุฎุช ู ุฌููฺฏุฑ ุงุฒ ูุนุงููุงุช ุจุงุฒ ุฏุฑ ุชุนุทูุงุช)
// ุงู ุชุงุจุน ุฒูุงู ุจุณุชู ุดุฏู ุฑุง ูุญุงุณุจู ูโฺฉูุฏ
bool IsOneHourBeforeMarketClose()  // ุชุงุจุน ฺฺฉ ฺฉ ุณุงุนุช ูุจู ุงุฒ ุจุณุชู ุดุฏู
{
   datetime from = 0, to = 0;  // ูุชุบุฑูุง ุฒูุงู ุฌูุณู
   MqlDateTime dt;  // ุณุงุฎุชุงุฑ ุฒูุงู
   TimeToStruct(TimeTradeServer(), dt);  // ุชุจุฏู ุฒูุงู ุณุฑูุฑ ุจู ุณุงุฎุชุงุฑ
   ENUM_DAY_OF_WEEK day = (ENUM_DAY_OF_WEEK)dt.day_of_week;  // ุฑูุฒ ููุชู
   datetime max_to = 0;  // ุญุฏุงฺฉุซุฑ ุฒูุงู ุจุณุชู ุดุฏู
   uint session = 0;  // ุดูุงุฑูุฏู ุฌูุณู
   // ูพุฏุง ฺฉุฑุฏู ุขุฎุฑู ุฌูุณู ูุนุงููุงุช ุฑูุฒ ุจุฑุง ุชุนู ุฒูุงู ุจุณุชู ุดุฏู
   // ุญููู ุฌูุณุงุช ุจุง SymbolInfoSessionTrade
   while(SymbolInfoSessionTrade(_Symbol, day, session, from, to))  // ุญููู ุฌูุณุงุช
   {
      if(to > max_to) max_to = to;  // ุฐุฎุฑู ุญุฏุงฺฉุซุฑ ุฒูุงู
      session++;  // ุงูุฒุงุด ุดูุงุฑูุฏู
   }
   if(max_to == 0)  // ฺฺฉ ุนุฏู ุงูุชู ุฌูุณู
   {
      CLogger::Log("ุฎุทุง ุฏุฑ SymbolInfoSessionTrade: " + IntegerToString(GetLastError()));  // ฺุงูพ ุฎุทุง
      return false;  // ุจุงุฒฺฏุดุช ูุงุฏุฑุณุช
   }
   datetime currentTime = TimeTradeServer();  // ุฒูุงู ูุนู ุณุฑูุฑ
   // ฺฺฉ ุงฺฏุฑ ุฒูุงู ูุนู ฺฉ ุณุงุนุช ูุจู ุงุฒ ุจุณุชู ุดุฏู ุจุงุดุฏ (ุจุฑุง ูพุงฺฉุณุงุฒ ูพุดฺฏุฑุงูู)
   if(currentTime >= (max_to - 3600) && currentTime < max_to)  // ฺฺฉ ูุญุฏูุฏู ุฒูุงู
   {
      CLogger::Log("ฺฉ ุณุงุนุช ูุจู ุงุฒ ุจุณุชู ุดุฏู ุจุงุฒุงุฑ: ูพุงฺฉุณุงุฒ ุณุฎุช ูุนุงู ุดุฏ.");  // ฺุงูพ ุฏุจุงฺฏ
      return true;  // ุจุงุฒฺฏุดุช ุฏุฑุณุช
   }
   return false;  // ุจุงุฒฺฏุดุช ูุงุฏุฑุณุช
}

// ุชุงุจุน ฺฺฉ ุจุณุชู ุจูุฏู ุจุงุฒุงุฑ (ุจุฑุง ูุนุงู ฺฉุฑุฏู ูพุงฺฉุณุงุฒ ูุฑู ู ุฌููฺฏุฑ ุงุฒ ุนููุงุช ุฏุฑ ุชุนุทูุงุช)
// ุงู ุชุงุจุน ูุถุนุช ุจุงุฒุงุฑ ุฑุง ุจุฑ ุงุณุงุณ ุฌูุณุงุช ฺฺฉ ูโฺฉูุฏ
bool IsMarketClosed()  // ุชุงุจุน ฺฺฉ ุจุณุชู ุจูุฏู ุจุงุฒุงุฑ
{
   datetime from = 0, to = 0;  // ูุชุบุฑูุง ุฒูุงู ุฌูุณู
   MqlDateTime dt;  // ุณุงุฎุชุงุฑ ุฒูุงู
   TimeToStruct(TimeTradeServer(), dt);  // ุชุจุฏู ุฒูุงู ุณุฑูุฑ ุจู ุณุงุฎุชุงุฑ
   ENUM_DAY_OF_WEEK day = (ENUM_DAY_OF_WEEK)dt.day_of_week;  // ุฑูุฒ ููุชู
   uint session = 0;  // ุดูุงุฑูุฏู ุฌูุณู
   // ฺฺฉ ุฌูุณุงุช ูุนุงููุงุช ุฑูุฒ ุจุฑุง ุชุนู ูุถุนุช ุจุงุฒุงุฑ
   // ุญููู ุฌูุณุงุช
   while(SymbolInfoSessionTrade(_Symbol, day, session, from, to))  // ุญููู ุฌูุณุงุช
   {
      if(TimeTradeServer() >= from && TimeTradeServer() <= to)  // ฺฺฉ ุฏุงุฎู ุฌูุณู
      {
         return false;  // ุจุงุฒุงุฑ ุจุงุฒ ุงุณุชุ ุนููุงุช ุงุฏุงูู ูโุงุจุฏ
      }
      session++;  // ุงูุฒุงุด ุดูุงุฑูุฏู
   }
   // ฺฺฉ ุชุนุทูุงุช ุขุฎุฑ ููุชู (ุดูุจู ู ฺฉุดูุจู)
   if(dt.day_of_week == 6 || dt.day_of_week == 0)  // ฺฺฉ ุดูุจู ุง ฺฉุดูุจู
   {
      CLogger::Log("ุจุงุฒุงุฑ ุชุนุทู ุงุณุช (weekend).");  // ฺุงูพ ุฏุจุงฺฏ
      return true;  // ุจุงุฒฺฏุดุช ุฏุฑุณุช
   }
   CLogger::Log("ุจุงุฒุงุฑ ุชุนุทู ุงุณุช (ุฎุงุฑุฌ ุงุฒ ุฌูุณู).");  // ฺุงูพ ุฏุจุงฺฏ
   return true;  // ุจุงุฒฺฏุดุช ุฏุฑุณุช
}
```

```mql5
//+------------------------------------------------------------------+
//|                                                          Utils.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ุงู ูุงู ุดุงูู ุชูุงุจุน ฺฉูฺฉ ุนููู ุจุฑุง ุงฺฉุณูพุฑุช Elemento ุงุณุช.
// ุงุณุชุฑุงุชฺ ฺฉู: ุงู ูุงู ุจุฑุง ุจูููโุณุงุฒ ู ุงุณุชุงูุฏุงุฑุฏุณุงุฒ ุนููุงุช ูุดุชุฑฺฉ ูุงููุฏ ูุฑูุงูโุณุงุฒ ููุชโูุง ู ุงุนุชุจุงุฑุณูุฌโูุง ุงุณุชูุงุฏู ูโุดูุฏ.
// ููุทู ูุงู Utils.mqh: ุญุงู ุชูุงุจุน ุงุณุชุงุชฺฉ ุจุฑุง ูุฑูุงูโุณุงุฒ ููุชโูุง ุจุฑ ุงุณุงุณ Tick Size ููุงุฏ. 
// ุงู ูุงู ุชูุณุท ูุงูโูุง ุฏฺฏุฑ ูุงููุฏ CRange.mqh include ูโุดูุฏ ุชุง ุฏุณุชุฑุณ ุจู ุชูุงุจุน ฺฉูฺฉ ูุฑุงูู ุดูุฏ. 
// ุชุบุฑุงุช ุฌุฏุฏ ุฏุฑ ูุณุฎู 2.10: ุจูุจูุฏ ฺฉุงููุชโฺฏุฐุงุฑ ุจุฑุง ูุฑ ุฎุทุ ุงุถุงูู ุชูุถุญุงุช ุฏููโุชุฑ ุจุฑุง NormalizePriceุ 
// ุจุฏูู ุชุบุฑ ุฏุฑ ููุทู ุชุงุจุน ุงูุง ุจุง ฺฺฉ ุงุถุงู ุจุฑุง tickSize ุตูุฑ. ูฺ ุชุบุฑ ุงุนูุงู ูุดุฏู ุฒุฑุง ุจูููพุฑูุช ุชุบุฑ ูุดุฎุต ูฺฉุฑุฏู.

#ifndef UTILS_MQH  // ฺฺฉ ูุฌูุฏ ูุงู
#define UTILS_MQH  // ุชุนุฑู ูุงฺฉุฑู

// ุชุงุจุน ุจุฑุง ูุฑูุงู ุณุงุฒ ุฏูู ููุช ุจุฑ ุงุณุงุณ TickSize ููุงุฏ
// ุงู ุชุงุจุน ููุช ุฑุง ุจู ูุฒุฏฺฉโุชุฑู ูุถุฑุจ tickSize ุฑุงูุฏ ูโฺฉูุฏ ู ุจู _Digits ูุฑูุงู ูโฺฉูุฏ
double NormalizePrice(double price)  // ุชุงุจุน ูุฑูุงูโุณุงุฒ ููุช
{
   // ฺฏุฑูุชู ุงูุฏุงุฒู ุชฺฉ ููุงุฏ ุจุง SymbolInfoDouble
   double tickSize = SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_SIZE);  // ฺฏุฑูุชู ุงูุฏุงุฒู ุชฺฉ ููุงุฏ
   if(tickSize > 0)  // ฺฺฉ ุงฺฏุฑ tickSize ูุนุชุจุฑ ุจุงุดุฏ (ุจุฒุฑฺฏุชุฑ ุงุฒ ุตูุฑ)
   {
      // ุฑุงูุฏ ุจู ูุฒุฏฺฉโุชุฑู ูุถุฑุจ tickSize ุจุง MathRound ู ุณูพุณ ูุฑูุงูโุณุงุฒ ุจู _Digits ุจุง NormalizeDouble
      return NormalizeDouble(MathRound(price / tickSize) * tickSize, _Digits);  // ุฑุงูุฏ ุจู ูุฒุฏฺฉโุชุฑู ูุถุฑุจ tickSize ู ูุฑูุงูโุณุงุฒ ุจู _Digits
   }
   // ุงฺฏุฑ tickSize ุตูุฑ ุจูุฏุ ูุฑูุงูโุณุงุฒ ุงุณุชุงูุฏุงุฑุฏ ุจุฏูู ุฑุงูุฏ ุชฺฉ
   return NormalizeDouble(price, _Digits);  // ุงฺฏุฑ tickSize ุตูุฑ ุจูุฏุ ูุฑูุงูโุณุงุฒ ุงุณุชุงูุฏุงุฑุฏ
}

#endif  // ูพุงุงู ฺฺฉ include
```

```mql5
//+------------------------------------------------------------------+
//|                                                         CRange.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ุงู ูุงู ฺฉูุงุณ CRange ุฑุง ุชุนุฑู ูโฺฉูุฏ ฺฉู ูุณุชู ุงุณุชุฑุงุชฺ ุดฺฉุณุช ุฑูุฌ ุฑุง ูุฏุฑุช ูโฺฉูุฏ.
// ุงุณุชุฑุงุชฺ ฺฉู ุงฺฉุณูพุฑุช: ูุฑ ุฑูุฌ ุฒูุงู (ูุงููุฏ ุณุดู ุขุณุง) ุฑุง ุดูุงุณุง ูโฺฉูุฏุ ุณูู ู ฺฉู ุขู ุฑุง ุชุนู ูโฺฉูุฏุ 
// ุงฺฏุฑ ุงุฑุชูุงุน ูุนุชุจุฑ ุจุงุดุฏุ ุจุง ุงูุณุช (ุจุฑ ุงุณุงุณ ATR ุง ุฏุฑุตุฏ) ูุณูุญ ูโุดูุฏุ ููุชุธุฑ ฺฉูุฏู ุจุฑฺฉ (ุดฺฉุณุช) ูโูุงูุฏุ 
// ุจู ุตูุฑุช ุงุฎุชุงุฑ ููุช ุฑุง ุชุฃุฏ ูโฺฉูุฏ (ุงฺฏุฑ Inp_PriceConfirmation_Enabled ูุนุงู ุจุงุดุฏ)ุ 
// ููุชุฑ ุฑููุฏ ุฑุง ุจู ุทูุฑ ูุณุชูู ู ุฏุฑ ูุญุธู ฺฺฉ ูโฺฉูุฏุ ูุนุงููู ุจุงุฒ ูโฺฉูุฏ 
// ู ุณูพุณ ูุนุงููู ุฑุง ุจุง ุฎุฑูุฌ ูพููโุง (ููฺฏุงู ุฑุณุฏู ุจู RR)ุ ุงูุชูุงู SL ุจู ูุฑูุฏุ ู ุชุฑููฺฏ ูุฏุฑุช ูโฺฉูุฏ. 
// ุงู ุงุณุชุฑุงุชฺ ุจุฑุง ุจุงุฒุงุฑูุง ุฑูุฌ ุจุง ุดฺฉุณุช ูู ููุงุณุจ ุงุณุช ู ุจุง ููุชุฑ ุงฺููฺฉู ุฑุณฺฉ ุฎูุงู ุฑููุฏ ุฑุง ฺฉุงูุด ูโุฏูุฏ.
// ููุทู ูุงู CRange.mqh: ุงู ฺฉูุงุณ ุจุฑุง ูุฑ ุฑูุฌ ุฌุฏุงฺฏุงูู ุนูู ูโฺฉูุฏ. 
// ูุงุดู ุญุงูุช (ENUM_RANGE_STATE) ุฌุฑุงู ุฑุง ฺฉูุชุฑู ูโฺฉูุฏ: ุงุฒ ุงูุชุธุงุฑ ุฑูุฌ ุฌุฏุฏ ุดุฑูุน ูโุดูุฏุ 
// ุฑูุฌ ุฑุง ุดูุงุณุง ู ููุฏ ูโฺฉูุฏุ ูุณูุญ ูโฺฉูุฏุ ููุชุธุฑ ุจุฑฺฉ ู ุชุฃุฏูุง ูโูุงูุฏุ ูุนุงููู ุงุฌุฑุง ูโฺฉูุฏ ู ูุฏุฑุช ูโฺฉูุฏ. 
// ูพุงฺฉุณุงุฒ ูุฑู ุจุฑุง ุฑุณุช ุฑูุฒุงูู ู ุณุฎุช ุจุฑุง ุจุณุชู ูุนุงููุงุช ุฏุฑ ุชุนุทูุงุช ุงุณุชูุงุฏู ูโุดูุฏ. 
// ฺฉุด ATR ุจุฑุง ุจูููโุณุงุฒ ูุญุงุณุจุงุชุ ู ูุฑุงุฎูุงู ูุณุชูู g_trendFilter ุจุฑุง ููุชุฑ ุฏูุงูฺฉ. 
// ุชุบุฑุงุช ุฌุฏุฏ ุฏุฑ ูุณุฎู 2.10: ุญุฐู CleanupPaths ู ุงุฏุบุงู ุฏุฑ SoftCleanup ุฌุฏุฏ ุจุฑุง ุญู ุจุงฺฏ ููู ุดุฏูุ 
// ุงุตูุงุญ CheckCleanup ุจุฑุง ูุฑุงุฎูุงู SoftCleanupุ ุงุตูุงุญ ManageActiveTrade ุจุฑุง ุฑุณุช ููุฑ ุจุง SoftCleanupุ 
// ุงุถุงูู m_initialSlDistance ู ุฐุฎุฑู ุฏุฑ ฺฉุงููุช ูุนุงูููุ ุงุถุงูู RestoreState ุจุฑุง ุจุงุฒุงุจุ 
// ุงุณุชูุงุฏู ุงุฒ m_initialSlDistance ุฏุฑ ManageActiveTradeุ ุงุตูุงุญ m_slToBeMoved ุฏุฑ ManageActiveTrade ุจุฑุง ุฌููฺฏุฑ ุงุฒ Race Conditionุ 
// ฺฉุงููุชโฺฏุฐุงุฑ ุฏูู ูุฑ ุฎุทุ ู ุญูุธ ุณุงุฎุชุงุฑ ูุจู.

#ifndef CRANGE_MQH  // ฺฺฉ ูุฌูุฏ ูุงู
#define CRANGE_MQH  // ุชุนุฑู ูุงฺฉุฑู

#include "TimeHelper.mqh"  // ฺฉูุงุณ ฺฉูฺฉโฺฉููุฏู ุฒูุงู ุจุฑุง ูุญุงุณุจุงุช ุฑูุฌ ู ูพุงฺฉุณุงุฒ
#include "RiskManager.mqh"  // ฺฉูุงุณ ูุฏุฑุช ุฑุณฺฉ ุจุฑุง ูุญุงุณุจู ุญุฌู
#include "Utils.mqh"  // ฺฉูุงุณ ฺฉูฺฉ ุจุฑุง ูุฑูุงูโุณุงุฒ ููุชโูุง
#include "Logger.mqh"  // ฺฉุชุงุจุฎุงูู ูุงฺฏ ููุดููุฏ ุจุฑุง ฺุงูพ ูพุงูโูุง ฺฉูุชุฑูโุดุฏู

// ุชุนุฑู enum ุจุฑุง ุญุงูุชโูุง ุฑูุฌ (ูุงุดู ุญุงูุช ุจุฑุง ฺฉูุชุฑู ุฌุฑุงู ูุฑ ุฑูุฌ ุฌุฏุงฺฏุงูู)
// ุงู enum ุฌุฑุงู ุงุณุชุฑุงุชฺ ุฑุง ุงุฒ ุงูุชุธุงุฑ ุชุง ูุฏุฑุช ูุนุงููู ฺฉูุชุฑู ูโฺฉูุฏ
enum ENUM_RANGE_STATE
{
   RANGE_IDLE,                  // ุงูุชุธุงุฑ ุจุฑุง ุฑูุฌ ุฌุฏุฏ (ุญุงูุช ุงููู ุง ูพุณ ุงุฒ ูพุงฺฉุณุงุฒุ ุขูุงุฏู ุดูุงุณุง)
   RANGE_IDENTIFYING,           // ุฏุฑ ุญุงู ุดูุงุณุง ุฑูุฌ (ูุญุงุณุจู ุณูู/ฺฉู ู ฺฺฉ ุงุฑุชูุงุน)
   RANGE_ARMED,                 // ุฑูุฌ ูุณูุญ ุดุฏู ู ููุชุธุฑ ุดฺฉุณุช (ุฎุทูุท ุงูุณุช ุฑุณู ุดุฏู)
   AWAITING_CONFIRMATION,       // ุงูุชุธุงุฑ ุชุงุฏ ูุฑูุฏ (ูพุณ ุงุฒ ฺฉูุฏู ุจุฑฺฉุ ฺฺฉ ุงุจุทุงู ู ุชุงุฏูุง)
   RANGE_TRADE_ACTIVE,          // ูุนุงููู ุงู ุฑูุฌ ูุนุงู ุงุณุช (ูุนุงููู ุจุงุฒ ุดุฏูุ ููุชุธุฑ ูพุงฺฉุณุงุฒ)
   RANGE_EXPIRED                // ุฑูุฌ ูููุถ ุดุฏู (ูพุณ ุงุฒ ูพุงฺฉุณุงุฒ ุง ูุงูุนุชุจุฑุ ุขูุงุฏู ุฑูุฌ ุฌุฏุฏ)
};

// ฺฉูุงุณ CRange ุจุฑุง ูุฏุฑุช ูุฑ ุฑูุฌ ุฒูุงู ุจู ุทูุฑ ูุณุชูู
// ุงู ฺฉูุงุณ ุชูุงู ููุทู ฺฉ ุฑูุฌ ุฑุง ุงุฒ ุดูุงุณุง ุชุง ุจุงุฒ ฺฉุฑุฏู ูุนุงููู ฺฉูพุณููู ูโฺฉูุฏ (ูุฏุฑุช ูุนุงููู ุจู CActiveTradeManager ููุชูู ุดุฏู)
class CRange  // ฺฉูุงุณ ุงุตู ูุฏุฑุช ุฑูุฌ
{
private:
   int m_rangeIndex;  // ุงูุฏฺฉุณ ุฑูุฌ (1 ุชุง 4 ุจุฑุง ุชูุงุฒุ ุจุฑุง ูุงฺฏ ู ุงุดุงุก)
   long m_magicNumber;  // ูุฌฺฉ ูุงูุจุฑ ููุญุตุฑุจูโูุฑุฏ ุจุฑุง ูุนุงููุงุช ุงู ุฑูุฌ (ุจุฑุง ุชูุงุฒ ุฏุฑ PositionsTotal)
   ENUM_TIMEFRAMES m_timeframe;  // ุชุงูโูุฑู ุงุฌุฑุง ุจุฑุง ูุญุงุณุจุงุช ุฑูุฌ (ุจุฑุง iHigh/iLow/iClose)
   int m_startHour;  // ุณุงุนุช ุดุฑูุน ุฑูุฌ (0-23ุ ุจุฑ ุงุณุงุณ GMT ุณุฑูุฑ)
   int m_startMinute;  // ุฏููู ุดุฑูุน ุฑูุฌ (0-59)
   int m_endHour;  // ุณุงุนุช ูพุงุงู ุฑูุฌ (0-23)
   int m_endMinute;  // ุฏููู ูพุงุงู ุฑูุฌ (0-59)
   int m_minRangePoints;  // ุญุฏุงูู ุงุฑุชูุงุน ูุฌุงุฒ ุฑูุฌ ุจู ูพููุช (ุจุฑุง ููุชุฑ ุฑูุฌโูุง ฺฉูฺฺฉ)
   int m_maxRangePoints;  // ุญุฏุงฺฉุซุฑ ุงุฑุชูุงุน ูุฌุงุฒ ุฑูุฌ ุจู ูพููุช (ุจุฑุง ููุชุฑ ุฑูุฌโูุง ุจุฒุฑฺฏ)
   ENUM_PLACEMENT_MODE m_placementMode;  // ุญุงูุช ุงูุณุช ุดฺฉุณุช (ATR ุง ุฏุฑุตุฏุ ุจุฑุง ูุญุงุณุจู ุณุทูุญ)
   int m_atrPeriod;  // ุฏูุฑู ATR ุจุฑุง ุงูุณุช (ุจุฑุง iATR)
   double m_atrMultiplier;  // ุถุฑุจ ATR ุจุฑุง ุงูุณุช (ุจุฑุง ุญุณุงุณุช)
   ENUM_SL_STRATEGY m_slStrategy;  // ุงุณุชุฑุงุชฺ ุฌุงฺฏุฐุงุฑ SL (ููุงุจู ุง ุณุทุญ ุดฺฉุณุชุ ุจุฑุง base point)
   ENUM_SL_CALC_MODE m_slCalcMode;  // ุญุงูุช ูุญุงุณุจู ุจุงูุฑ SL (ATR ุง ุฏุฑุตุฏ)
   int m_slAtrPeriod;  // ุฏูุฑู ATR ุจุฑุง ุจุงูุฑ SL
   double m_slAtrMultiplier;  // ุถุฑุจ ATR ุจุฑุง ุจุงูุฑ SL
   ENUM_TRAILING_MODE m_trailingMode;  // ุญุงูุช ุชุฑููฺฏ (ATR ุง Senkou B)
   int m_trailingAtrPeriod;  // ุฏูุฑู ATR ุจุฑุง ุชุฑููฺฏ
   double m_trailingAtrMultiplier;  // ุถุฑุจ ATR ุจุฑุง ุชุฑููฺฏ
   double m_rrRatio;  // ูุณุจุช R:R ุจุฑุง ุฎุฑูุฌ ูพููโุง (ุณูุฏ/ุฑุณฺฉ)
   double m_partialClosePercent;  // ุฏุฑุตุฏ ุฎุฑูุฌ ูพููโุง (0-100)
   int m_cleanupHours;  // ุณุงุนุชโูุง ูพุงฺฉุณุงุฒ ูพุณ ุงุฒ ูพุงุงู ุฑูุฌ (0-24)
   color m_color;  // ุฑูฺฏ ูุณุชุทู ุฑูุฌ (ุจุฑุง OBJ_RECTANGLE)
   ENUM_TIMEFRAMES m_trendFilterTimeframe;  // ุชุงูโูุฑู ููุชุฑ ุฑููุฏ (ุจุฑุง GetTrendDirection)
   int m_atrHandle;  // ููุฏู ATR ุจุฑุง ุงูุณุช (shared ุงุฒ Elemento)
   int m_slAtrHandle;  // ููุฏู ATR ุจุฑุง SL (ุฌุฏุงฺฏุงูู ุจุฑุง ุฏูุฑู ูุชูุงูุช)
   int m_trailingAtrHandle;  // ููุฏู ATR ุจุฑุง ุชุฑููฺฏ (ุฌุฏุงฺฏุงูู)
   ENUM_RANGE_STATE m_currentState;  // ุญุงูุช ูุนู ุฑูุฌ (ูุงุดู ุญุงูุช)
   double m_rangeHigh;  // ุณูู ุฑูุฌ ุดูุงุณุงโุดุฏู (ุงุฒ iHighest)
   double m_rangeLow;  // ฺฉู ุฑูุฌ ุดูุงุณุงโุดุฏู (ุงุฒ iLowest)
   double m_potentialBuyPrice;  // ุณุทุญ ุฎุฑุฏ ุจุง ุงูุณุช (ุจุฑุง ฺฺฉ ุจุฑฺฉ)
   double m_potentialSellPrice;  // ุณุทุญ ูุฑูุด ุจุง ุงูุณุช (ุจุฑุง ฺฺฉ ุจุฑฺฉ)
   double m_breakerCandleLevel;  // ุณุทุญ ฺฉููุฒ ฺฉูุฏู ุดฺฉููุฏู (ุจุฑุง ุชุงุฏ ููุช)
   ulong m_activeTicket;  // ุชฺฉุช ูุนุงููู ูุนุงู (ุงุฒ result.deal)
   double m_cachedATR;  // ฺฉุด ATR ุจุฑุง ูุฑูุฏ (ุซุงุจุชุ ูุญุงุณุจู ุฏุฑ ุดูุงุณุง)
   double m_cachedSlATR;  // ฺฉุด ATR ุจุฑุง SL (ุซุงุจุช)
   double m_cachedTrailingATR;  // ฺฉุด ATR ุจุฑุง ุชุฑููฺฏ (ูพูุง ุฏุฑ ูุฏุฑุชุ ุงูุง ฺฉุด ุงููู)
   int m_waitCounter;  // ุดูุงุฑูุฏู ฺฉูุฏู ุจุฑุง ุญุงูุช ุชุงูุฑ ูุฏู (ููุท ุงฺฏุฑ CONFIRMATION_TIMEOUT)
   datetime m_cleanupTime;  // ุฒูุงู ูพุงฺฉุณุงุฒ ูุญุงุณุจูโุดุฏู (ุงุฒ CalculateCleanupTime)
   datetime m_lastEndTime;  // ุขุฎุฑู ุฒูุงู ูพุงุงู ูพุฑุฏุงุฒุด ุดุฏู (ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑ ุดูุงุณุง)
   bool m_lastInvalid;  // ููฺฏ ุขุฎุฑู ุฑูุฌ ูุงูุนุชุจุฑ (ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑ)
   datetime m_rangeEndTime;  // ุฒูุงู ฺฉุงูู ูพุงุงู ุฑูุฌ (ุจุฑุง ูุญุงุณุจู ุฏูู ูพุงฺฉุณุงุฒ)
   datetime m_lastFilterBarTime;  // ุฒูุงู ุขุฎุฑู ฺฉูุฏู ููุชุฑ ุฑููุฏ (ุจุฑุง ุขูพุฏุช ููุงุด)
   double m_fixedOffsetValue;  // ููุฏุงุฑ ุซุงุจุช ุงูุณุช ATR ุง ุฏุฑุตุฏ ุฏุฑ ูุญุธู ุดูุงุณุง ุฑูุฌ (ุจุฑุง ุซุงุจุช ฺฉุฑุฏู ุฎุทูุท)
   string m_rangeObjectName;  // ูุงู ูุณุชุทู ุฑูุฌ (ุจุฑุง OBJ_RECTANGLE)
   string m_buyLineName;  // ูุงู ุฎุท ุฎุฑุฏ (ุจุฑุง OBJ_HLINE)
   string m_sellLineName;  // ูุงู ุฎุท ูุฑูุด (ุจุฑุง OBJ_HLINE)
   double m_initialSlDistance; // ูุงุตูู SL ุงููู (ุจุฑุง ุฐุฎุฑู ู ุจุงุฒุงุจ ุฏุฑ ฺฉุงููุช ูุนุงูููุ ุจุฑุง ุญู ุจุงฺฏ ุจุงุฒุงุจ ูุงูุต)
   bool m_isCleanedForThisCycle;  // ููฺฏ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูพุงฺฉุณุงุฒ ูฺฉุฑุฑ ุฏุฑ ฺฉ ฺุฑุฎู

   // ุดูุงุณุง ู ููุฏ ุฑูุฌ: ูุญุงุณุจู ุณูู/ฺฉูุ ฺฺฉ ุงุฑุชูุงุน ู ุฑุณู ูุณุชุทู ุงฺฏุฑ ูุนุชุจุฑ ุจุงุดุฏ
   // ุงู ุชุงุจุน ุฑูุฌ ุฑุง ุจุฑ ุงุณุงุณ ุฒูุงู ูุญุงุณุจู ู ููุฏ ูโฺฉูุฏ
   void IdentifyAndValidateRange();  // ุดูุงุณุง ู ููุฏ ุฑูุฌ

   // ุงูุชุธุงุฑ ุจุฑุง ฺฉูุฏู ุจุฑฺฉ: ฺฺฉ ฺฉููุฒ ุจุงูุง/ูพุงู ุงูุณุช ุจุฑุง ุดุฑูุน ุชุงุฏ ูุฑูุฏ
   // ุงู ุชุงุจุน ุดฺฉุณุช ุฑุง ุชุดุฎุต ูโุฏูุฏ
   void WaitForBreakerCandle();  // ุงูุชุธุงุฑ ุจุฑุง ฺฉูุฏู ุจุฑฺฉ

   // ูุฑุขูุฏ ุชูุงุด ูุฑูุฏ: ฺฺฉ ุงุจุทุงูุ ุชุงุฏ ููุช ู ููุชุฑ ุฑููุฏุ ุงุฌุฑุง ูุนุงููู ุงฺฏุฑ ุชุงุฏ ุดุฏ
   // ุงู ุชุงุจุน ุงุจุทุงู ู ุชุงุฏูุง ุฑุง ูุฏุฑุช ูโฺฉูุฏ
   void ProcessEntryAttempt();  // ูุฑุขูุฏ ุชูุงุด ูุฑูุฏ

   // ุฑุณุช ุจู ุญุงูุช ูุณูุญ: ุฑุณุช ุณุทุญ ุจุฑฺฉ ุจุฏูู ุญุฐู ุฎุทูุท ุจุฑุง ุญูุธ ูุฑุตุชโูุง
   // ุงู ุชุงุจุน ุจุฑุง ุงุจุทุงู ุจุฏูู ูพุงฺฉุณุงุฒ ุงุณุชูุงุฏู ูโุดูุฏ
   void ResetToArmedState();  // ุฑุณุช ุจู ุญุงูุช ูุณูุญ

   // ุงุฌุฑุง ูุนุงููู: ูุญุงุณุจู SL ุจุง ุงุณุชุฑุงุชฺ ุฌุฏุฏุ ุญุฌู ู ุงุฑุณุงู ุณูุงุฑุด ุจุงุฒุงุฑ
   // ุงู ุชุงุจุน ูุนุงููู ุฑุง ุจุงุฒ ูโฺฉูุฏ
   void ExecuteTrade(bool isBuy);  // ุงุฌุฑุง ูุนุงููู

   // ุบุฑูุนุงู ฺฉุฑุฏู ูุณุฑ ูุฎุงูู: ุญุฐู ุฎุท ู ุฑุณุช ููุช ุจุฑุง OCO
   // ุงู ุชุงุจุน ูุณุฑ ูุฎุงูู ุฑุง ุบุฑูุนุงู ูโฺฉูุฏ
   void DisableOppositePath(bool isBuy);  // ุบุฑูุนุงู ฺฉุฑุฏู ูุณุฑ ูุฎุงูู

   // ูพุงฺฉุณุงุฒ ูุฑู: ุฑุณุช ูุชุบุฑูุง ู ุญุฐู ุงุดุงุก ุจุฏูู ุจุณุชู ูุนุงููู
   // ุงู ุชุงุจุน ุจุฑุง ุฑุณุช ุฑูุฒุงูู ุงุณุชูุงุฏู ูโุดูุฏ
   void SoftCleanup();  // ูพุงฺฉุณุงุฒ ูุฑู

   // ฺฏุฑูุชู ATR ฺฉุดโุดุฏู: ูุญุงุณุจู ุงฺฏุฑ ุฎุงู ุจุงุดุฏ (ุจุฑุง ูุฑูุฏ ุซุงุจุช)
   // ุงู ุชุงุจุน ฺฉุด ATR ุฑุง ูุฏุฑุช ูโฺฉูุฏ
   double GetCachedATR();  // ฺฏุฑูุชู ATR ฺฉุดโุดุฏู

   // ฺฏุฑูุชู ATR ุจุฑุง SL: ูุดุงุจู ุจุฑุง SL (ุซุงุจุช)
   // ุงู ุชุงุจุน ฺฉุด SL ุฑุง ูุฏุฑุช ูโฺฉูุฏ
   double GetSlATR();  // ฺฏุฑูุชู ATR ุจุฑุง SL

   // ฺฏุฑูุชู ATR ุจุฑุง ุชุฑููฺฏ: ูุดุงุจู ุจุฑุง ุชุฑููฺฏ (ูพูุง ุฏุฑ ูุฏุฑุช)
   // ุงู ุชุงุจุน ฺฉุด ุชุฑููฺฏ ุฑุง ูุฏุฑุช ูโฺฉูุฏ
   double GetTrailingATR();  // ฺฏุฑูุชู ATR ุจุฑุง ุชุฑููฺฏ

public:
   // ุณุงุฒูุฏู ูพุดโูุฑุถ ุจุง ููุงุฏุฑ ุงููู ุจุฑุง ุฌููฺฏุฑ ุงุฒ garbage values
   CRange() : m_rangeIndex(0), m_magicNumber(0), m_timeframe(PERIOD_CURRENT), m_startHour(0), m_startMinute(0), m_endHour(0), m_endMinute(0),
              m_minRangePoints(0), m_maxRangePoints(0), m_placementMode(PLACEMENT_ATR), m_atrPeriod(0), m_atrMultiplier(0.0),
              m_slStrategy(SL_OPPOSITE_SIDE), m_slCalcMode(SL_CALC_ATR), m_slAtrPeriod(0), m_slAtrMultiplier(0.0),
              m_trailingMode(TRAILING_ATR), m_trailingAtrPeriod(0), m_trailingAtrMultiplier(0.0), m_rrRatio(0.0), m_partialClosePercent(0.0),
              m_cleanupHours(0), m_color(clrNONE), m_trendFilterTimeframe(PERIOD_CURRENT), m_atrHandle(INVALID_HANDLE),
              m_slAtrHandle(INVALID_HANDLE), m_trailingAtrHandle(INVALID_HANDLE), m_currentState(RANGE_IDLE),
              m_rangeHigh(0), m_rangeLow(0), m_potentialBuyPrice(0), m_potentialSellPrice(0), m_breakerCandleLevel(0),
              m_activeTicket(0), m_cachedATR(0), m_cachedSlATR(0), m_cachedTrailingATR(0),
              m_waitCounter(0), m_cleanupTime(0), m_lastEndTime(0), m_lastInvalid(false), m_rangeEndTime(0), m_lastFilterBarTime(0),
              m_fixedOffsetValue(0.0), m_rangeObjectName(""), m_buyLineName(""), m_sellLineName(""), m_initialSlDistance(0.0), m_isCleanedForThisCycle(false) {}  // ุณุงุฒูุฏู ูพุดโูุฑุถ ุจุง ููุงุฏุฑ ุงููู

   // ููุฏุงุฑุฏู ุฑูุฌ: ุชูุธู ูพุงุฑุงูุชุฑูุงุ ุงุฌุงุฏ ููุฏูโูุง ATR ู ูุงูโฺฏุฐุงุฑ ุงุดุงุก
   // ุงู ุชุงุจุน ุชูุงู ูพุงุฑุงูุชุฑูุง ุฑุง ุงุฒ ูุฑูุฏโูุง ูโฺฏุฑุฏ
   bool Init(int index, long magic, ENUM_TIMEFRAMES timeframe, int startHour, int startMinute, int endHour, int endMinute,
             int minRangePoints, int maxRangePoints, ENUM_PLACEMENT_MODE placementMode, int atrPeriod, double atrMultiplier,
             ENUM_SL_STRATEGY slStrategy, ENUM_SL_CALC_MODE slCalcMode, int slAtrPeriod, double slAtrMultiplier,
             ENUM_TRAILING_MODE trailingMode, int trailingAtrPeriod, double trailingAtrMultiplier,
             double rrRatio, double partialClosePercent, int cleanupHours, color col, ENUM_TIMEFRAMES trendTf, int sharedAtrHandle);  // ููุฏุงุฑุฏู ุฑูุฌ

   // ุฏูุน ุฑูุฌ: ุขุฒุงุฏุณุงุฒ ููุฏูโูุง ATR
   // ุงู ุชุงุจุน ููุงุจุน ุฑุง ุขุฒุงุฏ ูโฺฉูุฏ
   void Deinit();  // ุฏูุน ุฑูุฌ

   // ุจูโุฑูุฒุฑุณุงู ุฏุฑ ฺฉูุฏู ุฌุฏุฏ: ุงุฌุฑุง ูุงุดู ุญุงูุช
   // ุงู ุชุงุจุน ุจุฑ ุงุณุงุณ ุญุงูุช ูุนู ุนูู ูโฺฉูุฏ
   void UpdateOnNewBar();  // ุจูโุฑูุฒุฑุณุงู ุฏุฑ ฺฉูุฏู ุฌุฏุฏ

   // ูพุงฺฉุณุงุฒ ุณุฎุช: ุจุณุชู ูุนุงููู ุงฺฏุฑ ุจุงุฒ ุจุงุดุฏ ู ุณูพุณ ูพุงฺฉุณุงุฒ ูุฑู (ุจุฑุง ุชุนุทูุงุช ุง ุฏูุน)
   // ุงู ุชุงุจุน ุจุฑุง ูพุงฺฉุณุงุฒ ฺฉุงูู ุงุณุชูุงุฏู ูโุดูุฏ
   void HardCleanup();  // ูพุงฺฉุณุงุฒ ุณุฎุช

   // ฺฺฉ ูพุงฺฉุณุงุฒ: ฺฺฉ ุฒูุงู ุงููุถุง ู ูุฑุงุฎูุงู ูพุงฺฉุณุงุฒ ููุงุณุจ
   // ุงู ุชุงุจุน ุฏุฑ OnTick ูุฑุงุฎูุงู ูโุดูุฏ
   void CheckCleanup();  // ฺฺฉ ูพุงฺฉุณุงุฒ

   // ุฑุณุช ฺฉุดโูุง: ุตูุฑ ฺฉุฑุฏู ฺฉุด ATRูุง ุจุฑุง ุฑูุฌ ุฌุฏุฏ
   // ุงู ุชุงุจุน ฺฉุดโูุง ุฑุง ุฑุณุช ูโฺฉูุฏ
   void ResetCaches();  // ุฑุณุช ฺฉุดโูุง

   // ฺฏุฑูุชู ุชุงูโูุฑู ุงุฌุฑุง
   // ุงู ฺฏุชุฑ ุชุงูโูุฑู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ
   ENUM_TIMEFRAMES GetTimeframe() const { return m_timeframe; }  // ุจุงุฒฺฏุดุช ุชุงูโูุฑู ุงุฌุฑุง

   // ฺฏุฑูุชู ุชุงูโูุฑู ููุชุฑ ุฑููุฏ
   // ุงู ฺฏุชุฑ ููุชุฑ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ
   ENUM_TIMEFRAMES GetTrendFilterTimeframe() const { return m_trendFilterTimeframe; }  // ุจุงุฒฺฏุดุช ุชุงูโูุฑู ููุชุฑ

   // ฺฏุฑูุชู ุญุงูุช ูุนู
   // ุงู ฺฏุชุฑ ุญุงูุช ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ
   ENUM_RANGE_STATE GetCurrentState() const { return m_currentState; }  // ุจุงุฒฺฏุดุช ุญุงูุช ูุนู

   // ุชูุธู ุญุงูุช ูุนู (ุจุฑุง ุงุณุชูุงุฏู ุฏุงุฎู ุง ุจุงุฒุงุจ ุญุงูุธู)
   // ุงู ุณุชุฑ ุญุงูุช ุฑุง ุชูุธู ูโฺฉูุฏ
   void SetCurrentState(ENUM_RANGE_STATE state) { m_currentState = state; }  // ุชูุธู ุญุงูุช

   // ฺฏุฑูุชู ุฒูุงู ุขุฎุฑู ฺฉูุฏู ููุชุฑ
   // ุงู ฺฏุชุฑ ุฒูุงู ููุชุฑ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ
   datetime GetLastFilterBarTime() const { return m_lastFilterBarTime; }  // ุจุงุฒฺฏุดุช ุฒูุงู ููุชุฑ

   // ุจูโุฑูุฒุฑุณุงู ุฒูุงู ุขุฎุฑู ฺฉูุฏู ููุชุฑ
   // ุงู ุณุชุฑ ุฒูุงู ุฑุง ุขูพุฏุช ูโฺฉูุฏ
   void UpdateLastFilterBarTime(datetime time) { m_lastFilterBarTime = time; }  // ุชูุธู ุฒูุงู ููุชุฑ

   // ุชูุธู ุชฺฉุช ูุนุงู (ุจุฑุง ุจุงุฒุงุจ ุญุงูุธู)
   // ุงู ุณุชุฑ ุชฺฉุช ุฑุง ุชูุธู ูโฺฉูุฏ
   void SetActiveTicket(ulong ticket) { m_activeTicket = ticket; }  // ุชูุธู ุชฺฉุช

   // (ุฌุฏุฏ) ุจุงุฒุงุจ ูุถุนุช: ุฐุฎุฑู ุณููุ ฺฉู ู ูุงุตูู SL ุงููู ุจุฑุง ุงุณุชูุงุฏู ูพุณ ุงุฒ ุฑโุงุณุชุงุฑุช
   // ุงู ุชุงุจุน ูุถุนุช ุฑุง ุงุฒ ฺฉุงููุช ุจุงุฒุงุจ ูโฺฉูุฏ
   void RestoreState(double range_high, double range_low, double initial_sl_distance)  // ุจุงุฒุงุจ ูุถุนุช
   {
      m_rangeHigh = range_high;  // ุฐุฎุฑู ุณูู
      m_rangeLow = range_low;  // ุฐุฎุฑู ฺฉู
      m_initialSlDistance = initial_sl_distance;  // ุฐุฎุฑู ูุงุตูู SL
      CLogger::Log("ูุถุนุช ุฑูุฌ " + IntegerToString(m_rangeIndex) + " ุจุง ููููุช ุจุงุฒุงุจ ุดุฏ.", m_rangeIndex);  // ฺุงูพ ููููุช
   }
};

// ูพุงุฏูโุณุงุฒ ุชูุงุจุน ฺฉูุงุณ CRange (ุฎุงุฑุฌ ุงุฒ ุชุนุฑู ฺฉูุงุณ ุจุฑุง ุฎูุงูุง)
// ุชูุงู ุชูุงุจุน private/public ุฏุฑ ุงุฏุงูู ุชุนุฑู ูโุดููุฏ

// ููุฏุงุฑุฏู ุฑูุฌ: ุชูุธู ูพุงุฑุงูุชุฑูุงุ ุงุฌุงุฏ ููุฏูโูุง ATR ู ูุงูโฺฏุฐุงุฑ ุงุดุงุก
// ุงู ุชุงุจุน ุชูุงู ููุฏูุง private ุฑุง ููุฏุงุฑุฏู ูโฺฉูุฏ
bool CRange::Init(int index, long magic, ENUM_TIMEFRAMES timeframe, int startHour, int startMinute, int endHour, int endMinute,
                  int minRangePoints, int maxRangePoints, ENUM_PLACEMENT_MODE placementMode, int atrPeriod, double atrMultiplier,
                  ENUM_SL_STRATEGY slStrategy, ENUM_SL_CALC_MODE slCalcMode, int slAtrPeriod, double slAtrMultiplier,
                  ENUM_TRAILING_MODE trailingMode, int trailingAtrPeriod, double trailingAtrMultiplier,
                  double rrRatio, double partialClosePercent, int cleanupHours, color col, ENUM_TIMEFRAMES trendTf, int sharedAtrHandle)  // ูพุงุฑุงูุชุฑูุง ูุฑูุฏ
{
   // ุชูุธู ุงูุฏฺฉุณ ุฑูุฌ ุจุฑุง ูุงฺฏ ู ุงุดุงุก
   m_rangeIndex = index;  // ุชูุธู ุงูุฏฺฉุณ ุฑูุฌ
   // ุชูุธู ูุฌฺฉ ุจุฑุง ุชูุงุฒ ูุนุงููุงุช
   m_magicNumber = magic;  // ุชูุธู ูุฌฺฉ
   // ุชูุธู ุชุงูโูุฑู ุงุฌุฑุง
   m_timeframe = timeframe;  // ุชูุธู ุชุงูโูุฑู ุงุฌุฑุง
   // ุชูุธู ุฒูุงู ุดุฑูุน
   m_startHour = startHour;  // ุชูุธู ุณุงุนุช ุดุฑูุน
   m_startMinute = startMinute;  // ุชูุธู ุฏููู ุดุฑูุน
   // ุชูุธู ุฒูุงู ูพุงุงู
   m_endHour = endHour;  // ุชูุธู ุณุงุนุช ูพุงุงู
   m_endMinute = endMinute;  // ุชูุธู ุฏููู ูพุงุงู
   // ุชูุธู ูุญุฏูุฏุชโูุง ุงุฑุชูุงุน
   m_minRangePoints = minRangePoints;  // ุชูุธู ุญุฏุงูู ุงุฑุชูุงุน
   m_maxRangePoints = maxRangePoints;  // ุชูุธู ุญุฏุงฺฉุซุฑ ุงุฑุชูุงุน
   // ุชูุธู ุญุงูุช ุงูุณุช
   m_placementMode = placementMode;  // ุชูุธู ุญุงูุช ุงูุณุช
   // ุชูุธู ูพุงุฑุงูุชุฑูุง ATR ุงูุณุช
   m_atrPeriod = atrPeriod;  // ุชูุธู ุฏูุฑู ATR ุงูุณุช
   m_atrMultiplier = atrMultiplier;  // ุชูุธู ุถุฑุจ ATR ุงูุณุช
   // ุชูุธู ูพุงุฑุงูุชุฑูุง SL
   m_slStrategy = slStrategy;  // ุชูุธู ุงุณุชุฑุงุชฺ SL
   m_slCalcMode = slCalcMode;  // ุชูุธู ุญุงูุช ุจุงูุฑ SL
   m_slAtrPeriod = slAtrPeriod;  // ุชูุธู ุฏูุฑู ATR SL
   m_slAtrMultiplier = slAtrMultiplier;  // ุชูุธู ุถุฑุจ ATR SL
   // ุชูุธู ูพุงุฑุงูุชุฑูุง ุชุฑููฺฏ
   m_trailingMode = trailingMode;  // ุชูุธู ุญุงูุช ุชุฑููฺฏ
   m_trailingAtrPeriod = trailingAtrPeriod;  // ุชูุธู ุฏูุฑู ATR ุชุฑููฺฏ
   m_trailingAtrMultiplier = trailingAtrMultiplier;  // ุชูุธู ุถุฑุจ ATR ุชุฑููฺฏ
   // ุชูุธู ูพุงุฑุงูุชุฑูุง ูุฏุฑุช ูุนุงููู
   m_rrRatio = rrRatio;  // ุชูุธู ูุณุจุช RR
   m_partialClosePercent = partialClosePercent;  // ุชูุธู ุฏุฑุตุฏ ูพููโุง
   m_cleanupHours = cleanupHours;  // ุชูุธู ุณุงุนุชโูุง ูพุงฺฉุณุงุฒ
   m_color = col;  // ุชูุธู ุฑูฺฏ
   m_trendFilterTimeframe = trendTf;  // ุชูุธู ุชุงูโูุฑู ููุชุฑ
   m_atrHandle = sharedAtrHandle;  // ููุฏู ATR ุงูุณุช (ูุดุชุฑฺฉ)

   // ุงุฌุงุฏ ููุฏูโูุง ุฌุฏุงฺฏุงูู ุจุฑุง SL ู ุชุฑููฺฏ (ุจุฑุง ุฏูุฑูโูุง ูุชูุงูุช)
   // iATR ููุฏู ุงูุฏฺฉุงุชูุฑ ุฑุง ุงุฌุงุฏ ูโฺฉูุฏ
   m_slAtrHandle = iATR(_Symbol, timeframe, m_slAtrPeriod);  // ููุฏู ATR ุจุฑุง SL
   if(m_slAtrHandle == INVALID_HANDLE)  // ฺฺฉ ููููุช ุงุฌุงุฏ
   {
      CLogger::Log("ุฎุทุง ุฏุฑ ุงุฌุงุฏ ููุฏู ATR ุจุฑุง SL ุฑูุฌ " + IntegerToString(index), index);  // ฺุงูพ ุฎุทุง
      return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
   }
   m_trailingAtrHandle = iATR(_Symbol, timeframe, m_trailingAtrPeriod);  // ููุฏู ATR ุจุฑุง ุชุฑููฺฏ
   if(m_trailingAtrHandle == INVALID_HANDLE)  // ฺฺฉ ููููุช
   {
      CLogger::Log("ุฎุทุง ุฏุฑ ุงุฌุงุฏ ููุฏู ATR ุจุฑุง ุชุฑููฺฏ ุฑูุฌ " + IntegerToString(index), index);  // ฺุงูพ ุฎุทุง
      return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
   }

   // ูุงูโฺฏุฐุงุฑ ุงุดุงุก ฺฏุฑุงูฺฉ ุจุง ุงูุฏฺฉุณ ุจุฑุง ุชูุงุฒ
   m_rangeObjectName = "Range_Rect_" + IntegerToString(index);  // ูุงู ูุณุชุทู ุฑูุฌ
   m_buyLineName = "Range_BuyLine_" + IntegerToString(index);  // ูุงู ุฎุท ุฎุฑุฏ
   m_sellLineName = "Range_SellLine_" + IntegerToString(index);  // ูุงู ุฎุท ูุฑูุด

   ResetCaches();  // ุฑุณุช ฺฉุดโูุง ุฏุฑ ุดุฑูุน
   m_currentState = RANGE_IDLE;  // ุญุงูุช ุงููู ุงูุชุธุงุฑ
   m_lastFilterBarTime = 0;  // ุฑุณุช ุฒูุงู ููุชุฑ
   m_isCleanedForThisCycle = false;  // ุฑุณุช ููฺฏ ูพุงฺฉุณุงุฒ ฺุฑุฎู
   // ฺุงูพ ููููุช ุจุง CLogger
   CLogger::Log("ุฑูุฌ " + IntegerToString(index) + " ููุฏุงุฑุฏู ุดุฏ.", index);  // ฺุงูพ ููููุช
   return true;  // ุจุงุฒฺฏุดุช ููููุช
}

// ุฏูุน ุฑูุฌ: ุขุฒุงุฏุณุงุฒ ููุฏูโูุง ATR
// IndicatorRelease ููุฏูโูุง ุฑุง ุขุฒุงุฏ ูโฺฉูุฏ
void CRange::Deinit()  // ุชุงุจุน ุฏูุน
{
   if(m_slAtrHandle != INVALID_HANDLE) IndicatorRelease(m_slAtrHandle);  // ุขุฒุงุฏุณุงุฒ ููุฏู SL
   if(m_trailingAtrHandle != INVALID_HANDLE) IndicatorRelease(m_trailingAtrHandle);  // ุขุฒุงุฏุณุงุฒ ููุฏู ุชุฑููฺฏ
   CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + " ุฏูุน ุดุฏ.", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ
}

// ุจูโุฑูุฒุฑุณุงู ุฏุฑ ฺฉูุฏู ุฌุฏุฏ: ุงุฌุฑุง ูุงุดู ุญุงูุช
// ุณูุฆฺ ุจุฑ ุงุณุงุณ ุญุงูุช ูุนู ุจุฑุง ฺฉูุชุฑู ุฌุฑุงู
void CRange::UpdateOnNewBar()  // ุชุงุจุน ุจูโุฑูุฒุฑุณุงู
{
   // ูุงฺฏ ูุฑูุฏ ุจู ุชุงุจุน ุจุฑุง ุฑุฏุงุจ
   CLogger::Log("------ ุฏุฑ ุญุงูุช " + EnumToString(m_currentState) + " ------", m_rangeIndex);  // ุนููุงู ุญุงูุช

   // ุณูุฆฺ ุจุฑ ุงุณุงุณ ุญุงูุช ูุนู ุจุฑุง ุงุฌุฑุง ุชุงุจุน ูุฑุจูุทู
   switch(m_currentState)  // ุณูุฆฺ ุจุฑ ุงุณุงุณ ุญุงูุช ูุนู
   {
      case RANGE_IDLE:  // ุญุงูุช ุจฺฉุงุฑ
         // ฺฺฉ ุงฺฏุฑ ุฒูุงู ูุงุฑุฏ ูุญุฏูุฏู ุฑูุฌ ุดุฏู ุจุงุดุฏ
         datetime currentTime = TimeCurrent();  // ุฒูุงู ูุนู
         datetime startTime, endTime;  // ุฒูุงู ุดุฑูุน ู ูพุงุงู
         if(CTimeHelper::CalculateRangeTimes(m_startHour, m_startMinute, m_endHour, m_endMinute, startTime, endTime))  // ูุญุงุณุจู ุฒูุงูโูุง
         {
            if(currentTime >= startTime && currentTime < endTime)  // ฺฺฉ ุฏุงุฎู ูุญุฏูุฏู
            {
               CLogger::Log("ุฒูุงู ุฑูุฌ ูุฑุง ุฑุณุฏ. ุงูุชูุงู ุจู RANGE_IDENTIFYING.", m_rangeIndex);  // ูุงฺฏ ุงูุชูุงู
               m_currentState = RANGE_IDENTIFYING;  // ุชุบุฑ ุจู ุดูุงุณุง
            }
         }
         break;  // ุฎุฑูุฌ ุงุฒ ฺฉุณ
      case RANGE_IDENTIFYING:  // ุฏุฑ ุญุงู ุดูุงุณุง
         IdentifyAndValidateRange();  // ุดูุงุณุง ุฑูุฌ
         break;  // ุฎุฑูุฌ
      case RANGE_ARMED:  // ูุณูุญ ู ุงูุชุธุงุฑ
         WaitForBreakerCandle();  // ุงูุชุธุงุฑ ุจุฑฺฉ
         break;  // ุฎุฑูุฌ
      case AWAITING_CONFIRMATION:  // ุงูุชุธุงุฑ ุชุงุฏ
         ProcessEntryAttempt();  // ูุฑุขูุฏ ูุฑูุฏ
         break;  // ุฎุฑูุฌ
      case RANGE_TRADE_ACTIVE:  // ูุนุงููู ูุนุงู
         // ูฺ ุนููุ ููุชุธุฑ ูพุงฺฉุณุงุฒ
         CLogger::Log("ูุนุงููู ูุนุงู ุงุณุช. ููุชุธุฑ ูพุงฺฉุณุงุฒ.", m_rangeIndex);  // ูุงฺฏ ูุถุนุช
         break;  // ุฎุฑูุฌ
      case RANGE_EXPIRED:  // ูููุถ
         SoftCleanup();  // ูพุงฺฉุณุงุฒ ูุฑู
         m_currentState = RANGE_IDLE;  // ุจุงุฒฺฏุดุช ุจู ุจฺฉุงุฑ
         break;  // ุฎุฑูุฌ
   }

   CheckCleanup();  // ฺฺฉ ูพุงฺฉุณุงุฒ ุฏุฑ ูุฑ ฺฉูุฏู ุฌุฏุฏ
}

// ุดูุงุณุง ู ููุฏ ุฑูุฌ: ูุญุงุณุจู ุณูู/ฺฉูุ ฺฺฉ ุงุฑุชูุงุนุ ูุญุงุณุจู ุซุงุจุช ุงูุณุช ู ุฑุณู ูุณุชุทู ุงฺฏุฑ ูุนุชุจุฑ ุจุงุดุฏ
// ุงู ุชุงุจุน ุฑูุฌ ุฑุง ุจุฑ ุงุณุงุณ ุฒูุงู ู ุฏุงุฏูโูุง ฺฉูุฏู ูุญุงุณุจู ู ููุฏ ูโฺฉูุฏ
void CRange::IdentifyAndValidateRange()  // ุชุงุจุน ุดูุงุณุง
{
   CLogger::Log("ุดูุงุณุง ุฑูุฌ " + IntegerToString(m_rangeIndex) + "...", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุดูุงุณุง

   datetime startTime, endTime;  // ูุชุบุฑูุง ุฒูุงู ุดุฑูุน ู ูพุงุงู
   // ูุญุงุณุจู ุฒูุงูโูุง ุจุง CTimeHelper
   if(!CTimeHelper::CalculateRangeTimes(m_startHour, m_startMinute, m_endHour, m_endMinute, startTime, endTime))  // ูุญุงุณุจู ุฒูุงูโูุง
   {
      CLogger::Log("ุฎุทุง ุฏุฑ ูุญุงุณุจู ุฒูุงู ุฑูุฌ " + IntegerToString(m_rangeIndex), m_rangeIndex);  // ฺุงูพ ุฎุทุง
      m_currentState = RANGE_EXPIRED;  // ุชูุธู ุจู ูููุถ
      return;  // ุฎุฑูุฌ
   }

   // ฺฺฉ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูพุฑุฏุงุฒุด ุชฺฉุฑุงุฑ ุฑูุฌ ุฏุฑ ฺฉ ุฑูุฒ (ุจุง ฺฺฉ ูุงูุนุชุจุฑ ุจูุฏู ุขุฎุฑู)
   // ุงู ุดุฑุท ุงุฒ ูุญุงุณุจุงุช ูฺฉุฑุฑ ุฌููฺฏุฑ ูโฺฉูุฏ
   if(endTime == m_lastEndTime && !m_lastInvalid) return;  // ุงฺฏุฑ ููุงู ูพุงุงู ูุจู ู ูุนุชุจุฑุ ูพุฑุด
   if(endTime == m_lastEndTime && m_lastInvalid) return;  // ุงฺฏุฑ ููุงู ู ูุงูุนุชุจุฑุ ูพุฑุด
   if(TimeCurrent() < endTime) return;  // ุงฺฏุฑ ูููุฒ ูพุงุงู ูุฑุณุฏูุ ูพุฑุด

   m_rangeEndTime = endTime;  // ุฐุฎุฑู ุฒูุงู ูพุงุงู ฺฉุงูู ุจุฑุง ูพุงฺฉุณุงุฒ ุฏูู

   // iBarShift ุดูุช ฺฉูุฏู ุฑุง ุจุฑ ุงุณุงุณ ุฒูุงู ุจุฑูโฺฏุฑุฏุงูุฏ
   int startShift = iBarShift(_Symbol, m_timeframe, startTime);  // ุดูุช ุดุฑูุน
   int endShift = iBarShift(_Symbol, m_timeframe, endTime);  // ุดูุช ูพุงุงู

   if(startShift < 0 || endShift < 0)  // ฺฺฉ ุดูุช ูุนุชุจุฑ (ุจุฑุง Edge Case ุจุฏูู ฺฉูุฏู)
   {
      CLogger::Log("ุฎุทุง: ฺฉูุฏู ุฏุฑ ุจุงุฒู ุฒูุงู ูุดุฎุต ุดุฏู ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex) + " ุงูุช ูุดุฏ.", m_rangeIndex);  // ฺุงูพ ุฎุทุง
      m_lastInvalid = true;  // ุชูุธู ููฺฏ ูุงูุนุชุจุฑ
      m_lastEndTime = endTime;  // ุฐุฎุฑู ูพุงุงู
      m_currentState = RANGE_EXPIRED;  // ุชูุธู ุจู ูููุถ
      return;  // ุฎุฑูุฌ
   }

   int bars = startShift - endShift + 1;  // ุชุนุฏุงุฏ ุจุงุฑูุง ุฏุฑ ุฑูุฌ
   if(bars <= 0)  // ฺฺฉ ุชุนุฏุงุฏ ูุนุชุจุฑ
   {
      CLogger::Log("ุฎุทุง: ุชุนุฏุงุฏ ุจุงุฑูุง ูุงูุนุชุจุฑ ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex), m_rangeIndex);  // ฺุงูพ ุฎุทุง
      m_lastInvalid = true;  // ุชูุธู ููฺฏ
      m_lastEndTime = endTime;  // ุฐุฎุฑู ูพุงุงู
      m_currentState = RANGE_EXPIRED;  // ุชูุธู ุจู ูููุถ
      return;  // ุฎุฑูุฌ
   }

   // ูุญุงุณุจู ุณูู ู ฺฉู ุฑูุฌ ุจุง iHighest/iLowest
   int highestIdx = iHighest(_Symbol, m_timeframe, MODE_HIGH, bars, endShift);  // ุงูุฏฺฉุณ ุณูู
   int lowestIdx = iLowest(_Symbol, m_timeframe, MODE_LOW, bars, endShift);  // ุงูุฏฺฉุณ ฺฉู
   m_rangeHigh = iHigh(_Symbol, m_timeframe, highestIdx);  // ุณูู ุฑูุฌ
   m_rangeLow = iLow(_Symbol, m_timeframe, lowestIdx);  // ฺฉู ุฑูุฌ

   double rangeHeight = (m_rangeHigh - m_rangeLow) / _Point;  // ุงุฑุชูุงุน ุจู ูพููุช
   CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": ุณูู=" + DoubleToString(m_rangeHigh, _Digits) + ", ฺฉู=" + DoubleToString(m_rangeLow, _Digits) + ", ุงุฑุชูุงุน=" + DoubleToString(rangeHeight, 0) + " ูพููุช", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ

   // ฺฺฉ ฺฉูุช ุฑูุฌ (ุงุฑุชูุงุน ุฏุฑ ูุญุฏูุฏู ูุฌุงุฒ)
   if(rangeHeight < m_minRangePoints || rangeHeight > m_maxRangePoints)  // ุดุฑุท ฺฺฉ ุงุฑุชูุงุน
   {
      CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + " ุจโฺฉูุช ุงุณุช. ุงุฑุชูุงุน ุฎุงุฑุฌ ุงุฒ ูุญุฏูุฏู ูุฌุงุฒ.", m_rangeIndex);  // ฺุงูพ ุฎุทุง
      m_lastInvalid = true;  // ุชูุธู ููฺฏ
      m_lastEndTime = endTime;  // ุฐุฎุฑู ูพุงุงู
      m_currentState = RANGE_EXPIRED;  // ุชูุธู ุจู ูููุถ
      return;  // ุฎุฑูุฌ
   }

   // --- START: Calculate and Fix Offset Value --- (ูุญุงุณุจู ุซุงุจุช ุงูุณุช ุฏุฑ ูุญุธู ุดูุงุณุง ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฌุงุจุฌุง)
   // ุงู ุจุฎุด ุงูุณุช ุฑุง ุซุงุจุช ูโฺฉูุฏ
   if(m_placementMode == PLACEMENT_ATR)  // ุญุงูุช ATR
   {
      double atr_buffer[];  // ุจุงูุฑ ATR (ุฏูุงูฺฉ ุจุฏูู ุงูุฏุงุฒู ุซุงุจุช)
      ArraySetAsSeries(atr_buffer, true);  // ุชูุธู ุณุฑ ุขุฑุงู
      if(CopyBuffer(m_atrHandle, 0, 1, 1, atr_buffer) > 0)  // ฺฉูพ ATR ูุนู (shift 1 ุจุฑุง ฺฉูุฏู ุจุณุชู)
      {
         m_fixedOffsetValue = atr_buffer[0] * m_atrMultiplier;  // ูุญุงุณุจู ู ุฐุฎุฑู ุซุงุจุช
      }
      else  // ุดุฑุท ุดฺฉุณุช ฺฉูพ
      {
         CLogger::Log("ุฎุทุง ุฏุฑ ฺฏุฑูุชู ATR ุจุฑุง ุชุซุจุช ุงูุณุช ุฑูุฌ " + IntegerToString(m_rangeIndex), m_rangeIndex);  // ฺุงูพ ุฎุทุง
         m_currentState = RANGE_EXPIRED;  // ุชูุธู ุจู ูููุถ
         return;  // ุฎุฑูุฌ
      }
   }
   else  // ุญุงูุช ุฏุฑุตุฏ
   {
      m_fixedOffsetValue = (m_rangeHigh - m_rangeLow) * m_atrMultiplier / 100.0;  // ูุญุงุณุจู ุซุงุจุช ุฏุฑุตุฏ
   }
   // --- END: Calculate and Fix Offset Value ---

   // ุฑุณู ูุณุชุทู ุฑูุฌ ุงฺฏุฑ ูุนุชุจุฑ ุจุงุดุฏ ุจุง ObjectCreate
   if(!ObjectCreate(0, m_rangeObjectName, OBJ_RECTANGLE, 0, startTime, m_rangeHigh, endTime, m_rangeLow))  // ุฑุณู ูุณุชุทู
   {
      CLogger::Log("ุฎุทุง ุฏุฑ ุฑุณู ูุณุชุทู ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // ฺุงูพ ุฎุทุง
   }
   else  // ุดุฑุท ููููุช ุฑุณู
   {
      ObjectSetInteger(0, m_rangeObjectName, OBJPROP_COLOR, m_color);  // ุชูุธู ุฑูฺฏ
      ObjectSetInteger(0, m_rangeObjectName, OBJPROP_STYLE, STYLE_SOLID);  // ุชูุธู ุงุณุชุงู
      ObjectSetInteger(0, m_rangeObjectName, OBJPROP_WIDTH, 1);  // ุชูุธู ุนุฑุถ
      ObjectSetInteger(0, m_rangeObjectName, OBJPROP_FILL, true);  // ุชููพุฑ ฺฉุฑุฏู ูุณุชุทู (ุดุดูโุง)
      ObjectSetInteger(0, m_rangeObjectName, OBJPROP_BACK, true);  // ูพุณโุฒููู ุจุฑุง ุดูุงูุช
   }
   
   // ++++++++++++++++ START: ฺฉุฏ ุงุถุงูู ุดุฏู ุงุฒ ArmAndWait ++++++++++++++++
   CLogger::Log("ูุณูุญ ฺฉุฑุฏู ุฑูุฌ " + IntegerToString(m_rangeIndex) + "...", m_rangeIndex);

   // ุงุณุชูุงุฏู ุงุฒ ุงูุณุช ุซุงุจุช ูุญุงุณุจูโุดุฏู ุฏุฑ ุดูุงุณุง (ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฌุงุจุฌุง ุฎุทูุท)
   m_potentialBuyPrice = NormalizePrice(m_rangeHigh + m_fixedOffsetValue);
   m_potentialSellPrice = NormalizePrice(m_rangeLow - m_fixedOffsetValue);

   datetime currentTime = TimeCurrent();
   // ุฑุณู ุฎุท ุฎุฑุฏ
   if(!ObjectCreate(0, m_buyLineName, OBJ_HLINE, 0, currentTime, m_potentialBuyPrice))
   {
      CLogger::Log("ุฎุทุง ุฏุฑ ุฑุณู ุฎุท BUY ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex), m_rangeIndex);
   }
   else
   {
      ObjectSetInteger(0, m_buyLineName, OBJPROP_COLOR, clrGreen);
      ObjectSetInteger(0, m_buyLineName, OBJPROP_STYLE, STYLE_DASH);
   }
   // ุฑุณู ุฎุท ูุฑูุด
   if(!ObjectCreate(0, m_sellLineName, OBJ_HLINE, 0, currentTime, m_potentialSellPrice))
   {
      CLogger::Log("ุฎุทุง ุฏุฑ ุฑุณู ุฎุท SELL ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex), m_rangeIndex);
   }
   else
   {
      ObjectSetInteger(0, m_sellLineName, OBJPROP_COLOR, clrRed);
      ObjectSetInteger(0, m_sellLineName, OBJPROP_STYLE, STYLE_DASH);
   }

   // ูุญุงุณุจู ุฒูุงู ูพุงฺฉุณุงุฒ
   m_cleanupTime = CTimeHelper::CalculateCleanupTime(m_rangeEndTime, m_cleanupHours);
   CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + " ูุณูุญ ุดุฏ. Potential Buy: " + DoubleToString(m_potentialBuyPrice, _Digits) + ", Sell: " + DoubleToString(m_potentialSellPrice, _Digits), m_rangeIndex);
   // ++++++++++++++++ END: ฺฉุฏ ุงุถุงูู ุดุฏู ุงุฒ ArmAndWait ++++++++++++++++

   m_lastInvalid = false;  // ุฑุณุช ููฺฏ ูุงูุนุชุจุฑ
   m_lastEndTime = endTime;  // ุฐุฎุฑู ูพุงุงู
   m_currentState = RANGE_ARMED;  // ุชุบุฑ ุญุงูุช ุจู ูุณูุญ
   CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + " ูุนุชุจุฑ ุงุณุช. ุชุบุฑ ุญุงูุช ุจู ARMED.", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ
}

// ุงูุชุธุงุฑ ุจุฑุง ฺฉูุฏู ุจุฑฺฉ: ฺฺฉ ฺฉููุฒ ุจุงูุง/ูพุงู ุงูุณุช ุจุฑุง ุดุฑูุน ุชุงุฏ ูุฑูุฏ (ุจุฏูู ุชุงูุฑุ ููุท ุชูุธู ุญุงูุช ุฌุฏุฏ)
// ุงู ุชุงุจุน ุดฺฉุณุช ุฑุง ุจุฑ ุงุณุงุณ ฺฉููุฒ ฺฉูุฏู ูุจู ฺฺฉ ูโฺฉูุฏ
void CRange::WaitForBreakerCandle()  // ุชุงุจุน ุงูุชุธุงุฑ ุจุฑฺฉ
{
   // iClose ฺฉููุฒ ฺฉูุฏู ูุจู (shift 1) ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ
   double close1 = iClose(_Symbol, m_timeframe, 1);  // ฺฉููุฒ ฺฉูุฏู ูุจู
   if(close1 == 0)  // ฺฺฉ ููุฏุงุฑ ูุนุชุจุฑ
   {
      CLogger::Log("ุฎุทุง: iClose ููุฏุงุฑ ูุงูุนุชุจุฑ ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex), m_rangeIndex);  // ฺุงูพ ุฎุทุง
      return;  // ุฎุฑูุฌ
   }

   if(close1 > m_potentialBuyPrice)  // ฺฺฉ ุดฺฉุณุช ุฎุฑุฏ
   {
      m_breakerCandleLevel = iHigh(_Symbol, m_timeframe, 1);  // ุณุทุญ ูุง ฺฉูุฏู ุดฺฉุณุช
      CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + " - BUY Breaker Candle detected! Level: " + DoubleToString(m_breakerCandleLevel, _Digits), m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ
      m_waitCounter = 0;  // ุฑุณุช ุดูุงุฑูุฏู ุจุฑุง ุญุงูุช ูุฏู
      m_currentState = AWAITING_CONFIRMATION;  // ุชุบุฑ ุญุงูุช ุจู ุงูุชุธุงุฑ ูุฑูุฏ
   }
   else if(close1 < m_potentialSellPrice)  // ฺฺฉ ุดฺฉุณุช ูุฑูุด
   {
      m_breakerCandleLevel = iLow(_Symbol, m_timeframe, 1);  // ุณุทุญ ูู ฺฉูุฏู ุดฺฉุณุช
      CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + " - SELL Breaker Candle detected! Level: " + DoubleToString(m_breakerCandleLevel, _Digits), m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ
      m_waitCounter = 0;  // ุฑุณุช ุดูุงุฑูุฏู ุจุฑุง ุญุงูุช ูุฏู
      m_currentState = AWAITING_CONFIRMATION;  // ุชุบุฑ ุญุงูุช ุจู ุงูุชุธุงุฑ ูุฑูุฏ
   }
}

// ูุฑุขูุฏ ุชูุงุด ูุฑูุฏ: ฺฺฉ ุงุจุทุงู ุจุฑ ุงุณุงุณ ุจุงุฒฺฏุดุช ููุชุ ุชุงุฏ ููุช ู ููุชุฑ ุฑููุฏุ ุงุฌุฑุง ูุนุงููู ุงฺฏุฑ ุชุงุฏ ุดุฏ (ุจุฏูู ูุญุฏูุฏุช ุฒูุงู)
// ุงู ุชุงุจุน ุงุจุทุงูุ ุชุงุฏ ู ูุฑูุฏ ุฑุง ูุฏุฑุช ูโฺฉูุฏ
void CRange::ProcessEntryAttempt()  // ุชุงุจุน ูุฑุขูุฏ ูุฑูุฏ
{
   // ุชุดุฎุต ุฌูุช ุชูุงุด (ุฎุฑุฏ ุง ูุฑูุด) ุจุฑ ุงุณุงุณ ุณุทุญ ุจุฑฺฉ
   bool isBuyAttempt = (m_breakerCandleLevel == iHigh(_Symbol, m_timeframe, 1));  // ุชุดุฎุต ุฎุฑุฏ ุงฺฏุฑ ุณุทุญ ูุง ุจุงุดุฏ
   double close1 = iClose(_Symbol, m_timeframe, 1);  // ฺฉููุฒ ฺฉูุฏู ูุจู ุจุฑุง ฺฺฉ ุงุจุทุงู ู ุชุงุฏ
   bool isInvalid = false;  // ููฺฏ ุจุฑุง ุดุฑุท ุงุจุทุงู (ุจุฑุง ุชูุฒุชุฑ ุดุฏู ฺฉุฏ)

   // ุงฺฏุฑ ุญุงูุช ูุฏู (ุชุงูโุงูุช) ุงูุชุฎุงุจ ุดุฏูุ ฺฺฉ ุดูุงุฑูุฏู ฺฉูุฏูโูุง
   // ุงู ููุทู ููุท ุฏุฑ CONFIRMATION_TIMEOUT ูุนุงู ุงุณุช
   if(Inp_Confirmation_Strategy == CONFIRMATION_TIMEOUT)  // ุญุงูุช ูุฏู ุจุง ุชุงูุฑ
   {
      m_waitCounter++;  // ุงูุฒุงุด ุดูุงุฑูุฏู ฺฉูุฏูโูุง
      if(m_waitCounter >= Inp_Confirmation_Timeout)  // ฺฺฉ ูููุช ุชูุงู ุดุฏู
      {
         CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": ูููุช ุชุงุฏ ุชูุงู ุดุฏ. ุงุจุทุงู.", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ
         ResetToArmedState();  // ุฑุณุช ุจู ูุณูุญ
         return;  // ุฎุฑูุฌ
      }
   }

   // ฑ. ุดุฑุท ุงุจุทุงู ู ุฑุณุช (ุจุฑ ุงุณุงุณ ุงูุชุฎุงุจ ฺฉุงุฑุจุฑ ุงุฒ Inp_Invalidation_Mode - ููุท ุจุฑุง ุญุงูุช ุฌุฏุฏ)
   // ุงู ุจุฎุด ุงุจุทุงู ุฑุง ุจุฑ ุงุณุงุณ ุงุณุชุฑุงุชฺ ฺฺฉ ูโฺฉูุฏ
   if(Inp_Confirmation_Strategy == CONFIRMATION_PRICE_INVALIDATION)  // ุญุงูุช ุฌุฏุฏ ุจุง ููุช
   {
      if(Inp_Invalidation_Mode == INVALIDATION_RANGE_REENTRY)  // ุญุงูุช ุตุจูุฑ: ุจุงุฒฺฏุดุช ุจู ุฏุงุฎู ุฑูุฌ ุงุตู
      {
         if(isBuyAttempt && close1 < m_rangeHigh) isInvalid = true;  // ุงุจุทุงู ุฎุฑุฏ ุงฺฏุฑ ฺฉููุฒ ุฒุฑ ุณูู ุฑูุฌ
         if(!isBuyAttempt && close1 > m_rangeLow) isInvalid = true;  // ุงุจุทุงู ูุฑูุด ุงฺฏุฑ ฺฉููุฒ ุจุงูุง ฺฉู ุฑูุฌ
      }
      else  // ุญุงูุช ุชูุงุฌู: INVALIDATION_BREAKOUT_LINE_CROSS - ุนุจูุฑ ุงุฒ ุฎุท ุดฺฉุณุช (ุงูุณุช)
      {
         if(isBuyAttempt && close1 < m_potentialBuyPrice) isInvalid = true;  // ุงุจุทุงู ุฎุฑุฏ ุงฺฏุฑ ฺฉููุฒ ุฒุฑ ุฎุท ุฎุฑุฏ
         if(!isBuyAttempt && close1 > m_potentialSellPrice) isInvalid = true;  // ุงุจุทุงู ูุฑูุด ุงฺฏุฑ ฺฉููุฒ ุจุงูุง ุฎุท ูุฑูุด
      }

      // ุงฺฏุฑ ุดุฑุท ุงุจุทุงู ุจุฑูุฑุงุฑ ุจูุฏุ ุฑุณุช ฺฉู ู ุงุฒ ุชุงุจุน ุฎุงุฑุฌ ุดู
      if(isInvalid)  // ฺฺฉ ููฺฏ ุงุจุทุงู
      {
         ResetToArmedState();  // ุฑุณุช ุจู ุญุงูุช ูุณูุญ ุจุฏูู ุญุฐู ูุณุฑูุง
         return;  // ุฎุฑูุฌ ุงุฒ ุชุงุจุน
      }
   }

   // ฒ. ฺฺฉ ฺฉุฑุฏู ุดุฑุงุท ูุฑูุฏ
   // ุงูู) ุชุงุฏู ููุช (ุงุฎุชุงุฑ: ฺฺฉ ฺฉููุฒ ุจุงูุง/ูพุงู ุณุทุญ ุจุฑฺฉ)
   // Inp_PriceConfirmation_Enabled ุงุฎุชุงุฑ ุงุณุช
   bool priceConfirmed = !Inp_PriceConfirmation_Enabled ||  // ุงฺฏุฑ ุชุงุฏ ููุช ุฎุงููุดุ ููุดู ุฏุฑุณุช
                         (isBuyAttempt ? (close1 > m_breakerCandleLevel) : (close1 < m_breakerCandleLevel));  // ฺฺฉ ุชุงุฏ ุจุฑ ุงุณุงุณ ุฌูุช

   if(!priceConfirmed) return;  // ุงฺฏุฑ ุชุงุฏ ููุช ูุงุฒู ุจูุฏ ู ูฺฏุฑูุชูุ ููุชุธุฑ ฺฉูุฏู ุจุนุฏ ุจููู

   // ุจ) ุชุงุฏู ููุชุฑ ุงฺููฺฉู (ุจู ุตูุฑุช ุฏูุงูฺฉ ู ุจุฏูู ูุญุฏูุฏุช ุฒูุงู)
   // g_trendFilter.GetTrendDirection ุฏูุงูฺฉ ุงุณุช
   ENUM_TREND_DIRECTION currentTrend = g_trendFilter.GetTrendDirection(m_trendFilterTimeframe);  // ฺฏุฑูุชู ุฌูุช ุฑููุฏ ูุนู
   bool filterConfirmed = !Inp_IchimokuFilter_Enabled ||  // ุงฺฏุฑ ููุชุฑ ุฎุงููุดุ ููุดู ุฏุฑุณุช
                          (isBuyAttempt && (currentTrend == TREND_BUY || currentTrend == TREND_NEUTRAL)) ||  // ฺฺฉ ุจุฑุง ุฎุฑุฏ
                          (!isBuyAttempt && (currentTrend == TREND_SELL || currentTrend == TREND_NEUTRAL));  // ฺฺฉ ุจุฑุง ูุฑูุด

   // ณ. ุงุฌุฑุง ูุนุงููู ุงฺฏุฑ ููุชุฑ ุชุงุฏ ุดุฏ
   if(filterConfirmed)  // ฺฺฉ ุชุงุฏ ููุชุฑ
   {
      ExecuteTrade(isBuyAttempt);  // ุงุฌุฑุง ูุนุงููู ุจุง ูพุงุฑุงูุชุฑ ุฌูุช (ุจุฑุง ุชุดุฎุต ุฎุฑุฏ/ูุฑูุด)
   }
}

// ุฑุณุช ุจู ุญุงูุช ูุณูุญ: ุฑุณุช ุณุทุญ ุจุฑฺฉ ุจุฏูู ุญุฐู ุฎุทูุท ฺฏุฑุงูฺฉ ุง ูุณุฑูุง (ุจุฑุง ุญูุธ ูุฑุตุชโูุง)
// ุงู ุชุงุจุน ุจุฑุง ุงุจุทุงู ูููุช ุงุณุชูุงุฏู ูโุดูุฏ
void CRange::ResetToArmedState()  // ุชุงุจุน ุฑุณุช
{
   CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": ุดุฑุท ุงุจุทุงู ุฑุฎ ุฏุงุฏ. ุฑุณุช ุจู ุญุงูุช ูุณูุญ.", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุงุจุทุงู
   m_breakerCandleLevel = 0;  // ูพุงฺฉ ฺฉุฑุฏู ุณุทุญ ฺฉูุฏู ุดฺฉููุฏู
   m_waitCounter = 0;  // ุฑุณุช ุดูุงุฑูุฏู ุจุฑุง ุญุงูุช ุจุนุฏ
   m_currentState = RANGE_ARMED;  // ุฑุณุช ุญุงูุช ุจู ูุณูุญ ู ุงูุชุธุงุฑ
   // ูฺฉุชู ฺฉูุฏ: ูฺ ุฎุท ฺฏุฑุงูฺฉ ุง ูุณุฑ ุงูุฌุง ุญุฐู ููโุดูุฏ ุชุง ูุฑุตุช ุฏูุจุงุฑู ุดฺฉู ฺฏุฑุฏ
}

// ุงุฌุฑุง ูุนุงููู: ูุญุงุณุจู SL ุจุฑ ุงุณุงุณ SL strategy ุฌุฏุฏ (base point + ุจุงูุฑ)ุ ุญุฌู ู ุงุฑุณุงู ุณูุงุฑุด ุจุงุฒุงุฑ
// ุงู ุชุงุจุน ูุนุงููู ุฑุง ุจุงุฒ ูโฺฉูุฏ
void CRange::ExecuteTrade(bool isBuy)  // ุชุงุจุน ุงุฌุฑุง ูุนุงููู
{
   // ููุช ูุฑูุฏ ูุนู (ASK ุจุฑุง ุฎุฑุฏุ BID ุจุฑุง ูุฑูุด)
   double entryPrice = isBuy ? SymbolInfoDouble(_Symbol, SYMBOL_ASK) : SymbolInfoDouble(_Symbol, SYMBOL_BID);  // ููุช ูุฑูุฏ ูุนู (ASK ุจุฑุง ุฎุฑุฏุ BID ุจุฑุง ูุฑูุด)
   double adjustment;  // ุจุงูุฑ SL

   // ฺฺฉ ุญุงูุช ATR ุจุฑุง ุจุงูุฑ SL
   if(m_slCalcMode == SL_CALC_ATR)  // ฺฺฉ ุญุงูุช ATR ุจุฑุง ุจุงูุฑ SL
   {
      double atr_buffer[];  // ุขุฑุงู ATR (ุฏูุงูฺฉ ุจุฏูู ุงูุฏุงุฒู ุซุงุจุช)
      ArraySetAsSeries(atr_buffer, true);  // ุชูุธู ุณุฑ ุขุฑุงู
      if(CopyBuffer(m_slAtrHandle, 0, 1, 1, atr_buffer) <= 0)  // ฺฉูพ ุจุงูุฑ (shift 1)
      {
         CLogger::Log("ุฎุทุง ุฏุฑ ฺฏุฑูุชู ATR ุจุฑุง SL ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // ฺุงูพ ุฎุทุง
         return;  // ุฎุฑูุฌ
      }
      adjustment = atr_buffer[0] * m_slAtrMultiplier;  // ูุญุงุณุจู ุจุงูุฑ ATR
   }
   else  // ุญุงูุช ุฏุฑุตุฏ
   {
      adjustment = (m_rangeHigh - m_rangeLow) * m_slAtrMultiplier / 100.0;  // ูุญุงุณุจู ุจุงูุฑ ุฏุฑุตุฏ
   }

   // ุงูุชุฎุงุจ base point ุจุฑ ุงุณุงุณ SL strategy
   double basePoint;  // ูพุงู SL
   if(m_slStrategy == SL_OPPOSITE_SIDE)  // ุญุงูุช ููุงุจู ุฑูุฌ
   {
      basePoint = isBuy ? m_rangeLow : m_rangeHigh;  // ููุงุจู ุฑูุฌ ุจุฑุง BUY/SELL
   }
   else  // SL_BREAKOUT_LEVEL - ุณุทุญ ุดฺฉุณุช
   {
      basePoint = isBuy ? m_rangeHigh : m_rangeLow;  // ุณุทุญ ุดฺฉุณุช ุจุฑุง BUY/SELL
   }

   // ูุญุงุณุจู SL ุจุฑ ุงุณุงุณ base point ุจุง NormalizePrice
   double slPrice = isBuy ? NormalizePrice(basePoint - adjustment) : NormalizePrice(basePoint + adjustment);  // ููุช SL ูุฑูุงูุงุฒ ุดุฏู
   double slDistance = MathAbs(entryPrice - slPrice);  // ูุงุตูู SL ุงุฒ ูุฑูุฏ
   m_initialSlDistance = slDistance;  // ุฐุฎุฑู ูุงุตูู SL ุงููู ุจุฑุง ุจุงุฒุงุจ

   // ุณุทุญ ุญุฏุงูู ูุงุตูู ุงุฒ SYMBOL_TRADE_STOPS_LEVEL
   long stops_level = SymbolInfoInteger(_Symbol, SYMBOL_TRADE_STOPS_LEVEL);  // ุณุทุญ ุญุฏุงูู ูุงุตูู
   double minStop = stops_level * _Point + _Point;  // ุญุฏุงูู ูุงุตูู ุจุง ุจุงูุฑ
   if(slDistance <= 0 || slDistance < minStop)  // ฺฺฉ ูุงุตูู ูุนุชุจุฑ
   {
      CLogger::Log("ุฎุทุง: slDistance ูุงูุนุชุจุฑ ุง ฺฉูุชุฑ ุงุฒ ุญุฏุงูู ูุงุตูู ูุฌุงุฒ ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex) + " (slDistance=" + DoubleToString(slDistance, _Digits) + ")", m_rangeIndex);  // ฺุงูพ ุฎุทุง
      m_currentState = RANGE_EXPIRED;  // ุชูุธู ุจู ูููุถ
      return;  // ุฎุฑูุฌ
   }

   CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": SL Strategy=" + EnumToString(m_slStrategy) + ", slDistance=" + DoubleToString(slDistance, _Digits) + ", slPrice=" + DoubleToString(slPrice, _Digits), m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ SL

   // ูุญุงุณุจู ุญุฌู ุจุง CRiskManager
   double lotSize = CRiskManager::CalculateLotSize(InpRiskPercent, slDistance);  // ูุญุงุณุจู ุญุฌู ุจุฑ ุงุณุงุณ ุฑุณฺฉ
   if(lotSize == 0)  // ฺฺฉ ุญุฌู ูุนุชุจุฑ
   {
      CLogger::Log("ุฎุทุง ุฏุฑ ูุญุงุณุจู ุญุฌู ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex), m_rangeIndex);  // ฺุงูพ ุฎุทุง
      m_currentState = RANGE_EXPIRED;  // ุชูุธู ุจู ูููุถ
      return;  // ุฎุฑูุฌ
   }

   CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": lotSize=" + DoubleToString(lotSize, 2), m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ ุญุฌู

   // --- START: Margin Pre-validation --- (ฺฺฉ ูพุด-ุงุนุชุจุงุฑุณูุฌ ูุงุฑุฌู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุนุงููู ุจุฏูู ูุงุฑุฌู ฺฉุงู)
   double margin_required;  // ูุชุบุฑ ุจุฑุง ูุงุฑุฌู ููุฑุฏ ูุงุฒ
   // OrderCalcMargin ูุงุฑุฌู ุฑุง ูุญุงุณุจู ูโฺฉูุฏ
   if(!OrderCalcMargin(isBuy ? ORDER_TYPE_BUY : ORDER_TYPE_SELL, _Symbol, lotSize, entryPrice, margin_required))  // ูุญุงุณุจู ูุงุฑุฌู
   {
      CLogger::Log("ุฎุทุง ุฏุฑ ูุญุงุณุจู ูุงุฑุฌู ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex) + ". ูุนุงููู ูุบู ุดุฏ.", m_rangeIndex);  // ฺุงูพ ุฎุทุง
      m_currentState = RANGE_EXPIRED;  // ุชูุธู ุจู ูููุถ
      return;  // ุฎุฑูุฌ
   }
   // AccountInfoDouble ูุงุฑุฌู ุขุฒุงุฏ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ
   if(margin_required > AccountInfoDouble(ACCOUNT_MARGIN_FREE))  // ฺฺฉ ูุงุฑุฌู ฺฉุงู
   {
      CLogger::Log("ูุงุฑุฌู ฺฉุงู ูุณุช. ูุงุฒ: " + DoubleToString(margin_required, 2) + ", ููุฌูุฏ: " + DoubleToString(AccountInfoDouble(ACCOUNT_MARGIN_FREE), 2), m_rangeIndex);  // ฺุงูพ ุฎุทุง
      m_currentState = RANGE_EXPIRED;  // ุชูุธู ุจู ูููุถ
      return;  // ุฎุฑูุฌ
   }
   // --- END: Margin Pre-validation ---

   // ููููู CTrade ุจุฑุง ุงุฑุณุงู ุณูุงุฑุด
   CTrade trade;  // ููููู ฺฉูุงุณ ูุนุงููู
   MqlTradeRequest request;  // ุฏุฑุฎูุงุณุช ูุนุงููู
   MqlTradeResult result;  // ูุชุฌู ูุนุงููู
   ZeroMemory(request);  // ุตูุฑ ฺฉุฑุฏู ุฏุฑุฎูุงุณุช
   request.action = TRADE_ACTION_DEAL;  // ุนูู ูุนุงููู ุจุงุฒุงุฑ
   request.symbol = _Symbol;  // ููุงุฏ
   request.volume = lotSize;  // ุญุฌู
   request.type = isBuy ? ORDER_TYPE_BUY : ORDER_TYPE_SELL;  // ููุน ุณูุงุฑุด
   request.price = entryPrice;  // ุงุณุชูุงุฏู ุงุฒ ููุช ูุญุธูโุง ุจุฑุง ุณูุงุฑุด ุจุงุฒุงุฑ
   request.sl = slPrice;  // SL
   request.tp = 0.0;  // TP ุจู 0.0 ุจุฑุง ุญุฐู ุญุฏ ุณูุฏ ุงููู (ุงุฌุงุฒู ุฑููุฏ ุงุฏุงูู)
   request.magic = m_magicNumber;  // ูุฌฺฉ
   request.comment = StringFormat("R%d;H:%.5f;L:%.5f;SLD:%.5f", m_rangeIndex, m_rangeHigh, m_rangeLow, m_initialSlDistance);  // ฺฉุงููุช ุจุง ุงุทูุงุนุงุช ุญุงุช
   request.deviation = 10;  // ุงูุญุฑุงู ูุฌุงุฒ
   // OrderSend ุฏุฑุฎูุงุณุช ุฑุง ุงุฑุณุงู ูโฺฉูุฏ
   if(!trade.OrderSend(request, result) || result.deal == 0)  // ุงุฑุณุงู ุณูุงุฑุด
   {
      CLogger::Log("ุฎุทุง ุฏุฑ ุจุงุฒ ฺฉุฑุฏู ูุนุงููู ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(result.retcode), m_rangeIndex);  // ฺุงูพ ุฎุทุง
      m_currentState = RANGE_EXPIRED;  // ุชูุธู ุจู ูููุถ
      return;  // ุฎุฑูุฌ
   }
   m_activeTicket = result.deal;  // ุฐุฎุฑู ุชฺฉุช

   CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + " - " + (isBuy ? "BUY" : "SELL") + " Trade Opened! Ticket: " + (string)m_activeTicket, m_rangeIndex);  // ฺุงูพ ููููุช

   // ุซุจุช ูุนุงููู ุฏุฑ ูุฏุฑ ูุนุงููุงุช ุจุฑุง ูุฏุฑุช ุขูุฏู
   g_tradeManager.RegisterTrade(m_activeTicket, m_magicNumber, m_rangeIndex, m_initialSlDistance, entryPrice, m_rrRatio, m_partialClosePercent, m_trailingMode, m_trailingAtrPeriod, m_trailingAtrMultiplier, m_timeframe, m_trailingAtrHandle, m_trendFilterTimeframe);  // ุซุจุช ูุนุงููู

   DisableOppositePath(isBuy);  // ุบุฑูุนุงู ฺฉุฑุฏู ูุณุฑ ูุฎุงูู ุจุฑุง OCO
   m_currentState = RANGE_TRADE_ACTIVE;  // ุชุบุฑ ุญุงูุช ุจู ูุนุงููู ูุนุงู
}

// ุบุฑูุนุงู ฺฉุฑุฏู ูุณุฑ ูุฎุงูู: ุญุฐู ุฎุท ู ุฑุณุช ููุช ุจุงูููู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุณฺฏูุงู ุฏูฺฏุงูู
// ุงู ุชุงุจุน OCO ุฑุง ุดุจูโุณุงุฒ ูโฺฉูุฏ
void CRange::DisableOppositePath(bool isBuy)  // ุชุงุจุน ุบุฑูุนุงู ฺฉุฑุฏู
{
   if(isBuy)  // ุจุฑุง ุฎุฑุฏ
   {
      m_potentialSellPrice = 0;  // ุฑุณุช ููุช ูุฑูุด
      ObjectDelete(0, m_sellLineName);  // ุญุฐู ุฎุท ูุฑูุด
      CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + " - SELL path deactivated (OCO).", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ
   }
   else  // ุจุฑุง ูุฑูุด
   {
      m_potentialBuyPrice = 0;  // ุฑุณุช ููุช ุฎุฑุฏ
      ObjectDelete(0, m_buyLineName);  // ุญุฐู ุฎุท ุฎุฑุฏ
      CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + " - BUY path deactivated (OCO).", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ
   }
}

// ูพุงฺฉุณุงุฒ ูุฑู: ุฑุณุช ูุชุบุฑูุง ู ุญุฐู ุงุดุงุก ุจุฏูู ุจุณุชู ูุนุงููู ุจุฑุง ุขูุงุฏูโุณุงุฒ ุฑูุฌ ุจุนุฏ
// ุงู ุชุงุจุน ุจุฑุง ุฑุณุช ุฑูุฒุงูู ุจุฏูู ุจุณุชู ูุนุงููู ุงุณุช
void CRange::SoftCleanup()  // ุชุงุจุน ูพุงฺฉุณุงุฒ ูุฑู
{
   CLogger::Log("ูพุงฺฉุณุงุฒ ูุฑู ุฑูุฌ " + IntegerToString(m_rangeIndex) + "...", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ูพุงฺฉุณุงุฒ ูุฑู

   // ฑ. ูพุงฺฉุณุงุฒ ูุชุบุฑูุง ูุฑุจูุท ุจู ุชูุงุด ุจุฑุง ูุฑูุฏ
   m_potentialBuyPrice = 0;  // ุฑุณุช ููุช ุฎุฑุฏ
   m_potentialSellPrice = 0;  // ุฑุณุช ููุช ูุฑูุด
   m_breakerCandleLevel = 0;  // ุฑุณุช ุณุทุญ ุจุฑฺฉ
   m_waitCounter = 0;  // ุฑุณุช ุดูุงุฑูุฏู

   // ฒ. ุญุฐู ุชูุงู ุงุดุงุก ฺฏุฑุงูฺฉ ูุฑุจูุท ุจู ุฑูุฌ
   ObjectDelete(0, m_buyLineName);  // ุญุฐู ุฎุท ุฎุฑุฏ
   ObjectDelete(0, m_sellLineName);  // ุญุฐู ุฎุท ูุฑูุด
   ObjectDelete(0, m_rangeObjectName);  // ุญุฐู ูุณุชุทู ุฑูุฌ

   // ณ. ุฑุณุช ฺฉุฑุฏู ูุชุบุฑูุง ฺฉูุชุฑู ุจุฑุง ุดูุงุณุง ุฑูุฌ ุจุนุฏ
   m_lastEndTime = 0;  // << ุจุณุงุฑ ููู: ุงู ุฎุท ุจุงฺฏ ุงุตู ููู ุดุฏู ุฑุง ุญู ูโฺฉูุฏ
   m_lastInvalid = false;  // ุฑุณุช ููฺฏ ูุงูุนุชุจุฑ

   // ด. ุฑุณุช ฺฉุฑุฏู ฺฉุดโูุง
   ResetCaches();  // ุฑุณุช ฺฉุดโูุง

   // ุฑุณุช ูุชุบุฑ ูุนุงููู
   m_activeTicket = 0;  // ุฑุณุช ุชฺฉุช
   
   // ต. ุงุถุงูู ฺฉุฑุฏู ุนูุงูุช ูพุงฺฉุณุงุฒ ุฑู ฺฉูุฏู ูุนู (ฺฉุฏ 217 ุจุฑุง OBJ_ARROW)
   string cleanupMarkerName = "Cleanup_Marker_" + IntegerToString(m_rangeIndex);  // ูุงู ุนูุงูุช ูพุงฺฉุณุงุฒ
   datetime currentTime = TimeCurrent();  // ุฒูุงู ูุนู ุจุฑุง ุนูุงูุช
   double currentPrice = SymbolInfoDouble(_Symbol, SYMBOL_BID);  // ููุช ูุนู ุจุฑุง ุนูุงูุช
   if(!ObjectCreate(0, cleanupMarkerName, OBJ_ARROW, 0, currentTime, currentPrice))  // ุฑุณู ุนูุงูุช
   {
      CLogger::Log("ุฎุทุง ุฏุฑ ุฑุณู ุนูุงูุช ูพุงฺฉุณุงุฒ ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // ฺุงูพ ุฎุทุง
   }
   else  // ุดุฑุท ููููุช
   {
      ObjectSetInteger(0, cleanupMarkerName, OBJPROP_ARROWCODE, 217);  // ฺฉุฏ ุนูุงูุช (217)
      ObjectSetInteger(0, cleanupMarkerName, OBJPROP_COLOR, clrYellow);  // ุฑูฺฏ ุฒุฑุฏ ุจุฑุง ุชูุงุฒ
   }

   // 6. ุชูุธู ููฺฏ ูพุงฺฉุณุงุฒ ฺุฑุฎู
   m_isCleanedForThisCycle = true;  // ููฺฏ ูพุงฺฉุณุงุฒ ุงูุฌุงู ุดุฏู
   m_cleanupTime = 0;  // ุณุงุนุช ูพุงฺฉุณุงุฒ ุฑุง ุตูุฑ ฺฉู ุชุง ุงู ูุฑุขูุฏ ุชฺฉุฑุงุฑ ูุดูุฏ
   CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + " ูพุงฺฉุณุงุฒ ูุฑู ุดุฏ.", m_rangeIndex);  // ฺุงูพ ููููุช
}

// ูพุงฺฉุณุงุฒ ุณุฎุช: ุจุณุชู ูุนุงููู ุงฺฏุฑ ุจุงุฒ ุจุงุดุฏ ู ุณูพุณ ูพุงฺฉุณุงุฒ ูุฑู (ุจุฑุง ุชุนุทูุงุช ุง ุฏูุน)
// ุชุบุฑุงุช 2.10: ุฑุณุช ุฏุณุช ููฺฏโูุง ูุจู ุงุฒ SoftCleanup
void CRange::HardCleanup()  // ุชุงุจุน ูพุงฺฉุณุงุฒ ุณุฎุช
{
   CLogger::Log("ูพุงฺฉุณุงุฒ ุณุฎุช ุฑูุฌ " + IntegerToString(m_rangeIndex) + "...", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ูพุงฺฉุณุงุฒ ุณุฎุช

   if(m_activeTicket != 0)  // ฺฺฉ ูุนุงููู ุจุงุฒ
   {
      if(g_tradeManager.ClosePosition(m_activeTicket))  // ุจุณุชู ฺฉุงูู ูุนุงููู ุงุฒ ูุฏุฑ ูุนุงููุงุช
      {
         CLogger::Log("ูุนุงููู ุจุง ุชฺฉุช " + (string)m_activeTicket + " ุจุณุชู ุดุฏ (ุณุฎุช).", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ
      }
      // ุฑุณุช ฺฉุฑุฏู ูุชุบุฑูุง ูุฑุจูุท ุจู ูุนุงููู ุจุงุฒ ูุจู ุงุฒ SoftCleanup
      m_activeTicket = 0;  // ุฑุณุช ุชฺฉุช ูพุณ ุงุฒ ุจุณุชู
   }

   SoftCleanup();  // ูุฑุงุฎูุงู ูพุงฺฉุณุงุฒ ูุฑู ูพุณ ุงุฒ ุจุณุชู ู ุฑุณุช ูุชุบุฑูุง
   CLogger::Log("ุฑูุฌ " + IntegerToString(m_rangeIndex) + " ูพุงฺฉุณุงุฒ ุณุฎุช ุดุฏ.", m_rangeIndex);  // ฺุงูพ ููููุช
}

// ฺฺฉ ูพุงฺฉุณุงุฒ: ฺฺฉ ุฒูุงู ุงููุถุง ู ูุฑุงุฎูุงู ูพุงฺฉุณุงุฒ ููุงุณุจ ุจุฑ ุงุณุงุณ ุญุงูุช (ุจุง ูุนุงููู: ููุท ูุณุฑูุงุ ุจุฏูู: ูุฑู)
// ุงู ุชุงุจุน ุฏุฑ OnTick ูุฑุงุฎูุงู ูโุดูุฏ
void CRange::CheckCleanup()  // ุชุงุจุน ฺฺฉ ูพุงฺฉุณุงุฒ
{
   // ุงฺฏุฑ ุฒูุงู ูพุงฺฉุณุงุฒ ูุฑุณุฏู ุง ูุจูุงู ุงูุฌุงู ุดุฏูุ ุฎุงุฑุฌ ุดู
   if(m_cleanupTime == 0 || TimeCurrent() < m_cleanupTime || m_isCleanedForThisCycle) return;  // ฺฺฉ ุฒูุงู ู ููฺฏ

   CLogger::Log("ุฒูุงู ูพุงฺฉุณุงุฒ ูุฑุง ุฑุณุฏ...", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ
   m_currentState = RANGE_EXPIRED;  // ุชุบุฑ ุจู ูููุถ ุจุฑุง ุงุฌุฑุง ูพุงฺฉุณุงุฒ
}

// ุฑุณุช ฺฉุดโูุง: ุตูุฑ ฺฉุฑุฏู ฺฉุด ATRูุง ุจุฑุง ุฑูุฌ ุฌุฏุฏ (ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงุณุชูุงุฏู ุงุฒ ุฏุงุฏูโูุง ฺฉููู)
// ุงู ุชุงุจุน ฺฉุดโูุง ุฑุง ุตูุฑ ูโฺฉูุฏ
void CRange::ResetCaches()  // ุชุงุจุน ุฑุณุช ฺฉุด
{
   m_cachedATR = 0;  // ุฑุณุช ฺฉุด ATR ุงูุณุช
   m_cachedSlATR = 0;  // ุฑุณุช ฺฉุด ATR SL
   m_cachedTrailingATR = 0;  // ุฑุณุช ฺฉุด ATR ุชุฑููฺฏ
   CLogger::Log("ฺฉุดโูุง ATR ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex) + " ุฑุณุช ุดุฏูุฏ.", m_rangeIndex);  // ฺุงูพ ุฏุจุงฺฏ
}

// ฺฏุฑูุชู ATR ฺฉุดโุดุฏู ุงุตู: ุงฺฏุฑ ฺฉุด ุฎุงู ุจุงุดุฏุ ุงุฒ ููุฏู ฺฉูพ ูโฺฏุฑุฏ (ููุท ุจุฑุง ูุฑูุฏ ุงุณุชูุงุฏู ุดูุฏ)
// CopyBuffer ุจุงูุฑ ุฑุง ฺฉูพ ูโฺฉูุฏ
double CRange::GetCachedATR()  // ุชุงุจุน ฺฏุฑูุชู ATR
{
   if(m_cachedATR <= 0)  // ฺฺฉ ฺฉุด ุฎุงู
   {
      double atr[];  // ุขุฑุงู ATR (ุฏูุงูฺฉ ุจุฏูู ุงูุฏุงุฒู ุซุงุจุช)
      ArraySetAsSeries(atr, true);  // ุชูุธู ุณุฑ
      if(CopyBuffer(m_atrHandle, 0, 1, 1, atr) <= 0)  // ฺฉูพ ุจุงูุฑ
      {
         CLogger::Log("ุฎุทุง ุฏุฑ ฺฏุฑูุชู ATR ุจุฑุง ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // ฺุงูพ ุฎุทุง
         return 0;  // ุจุงุฒฺฏุดุช ุตูุฑ
      }
      m_cachedATR = atr[0];  // ุฐุฎุฑู ุฏุฑ ฺฉุด
   }
   return m_cachedATR;  // ุจุงุฒฺฏุดุช ฺฉุด
}

// ฺฏุฑูุชู ATR ฺฉุดโุดุฏู ุจุฑุง SL: ูุดุงุจู ุจุฑุง ุจูููโุณุงุฒ ูุญุงุณุจุงุช SL (ููุท ุจุฑุง ูุฑูุฏ ุงุณุชูุงุฏู ุดูุฏ)
double CRange::GetSlATR()  // ุชุงุจุน ฺฏุฑูุชู SL ATR
{
   if(m_cachedSlATR <= 0)  // ฺฺฉ ฺฉุด ุฎุงู
   {
      double atr[];  // ุขุฑุงู ATR (ุฏูุงูฺฉ ุจุฏูู ุงูุฏุงุฒู ุซุงุจุช)
      ArraySetAsSeries(atr, true);  // ุชูุธู ุณุฑ
      if(CopyBuffer(m_slAtrHandle, 0, 1, 1, atr) <= 0)  // ฺฉูพ ุจุงูุฑ
      {
         CLogger::Log("ุฎุทุง ุฏุฑ ฺฏุฑูุชู ATR ุจุฑุง SL ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // ฺุงูพ ุฎุทุง
         return 0;  // ุจุงุฒฺฏุดุช ุตูุฑ
      }
      m_cachedSlATR = atr[0];  // ุฐุฎุฑู ุฏุฑ ฺฉุด
   }
   return m_cachedSlATR;  // ุจุงุฒฺฏุดุช ฺฉุด
}

// ฺฏุฑูุชู ATR ฺฉุดโุดุฏู ุจุฑุง ุชุฑููฺฏ: ูุดุงุจู ุจุฑุง ุจูููโุณุงุฒ ุชุฑููฺฏ (ููุท ุจุฑุง ูุฑูุฏ ุงุณุชูุงุฏู ุดูุฏุ ุจุฑุง ูุฏุฑุช ูพูุง ุงุณุชูุงุฏู ูุดูุฏ)
double CRange::GetTrailingATR()  // ุชุงุจุน ฺฏุฑูุชู ุชุฑููฺฏ ATR
{
   if(m_cachedTrailingATR <= 0)  // ฺฺฉ ฺฉุด ุฎุงู
   {
      double atr[];  // ุขุฑุงู ATR (ุฏูุงูฺฉ ุจุฏูู ุงูุฏุงุฒู ุซุงุจุช)
      ArraySetAsSeries(atr, true);  // ุชูุธู ุณุฑ
      if(CopyBuffer(m_trailingAtrHandle, 0, 1, 1, atr) <= 0)  // ฺฉูพ ุจุงูุฑ
      {
         CLogger::Log("ุฎุทุง ุฏุฑ ฺฏุฑูุชู ATR ุจุฑุง ุชุฑููฺฏ ุฑูุฌ " + IntegerToString(m_rangeIndex) + ": " + IntegerToString(GetLastError()), m_rangeIndex);  // ฺุงูพ ุฎุทุง
         return 0;  // ุจุงุฒฺฏุดุช ุตูุฑ
      }
      m_cachedTrailingATR = atr[0];  // ุฐุฎุฑู ุฏุฑ ฺฉุด
   }
   return m_cachedTrailingATR;  // ุจุงุฒฺฏุดุช ฺฉุด
}

#endif // ูพุงุงู ฺฺฉ include
```

```mql5
//+------------------------------------------------------------------+
//|                                                     TradeManager.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ุงู ูุงู ฺฉูุงุณ CTradeManager ุฑุง ุชุนุฑู ูโฺฉูุฏ ฺฉู ุนููุงุช ูุนุงููุงุช ูพุดุฑูุชู ุฑุง ูุฏุฑุช ูโฺฉูุฏ.
// ุงุณุชุฑุงุชฺ ฺฉู ุงฺฉุณูพุฑุช: ุงู ฺฉูุงุณ ุจุฎุด ุงุฒ ูุฏุฑุช ูุนุงููู ุฏุฑ ุงุณุชุฑุงุชฺ ุดฺฉุณุช ุฑูุฌ ุงุณุชุ 
// ุฌุง ฺฉู ูพุณ ุงุฒ ุจุงุฒ ุดุฏู ูุนุงูููุ ุฎุฑูุฌ ูพููโุง (ููฺฏุงู ุฑุณุฏู ุจู RR)ุ ุงูุชูุงู SL ุจู ูุฑูุฏ (ุจุฑุง ุญูุธ ุณุฑูุงู)ุ 
// ุชุฑููฺฏ (ุจุฑุง ููู ุณูุฏ) ู ุจุณุชู ฺฉุงูู (ุฏุฑ ูพุงฺฉุณุงุฒ ุณุฎุช) ุงูุฌุงู ูโุดูุฏ. 
// ุงู ุนููุงุช ุฑุณฺฉ ุฑุง ฺฉูุชุฑู ู ุณูุฏ ุฑุง ุจู ุญุฏุงฺฉุซุฑ ูโุฑุณุงูุฏ.
// ููุทู ูุงู TradeManager.mqh: ฺฉูุงุณ ุดุงูู ูุชุฏูุง ุงุณุชุงุชฺฉ ุจุฑุง ุจุณุชู ุฌุฒุฆ (PartialClose ุจุง ฺฺฉ ุญุฌู ูุฌุงุฒ)ุ 
// ุงูุชูุงู SL ุจู ุจุฑฺฉโุงูู (MoveSLToBreakEven ุจุง ูุฑูุงูุงุฒ ููุช)ุ 
// ุชุฑููฺฏ ุงุณุชุงูพ (TrailingStop ุจุง ูุญุงุณุจู ูุงุตูู ATR ุง Senkou Span B ู ฺฺฉ ุญุฏุงูู ุชุบุฑ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุจูโุฑูุฒุฑุณุงูโูุง ุจููุฏู)ุ 
// ู ุจุณุชู ฺฉุงูู (ClosePosition). 
// ุชูุงู ูุชุฏูุง PositionSelectByTicket ุฑุง ฺฺฉ ูโฺฉููุฏ ู ุงุฒ CTrade ุจุฑุง ุงุฑุณุงู ุฏุฑุฎูุงุณุช ุงุณุชูุงุฏู ูโฺฉููุฏ. 
// ุงู ูุงู ุชูุณุท CRange ุจุฑุง ูุฏุฑุช ูุนุงููุงุช ุฏุฑ ManageActiveTrade ูุฑุงุฎูุงู ูโุดูุฏ ู ูฺ ูุงุจุณุชฺฏ ุฎุงุฑุฌ ูุฏุงุฑุฏ ุฌุฒ Trade.mqh. 
// ุชุบุฑุงุช ุฌุฏุฏ: ุงุถุงูู ููุทู TRAILING_ICHIMOKU_B ุฏุฑ TrailingStop ุจุง ุงุณุชูุงุฏู ุงุฒ GetSenkouSpanB ู ุจุงูุฑ ุซุงุจุช (10 * _Point). 
// ููฺูู ุชุบุฑ PartialClose ุจู ุฑูุด ุจุณุชู ูุฎุงูู ุจุฑุง ุณุงุฒฺฏุงุฑ ุจุง ุจุฑูฺฉุฑูุง.
// ุชุบุฑุงุช ูุณุฎู 2.10: ุฌุงฺฏุฒู Print ุจุง CLogger::Logุ ฺฉุงููุชโฺฏุฐุงุฑ ุฏูู ูุฑ ุฎุทุ ุจุฏูู ุชุบุฑ ุฏุฑ ููุทู. ูฺ ุชุบุฑ ุงุนูุงู ูุดุฏู ุฒุฑุง ุจูููพุฑูุช ุชุบุฑ ูุดุฎุต ูฺฉุฑุฏู.

#ifndef TRADE_MANAGER_MQH  // ฺฺฉ ูุฌูุฏ
#define TRADE_MANAGER_MQH  // ุชุนุฑู ูุงฺฉุฑู

#include <Trade\Trade.mqh>  // ฺฉูุงุณ ูุนุงููู ุจุฑุง ุนููุงุช

// ฺฉูุงุณ CTradeManager ุจุฑุง ุนููุงุช ูุนุงููุงุช ุงุณุชุงุชฺฉ (ุจุฏูู ูุงุฒ ุจู ูููููโุณุงุฒ)
// ุชูุงู ูุชุฏูุง ุงุณุชุงุชฺฉ ูุณุชูุฏ ุจุฑุง ุณุงุฏฺฏ ูุฑุงุฎูุงู
class CTradeManager  // ฺฉูุงุณ ูุฏุฑุช ูุนุงููู
{
public:
   // ุจุณุชู ุฌุฒุฆ ูพูุฒุดู: ูุญุงุณุจู ู ุจุณุชู ุญุฌู ูุดุฎุต ุจุง ฺฺฉ ุงุถุงู Magic ุจุฑุง ุงููุช
   // ุงู ูุชุฏ ุจุง ูุนุงููู ูุฎุงูู ุฌุฒุฆ ูโุจูุฏุฏ
   static bool PartialClose(ulong ticket, double volume)  // ุจุณุชู ุฌุฒุฆ ุจุง ุชฺฉุช ู ุญุฌู
   {
      if(!PositionSelectByTicket(ticket))  // ฺฺฉ ุงูุชุฎุงุจ ูพูุฒุดู
      {
         CLogger::Log("ุฎุทุง: ูพูุฒุดู ุจุง ุชฺฉุช " + (string)ticket + " ุจุฑุง ุจุณุชู ุฌุฒุฆ ุงูุช ูุดุฏ.");  // ฺุงูพ ุฎุทุง
         return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
      }

      // ฺฏุฑูุชู ุงุทูุงุนุงุช ุถุฑูุฑ ุงุฒ ูพูุฒุดู ุงุตู
      ENUM_POSITION_TYPE posType = (ENUM_POSITION_TYPE)PositionGetInteger(POSITION_TYPE);  // ููุน ูพูุฒุดู
      string symbolName = PositionGetString(POSITION_SYMBOL);  // ููุงุฏ

      // ุขูุงุฏู ฺฉุฑุฏู ุฏุฑุฎูุงุณุช ูุนุงููู ุฌุฏุฏ (ูุฎุงูู ูพูุฒุดู ุงุตู)
      CTrade trade;  // ููููู ฺฉูุงุณ ูุนุงููู
      MqlTradeRequest request;  // ุฏุฑุฎูุงุณุช ูุนุงููู
      MqlTradeResult result;  // ูุชุฌู ูุนุงููู
      ZeroMemory(request);  // ุตูุฑ ฺฉุฑุฏู ุฏุฑุฎูุงุณุช
      ZeroMemory(result);  // ุตูุฑ ฺฉุฑุฏู ูุชุฌู

      request.action   = TRADE_ACTION_DEAL;              // ููุน ุนููุงุช: ูุนุงููู
      request.symbol   = symbolName;                     // ููุงุฏ ูุนุงููู
      request.volume   = volume;                         // ุญุฌู ฺฉู ูโุฎูุงูู ุจุจูุฏู
      request.deviation = 10;                            // ุงูุญุฑุงู ูุฌุงุฒ ููุช
      request.magic    = (long)PositionGetInteger(POSITION_MAGIC); // ูุฌฺฉ ูุงูุจุฑ ุจุงุฏ ฺฉ ุจุงุดู

      // ููฺฉ ฺฉุฑุฏู ุงู ุฏุฑุฎูุงุณุช ุจู ูพูุฒุดู ุจุงุฒ ููุฌูุฏ
      request.position = ticket; // ููฺฉ ุจู ูพูุฒุดู ุจุฑุง ุจุณุชู ุฌุฒุฆ

      // ุชุนู ููุน ูุนุงููู ูุฎุงูู
      if(posType == POSITION_TYPE_BUY)  // ุงฺฏุฑ ูพูุฒุดู ุฎุฑุฏุ ุจุฑุง ุจุณุชู ุฌุฒุฆ ูุฑูุด ูโุฒูู
      {
         request.price = SymbolInfoDouble(symbolName, SYMBOL_BID);  // ุจุฑุง ุจุณุชู ุฎุฑุฏุ ุจุง ููุช BID ูโูุฑูุดู
         request.type = ORDER_TYPE_SELL;  // ููุน ูุฑูุด
      }
      else  // ุงฺฏุฑ ูพูุฒุดู ูุฑูุดุ ุจุฑุง ุจุณุชู ุฌุฒุฆ ุฎุฑุฏ ูโุฒูู
      {
         request.price = SymbolInfoDouble(symbolName, SYMBOL_ASK);  // ุจุฑุง ุจุณุชู ูุฑูุดุ ุจุง ููุช ASK ูโุฎุฑู
         request.type = ORDER_TYPE_BUY;  // ููุน ุฎุฑุฏ
      }

      // ุงุฑุณุงู ุฏุฑุฎูุงุณุช ู ุจุฑุฑุณ ูุชุฌู
      if(trade.OrderSend(request, result))  // ุงุฑุณุงู ุฏุฑุฎูุงุณุช ูุนุงููู ูุฎุงูู
      {
         if(result.retcode == TRADE_RETCODE_DONE || result.retcode == TRADE_RETCODE_PLACED)  // ฺฺฉ ููููุช
         {
            if(InpDebugMode) CLogger::Log("ุจุฎุด ุงุฒ ูพูุฒุดู ุจุง ุชฺฉุช " + (string)ticket + " (ุญุฌู " + DoubleToString(volume, 2) + ") ุจุง ููููุช ุจุณุชู ุดุฏ.");  // ฺุงูพ ููููุช
            return true;  // ุจุงุฒฺฏุดุช ููููุช
         }
      }

      CLogger::Log("ุฎุทุง ุฏุฑ ุจุณุชู ุจุฎุด ุงุฒ ูพูุฒุดู ุจุง ุชฺฉุช " + (string)ticket + ": " + IntegerToString(result.retcode) + " - " + result.comment);  // ฺุงูพ ุฎุทุง
      return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
   }

   // ุงูุชูุงู SL ุจู ุจุฑฺฉโุงูู: ูุฑูุงูุงุฒ ููุช ู ุชุบุฑ SL ุจู ููุทู ูุฑูุฏ
   // NormalizeDouble ููุช ุฑุง ูุฑูุงู ูโฺฉูุฏ
   static bool MoveSLToBreakEven(ulong ticket, double breakEvenPrice)  // ุงูุชูุงู SL ุจู ูุฑูุฏ
   {
      if(!PositionSelectByTicket(ticket))  // ฺฺฉ ุงูุชุฎุงุจ ูพูุฒุดู
      {
         CLogger::Log("ุฎุทุง: ูพูุฒุดู ุจุง ุชฺฉุช " + (string)ticket + " ุงูุช ูุดุฏ.");  // ฺุงูพ ุฎุทุง
         return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
      }

      CTrade trade;  // ููููู ฺฉูุงุณ ูุนุงููู
      breakEvenPrice = NormalizeDouble(breakEvenPrice, _Digits);  // ูุฑูุงูุงุฒ ููุช
      if(trade.PositionModify(ticket, breakEvenPrice, PositionGetDouble(POSITION_TP)))  // ุชุบุฑ SL
      {
         CLogger::Log("ุงุณุชุงูพ ูุงุณ ูพูุฒุดู " + (string)ticket + " ุจู ููุทู ูุฑูุฏ ููุชูู ุดุฏ.");  // ฺุงูพ ููููุช
         return true;  // ุจุงุฒฺฏุดุช ููููุช
      }
      else  // ุดุฑุท ุดฺฉุณุช
      {
         CLogger::Log("ุฎุทุง ุฏุฑ ุงูุชูุงู ุงุณุชุงูพ ูุงุณ ูพูุฒุดู " + (string)ticket + ": " + IntegerToString(trade.ResultRetcode()));  // ฺุงูพ ุฎุทุง
         return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
      }
   }

   // ุงุนูุงู ุชุฑููฺฏ ุงุณุชุงูพ: ูุญุงุณุจู ูุงุตูู ุฌุฏุฏุ ฺฺฉ ุญุฏุงูู ุชุบุฑ ู ุชุบุฑ SL (ูุญุงุณุจู ูพูุง ATR ุง Senkou Span B ูุฑ ุจุงุฑ)
   // ุงู ูุชุฏ ูพูุง ูุญุงุณุจู ูโฺฉูุฏ
   static bool TrailingStop(ulong ticket, ENUM_TRAILING_MODE mode, int atrPeriod, double atrMultiplier, ENUM_TIMEFRAMES timeframe, int atrHandle, ENUM_TIMEFRAMES trendTf)  // ุชุฑููฺฏ ุจุง ูพุงุฑุงูุชุฑูุง ู ุชุงูโูุฑู ููุชุฑ
   {
      if(!PositionSelectByTicket(ticket))  // ฺฺฉ ุงูุชุฎุงุจ ูพูุฒุดู
      {
         CLogger::Log("ุฎุทุง: ูพูุฒุดู ุจุง ุชฺฉุช " + (string)ticket + " ุงูุช ูุดุฏ.");  // ฺุงูพ ุฎุทุง
         return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
      }

      double sl = PositionGetDouble(POSITION_SL);  // SL ูุนู
      if(sl == 0)  // ฺฺฉ SL ุตูุฑ
      {
         CLogger::Log("ูุดุฏุงุฑ: SL ุงููู ุตูุฑ ุงุณุช ุจุฑุง ูพูุฒุดู " + (string)ticket + ". ุชุฑููฺฏ skip ุดุฏ.");  // ฺุงูพ ูุดุฏุงุฑ
         return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
      }

      ENUM_POSITION_TYPE posType = (ENUM_POSITION_TYPE)PositionGetInteger(POSITION_TYPE);  // ููุน ูพูุฒุดู
      double currentPrice = posType == POSITION_TYPE_BUY ? SymbolInfoDouble(_Symbol, SYMBOL_BID) : SymbolInfoDouble(_Symbol, SYMBOL_ASK);  // ููุช ูุนู

      double trailingDistance;  // ูุงุตูู ุชุฑููฺฏ
      if(mode == TRAILING_ATR)  // ฺฺฉ ุญุงูุช ATR
      {
         double atr[];  // ุขุฑุงู ATR (ุฏูุงูฺฉ ุจุฏูู ุงูุฏุงุฒู ุซุงุจุช)
         ArraySetAsSeries(atr, true);  // ุชูุธู ุณุฑ
         if(CopyBuffer(atrHandle, 0, 1, 1, atr) <= 0)  // ฺฉูพ ุจุงูุฑ
         {
            CLogger::Log("ุฎุทุง ุฏุฑ ฺฏุฑูุชู ATR ุจุฑุง ุชุฑููฺฏ: " + IntegerToString(GetLastError()));  // ฺุงูพ ุฎุทุง
            return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
         }
         trailingDistance = atr[0] * atrMultiplier;  // ูุญุงุณุจู ูพูุง ูุฑ ุจุงุฑ ุจุฏูู ฺฉุด
      }
      else if(mode == TRAILING_ICHIMOKU_B)  // ุญุงูุช ุฌุฏุฏ: TRIALING ุจุฑ ุงุณุงุณ Senkou Span B
      {
         double senkouB = g_trendFilter.GetSenkouSpanB(trendTf);  // ฺฏุฑูุชู Senkou Span B ุงุฒ ููุชุฑ ุฑููุฏ
         if(senkouB == 0)  // ฺฺฉ ููุฏุงุฑ ูุนุชุจุฑ
         {
            CLogger::Log("ุฎุทุง ุฏุฑ ฺฏุฑูุชู Senkou Span B ุจุฑุง ุชุฑููฺฏ.");  // ฺุงูพ ุฎุทุง
            return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
         }
         double buffer = 10 * _Point;  // ุจุงูุฑ ุซุงุจุช (10 ูพููุช) ุจุฑุง ูุงุตูู ุงุฒ ุฎุท
         trailingDistance = buffer;  // ูุงุตูู ุจุฑ ุงุณุงุณ ุจุงูุฑ (ุจุฑุง ุชูุธู SL ูุณุจุช ุจู Senkou B)
         // ุจุฑุง ุฎุฑุฏ: SL ฺฉู ูพุงูโุชุฑ ุงุฒ Senkou B
         // ุจุฑุง ูุฑูุด: SL ฺฉู ุจุงูุงุชุฑ ุงุฒ Senkou B
      }
      else  // ุญุงูุช ูุงูุนุชุจุฑ (ุจุฑุง ุงูู)
      {
         return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
      }

      double newSL;  // SL ุฌุฏุฏ
      if(posType == POSITION_TYPE_BUY)  // ุจุฑุง ุฎุฑุฏ
      {
         if(mode == TRAILING_ICHIMOKU_B)  // ุญุงูุช ุงฺููฺฉู
         {
            newSL = NormalizeDouble(g_trendFilter.GetSenkouSpanB(trendTf) - trailingDistance, _Digits);  // SL ูพุงูโุชุฑ ุงุฒ Senkou B
         }
         else  // ATR
         {
            newSL = NormalizeDouble(currentPrice - trailingDistance, _Digits);  // ูุญุงุณุจู SL ุฌุฏุฏ
         }
         if(newSL > sl)  // ฺฺฉ ุจูุจูุฏ SL (ุจุงูุงุชุฑ ุจุฑุง ุฎุฑุฏ)
         {
            // ฺฺฉ ุญุฏุงูู ุชุบุฑ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุจูโุฑูุฒุฑุณุงูโูุง ุจููุฏู ู ูุฒููโูุง ุงุถุงู
            if(MathAbs(newSL - sl) < _Point * 5) return true;  // ุจุฏูู ุชุบุฑ ุงฺฏุฑ ฺฉู
            CTrade trade;  // ููููู ูุนุงููู
            if(trade.PositionModify(ticket, newSL, PositionGetDouble(POSITION_TP)))  // ุชุบุฑ SL
            {
               CLogger::Log("ุชุฑููฺฏ ุงุณุชุงูพ ุจุฑุง ูพูุฒุดู " + (string)ticket + " ุจูโุฑูุฒุฑุณุงู ุดุฏ. SL ุฌุฏุฏ=" + DoubleToString(newSL, _Digits));  // ฺุงูพ ููููุช
               return true;  // ุจุงุฒฺฏุดุช ููููุช
            }
            else  // ุดุฑุท ุดฺฉุณุช
            {
               CLogger::Log("ุฎุทุง ุฏุฑ ุจูโุฑูุฒุฑุณุงู ุชุฑููฺฏ ุงุณุชุงูพ: " + IntegerToString(trade.ResultRetcode()));  // ฺุงูพ ุฎุทุง
               return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
            }
         }
      }
      else  // ุจุฑุง ูุฑูุด
      {
         if(mode == TRAILING_ICHIMOKU_B)  // ุญุงูุช ุงฺููฺฉู
         {
            newSL = NormalizeDouble(g_trendFilter.GetSenkouSpanB(trendTf) + trailingDistance, _Digits);  // SL ุจุงูุงุชุฑ ุงุฒ Senkou B
         }
         else  // ATR
         {
            newSL = NormalizeDouble(currentPrice + trailingDistance, _Digits);  // ูุญุงุณุจู SL ุฌุฏุฏ
         }
         if(newSL < sl)  // ฺฺฉ ุจูุจูุฏ SL (ูพุงูโุชุฑ ุจุฑุง ูุฑูุด)
         {
            // ฺฺฉ ุญุฏุงูู ุชุบุฑ ูุดุงุจู
            if(MathAbs(newSL - sl) < _Point * 5) return true;  // ุจุฏูู ุชุบุฑ ุงฺฏุฑ ฺฉู
            CTrade trade;  // ููููู ูุนุงููู
            if(trade.PositionModify(ticket, newSL, PositionGetDouble(POSITION_TP)))  // ุชุบุฑ SL
            {
               CLogger::Log("ุชุฑููฺฏ ุงุณุชุงูพ ุจุฑุง ูพูุฒุดู " + (string)ticket + " ุจูโุฑูุฒุฑุณุงู ุดุฏ. SL ุฌุฏุฏ=" + DoubleToString(newSL, _Digits));  // ฺุงูพ ููููุช
               return true;  // ุจุงุฒฺฏุดุช ููููุช
            }
            else  // ุดุฑุท ุดฺฉุณุช
            {
               CLogger::Log("ุฎุทุง ุฏุฑ ุจูโุฑูุฒุฑุณุงู ุชุฑููฺฏ ุงุณุชุงูพ: " + IntegerToString(trade.ResultRetcode()));  // ฺุงูพ ุฎุทุง
               return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
            }
         }
      }
      return true;  // ุจุงุฒฺฏุดุช ููููุช ูพุดโูุฑุถ
   }

   // ุจุณุชู ฺฉุงูู ูพูุฒุดู: ุงูุชุฎุงุจ ู ุจุณุชู ุจุง ฺฺฉ ูุชุฌู
   // PositionClose ูพูุฒุดู ุฑุง ูโุจูุฏุฏ
   static bool ClosePosition(ulong ticket)  // ุจุณุชู ฺฉุงูู ุจุง ุชฺฉุช
   {
      if(!PositionSelectByTicket(ticket))  // ฺฺฉ ุงูุชุฎุงุจ ูพูุฒุดู
      {
         CLogger::Log("ุฎุทุง: ูพูุฒุดู ุจุง ุชฺฉุช " + (string)ticket + " ุงูุช ูุดุฏ.");  // ฺุงูพ ุฎุทุง
         return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
      }

      CTrade trade;  // ููููู ูุนุงููู
      if(trade.PositionClose(ticket))  // ุจุณุชู ฺฉุงูู
      {
         CLogger::Log("ูพูุฒุดู ุจุง ุชฺฉุช " + (string)ticket + " ุจุณุชู ุดุฏ.");  // ฺุงูพ ููููุช
         return true;  // ุจุงุฒฺฏุดุช ููููุช
      }
      else  // ุดุฑุท ุดฺฉุณุช
      {
         CLogger::Log("ุฎุทุง ุฏุฑ ุจุณุชู ูพูุฒุดู ุจุง ุชฺฉุช " + (string)ticket + ": " + IntegerToString(trade.ResultRetcode()));  // ฺุงูพ ุฎุทุง
         return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
      }
   }
};

#endif  // ูพุงุงู
```

```mql5
//+------------------------------------------------------------------+
//|                                             CActiveTradeManager.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ุงู ูุงู ฺฉูุงุณ CActiveTradeManager ุฑุง ุชุนุฑู ูโฺฉูุฏ ฺฉู ูุฏุฑุช ุชูุงู ูุนุงููุงุช ุจุงุฒ ุฑุง ุจุฑ ุนูุฏู ุฏุงุฑุฏ.
// ุงุณุชุฑุงุชฺ ฺฉู: ุงู ฺฉูุงุณ ูุนุงููุงุช ุจุงุฒ ุฑุง ุงุฒ CRange ุฏุฑุงูุช ูโฺฉูุฏ ู ูุฏุฑุช ูโฺฉูุฏ (ูพููโุงุ ุฑุณฺฉ-ูุฑุ ุชุฑููฺฏ).
// ููุทู ูุงู: ุขุฑุงู ManagedTrade ุจุฑุง ุฐุฎุฑู ุงุทูุงุนุงุช ูุฑ ูุนุงูููุ ูุงุดู ุญุงูุช ุฏุงุฎู ุจุฑุง ูุฑ ูุนุงููู (TRADE_PARTIAL_CLOSE, TRADE_RISK_FREE, TRADE_TRAILING).
// RegisterTrade ูุนุงููู ุฑุง ุงุถุงูู ูโฺฉูุฏุ ManageAllTrades ุชูุงู ูุนุงููุงุช ุฑุง ูุฏุฑุช ูโฺฉูุฏ ู ุญุงูุชโูุง ุฑุง ุจุฑูุฒุฑุณุงู ูโฺฉูุฏ.
// ClosePosition ุจุฑุง ุจุณุชู ฺฉุงูู ุงุณุชูุงุฏู ูโุดูุฏ.
// ุชุบุฑุงุช ุฌุฏุฏ: ฺฉูุงุณ ุฌุฏุฏ ุจุฑ ุงุณุงุณ ุจูููพุฑูุชุ ุจุง ูุงุดู ุญุงูุช ุฏุงุฎู ุจุฑุง ูุฑ ูุนุงููู.

#ifndef ACTIVE_TRADE_MANAGER_MQH
#define ACTIVE_TRADE_MANAGER_MQH

#include "TradeManager.mqh"  // ุจุฑุง PartialClose, MoveSLToBreakEven, TrailingStop
#include "Logger.mqh"  // ุจุฑุง ูุงฺฏ

// enum ุจุฑุง ุญุงูุชโูุง ูุฏุฑุช ูุฑ ูุนุงููู (ูุงุดู ุญุงูุช ุฏุงุฎู)
enum ENUM_TRADE_MANAGEMENT_STATE
{
   TRADE_PARTIAL_CLOSE,   // ูุฑุญูู ุฎุฑูุฌ ูพููโุง
   TRADE_RISK_FREE,       // ูุฑุญูู ุฑุณฺฉ-ูุฑ
   TRADE_TRAILING         // ูุฑุญูู ุชุฑููฺฏ
};

// ุณุงุฎุชุงุฑ ุจุฑุง ูุฑ ูุนุงููู ูุฏุฑุชโุดุฏู
struct ManagedTrade
{
   ulong ticket;  // ุชฺฉุช ูุนุงููู
   long magicNumber;  // ูุฌฺฉ ุจุฑุง ุชูุงุฒ
   int rangeIndex;  // ุงูุฏฺฉุณ ุฑูุฌ (1-4)
   double initialSlDistance;  // ูุงุตูู SL ุงููู
   double entryPrice;  // ููุช ูุฑูุฏ
   bool isPartialClosed;  // ููฺฏ ูพููโุง
   bool isRiskFree;  // ููฺฏ ุฑุณฺฉ-ูุฑ
   double rrRatio;  // ูุณุจุช RR
   double partialClosePercent;  // ุฏุฑุตุฏ ูพููโุง
   ENUM_TRAILING_MODE trailingMode;  // ุญุงูุช ุชุฑููฺฏ
   int trailingAtrPeriod;  // ุฏูุฑู ATR ุชุฑููฺฏ
   double trailingAtrMultiplier;  // ุถุฑุจ ุชุฑููฺฏ
   ENUM_TIMEFRAMES timeframe;  // ุชุงูโูุฑู
   int atrHandle;  // ููุฏู ATR
   ENUM_TIMEFRAMES trendTf;  // ุชุงูโูุฑู ููุชุฑ
   ENUM_TRADE_MANAGEMENT_STATE currentState;  // ุญุงูุช ูุนู ูุฏุฑุช
};

// ฺฉูุงุณ CActiveTradeManager ุจุฑุง ูุฏุฑุช ุชูุงู ูุนุงููุงุช ุจุงุฒ
class CActiveTradeManager
{
private:
   ManagedTrade m_managedTrades[];  // ุขุฑุงู ูุนุงููุงุช ูุฏุฑุชโุดุฏู

public:
   CActiveTradeManager() {}  // ุณุงุฒูุฏู

   // ุซุจุช ูุนุงููู ุฌุฏุฏ: ุงุถุงูู ุจู ุขุฑุงู ู ุชูุธู ุญุงูุช ุงููู
   void RegisterTrade(ulong ticket, long magicNumber, int rangeIndex, double initialSlDistance, double entryPrice, double rrRatio, double partialClosePercent,
                      ENUM_TRAILING_MODE trailingMode, int trailingAtrPeriod, double trailingAtrMultiplier, ENUM_TIMEFRAMES timeframe, int atrHandle, ENUM_TIMEFRAMES trendTf)
   {
      int size = ArraySize(m_managedTrades);  // ุงูุฏุงุฒู ูุนู ุขุฑุงู
      ArrayResize(m_managedTrades, size + 1);  // ุงูุฒุงุด ุงูุฏุงุฒู
      ManagedTrade &trade = m_managedTrades[size];  // ูุฑุฌุน ุจู ุขุฎุฑู
      trade.ticket = ticket;  // ุชูุธู ุชฺฉุช
      trade.magicNumber = magicNumber;  // ุชูุธู ูุฌฺฉ
      trade.rangeIndex = rangeIndex;  // ุชูุธู ุงูุฏฺฉุณ ุฑูุฌ
      trade.initialSlDistance = initialSlDistance;  // ุชูุธู ูุงุตูู SL
      trade.entryPrice = entryPrice;  // ุชูุธู ููุช ูุฑูุฏ
      trade.isPartialClosed = false;  // ุฑุณุช ููฺฏ ูพููโุง
      trade.isRiskFree = false;  // ุฑุณุช ููฺฏ ุฑุณฺฉ-ูุฑ
      trade.rrRatio = rrRatio;  // ุชูุธู RR
      trade.partialClosePercent = partialClosePercent;  // ุชูุธู ุฏุฑุตุฏ ูพููโุง
      trade.trailingMode = trailingMode;  // ุชูุธู ุญุงูุช ุชุฑููฺฏ
      trade.trailingAtrPeriod = trailingAtrPeriod;  // ุชูุธู ุฏูุฑู ATR
      trade.trailingAtrMultiplier = trailingAtrMultiplier;  // ุชูุธู ุถุฑุจ
      trade.timeframe = timeframe;  // ุชูุธู ุชุงูโูุฑู
      trade.atrHandle = atrHandle;  // ุชูุธู ููุฏู ATR
      trade.trendTf = trendTf;  // ุชูุธู ุชุงูโูุฑู ููุชุฑ
      trade.currentState = TRADE_PARTIAL_CLOSE;  // ุญุงูุช ุงููู: ูพููโุง
      CLogger::Log("ูุนุงููู ุฌุฏุฏ ุซุจุช ุดุฏ. ุชฺฉุช: " + (string)ticket + ", ุฑูุฌ: " + IntegerToString(rangeIndex));  // ูุงฺฏ ุซุจุช
   }

   // ูุฏุฑุช ุชูุงู ูุนุงููุงุช: ุญููู ุฑู ุขุฑุงูุ ฺฺฉ ุจุณุชู ุดุฏูุ ู ุงุฌุฑุง ูุงุดู ุญุงูุช ุฏุงุฎู
   void ManageAllTrades()
   {
      for(int i = ArraySize(m_managedTrades) - 1; i >= 0; i--)  // ุญููู ุงุฒ ุงูุชูุง ุจุฑุง ุญุฐู ุงูู
      {
         ManagedTrade &trade = m_managedTrades[i];  // ูุฑุฌุน ูุนุงููู
         if(!PositionSelectByTicket(trade.ticket))  // ฺฺฉ ุจุงุฒ ุจูุฏู
         {
            CLogger::Log("ูุนุงููู ุจุง ุชฺฉุช " + (string)trade.ticket + " ุจุณุชู ุดุฏู. ุญุฐู ุงุฒ ูุณุช.", trade.rangeIndex);  // ูุงฺฏ ุจุณุชู ุดุฏู
            ArrayRemove(m_managedTrades, i, 1);  // ุญุฐู ุงุฒ ุขุฑุงู
            g_ranges[trade.rangeIndex - 1].SetCurrentState(RANGE_IDLE);  // ุงุทูุงุน ุจู ุฑูุฌ ูุฑุจูุทู
            continue;  // ูพุฑุด
         }

         // ูุงฺฏ ูุฑูุฏ ุจู ูุฏุฑุช ูุนุงููู
         CLogger::Log("------ ูุฏุฑุช ูุนุงููู ุชฺฉุช " + (string)trade.ticket + " ุฏุฑ ุญุงูุช " + EnumToString(trade.currentState) + " ------", trade.rangeIndex);  // ุนููุงู ุญุงูุช ูุฏุฑุช

         switch(trade.currentState)  // ูุงุดู ุญุงูุช ุฏุงุฎู
         {
            case TRADE_PARTIAL_CLOSE:  // ูุฑุญูู ูพููโุง
               double currentPrice = PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY ? SymbolInfoDouble(_Symbol, SYMBOL_BID) : SymbolInfoDouble(_Symbol, SYMBOL_ASK);  // ููุช ูุนู
               double currentProfit = (PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY ? (currentPrice - trade.entryPrice) : (trade.entryPrice - currentPrice));  // ุณูุฏ ููุช
               double targetProfit = trade.initialSlDistance * trade.rrRatio;  // ูุฏู ุณูุฏ
               if(currentProfit >= targetProfit)  // ฺฺฉ ุฑุณุฏู
               {
                  double volume = PositionGetDouble(POSITION_VOLUME);  // ุญุฌู ูุนู
                  double closeVolume = MathFloor((volume * trade.partialClosePercent / 100.0) / g_volumeStep) * g_volumeStep;  // ุญุฌู ูพููโุง
                  if(closeVolume >= g_volumeMin && closeVolume < volume)  // ฺฺฉ ูุนุชุจุฑ
                  {
                     if(CTradeManager::PartialClose(trade.ticket, closeVolume))  // ุจุณุชู ูพููโุง
                     {
                        trade.isPartialClosed = true;  // ุชูุธู ููฺฏ
                        trade.currentState = TRADE_RISK_FREE;  // ุงูุชูุงู ุจู ุฑุณฺฉ-ูุฑ
                        CLogger::Log("ุฎุฑูุฌ ูพููโุง ุงูุฌุงู ุดุฏ. ุงูุชูุงู ุจู RISK_FREE.", trade.rangeIndex);  // ูุงฺฏ ุงูุชูุงู
                     }
                  }
               }
               break;
            case TRADE_RISK_FREE:  // ูุฑุญูู ุฑุณฺฉ-ูุฑ
               if(!trade.isRiskFree)  // ฺฺฉ ููฺฏ
               {
                  double breakEvenBuffer = _Point * 3;  // ุจุงูุฑ
                  double newSL = (PositionGetInteger(POSITION_TYPE) == POSITION_TYPE_BUY) ? trade.entryPrice + breakEvenBuffer : trade.entryPrice - breakEvenBuffer;  // SL ุฌุฏุฏ
                  if(CTradeManager::MoveSLToBreakEven(trade.ticket, newSL))  // ุงูุชูุงู
                  {
                     trade.isRiskFree = true;  // ุชูุธู ููฺฏ
                     trade.currentState = TRADE_TRAILING;  // ุงูุชูุงู ุจู ุชุฑููฺฏ
                     CLogger::Log("ุฑุณฺฉ-ูุฑ ุงูุฌุงู ุดุฏ. ุงูุชูุงู ุจู TRAILING.", trade.rangeIndex);  // ูุงฺฏ ุงูุชูุงู
                  }
               }
               break;
            case TRADE_TRAILING:  // ูุฑุญูู ุชุฑููฺฏ
               CTradeManager::TrailingStop(trade.ticket, trade.trailingMode, trade.trailingAtrPeriod, trade.trailingAtrMultiplier, trade.timeframe, trade.atrHandle, trade.trendTf);  // ุชุฑููฺฏ
               break;
         }
      }
   }

   // ุจุณุชู ฺฉุงูู ูุนุงููู: ูุฑุงุฎูุงู ุงุฒ HardCleanup
   bool ClosePosition(ulong ticket)
   {
      return CTradeManager::ClosePosition(ticket);  // ุงุณุชูุงุฏู ุงุฒ TradeManager ุจุฑุง ุจุณุชู
   }

   // ุชูุธู ููฺฏ ูพููโุง ุจุฑุง ุจุงุฒุงุจ
   void SetPartialClosedFlag(ulong ticket, bool value)
   {
      for(int i = 0; i < ArraySize(m_managedTrades); i++)
      {
         if(m_managedTrades[i].ticket == ticket)
         {
            m_managedTrades[i].isPartialClosed = value;  // ุชูุธู ููฺฏ
            break;
         }
      }
   }
};

// ููุฏุงุฑุฏู ุงููู ูุชุบุฑ ุงุณุชุงุชฺฉ
string CLogger::m_lastMessage = "";  // ุงููู ุจุฑุง ูุงฺฏ

#endif
```

```mql5
//+------------------------------------------------------------------+
//|                                                     RiskManager.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ุงู ูุงู ฺฉูุงุณ CRiskManager ุฑุง ุชุนุฑู ูโฺฉูุฏ ฺฉู ูุญุงุณุจู ุฑุณฺฉ ู ุญุฌู ุฑุง ูุฏุฑุช ูโฺฉูุฏ.
// ุงุณุชุฑุงุชฺ ฺฉู ุงฺฉุณูพุฑุช: ุฑุณฺฉ ูุฑ ูุนุงููู ุจุฑ ุงุณุงุณ ุฏุฑุตุฏ ููุฌูุฏ ุญุณุงุจ ู ูุงุตูู SL ูุญุงุณุจู ูโุดูุฏ ุชุง ุฒุงู ูุญุฏูุฏ ุดูุฏ. 
// ุงู ฺฉูุงุณ ุญุฌู ุฑุง ุทูุฑ ุชุนู ูโฺฉูุฏ ฺฉู ุฒุงู SL ุจุฑุงุจุฑ ุฏุฑุตุฏ ุฑุณฺฉ ุจุงุดุฏุ ูุณุชูู ุงุฒ ููุน ููุงุฏ (ูุงุฑฺฉุณุ ุดุงุฎุตุ JPY).
// ููุทู ูุงู RiskManager.mqh: ูุชุฏ ุงุณุชุงุชฺฉ CalculateLotSize ูุงุตูู SL (ููุช ูุงูุน) ุฑุง ูโฺฏุฑุฏุ 
// ุฑุณฺฉ ุจู ุงุฒุง ูุฑ ูุงุช ุฑุง ุจุง ูุฑููู slDistance * (g_tickValue / g_tickSize) ูุญุงุณุจู ูโฺฉูุฏ 
// (ุจุฑุง ุณุงุฒฺฏุงุฑ ุจุง ููุงุฏูุง ูุฎุชูู)ุ ุญุฌู ุฑุง ุจุฑ ุงุณุงุณ ุฑุณฺฉ ูุทููุจ ุชุนู ูโฺฉูุฏ ู ุจู ฺฏุงู ุญุฌู ุฑุงูุฏ ูโฺฉูุฏ. 
// ฺฺฉโูุง ููุฏ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุญุฌู ูุงูุนุชุจุฑ ุงุถุงูู ุดุฏู. 
// ุงู ูุงู ุชูุณุท CRange ุจุฑุง ูุญุงุณุจู ุญุฌู ุฏุฑ ExecuteTrade ูุฑุงุฎูุงู ูโุดูุฏ. 
// ุชุบุฑุงุช: ูฺ ุชุบุฑ ูุงุฒู ูุจูุฏุ ุงูุง ฺฉุงููุชโูุง ุจูโุฑูุฒุฑุณุงู ุดุฏ.
// ุชุบุฑุงุช ูุณุฎู 2.10: ุฌุงฺฏุฒู Print ุจุง CLogger::Logุ ฺฉุงููุชโฺฏุฐุงุฑ ุฏูู. ูฺ ุชุบุฑ ุงุนูุงู ูุดุฏู ุฒุฑุง ุจูููพุฑูุช ุชุบุฑ ูุดุฎุต ูฺฉุฑุฏู.

#ifndef RISK_MANAGER_MQH  // ฺฺฉ
#define RISK_MANAGER_MQH  // ุชุนุฑู

extern double g_tickValue;  // ุงุฑุฒุด ุชฺฉ ุฎุงุฑุฌ (ุงุฒ Elemento ฺฉุดโุดุฏู)
extern double g_tickSize;  // ุงูุฏุงุฒู ุชฺฉ ุฎุงุฑุฌ
extern double g_volumeStep;  // ฺฏุงู ุญุฌู ุฎุงุฑุฌ
extern double g_volumeMin;  // ุญุฏุงูู ุญุฌู ุฎุงุฑุฌ
extern double g_volumeMax;  // ุญุฏุงฺฉุซุฑ ุญุฌู ุฎุงุฑุฌ

// ฺฉูุงุณ CRiskManager ุจุฑุง ูุญุงุณุจู ุญุฌู ูุนุงููุงุช ุจุฑ ุงุณุงุณ ุฑุณฺฉ
// ูุชุฏ ุงุณุชุงุชฺฉ ุจุฑุง ุณุงุฏฺฏ
class CRiskManager  // ฺฉูุงุณ ุฑุณฺฉ
{
public:
   // ูุญุงุณุจู ุญุฌู: ุจุฑ ุงุณุงุณ ุฏุฑุตุฏ ุฑุณฺฉ ู ูุงุตูู SLุ ุจุง ูุฑููู ุณุงุฒฺฏุงุฑ ุจุฑุง ุชูุงู ููุงุฏูุง
   static double CalculateLotSize(double riskPercent, double slDistance)  // ูุญุงุณุจู ูุงุช ุจุง ุฑุณฺฉ ู ูุงุตูู SL
   {
      if(g_tickValue == 0 || g_tickSize == 0)  // ฺฺฉ ููุงุฏุฑ ฺฉุด ูุนุชุจุฑ
      {
         CLogger::Log("ุฎุทุง: tickValue ุง tickSize ุตูุฑ ุงุณุช. ูุญุงุณุจู ุญุฌู ููฺฉู ูุณุช.");  // ฺุงูพ ุฎุทุง
         return 0;  // ุจุงุฒฺฏุดุช ุตูุฑ
      }

      // ุงฺฏุฑ g_tickSize ุตูุฑ ุจุงุดุฏ (ูุงุฏุฑ)ุ default ุจู _Point ุจุฑุง ุณุงุฒฺฏุงุฑ
      if(g_tickSize == 0) g_tickSize = _Point;  // ุชูุธู ูพุดโูุฑุถ ุงูุฏุงุฒู ุชฺฉ

      double accountBalance = AccountInfoDouble(ACCOUNT_BALANCE);  // ููุฌูุฏ ุญุณุงุจ
      double riskPerLot = slDistance * (g_tickValue / g_tickSize);  // ุฑุณฺฉ ุจู ุงุฒุง ูุฑ ูุงุช

      if (riskPerLot <= 0)  // ฺฺฉ ุฑุณฺฉ ูุนุชุจุฑ
      {
          CLogger::Log("ุฎุทุง: ุฑุณฺฉ ุจู ุงุฒุง ูุฑ ูุงุช ูุงูุนุชุจุฑ ุงุณุช. slDistance=" + DoubleToString(slDistance, _Digits));  // ฺุงูพ ุฎุทุง
          return 0;  // ุจุงุฒฺฏุดุช ุตูุฑ
      }

      double riskAmount = riskPercent / 100.0 * accountBalance;  // ููุฏุงุฑ ุฑุณฺฉ ูุทูู
      double lotSize = riskAmount / riskPerLot;  // ุญุฌู ุงููู

      lotSize = MathRound(lotSize / g_volumeStep) * g_volumeStep;  // ุฑุงูุฏ ุจู ฺฏุงู ุญุฌู
      lotSize = MathMax(g_volumeMin, MathMin(g_volumeMax, lotSize));  // ูุญุฏูุฏ ุจู min/max

      if(lotSize < g_volumeMin)  // ฺฺฉ ฺฉูุชุฑ ุงุฒ ุญุฏุงูู
      {
         CLogger::Log("ุฎุทุง: ุญุฌู ูุญุงุณุจู ุดุฏู (" + DoubleToString(lotSize, 2) + ") ฺฉูุชุฑ ุงุฒ ุญุฏุงูู (" + DoubleToString(g_volumeMin, 2) + ") ุงุณุช.");  // ฺุงูพ ุฎุทุง
         return 0;  // ุจุงุฒฺฏุดุช ุตูุฑ
      }

      if(InpDebugMode) CLogger::Log("ุญุฌู ูุญุงุณุจู ุดุฏู: " + DoubleToString(lotSize, 2) + ", slDistance=" + DoubleToString(slDistance, _Digits) + ", riskPerLot=" + DoubleToString(riskPerLot, 2));  // ฺุงูพ ุฏุจุงฺฏ
      return lotSize;  // ุจุงุฒฺฏุดุช ุญุฌู
   }
};

#endif  // ูพุงุงู
```

```mql5
//+------------------------------------------------------------------+
//|                                                     TimeHelper.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ุงู ูุงู ฺฉูุงุณ CTimeHelper ุฑุง ุชุนุฑู ูโฺฉูุฏ ฺฉู ูุญุงุณุจุงุช ุฒูุงู ุฑุง ูุฏุฑุช ูโฺฉูุฏ.
// ุงุณุชุฑุงุชฺ ฺฉู ุงฺฉุณูพุฑุช: ุฒูุงูโูุง ุฑูุฌ ู ูพุงฺฉุณุงุฒ ุจุฑ ุงุณุงุณ ุณุงุนุงุช ูุญู ุณุฑูุฑ ูุญุงุณุจู ูโุดูุฏ ุชุง ุฑูุฌโูุง ุฏููุงู ุฏุฑ ุจุงุฒูโูุง ุชุนุฑูโุดุฏู ุนูู ฺฉููุฏ ู ูพุณ ุงุฒ ุงููุถุง ูพุงฺฉ ุดููุฏ.
// ููุทู ูุงู TimeHelper.mqh: ูุชุฏูุง ุงุณุชุงุชฺฉ CalculateRangeTimes ุฒูุงู ุดุฑูุน/ูพุงุงู ุฑูุฌ ุฑุง ูุญุงุณุจู ูโฺฉูุฏ 
// (ุจุง ูุฏุฑุช ุฑูุฌโูุง ุดุจุงูู ู ุชูุธู ุจุฑ ุงุณุงุณ ุฑูุฒ ูุนู)ุ 
// ู CalculateCleanupTime ุฒูุงู ุงููุถุง ุฑุง ุจุฑ ุงุณุงุณ ุณุงุนุชโูุง ูพุงฺฉุณุงุฒ ุงุถุงูู ูโฺฉูุฏ. 
// ุงู ูุงู ุชูุณุท CRange ุจุฑุง ุชุนู ุฒูุงูโูุง ุงุณุชูุงุฏู ูโุดูุฏ ู ูุงุจุณุชฺฏ ุจู TimeCurrent ุฏุงุฑุฏ. 
// ุชุบุฑุงุช ุฌุฏุฏ ุฏุฑ ูุณุฎู 2.10: ุงุตูุงุญ CalculateRangeTimes ุจุฑุง ูุฏุฑุช DST ุจุง GMT offset ู ุญููู ุจุฑุง ุฑูุฒ ูุนุงููุงุช ูุจูุ 
// ุงุตูุงุญ CalculateCleanupTime ุจุฑุง ูพุฐุฑุด datetime rangeEndTime ู ูุญุงุณุจู ุณุงุฏู cleanupTime = rangeEndTime + cleanupHours * 3600 
// ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุจุงฺฏ ูุญุงุณุจู ุฏุฑ ุฑูุฌโูุง ุดุจุงูู.
// ุชุบุฑุงุช ูุณุฎู 2.10: ฺฉุงููุชโฺฏุฐุงุฑ ุฏููุ ุจุฏูู Print (ุงุณุชุงุชฺฉ).

#ifndef TIME_HELPER_MQH  // ฺฺฉ
#define TIME_HELPER_MQH  // ุชุนุฑู

// ฺฉูุงุณ CTimeHelper ุจุฑุง ูุญุงุณุจุงุช ุฒูุงู ุฑูุฌ ู ูพุงฺฉุณุงุฒ
// ูุชุฏูุง ุงุณุชุงุชฺฉ ุจุฑุง ุณุงุฏฺฏ
class CTimeHelper  // ฺฉูุงุณ ุฒูุงู
{
public:
   // ูุญุงุณุจู ุฒูุงู ุดุฑูุน ู ูพุงุงู ุฑูุฌ: ุชูุธู ุจุฑ ุงุณุงุณ ุฑูุฒ ูุนู ู ูุฏุฑุช ุฑูุฌโูุง ุนุจูุฑ ุงุฒ ูููโุดุจ
   // TimeToStruct ุฒูุงู ุฑุง ุจู ุณุงุฎุชุงุฑ ุชุจุฏู ูโฺฉูุฏ
   static bool CalculateRangeTimes(int startHour, int startMinute, int endHour, int endMinute, datetime &startTime, datetime &endTime)  // ูุญุงุณุจู ุฒูุงู ุฑูุฌ
   {
      long server_gmt_offset = SymbolInfoInteger(_Symbol, SYMBOL_TIME_BIAS);  // ฺฏุฑูุชู ุงูุณุช GMT ุณุฑูุฑ (ุจุฑุง DST)
      datetime gmt_now = TimeGMT();  // ุฒูุงู GMT ูุนู
      MqlDateTime dt_gmt;  // ุณุงุฎุชุงุฑ ุฒูุงู GMT
      TimeToStruct(gmt_now, dt_gmt);  // ุชุจุฏู ุจู ุณุงุฎุชุงุฑ

      datetime gmt_today_start = gmt_now - (dt_gmt.hour * 3600 + dt_gmt.min * 60 + dt_gmt.sec);  // ุดุฑูุน ุฑูุฒ GMT

      datetime gmt_start_time = gmt_today_start + startHour * 3600 + startMinute * 60;  // ุฒูุงู ุดุฑูุน GMT
      datetime gmt_end_time = gmt_today_start + endHour * 3600 + endMinute * 60;  // ุฒูุงู ูพุงุงู GMT

      if(gmt_end_time <= gmt_start_time)  // ฺฺฉ ุฑูุฌ ุดุจุงูู
      {
         gmt_end_time += 86400;  // ุงุถุงูู ุฑูุฒ
      }

      // ุญููู ููุดููุฏ ุจุฑุง ูพุฏุง ฺฉุฑุฏู ุขุฎุฑู ุฑูุฒ ูุนุงููุงุช (ุจุฑุง ุขุฎุฑ ููุชูโูุง ู ฺฉุฑูพุชู)
      while(gmt_now < gmt_start_time)  // ฺฺฉ ุฒูุงู ูุนู ูุจู ุงุฒ ุดุฑูุน
      {
         gmt_start_time -= 86400;  // ุนูุจ ุจุฑุฏู ุจู ุฑูุฒ ูุจู
         gmt_end_time -= 86400;  // ุนูุจ ุจุฑุฏู ูพุงุงู

         MqlDateTime check_day_dt;  // ุณุงุฎุชุงุฑ ุฑูุฒ ฺฺฉ
         TimeToStruct(gmt_start_time, check_day_dt);  // ุชุจุฏู
         datetime session_from, session_to;  // ุฒูุงู ุฌูุณู

         // ุงฺฏุฑ ุงู ุฑูุฒ ุฌูุณู ูุนุงููุงุช ูุฏุงุฑุฏ (ูุซู ุดูุจู ุจุฑุง ูุงุฑฺฉุณ)ุ ฺฉ ุฑูุฒ ุฏฺฏุฑ ุนูุจ ุจุฑู
         if(!SymbolInfoSessionTrade(_Symbol, (ENUM_DAY_OF_WEEK)check_day_dt.day_of_week, 0, session_from, session_to))  // ฺฺฉ ุฌูุณู
         {
            CLogger::Log("ุฑูุฒ ุบุฑ ูุนุงููุงุช ุดูุงุณุง ุดุฏ: " + TimeToString(gmt_start_time, TIME_DATE) + ". ุจุฑุฑุณ ุฑูุฒ ูุจู...", 0);  // ฺุงูพ ุฏุจุงฺฏ
            continue;  // ูพุฑุด
         }
         break;  // ุฑูุฒ ูุนุงููุงุช ูพุฏุง ุดุฏ
      }

      startTime = gmt_start_time + server_gmt_offset;  // ุชูุธู ุฒูุงู ูุญู ุดุฑูุน
      endTime = gmt_end_time + server_gmt_offset;  // ุชูุธู ุฒูุงู ูุญู ูพุงุงู

      if(InpDebugMode) CLogger::Log("ูุญุงุณุจู ุฒูุงู ุฑูุฌ (GMT Aware): Start=" + TimeToString(startTime) + ", End=" + TimeToString(endTime));  // ฺุงูพ ุฏุจุงฺฏ
      return true;  // ุจุงุฒฺฏุดุช ููููุช
   }

   // ูุญุงุณุจู ุฒูุงู ูพุงฺฉุณุงุฒ: ุงุถุงูู ฺฉุฑุฏู ุณุงุนุชโูุง ูพุงฺฉุณุงุฒ ุจู ุฒูุงู ูพุงุงู ุจุฑุง ุงููุถุง (ูุณุฎู ุงุตูุงุญ ุดุฏู)
   // ูุญุงุณุจู ุณุงุฏู ุจุฑุง ุฏูุช
   static datetime CalculateCleanupTime(datetime rangeEndTime, int cleanupHours)  // ูุญุงุณุจู ุฒูุงู ูพุงฺฉุณุงุฒ
   {
      datetime cleanupTime = rangeEndTime + cleanupHours * 3600;  // ุจู ููู ุณุงุฏฺฏ!
      if(InpDebugMode) CLogger::Log("ุฒูุงู ูพุงฺฉุณุงุฒ ูุญุงุณุจู ุดุฏ: " + TimeToString(cleanupTime));  // ฺุงูพ ุฏุจุงฺฏ
      return cleanupTime;  // ุจุงุฒฺฏุดุช ุฒูุงู
   }
};

#endif  // ูพุงุงู
```

```mql5
//+------------------------------------------------------------------+
//|                                                     TrendFilter.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ุงู ูุงู ฺฉูุงุณ CTrendFilter ุฑุง ุชุนุฑู ูโฺฉูุฏ ฺฉู ููุชุฑ ุฑููุฏ ุจุฑ ุงุณุงุณ ุงฺููฺฉู ุฑุง ูุฏุฑุช ูโฺฉูุฏ.
// ุงุณุชุฑุงุชฺ ฺฉู ุงฺฉุณูพุฑุช: ููุชุฑ ุฑููุฏ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุนุงููุงุช ุฎูุงู ุฌูุช ุงุณุชูุงุฏู ูโุดูุฏุ 
// ุงฺฏุฑ ุงุจุฑ ุงฺููฺฉู ููุช (ุฎูุซ) ุง ููโุฌูุช ุจุงุดุฏุ ูุนุงููู ูุฌุงุฒ ุงุณุชุ ะธะฝะฐัะต ุฑุฏ ูโุดูุฏ.
// ููุทู ูุงู TrendFilter.mqh: enum ENUM_TREND_DIRECTION ุจุฑุง ุฎุฑูุฌ (BUY/SELL/NEUTRAL). 
// ุชุงุจุน GetTrendDirection ุณูฺฉู A/B ุฑุง ุจู ุทูุฑ ุฏุณุช ูุญุงุณุจู ูโฺฉูุฏ 
// (ุจุง ุงุณุชูุงุฏู ุงุฒ iHigh/iLow ุจุฑุง ุฏูุฑูโูุง ุชูฺฉุงูุ ฺฉุฌูู ู ุณูฺฉู B)ุ 
// ุชูุงูุช ุฑุง ฺฺฉ ูโฺฉูุฏ (ุงฺฏุฑ ฺฉูุชุฑ ุงุฒ ุขุณุชุงููุ ุฎูุซ)ุ 
// ู ุฌูุช ุฑุง ุชุนู ูโฺฉูุฏ (A > B ุจุฑุง BUY). 
// ุงู ูุญุงุณุจู ุฏุณุช ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุดฺฉูุงุช ุฏุณุชุฑุณ ุจู ฺฉูุฏูโูุง ุขูุฏู ุฏุฑ MT5 ุงูุฌุงู ูโุดูุฏ. 
// Init/Deinit ุฎุงู ูุณุชูุฏ ุฒุฑุง ูฺ ููุฏู ุซุงุจุช ูุณุช. 
// ุงู ูุงู ุชูุณุท CRange ุจุฑุง ุชุฃุฏ ููุชุฑ ูุณุชูู ูุฑุงุฎูุงู ูโุดูุฏ. 
// ุชุบุฑุงุช ุฌุฏุฏ: ุงุถุงูู ุชุงุจุน GetSenkouSpanB ุจุฑุง ุจุงุฒฺฏุดุช ููุฏุงุฑ Senkou Span B ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ ุชุฑููฺฏ.
// ุชุบุฑุงุช ูุณุฎู 2.10: ุฌุงฺฏุฒู Print ุจุง CLogger::Logุ ฺฉุงููุชโฺฏุฐุงุฑ ุฏูู. ูฺ ุชุบุฑ ุงุนูุงู ูุดุฏู ุฒุฑุง ุจูููพุฑูุช ุชุบุฑ ูุดุฎุต ูฺฉุฑุฏู.

#ifndef TREND_FILTER_MQH  // ฺฺฉ
#define TREND_FILTER_MQH  // ุชุนุฑู

// ุชุนุฑู enum ุจุฑุง ุฌูุช ุฑููุฏ (ุจุฑุง ุชุตููโฺฏุฑ ุฏุฑ ููุชุฑ)
// ุงู enum ุฎุฑูุฌ ููุชุฑ ุฑุง ุงุณุชุงูุฏุงุฑุฏ ูโฺฉูุฏ
enum ENUM_TREND_DIRECTION
{
   TREND_BUY,     // ุฑููุฏ ุตุนูุฏ (ุณูฺฉู A ุจุงูุง B) - ุฌูุช ุฎุฑุฏ ูุฌุงุฒ
   TREND_SELL,    // ุฑููุฏ ูุฒูู (ุณูฺฉู A ูพุงู B) - ุฌูุช ูุฑูุด ูุฌุงุฒ
   TREND_NEUTRAL  // ุฑููุฏ ุฎูุซ (ุงุจุฑ ููุช ุง ููุชุฑ ุฎุงููุด) - ูุฑ ุฌูุช ูุฌุงุฒ
};

// ฺฉูุงุณ CTrendFilter ุจุฑุง ููุชุฑ ุฑููุฏ ูพูุง ุจุฑ ุงุณุงุณ ุงฺููฺฉู
// ูุญุงุณุจุงุช ุฏุณุช ุจุฏูู ููุฏู
class CTrendFilter  // ฺฉูุงุณ ููุชุฑ ุฑููุฏ
{
public:
   CTrendFilter() {}  // ุณุงุฒูุฏู ูพุดโูุฑุถ - ูฺ ููุฏุงุฑ ุงููู ูุฏุงุฑุฏ

   // Init ุฎุงู (ูฺ ููุฏู ุซุงุจุช ุณุงุฎุชู ููโุดูุฏุ ูุญุงุณุจู ุฏุณุช ุฏุฑ GetTrendDirection)
   bool Init() { return true; }  // ููุฏุงุฑุฏู - ููุดู ููููุช

   // Deinit ุฎุงู (ูฺ ููุจุน ุซุงุจุช ุจุฑุง ุขุฒุงุฏุณุงุฒ ูุณุช)
   void Deinit() {}  // ุฏูุน - ูฺ ุนูู

   // ฺฏุฑูุชู ุฌูุช ุฑููุฏ: ูุญุงุณุจู ุฏุณุช ุณูฺฉู A/B ุจุฑ ุงุณุงุณ ุฏุงุฏูโูุง ฺฏุฐุดุชู (ุจุฑุง ุงุจุฑ ุขูุฏู ุจุฏูู ูุงุฒ ุจู ฺฉูุฏู ุขูุฏู)
   // iHighest/iLowest ุงูุฏฺฉุณโูุง ุฑุง ูพุฏุง ูโฺฉููุฏ
   ENUM_TREND_DIRECTION GetTrendDirection(ENUM_TIMEFRAMES timeframe)  // ฺฏุฑูุชู ุฌูุช ุจุง ุชุงูโูุฑู
   {
      if(!Inp_IchimokuFilter_Enabled)  // ฺฺฉ ููุชุฑ ุฎุงููุด
      {
         return TREND_NEUTRAL;  // ุงฺฏุฑ ููุชุฑ ุฎุงููุด ุจุงุดุฏุ ููุดู ุฎูุซ ูุฑุถ ูโุดูุฏ
      }

      // ูุญุงุณุจู ุชูฺฉุงู-ุณู (ุจุฑุง ฺฉูุฏู ุจุณุชู ุขุฎุฑุ shift 1)
      int tenkanHighIdx = iHighest(_Symbol, timeframe, MODE_HIGH, Inp_Ichimoku_Tenkan, 1);  // ุงูุฏฺฉุณ ุณูู ุชูฺฉุงู
      int tenkanLowIdx = iLowest(_Symbol, timeframe, MODE_LOW, Inp_Ichimoku_Tenkan, 1);  // ุงูุฏฺฉุณ ฺฉู ุชูฺฉุงู
      double tenkanHigh = iHigh(_Symbol, timeframe, tenkanHighIdx);  // ูุง ุชูฺฉุงู
      double tenkanLow = iLow(_Symbol, timeframe, tenkanLowIdx);  // ูู ุชูฺฉุงู
      double tenkan = (tenkanHigh + tenkanLow) / 2.0;  // ุชูฺฉุงู-ุณู

      // ูุญุงุณุจู ฺฉุฌูู-ุณู
      int kijunHighIdx = iHighest(_Symbol, timeframe, MODE_HIGH, Inp_Ichimoku_Kijun, 1);  // ุงูุฏฺฉุณ ุณูู ฺฉุฌูู
      int kijunLowIdx = iLowest(_Symbol, timeframe, MODE_LOW, Inp_Ichimoku_Kijun, 1);  // ุงูุฏฺฉุณ ฺฉู ฺฉุฌูู
      double kijunHigh = iHigh(_Symbol, timeframe, kijunHighIdx);  // ูุง ฺฉุฌูู
      double kijunLow = iLow(_Symbol, timeframe, kijunLowIdx);  // ูู ฺฉุฌูู
      double kijun = (kijunHigh + kijunLow) / 2.0;  // ฺฉุฌูู-ุณู

      // ูุญุงุณุจู ุณูฺฉู ุงุณูพู A (ุจุฑุง ุงุจุฑ ุขูุฏู)
      double senkouA = (tenkan + kijun) / 2.0;  // ุณูฺฉู A

      // ูุญุงุณุจู ุณูฺฉู ุงุณูพู B (ุจุฑุง ุงุจุฑ ุขูุฏู)
      int senkouBHighIdx = iHighest(_Symbol, timeframe, MODE_HIGH, Inp_Ichimoku_SenkouB, 1);  // ุงูุฏฺฉุณ ุณูู ุณูฺฉู B
      int senkouBLowIdx = iLowest(_Symbol, timeframe, MODE_LOW, Inp_Ichimoku_SenkouB, 1);  // ุงูุฏฺฉุณ ฺฉู ุณูฺฉู B
      double senkouBHigh = iHigh(_Symbol, timeframe, senkouBHighIdx);  // ูุง ุณูฺฉู B
      double senkouBLow = iLow(_Symbol, timeframe, senkouBLowIdx);  // ูู ุณูฺฉู B
      double senkouB = (senkouBHigh + senkouBLow) / 2.0;  // ุณูฺฉู B

      double diff = MathAbs(senkouA - senkouB) / _Point;  // ุชูุงูุช ุจู ูพููุช
      if(diff < Inp_Ichimoku_FlatThreshold_Points)  // ฺฺฉ ููุช ุจูุฏู
      {
         if(InpDebugMode) CLogger::Log("ุงุจุฑ ุงฺููฺฉู ููุช ุงุณุช. ุฌูุช: NEUTRAL");  // ฺุงูพ ุฏุจุงฺฏ
         return TREND_NEUTRAL;  // ุจุงุฒฺฏุดุช ุฎูุซ
      }

      if(senkouA > senkouB)  // ฺฺฉ ุตุนูุฏ
      {
         if(InpDebugMode) CLogger::Log("ุฌูุช ุฑููุฏ: BUY");  // ฺุงูพ ุฏุจุงฺฏ
         return TREND_BUY;  // ุจุงุฒฺฏุดุช ุฎุฑุฏ
      }
      else  // ฺฺฉ ูุฒูู
      {
         if(InpDebugMode) CLogger::Log("ุฌูุช ุฑููุฏ: SELL");  // ฺุงูพ ุฏุจุงฺฏ
         return TREND_SELL;  // ุจุงุฒฺฏุดุช ูุฑูุด
      }
   }

   // (ุฌุฏุฏ) ฺฏุฑูุชู Senkou Span B: ูุญุงุณุจู ุฏุณุช ู ุจุงุฒฺฏุดุช ููุฏุงุฑ ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ ุชุฑููฺฏ
   // ูุดุงุจู ูุญุงุณุจู ุฏุฑ GetTrendDirection
   double GetSenkouSpanB(ENUM_TIMEFRAMES timeframe)  // ฺฏุฑูุชู Senkou B ุจุง ุชุงูโูุฑู
   {
      // ูุญุงุณุจู ุณูฺฉู ุงุณูพู B (ุจุฑุง ุงุจุฑ ุขูุฏู)
      int senkouBHighIdx = iHighest(_Symbol, timeframe, MODE_HIGH, Inp_Ichimoku_SenkouB, 1);  // ุงูุฏฺฉุณ ุณูู ุณูฺฉู B
      int senkouBLowIdx = iLowest(_Symbol, timeframe, MODE_LOW, Inp_Ichimoku_SenkouB, 1);  // ุงูุฏฺฉุณ ฺฉู ุณูฺฉู B
      double senkouBHigh = iHigh(_Symbol, timeframe, senkouBHighIdx);  // ูุง ุณูฺฉู B
      double senkouBLow = iLow(_Symbol, timeframe, senkouBLowIdx);  // ูู ุณูฺฉู B
      double senkouB = (senkouBHigh + senkouBLow) / 2.0;  // ูุญุงุณุจู Senkou B

      if(senkouB == 0)  // ฺฺฉ ููุฏุงุฑ ูุนุชุจุฑ (ุจุฑุง ุงูู)
      {
         if(InpDebugMode) CLogger::Log("ุฎุทุง ุฏุฑ ูุญุงุณุจู Senkou Span B.");  // ฺุงูพ ุฎุทุง
      }
      return senkouB;  // ุจุงุฒฺฏุดุช ููุฏุงุฑ
   }
};

#endif  // ูพุงุงู
```

```mql5
//+------------------------------------------------------------------+
//|                                                   VisualManager.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ุงู ูุงู ฺฉูุงุณ CVisualManager ุฑุง ุชุนุฑู ูโฺฉูุฏ ฺฉู ููุงุด ุจุตุฑ ุฑู ฺุงุฑุช ุฑุง ูุฏุฑุช ูโฺฉูุฏ.
// ุงุณุชุฑุงุชฺ ฺฉู ุงฺฉุณูพุฑุช: ููุงุด ูุถุนุช ุฑููุฏ (Bullish/Bearish/Neutral) ุจุฑุง ูุฑ ุฑูุฌ ูุนุงู ุจู ุทูุฑ ุฌุฏุงฺฏุงูู 
// ุจุฑุง ฺฉูฺฉ ุจู ฺฉุงุฑุจุฑ ุฏุฑ ูุธุงุฑุชุ ุจุฏูู ุชุฃุซุฑ ุจุฑ ููุทู ูุนุงููุงุช.
// ููุทู ูุงู VisualManager.mqh: ฺฉูุงุณ ุดุก LABEL ุฑุง ุจุฑุง ููุงุด ูุชู ฺฉุงูู ูุถุนุช ูุฑ ุฑูุฌ ุงุฌุงุฏ ูโฺฉูุฏุ 
// ูููุนุชุ ูููุช ุฑุง ุชูุธู ูโฺฉูุฏ. 
// ุชุงุจุน UpdateTrendStatus ูุชู ฺูุฏุฎุท ุฑุง ุจูโุฑูุฒุฑุณุงู ู ฺุงุฑุช ุฑุง redraw ูโฺฉูุฏ. 
// Init ุดุก ุฑุง ูโุณุงุฒุฏ ู Deinit ุญุฐู ูโฺฉูุฏ. 
// ุงู ูุงู ุชูุณุท Elemento.mq5 ุจุฑุง ููุงุด ุฏุฑ OnTick ูุฑุงุฎูุงู ูโุดูุฏ ู ุงุฎุชุงุฑ ุงุณุช 
// (ุงฺฏุฑ ููุงุด ุฎุงููุด ุจุงุดุฏุ ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ). 
// ุชุบุฑุงุช ุฌุฏุฏ: ูพุดุชุจุงู ุงุฒ ูุชู ฺูุฏุฎุท ุจุฑุง ููุงุด ูุฑ ุฑูุฌ ุฌุฏุงฺฏุงูู.
// ุชุบุฑุงุช ูุณุฎู 2.10: ุฌุงฺฏุฒู Print ุจุง CLogger::Logุ ฺฉุงููุชโฺฏุฐุงุฑ ุฏูู. ูฺ ุชุบุฑ ุงุนูุงู ูุดุฏู ุฒุฑุง ุจูููพุฑูุช ุชุบุฑ ูุดุฎุต ูฺฉุฑุฏู.

#ifndef VISUAL_MANAGER_MQH  // ฺฺฉ
#define VISUAL_MANAGER_MQH  // ุชุนุฑู

// ฺฉูุงุณ CVisualManager ุจุฑุง ูุฏุฑุช ููุงุด ูุชู ุฑููุฏ ูุฑ ุฑูุฌ ุฑู ฺุงุฑุช
// OBJ_LABEL ุจุฑุง ูุชู ุงุณุชูุงุฏู ูโุดูุฏ
class CVisualManager  // ฺฉูุงุณ ููุงุด
{
private:
   string m_trendStatusObjectName;  // ูุงู ููุญุตุฑุจูโูุฑุฏ ุดุก LABEL ุจุฑุง ููุงุด - ุซุงุจุช "TrendStatus"

public:
   CVisualManager() : m_trendStatusObjectName("TrendStatus") {}  // ุณุงุฒูุฏู - ุชูุธู ูุงู ุดุก

   // ููุฏุงุฑุฏู: ุงุฌุงุฏ ุดุก LABEL ุจุง ุชูุธูุงุช ูููุชุ ุฑูฺฏ ู ูููุนุช ุงฺฏุฑ ููุงุด ูุนุงู ุจุงุดุฏ
   // ObjectCreate ุดุก ุฑุง ูโุณุงุฒุฏ
   bool Init()  // ููุฏุงุฑุฏู ูุฏุฑ ููุงุด
   {
      if(InpDebugMode) CLogger::Log("ููุฏุงุฑุฏู ูุฏุฑ ููุงุด...");  // ฺุงูพ ุฏุจุงฺฏ ุจุฑุง ุดุฑูุน
      if(Inp_Visual_ShowTrendStatus)  // ฺฺฉ ูุนุงู ุจูุฏู ููุงุด
      {
         if(!ObjectCreate(0, m_trendStatusObjectName, OBJ_LABEL, 0, 0, 0))  // ุงุฌุงุฏ LABEL
         {
            CLogger::Log("ุฎุทุง ุฏุฑ ุงุฌุงุฏ ุดุก ููุงุด ุฑููุฏ: " + IntegerToString(GetLastError()));  // ฺุงูพ ุฎุทุง
            return false;  // ุจุงุฒฺฏุดุช ุดฺฉุณุช
         }

         ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_XDISTANCE, Inp_Visual_X_Offset);  // ุชูุธู ูุงุตูู ุงูู
         ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_YDISTANCE, Inp_Visual_Y_Offset);  // ุชูุธู ูุงุตูู ุนููุฏ
         ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_CORNER, CORNER_LEFT_UPPER);  // ุชูุธู ฺฏูุดู ฺูพ ุจุงูุง
         ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_FONTSIZE, Inp_Visual_FontSize);  // ุชูุธู ุงูุฏุงุฒู ูููุช
         ObjectSetString(0, m_trendStatusObjectName, OBJPROP_FONT, "Arial");  // ุชูุธู ูููุช
         ObjectSetString(0, m_trendStatusObjectName, OBJPROP_TEXT, "Initializing...");  // ูุชู ุงููู
         ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_COLOR, Inp_Visual_FontColor_Neutral);  // ุฑูฺฏ ุฎูุซ
      }
      if(InpDebugMode) CLogger::Log("ูุฏุฑ ููุงุด ุจุง ููููุช ููุฏุงุฑุฏู ุดุฏ.");  // ฺุงูพ ููููุช
      return true;  // ุจุงุฒฺฏุดุช ููููุช
   }

   // ุฏูุน: ุญุฐู ุดุก LABEL ุจุฑุง ูพุงฺฉุณุงุฒ ฺุงุฑุช
   // ObjectDelete ุดุก ุฑุง ุญุฐู ูโฺฉูุฏ
   void Deinit()  // ุฏูุน ูุฏุฑ ููุงุด
   {
      ObjectDelete(0, m_trendStatusObjectName);  // ุญุฐู ุดุก
      if(InpDebugMode) CLogger::Log("ุดุก ููุงุด ุฑููุฏ ุญุฐู ุดุฏ.");  // ฺุงูพ ุฏุจุงฺฏ
   }

   // ุจูโุฑูุฒุฑุณุงู ููุงุด: ุชุบุฑ ูุชู ฺฉุงูู ูุถุนุช ุฑููุฏ ูุฑ ุฑูุฌ ู redraw ฺุงุฑุช
   // ChartRedraw ฺุงุฑุช ุฑุง ุจูโุฑูุฒุฑุณุงู ูโฺฉูุฏ
   void UpdateTrendStatus(string fullText)  // ุจูโุฑูุฒุฑุณุงู ูุชู ููุงุด
   {
      if(!Inp_Visual_ShowTrendStatus) return;  // ุฎุฑูุฌ ุงฺฏุฑ ููุงุด ุฎุงููุด

      ObjectSetString(0, m_trendStatusObjectName, OBJPROP_TEXT, fullText);  // ุชูุธู ูุชู ุฌุฏุฏ
      ObjectSetInteger(0, m_trendStatusObjectName, OBJPROP_COLOR, Inp_Visual_FontColor_Neutral);  // ุฑูฺฏ ุฎูุซ ุจุฑุง ูุชู ฺูุฏุฎุท
      ChartRedraw();  // redraw ฺุงุฑุช
   }
};

#endif  // ูพุงุงู
```

```mql5
//+------------------------------------------------------------------+
//|                                                        Logger.mqh |
//|                       Copyright 2025, Hipoalgorithm Team         |
//|                       https://hipoalgorithm.com                  |
//+------------------------------------------------------------------+
// ฺฉ ฺฉุชุงุจุฎุงูู ุณุงุฏู ู ุงุณุชุงุชฺฉ ุจุฑุง ูุฏุฑุช ูุงฺฏโููุณ ููุดููุฏ
// ุงู ูุงู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุงฺฏ ุชฺฉุฑุงุฑ ู ููุฒ ุทุฑุงุญ ุดุฏู ุงุณุช.
// ุชุบุฑุงุช ูุณุฎู 2.10: ูุงู ุฌุฏุฏ ุจุง CLogger ุงุณุชุงุชฺฉุ m_lastMessage ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑุ 
// ูุฑูุช ุงุณุชุงูุฏุงุฑุฏ ุจุง ูพุดููุฏ [Elemento] [Range X] >> ูพุงู. ูฺ ุชุบุฑ ุงุนูุงู ูุดุฏู ุฒุฑุง ุจูููพุฑูุช ุชุบุฑ ูุดุฎุต ูฺฉุฑุฏู.

#ifndef LOGGER_MQH  // ฺฺฉ ูุฌูุฏ
#define LOGGER_MQH  // ุชุนุฑู ูุงฺฉุฑู

// ฺฉูุงุณ CLogger ุงุณุชุงุชฺฉ ุจุฑุง ูุงฺฏ ุจุฏูู ูููููโุณุงุฒ
class CLogger  // ฺฉูุงุณ ูุงฺฏ
{
private:
   static string m_lastMessage;  // ุจุฑุง ุฐุฎุฑู ุขุฎุฑู ูพุงู ู ุฌููฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑ (ุงุณุชุงุชฺฉ ุจุฑุง ุงุดุชุฑุงฺฉ)

public:
   // ุชุงุจุน ุงุตู ูุงฺฏโููุณ
   // ุงู ุชุงุจุน ูพุงู ุฑุง ุจุง ฺฺฉ ุชฺฉุฑุงุฑ ฺุงูพ ูโฺฉูุฏ
   static void Log(string message, int rangeIndex = 0)  // ุชุงุจุน ูุงฺฏ ุจุง ูพุงู ู ุงูุฏฺฉุณ ุงุฎุชุงุฑ
   {
      // ููุท ุงฺฏุฑ ุญุงูุช ุฏุจุงฺฏ ูุนุงู ุจุงุดุฏ ูุงฺฏ ูโููุณุฏ
      if(!InpDebugMode)  // ุดุฑุท ุฏุจุงฺฏ
         return;  // ุฎุฑูุฌ ุจุฏูู ฺุงูพ
         
      // ุงฺฏุฑ ูพุงู ุฌุฏุฏ ุจุง ูพุงู ูุจู ฺฉ ุจุงุดุฏุ ุขู ุฑุง ูุงุฏุฏู ูโฺฏุฑุฏ
      if(message == m_lastMessage)  // ฺฺฉ ุชฺฉุฑุงุฑ
         return;  // ุฎุฑูุฌ

      string prefix = "[Elemento]";  // ูพุดููุฏ ฺฉู
      
      if(rangeIndex > 0)  // ุงฺฏุฑ ูุฑุจูุท ุจู ฺฉ ุฑูุฌ ุฎุงุต ุจุงุดุฏ
      {
         prefix += " [Range " + IntegerToString(rangeIndex) + "]";  // ุงุถุงูู ุงูุฏฺฉุณ
      }
      
      Print(prefix + " >> " + message);  // ฺุงูพ ูพุงู ููุง ุจุง Print (MT5 ุงุณุชุงูุฏุงุฑุฏ)
      
      m_lastMessage = message;  // ุฐุฎุฑู ูพุงู ูุนู ุจุฑุง ููุงุณู ุจุนุฏ
   }
};

// ููุฏุงุฑุฏู ุงููู ูุชุบุฑ ุงุณุชุงุชฺฉ (ุฎุงุฑุฌ ุงุฒ ฺฉูุงุณ)
string CLogger::m_lastMessage = "";  // ููุฏุงุฑุฏู ุงููู ูุชุบุฑ ุงุณุชุงุชฺฉ

#endif  // ูพุงุงู
```


